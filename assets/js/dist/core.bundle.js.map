{
  "version": 3,
  "sources": ["../src/core/utils/bind-once.js", "../src/core/gifts/state.js", "../src/core/species/api.js", "../src/core/career/api.js", "../src/core/traits/service.js", "../src/core/formBuilder/render-details.js", "../src/core/formBuilder/render-profile.js", "../src/core/formBuilder/render-skills.js", "../src/core/formBuilder/render-summary.js", "../src/core/formBuilder/form-builder.js", "../src/core/formBuilder/index.js", "../src/core/species/events.js", "../src/core/species/index.js", "../src/core/career/events.js", "../src/core/career/index.js", "../src/core/main/builder-ui.js", "../src/core/traits/events.js", "../src/core/traits/index.js", "../src/core/gifts/free-choices.js", "../src/core/gifts/index.js", "../src/core/skills/render.js", "../src/core/skills/events.js", "../src/core/skills/index.js", "../src/core/summary/utils.js", "../src/core/summary/api.js", "../src/core/summary/index.js", "../src/core/main/builder-refresh.js", "../src/core/main/builder-load.js", "../src/core/main/builder-save.js", "../src/core/main/builder-events.js", "../src/core/main/index.js", "../src/core/index.js"],
  "sourcesContent": ["// assets/js/src/core/utils/bind-once.js\nconst $ = window.jQuery;\n\n/**\n * Bind an event with a required namespace and prevent duplicate handlers.\n * Example:\n *   bindOnce(document, 'click', '#cg-open', onOpen);              // => click.cg\n *   bindOnce(document, 'change.cg', '#cg-select', onChange);      // already namespaced OK\n */\nexport default function bindOnce(root, eventName, selector, handler, ns = 'cg') {\n  if (!eventName.includes('.')) eventName = `${eventName}.${ns}`;\n  $(root).off(eventName, selector).on(eventName, selector, handler);\n}\n\n/**\n * Idempotent init helper to ensure a module binds only once.\n * Usage:\n *   const init = makeInitGuard('builder-events');\n *   export default function bindUIEvents() { if (!init()) return; ... }\n */\nexport function makeInitGuard(key) {\n  const w = window;\n  w.__CG_INITED__ = w.__CG_INITED__ || new Set();\n  return function guard() {\n    if (w.__CG_INITED__.has(key)) return false;\n    w.__CG_INITED__.add(key);\n    return true;\n  };\n}\n", "// assets/js/src/core/gifts/state.js\n//\n// Shared Gifts state used by TraitsService to look up gifts by ID.\n// IMPORTANT: FormBuilderAPI.getData() may return a COPY, so we prefer writing to _data.\n\nimport FormBuilderAPI from '../formBuilder';\n\nconst State = {\n  // currently selected free-gift IDs (strings; '' means none)\n  selected: ['', '', ''],\n\n  // master list of gift objects (must include id; may include ct_gifts_manifold, etc.)\n  gifts: [],\n\n  /**\n   * Pull any previously saved free_gifts/freeGifts from the builder\u2019s data.\n   */\n  init() {\n    const src = (FormBuilderAPI && typeof FormBuilderAPI === 'object' && FormBuilderAPI._data)\n      ? FormBuilderAPI._data\n      : (typeof FormBuilderAPI?.getData === 'function' ? FormBuilderAPI.getData() : {});\n\n    const arr =\n      Array.isArray(src.free_gifts) ? src.free_gifts :\n      Array.isArray(src.freeGifts)  ? src.freeGifts  :\n      null;\n\n    const normalized = (Array.isArray(arr) ? arr : [])\n      .slice(0, 3)\n      .map(v => (v ? String(v) : ''));\n    while (normalized.length < 3) normalized.push('');\n\n    this.selected = normalized;\n  },\n\n  /**\n   * Update one slot and persist back into FormBuilder\u2019s live _data (when available).\n   */\n  set(index, id) {\n    this.selected[index] = id ? String(id) : '';\n\n    if (FormBuilderAPI && FormBuilderAPI._data) {\n      FormBuilderAPI._data.free_gifts = this.selected.slice();\n      // optional legacy alias\n      FormBuilderAPI._data.freeGifts  = this.selected.slice();\n    }\n  },\n\n  /**\n   * Replace selected list (normalized), and persist into builder _data if present.\n   */\n  setSelected(list = []) {\n    const normalized = (Array.isArray(list) ? list : [])\n      .slice(0, 3)\n      .map(v => (v ? String(v) : ''));\n    while (normalized.length < 3) normalized.push('');\n\n    this.selected = normalized;\n\n    if (FormBuilderAPI && FormBuilderAPI._data) {\n      FormBuilderAPI._data.free_gifts = this.selected.slice();\n      FormBuilderAPI._data.freeGifts  = this.selected.slice();\n    }\n  },\n\n  /**\n   * Merge incoming gift objects into our master list,\n   * keeping manifold, requires, etc.\n   */\n  setList(giftList = []) {\n    giftList.forEach(g => {\n      if (!g) return;\n\n      const idStr = String(g.id ?? g.ct_id ?? g.gift_id ?? g.ct_gift_id ?? '');\n      if (!idStr) return;\n\n      const idx = this.gifts.findIndex(x => String(x.id) === idStr);\n      if (idx > -1) {\n        this.gifts[idx] = { ...this.gifts[idx], ...g, id: idStr };\n      } else {\n        this.gifts.push({ ...g, id: idStr });\n      }\n    });\n  },\n\n  /**\n   * Find one gift object by its ID.\n   */\n  getGiftById(id) {\n    return this.gifts.find(g => String(g.id) === String(id));\n  }\n};\n\n// expose globally for debugging\nwindow.CG_FreeChoicesState = State;\n\nexport default State;\n", "// assets/js/src/core/species/api.js\n// Reliable Species data access with localized-globals first and AJAX fallback.\n// IMPORTANT: adds in-flight de-dupe so multiple callers don't spam AJAX.\n// Preserves behavior, supports both CG_AJAX & CG_Ajax, and sends all common nonce keys.\n// Exposes window.SpeciesAPI for console debugging.\n\nconst log  = (...a) => console.log('[SpeciesAPI]', ...a);\nconst warn = (...a) => console.warn('[SpeciesAPI]', ...a);\nconst $    = window.jQuery;\n\n/**\n * Collect AJAX env (mu-plugin, legacy, or WP ajaxurl)\n */\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  const ajax_url =\n    env.ajax_url ||\n    window.ajaxurl ||\n    document.body?.dataset?.ajaxUrl ||\n    '/wp-admin/admin-ajax.php';\n  const nonce = env.nonce || env.security || window.CG_NONCE || null;\n  return { ajax_url, nonce };\n}\n\n/**\n * Normalize various list shapes into [{id,name}]\n */\nfunction normalizeList(raw) {\n  if (!Array.isArray(raw)) return [];\n  return raw.map(it => {\n    if (it && typeof it === 'object') {\n      return {\n        id:   String(it.id ?? it.value ?? ''),\n        name: String(it.name ?? it.title ?? '')\n      };\n    }\n    return { id: String(it), name: String(it) };\n  }).filter(x => x.id && x.name);\n}\n\n/**\n * Try preloaded globals (fast path)\n */\nfunction preloadedList() {\n  if (Array.isArray(window.CG_SPECIES_LIST) && window.CG_SPECIES_LIST.length) {\n    return normalizeList(window.CG_SPECIES_LIST);\n  }\n  if (window.CG_DATA && Array.isArray(window.CG_DATA.species) && window.CG_DATA.species.length) {\n    return normalizeList(window.CG_DATA.species);\n  }\n  if (Array.isArray(window.cgSpecies) && window.cgSpecies.length) {\n    return normalizeList(window.cgSpecies);\n  }\n  return null;\n}\n\n/** Post + lenient JSON parse (stays in jQuery Deferred world) */\nfunction postJSON(url, data) {\n  return $.post(url, data).then(res => {\n    try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n    catch (_) { return res; }\n  });\n}\n\nconst SpeciesAPI = {\n  _cache: { list: null, listPromise: null },\n  currentProfile: null,\n\n  clearCache() {\n    this._cache.list = null;\n    this._cache.listPromise = null;\n  },\n\n  /**\n   * Get the species list.\n   * @param {boolean} force If true, bypasses globals/cache and hits AJAX.\n   * @returns {jqXHR|Promise<array>}\n   */\n  getList(force = false) {\n    // 1) Globals (no network)\n    if (!force) {\n      const pre = preloadedList();\n      if (pre && pre.length) {\n        this._cache.list = pre.slice();\n        return $.Deferred().resolve(this._cache.list).promise();\n      }\n    }\n\n    // 2) Cached\n    if (!force && this._cache.list) {\n      return $.Deferred().resolve(this._cache.list).promise();\n    }\n\n    // 2.5) In-flight de-dupe (CRITICAL)\n    // If a request is already running, reuse it (even if force=true) to avoid parallel spam.\n    if (this._cache.listPromise) {\n      return this._cache.listPromise;\n    }\n\n    // 3) AJAX\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available; returning empty list.');\n      return $.Deferred().resolve([]).promise();\n    }\n\n    log('Fetching species via AJAX\u2026');\n    const payload = {\n      action:      'cg_get_species_list',\n      security:    nonce,  // check_ajax_referer(...,'security')\n      nonce:       nonce,  // some handlers read `nonce`\n      _ajax_nonce: nonce   // and some rely on WP\u2019s default key\n    };\n\n    // Store the in-flight promise so other callers reuse it\n    const p = postJSON(ajax_url, payload)\n      .then(res => {\n        const listRaw = Array.isArray(res) ? res : (res?.data || []);\n        const list    = normalizeList(listRaw);\n        this._cache.list = list;\n        log('Species list fetched:', list.length);\n        return list;\n      })\n      .fail((xhr, status, err) => {\n        warn('AJAX species list failed:', status, err, xhr?.responseText);\n        return [];\n      })\n      .always(() => {\n        // Clear in-flight marker once resolved/rejected\n        this._cache.listPromise = null;\n      });\n\n    this._cache.listPromise = p;\n    return p;\n  },\n\n  /**\n   * Populate a <select> with the species list.\n   * Keeps prior selection if still present.\n   * @param {HTMLElement|string} sel element or query selector\n   * @param {{force?: boolean}} opts\n   * @returns {Promise<HTMLElement|null>}\n   */\n  populateSelect(sel, { force = false } = {}) {\n    const el = (sel instanceof Element) ? sel : document.querySelector(sel);\n    if (!el) return $.Deferred().resolve(null).promise();\n\n    const prior = el.value || '';\n    el.innerHTML = '';\n    const ph = document.createElement('option');\n    ph.value = '';\n    ph.textContent = '\u2014 Select Species \u2014';\n    el.appendChild(ph);\n\n    return this.getList(force).then(list => {\n      list.forEach(({ id, name }) => {\n        const o = document.createElement('option');\n        o.value = id;\n        o.textContent = name;\n        el.appendChild(o);\n      });\n      if (prior && list.some(x => String(x.id) === String(prior))) {\n        el.value = String(prior);\n      }\n      return el;\n    });\n  },\n\n  /**\n   * Fetch the full profile for one species (gifts, skills, etc).\n   * Caches to `currentProfile` and emits a DOM event.\n   * @param {string|number} speciesId\n   * @returns {jqXHR|Promise<object|null>}\n   */\n  fetchProfile(speciesId) {\n    if (!speciesId) {\n      this.currentProfile = null;\n      return $.Deferred().resolve(null).promise();\n    }\n\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available for fetchProfile.');\n      return $.Deferred().resolve(null).promise();\n    }\n\n    log('Fetching species profile', speciesId);\n    const payload = {\n      action:      'cg_get_species_profile',\n      species_id:  speciesId,  // preferred key\n      id:          speciesId,  // fallback\n      security:    nonce,\n      nonce:       nonce,\n      _ajax_nonce: nonce\n    };\n\n    return postJSON(ajax_url, payload)\n      .then(res => {\n        const profile = res?.data || res || null;\n        this.currentProfile = profile || null;\n        document.dispatchEvent(new CustomEvent('cg:species:profile', {\n          detail: { id: String(speciesId), profile: this.currentProfile }\n        }));\n        return this.currentProfile;\n      })\n      .fail((xhr, status, err) => {\n        warn('AJAX species profile failed:', status, err, xhr?.responseText);\n        this.currentProfile = null;\n        return null;\n      });\n  }\n};\n\n// Expose for console debugging\nif (typeof window !== 'undefined') {\n  window.SpeciesAPI = SpeciesAPI;\n}\n\nexport default SpeciesAPI;\n", "// assets/js/src/core/career/api.js\n// Reliable Career data access with localized-globals first and AJAX fallback.\n// IMPORTANT: adds in-flight de-dupe so multiple callers don't spam AJAX.\n// Matches your PHP endpoints:\n//   - cg_get_career_list   \u2192 [{ id, name }]\n//   - cg_get_career_gifts  \u2192 profile object (careerName, gift_*, gift_id_*, manifold_*, skill_one/two/three)\n\nconst log  = (...a) => console.log('[CareerAPI]', ...a);\nconst warn = (...a) => console.warn('[CareerAPI]', ...a);\nconst $    = window.jQuery;\n\n/** Collect AJAX env (mu-plugin, legacy, or WP ajaxurl) */\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  const ajax_url =\n    env.ajax_url ||\n    window.ajaxurl ||\n    document.body?.dataset?.ajaxUrl ||\n    '/wp-admin/admin-ajax.php';\n  const nonce = env.nonce || env.security || window.CG_NONCE || null;\n  return { ajax_url, nonce };\n}\n\n/** Normalize various list shapes into [{id,name}] */\nfunction normalizeList(raw) {\n  if (!Array.isArray(raw)) return [];\n  return raw.map(it => {\n    if (it && typeof it === 'object') {\n      return {\n        id:   String(it.id ?? it.value ?? ''),\n        name: String(it.name ?? it.title ?? '')\n      };\n    }\n    return { id: String(it), name: String(it) };\n  }).filter(x => x.id && x.name);\n}\n\n/**\n * Try preloaded globals (fast path)\n * NOTE: hardener localizes CG_CAREERS_LIST (plural). Older code sometimes used CG_CAREER_LIST (singular).\n * We accept both to avoid unnecessary AJAX calls.\n */\nfunction preloadedList() {\n  // Preferred (hardener)\n  if (Array.isArray(window.CG_CAREERS_LIST) && window.CG_CAREERS_LIST.length) {\n    return normalizeList(window.CG_CAREERS_LIST);\n  }\n\n  // Legacy/singular\n  if (Array.isArray(window.CG_CAREER_LIST) && window.CG_CAREER_LIST.length) {\n    return normalizeList(window.CG_CAREER_LIST);\n  }\n\n  // Other legacy shapes\n  if (window.CG_DATA && Array.isArray(window.CG_DATA.careers) && window.CG_DATA.careers.length) {\n    return normalizeList(window.CG_DATA.careers);\n  }\n  if (Array.isArray(window.cgCareers) && window.cgCareers.length) {\n    return normalizeList(window.cgCareers);\n  }\n  return null;\n}\n\n/** Post + lenient JSON parse (stay in jQuery Deferred world) */\nfunction postJSON(url, data) {\n  return $.post(url, data).then(res => {\n    try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n    catch (_) { return res; }\n  });\n}\n\n/** Coerce profile so downstream code always has predictable keys */\nfunction normalizeCareerProfileShape(profile = {}) {\n  const p = (profile && typeof profile === 'object') ? { ...profile } : {};\n\n  // Name aliases\n  if (!p.careerName && p.career_name) p.careerName = p.career_name;\n  if (!p.career_name && p.careerName) p.career_name = p.careerName;\n  if (!p.careerName && !p.career_name && p.name) p.careerName = p.name;\n\n  // Ensure skill ids are strings\n  ['skill_one', 'skill_two', 'skill_three'].forEach(k => {\n    if (p[k] != null) p[k] = String(p[k]);\n  });\n\n  // Gift IDs as strings\n  ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\n    if (p[k] != null) p[k] = String(p[k]);\n  });\n\n  // Manifolds as Numbers (default 1)\n  ['manifold_1', 'manifold_2', 'manifold_3'].forEach(k => {\n    if (p[k] != null) p[k] = parseInt(p[k], 10) || 1;\n  });\n\n  return p;\n}\n\n/** Convert normalized profile \u2192 array of gift names (with \u00D7 manifold if >1) */\nfunction giftNamesFromProfile(profile = {}) {\n  const names = [profile.gift_1, profile.gift_2, profile.gift_3]\n    .map(v => (v == null ? '' : String(v)))\n    .filter(Boolean);\n\n  return names.map((name, i) => {\n    const m = profile[`manifold_${i + 1}`];\n    const mult = parseInt(m, 10) || 1;\n    return mult > 1 ? `${name} \u00D7 ${mult}` : name;\n  });\n}\n\nconst CareerAPI = {\n  _cache: { list: null, listPromise: null },\n  currentProfile: null,\n\n  clearCache() {\n    this._cache.list = null;\n    this._cache.listPromise = null;\n  },\n\n  /** getList(force=false) \u2192 Promise resolving to [{id,name}] */\n  getList(force = false) {\n    // 1) Globals (no network)\n    if (!force) {\n      const pre = preloadedList();\n      if (pre && pre.length) {\n        this._cache.list = pre.slice();\n        return $.Deferred().resolve(this._cache.list).promise();\n      }\n    }\n\n    // 2) Cached\n    if (!force && this._cache.list) {\n      return $.Deferred().resolve(this._cache.list).promise();\n    }\n\n    // 2.5) In-flight de-dupe (CRITICAL)\n    // If a request is already running, reuse it (even if force=true) to avoid parallel spam.\n    if (this._cache.listPromise) {\n      return this._cache.listPromise;\n    }\n\n    // 3) AJAX\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available; returning empty list.');\n      return $.Deferred().resolve([]).promise();\n    }\n\n    log('Fetching careers via AJAX\u2026');\n    const payload = {\n      action:      'cg_get_career_list',\n      security:    nonce,\n      nonce:       nonce,\n      _ajax_nonce: nonce\n    };\n\n    const p = postJSON(ajax_url, payload)\n      .then(res => {\n        const listRaw = Array.isArray(res) ? res : (res?.data || []);\n        const list    = normalizeList(listRaw);\n        this._cache.list = list;\n        log('Career list fetched:', list.length);\n        return list;\n      })\n      .fail((xhr, status, err) => {\n        warn('AJAX career list failed:', status, err, xhr?.responseText);\n        return [];\n      })\n      .always(() => {\n        this._cache.listPromise = null;\n      });\n\n    this._cache.listPromise = p;\n    return p;\n  },\n\n  /** populateSelect(sel) \u2192 Promise resolving to the populated select */\n  populateSelect(sel, { force = false } = {}) {\n    const el = (sel instanceof Element) ? sel : document.querySelector(sel);\n    if (!el) return $.Deferred().resolve(null).promise();\n\n    const prior = el.value || '';\n    el.innerHTML = '';\n    const ph = document.createElement('option');\n    ph.value = '';\n    ph.textContent = '\u2014 Select Career \u2014';\n    el.appendChild(ph);\n\n    return this.getList(force).then(list => {\n      list.forEach(({ id, name }) => {\n        const o = document.createElement('option');\n        o.value = id;\n        o.textContent = name;\n        el.appendChild(o);\n      });\n      if (prior && list.some(x => String(x.id) === String(prior))) {\n        el.value = String(prior);\n      }\n      return el;\n    });\n  },\n\n  /**\n   * fetchProfile(careerId) \u2192 Promise resolving to normalized profile (or null)\n   * IMPORTANT: Your PHP returns the full profile from `cg_get_career_gifts`,\n   * so we call that here and treat the response as the profile.\n   */\n  fetchProfile(careerId) {\n    if (!careerId) {\n      this.currentProfile = null;\n      return $.Deferred().resolve(null).promise();\n    }\n\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available for fetchProfile.');\n      return $.Deferred().resolve(null).promise();\n    }\n\n    log('Fetching career profile', careerId);\n    const payload = {\n      action:      'cg_get_career_gifts',\n      id:          careerId,\n      security:    nonce,\n      nonce:       nonce,\n      _ajax_nonce: nonce\n    };\n\n    return postJSON(ajax_url, payload)\n      .then(res => {\n        const profRaw =\n          (res && res.success === true) ? res.data :\n          (res && res.success === undefined) ? res :\n          null;\n\n        if (!profRaw) {\n          warn('Career profile response missing/invalid:', res);\n          this.currentProfile = null;\n          return null;\n        }\n\n        const normalized = normalizeCareerProfileShape(profRaw);\n        this.currentProfile = normalized;\n        return normalized;\n      })\n      .fail((xhr, status, err) => {\n        warn('AJAX career profile failed:', status, err, xhr?.responseText);\n        this.currentProfile = null;\n        return null;\n      });\n  },\n\n  /**\n   * fetchGifts(careerId) \u2192 Promise<string[]>\n   * For compatibility with callers that \u201Cjust want gift names\u201D\n   */\n  fetchGifts(careerId) {\n    return this.fetchProfile(careerId).then(profile => {\n      if (!profile) return [];\n      return giftNamesFromProfile(profile);\n    });\n  }\n};\n\n// Expose for console debugging\nif (typeof window !== 'undefined') {\n  window.CareerAPI = CareerAPI;\n}\n\nexport default CareerAPI;\n", "// assets/js/src/core/traits/service.js\n\nimport GiftsState     from '../gifts/state.js';\nimport SpeciesService from '../species/api.js';\nimport CareerService  from '../career/api.js';\n\nconst DIE_ORDER = ['d4','d6','d8','d10','d12'];\n\n/**\n * Map of gift IDs \u2192 traitKey\n * (these IDs correspond to \u201Cincreased trait\u201D gifts)\n */\nconst BOOSTS = {\n  78:  'will',\n  89:  'speed',\n  85:  'body',\n  100: 'mind',\n  224: 'trait_species',\n  223: 'trait_career'\n};\n\nconst TRAITS     = ['will','speed','body','mind','trait_species','trait_career'];\nconst DICE_TYPES = ['d8','d6','d4'];\nconst MAX_COUNT  = { d8:2, d6:3, d4:1 };\n\nconst TraitsService = {\n  TRAITS,\n  DICE_TYPES,\n\n  /**\n   * Build a map: { traitKey: totalBoostCount }\n   * counting free, species, and career gifts, including any manifold multipliers.\n   */\n  calculateBoostMap() {\n    const map = {};\n\n    /**\n     * Look up one gift, see if it\u2019s in BOOSTS, then add\n     * its manifold count (default 1) to that traitKey in map.\n     */\n    function addGift(giftId) {\n      if (!giftId) return;\n      // Find the full gift object (with manifold, requires, etc)\n      const gift = GiftsState.getGiftById(giftId);\n      if (!gift) return;\n\n      // Only process if it\u2019s a known boost gift\n      const traitKey = BOOSTS[gift.id];\n      if (!traitKey) return;\n\n      // How many steps does this gift boost? `ct_gifts_manifold` or 1\n      const count = parseInt(gift.ct_gifts_manifold, 10) || 1;\n\n      map[traitKey] = (map[traitKey] || 0) + count;\n    }\n\n    // 1) Free\u2010choice gifts\n    GiftsState.selected.forEach(addGift);\n\n    // 2) Species gifts (profile.gift_id_1 \u2026 gift_id_3)\n    const sp = SpeciesService.currentProfile;\n    if (sp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(key => {\n        addGift(sp[key]);\n      });\n    }\n\n    // 3) Career gifts\n    const cp = CareerService.currentProfile;\n    if (cp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(key => {\n        addGift(cp[key]);\n      });\n    }\n\n    console.log('[Traits] boost map \u2192', map);\n    return map;\n  },\n\n  /**\n   * Enforce dice\u2010count limits on the trait selects.\n   */\n  enforceCounts() {\n    const $    = window.jQuery;\n    const freq = { d8:0, d6:0, d4:0 };\n\n    $('.cg-trait-select').each(function(){\n      const v = $(this).val();\n      if (v && v in freq) freq[v]++;\n    });\n\n    $('.cg-trait-select').each(function(){\n      const $sel    = $(this);\n      const current = $sel.val() || '';\n      let options   = '<option value=\"\">\u2014 Select \u2014</option>';\n\n      DICE_TYPES.forEach(die => {\n        if (freq[die] < MAX_COUNT[die] || current === die) {\n          const sel = current === die ? ' selected' : '';\n          options += `<option value=\"${die}\"${sel}>${die}</option>`;\n        }\n      });\n\n      $sel.html(options);\n    });\n  },\n\n  /**\n   * Update the \u201Cadjusted\u201D labels under each trait select.\n   */\n  updateAdjustedDisplays() {\n    const $      = window.jQuery;\n    const boosts = this.calculateBoostMap();\n\n    TRAITS.forEach(traitKey => {\n      const $sel   = $(`#cg-${traitKey}`);\n      const base   = $sel.val() || 'd4';\n      const idx    = DIE_ORDER.indexOf(base);\n      const count  = boosts[traitKey] || 0;\n      const boosted = DIE_ORDER[Math.min(idx + count, DIE_ORDER.length - 1)];\n      $(`#cg-${traitKey}-adjusted`).text(boosted);\n    });\n  },\n\n  /**\n   * Re-run both counts & adjusted displays.\n   */\n  refreshAll() {\n    this.enforceCounts();\n    this.updateAdjustedDisplays();\n  },\n\n  /**\n   * Get a single trait\u2019s boosted die (for external use).\n   */\n  getBoostedDie(traitKey) {\n    const boosts = this.calculateBoostMap();\n    const cnt    = boosts[traitKey] || 0;\n    if (!cnt) return '';\n    const base = window.jQuery(`#cg-${traitKey}`).val() || 'd4';\n    const idx  = DIE_ORDER.indexOf(base);\n    return DIE_ORDER[Math.min(idx + cnt, DIE_ORDER.length - 1)];\n  }\n};\n\nexport default TraitsService;\n", "// assets/js/src/core/formBuilder/render-details.js\r\n\r\nimport TraitsService from '../traits/service.js';\r\n\r\nconst TRAITS = TraitsService.TRAITS;       // [\"will\",\"speed\",\"body\",\"mind\",\"trait_species\",\"trait_career\"]\r\nconst DICE   = TraitsService.DICE_TYPES;   // [\"d8\",\"d6\",\"d4\"]\r\n\r\nfunction escape(val) {\r\n  const s = val == null ? '' : String(val);\r\n  return s\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#39;');\r\n}\r\n\r\nfunction capitalize(str = '') {\r\n  return str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\nexport default {\r\n  renderTabs() {\r\n    return `\r\n      <ul class=\"cg-tabs\">\r\n        <li data-tab=\"tab-traits\" class=\"active\">Details & Traits</li>\r\n        <li data-tab=\"tab-profile\">Profile: Species, Career & Gifts</li>\r\n        <li data-tab=\"tab-skills\">Skills</li>\r\n        <li data-tab=\"tab-summary\">Summary</li>\r\n      </ul>\r\n    `;\r\n  },\r\n\r\n  renderContent(data = {}) {\r\n    // Build each trait\u2019s <select> using the full DICE array\u2014\r\n    // no pool removal, so every option is always rendered.\r\n    const traitFields = TRAITS.map(trait => {\r\n      const val   = String(data[trait] ?? '');\r\n      const label = trait === 'trait_species' ? 'Species'\r\n                  : trait === 'trait_career'  ? 'Career'\r\n                  : capitalize(trait);\r\n\r\n      const options = DICE.map(die => {\r\n        const sel = (die === val) ? ' selected' : '';\r\n        return `<option value=\"${die}\"${sel}>${die}</option>`;\r\n      }).join('');\r\n\r\n      return `\r\n        <div class=\"cg-trait\">\r\n          <label>${label} <small>(choose one)</small></label>\r\n          <select id=\"cg-${trait}\" class=\"cg-trait-select\">\r\n            <option value=\"\">&mdash; Select &mdash;</option>\r\n            ${options}\r\n          </select>\r\n          <div\r\n            class=\"trait-adjusted\"\r\n            id=\"cg-${trait}-adjusted\"\r\n            style=\"color:#0073aa;font-weight:bold;\"\r\n          ></div>\r\n        </div>\r\n      `;\r\n    }).join('');\r\n\r\n    return `\r\n      <div id=\"tab-traits\" class=\"tab-panel active\">\r\n        <div class=\"cg-details-panel\">\r\n\r\n          <div class=\"cg-details-box\">\r\n            <h3>Details</h3>\r\n            <div class=\"cg-profile-grid\">\r\n              <div>\r\n                <label>Character Name</label>\r\n                <input type=\"text\" id=\"cg-name\" value=\"${escape(data.name)}\" required />\r\n              </div>\r\n              <div>\r\n                <label>Player Name</label>\r\n                <input type=\"text\" id=\"cg-player-name\" value=\"${escape(data.player_name)}\" />\r\n              </div>\r\n\r\n              <div>\r\n                <label>Gender</label>\r\n                <select id=\"cg-gender\">\r\n                  <option value=\"\">&mdash; Select &mdash;</option>\r\n                  <option value=\"Male\"     ${data.gender === 'Male'     ? 'selected' : ''}>Male</option>\r\n                  <option value=\"Female\"   ${data.gender === 'Female'   ? 'selected' : ''}>Female</option>\r\n                  <option value=\"Nonbinary\"${data.gender === 'Nonbinary'? 'selected' : ''}>Nonbinary</option>\r\n                </select>\r\n              </div>\r\n              <div>\r\n                <label>Age</label>\r\n                <input type=\"text\" id=\"cg-age\" value=\"${escape(data.age)}\" required />\r\n              </div>\r\n            </div>\r\n\r\n            <label>Motto</label>\r\n            <input type=\"text\" id=\"cg-motto\" value=\"${escape(data.motto)}\" />\r\n\r\n            <label>Goal 1</label>\r\n            <input type=\"text\" id=\"cg-goal1\" value=\"${escape(data.goal1)}\" />\r\n            <label>Goal 2</label>\r\n            <input type=\"text\" id=\"cg-goal2\" value=\"${escape(data.goal2)}\" />\r\n            <label>Goal 3</label>\r\n            <input type=\"text\" id=\"cg-goal3\" value=\"${escape(data.goal3)}\" />\r\n          </div>\r\n\r\n          <div class=\"cg-traits-box\">\r\n            <h3>Traits</h3>\r\n            <div class=\"cg-profile-grid\">\r\n              ${traitFields}\r\n            </div>\r\n          </div>\r\n\r\n          <div class=\"cg-text-box\">\r\n            <h3>Description & Backstory</h3>\r\n            <label>Description</label>\r\n            <textarea id=\"cg-description\">${escape(data.description)}</textarea>\r\n            <label>Backstory</label>\r\n            <textarea id=\"cg-backstory\">${escape(data.backstory)}</textarea>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n};\r\n", "// assets/js/src/core/formBuilder/render-profile.js\r\n\r\n/**\r\n * \u201CProfile\u201D tab & panel\r\n * Species, Career & Gifts all together\r\n */\r\n\r\nexport default {\r\n  renderContent(data = {}) {\r\n    return `\r\n      <div id=\"tab-profile\" class=\"tab-panel\">\r\n\r\n        <div class=\"cg-profile-box\">\r\n          <h3>Species and Career</h3>\r\n          <label for=\"cg-species\">Species</label>\r\n          <select \r\n            id=\"cg-species\" \r\n            class=\"cg-profile-select\" \r\n            data-selected=\"${data.species_id || ''}\"\r\n          ></select>\r\n          <ul id=\"species-gifts\" class=\"cg-gift-item\"></ul>\r\n\r\n          <label for=\"cg-career\">Career</label>\r\n          <select \r\n            id=\"cg-career\" \r\n            class=\"cg-profile-select\" \r\n            data-selected=\"${data.career_id || ''}\"\r\n          ></select>\r\n          <div class=\"trait-adjusted\" id=\"cg-trait_career-adjusted\"></div>\r\n          <div id=\"cg-extra-careers\" class=\"cg-profile-grid\"></div>\r\n        </div>\r\n\r\n        <div class=\"cg-profile-box\">\r\n          <h3>Gifts</h3>\r\n          <div class=\"cg-gift-label\">Local Knowledge</div>\r\n          <div id=\"cg-local-knowledge\" class=\"cg-gift-item\"></div>\r\n\r\n          <div class=\"cg-gift-label\">Language</div>\r\n          <div id=\"cg-language\" class=\"cg-gift-item\"></div>\r\n\r\n          <div class=\"cg-gift-label\">Species Gifts</div>\r\n          <ul id=\"species-gift-block\" class=\"cg-gift-item\"></ul>\r\n\r\n          <div class=\"cg-gift-label\">Career Gifts</div>\r\n          <ul id=\"career-gifts\" class=\"cg-gift-item\"></ul>\r\n\r\n          <div class=\"cg-gift-label\">Chosen</div>\r\n          <div id=\"cg-free-choices\" class=\"cg-gift-item\"></div>\r\n        </div>\r\n\r\n      </div>\r\n    `;\r\n  }\r\n};\r\n", "// assets/js/src/core/formBuilder/render-skills.js\r\n\r\nimport SpeciesService from '../species/api.js';\r\nimport CareerService  from '../career/api.js';\r\nimport FormBuilderAPI from '../formBuilder';\r\n\r\nfunction escape(str = '') {\r\n  return String(str)\r\n    .replace(/&/g, '&amp;')\r\n    .replace(/</g, '&lt;')\r\n    .replace(/>/g, '&gt;')\r\n    .replace(/\"/g, '&quot;')\r\n    .replace(/'/g, '&#039;');\r\n}\r\n\r\nexport default {\r\n  renderContent(data = {}) {\r\n    const speciesName  = SpeciesService.currentProfile?.species_name || '';\r\n    const careerName   = CareerService.currentProfile?.career_name  || '';\r\n    const extraCareers = data.extraCareers || []; \r\n    const skillList    = data.skillsList || [];\r\n\r\n    // Build header columns\r\n    const careerCols = [`<th>Career: ${escape(careerName)}</th>`]\r\n      .concat(\r\n        extraCareers.map((c,i) =>\r\n          `<th>Career ${i+2}: ${escape(c.name)}</th>`\r\n        )\r\n      ).join('');\r\n\r\n    // Build each skill row\r\n    const rows = skillList.map(skill => `\r\n      <tr data-skill-id=\"${skill.id}\">\r\n        <td>${escape(skill.name)}</td>\r\n        <td class=\"skill-species-die\"></td>\r\n        ${extraCareers.map(() => '<td></td>').join('')}\r\n        <td>\r\n          <input\r\n            type=\"number\"\r\n            class=\"skill-marks\"\r\n            data-skill-id=\"${skill.id}\"\r\n            min=\"0\"\r\n            value=\"${escape(data.skillMarks?.[skill.id]||0)}\"\r\n          />\r\n        </td>\r\n        <td class=\"skill-total\">\u2014</td>\r\n      </tr>\r\n    `).join('');\r\n\r\n    return `\r\n      <div id=\"tab-skills\" class=\"tab-panel\">\r\n        <table id=\"skills-table\" class=\"cg-skills-table\">\r\n          <thead>\r\n            <tr>\r\n              <th>Skill Name</th>\r\n              <th>Species: ${escape(speciesName)}</th>\r\n              ${careerCols}\r\n              <th>Skill Marks</th>\r\n              <th>Dice Pool</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            ${rows}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    `;\r\n  }\r\n};\r\n", "// assets/js/src/core/formBuilder/render-summary.js\r\n\r\n/**\r\n * \u201CSummary\u201D tab & panel skeleton\r\n */\r\nexport default {\r\n  renderContent(data = {}) {\r\n    return `\r\n      <div id=\"tab-summary\" class=\"tab-panel\">\r\n        <div class=\"summary-header\">\r\n          <button id=\"cg-export-pdf\" type=\"button\" class=\"button primary\">\r\n            \uD83D\uDDA8\uFE0F Export to PDF\r\n          </button>\r\n        </div>\r\n        <div id=\"cg-summary-sheet\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n};\r\n", "// assets/js/src/core/formBuilder/form-builder.js\r\nconst $ = window.jQuery;\r\n\r\nimport DetailsTabRenderer   from './render-details.js';\r\nimport ProfileTabRenderer   from './render-profile.js';\r\nimport SkillsTabRenderer    from './render-skills.js';\r\nimport SummaryTabRenderer   from './render-summary.js';\r\n\r\nconst FormBuilder = {\r\n  buildForm(data = {}) {\r\n    console.log('\uD83D\uDEE0\uFE0F FormBuilder.buildForm fired:', data);\r\n\r\n    // 1) Build the HTML into a variable\r\n    const html = `\r\n<form id=\"cg-form\">\r\n\r\n  ${DetailsTabRenderer.renderTabs()}\r\n  <div class=\"cg-tab-wrap\">\r\n    ${DetailsTabRenderer.renderContent(data)}\r\n    ${ProfileTabRenderer.renderContent(data)}\r\n    ${SkillsTabRenderer.renderContent(data)}\r\n    ${SummaryTabRenderer.renderContent(data)}\r\n  </div>\r\n\r\n  <input type=\"hidden\" id=\"cg-id\"     value=\"${data.id || ''}\" />\r\n  <div class=\"cg-form-buttons\">\r\n    <button type=\"button\" class=\"cg-save-button\">\uD83D\uDCBE Save</button>\r\n    <button type=\"button\" class=\"cg-save-button cg-close-after-save\">\uD83D\uDCBE Save & Close</button>\r\n  </div>\r\n</form>`;\r\n\r\n    // 2) AFTER the form is injected into the DOM, give the browser a tick\r\n    //    then read every <select> value out of the rendered HTML:\r\n    setTimeout(() => {\r\n      console.log('\uD83D\uDD3D [buildForm] SELECT VALUES AFTER RENDER:', {\r\n        will:            $('#cg-will').val(),\r\n        speed:           $('#cg-speed').val(),\r\n        body:            $('#cg-body').val(),\r\n        mind:            $('#cg-mind').val(),\r\n        trait_species:   $('#cg-trait_species').val(),\r\n        trait_career:    $('#cg-trait_career').val(),\r\n        profileSpecies:  $('#cg-species').val(),\r\n        profileCareer:   $('#cg-career').val(),\r\n      });\r\n    }, 0);\r\n\r\n    // 3) Return the HTML string to the caller\r\n    return html;\r\n  }\r\n};\r\n\r\nexport default FormBuilder;\r\n", "// assets/js/src/core/formBuilder/index.js\r\n\r\nconst $ = window.jQuery;\r\nimport BuilderUI     from '../main/builder-ui.js';\r\nimport TraitsService from '../traits/service.js';\r\nimport FormBuilder   from './form-builder.js';\r\n\r\n/**\r\n * Resolve AJAX URL + nonce from any of the bridges we\u2019ve set up.\r\n */\r\nfunction ajaxEnv() {\r\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\r\n  return {\r\n    url:   env.ajax_url || window.ajaxurl || document.body?.dataset?.ajaxUrl || '/wp-admin/admin-ajax.php',\r\n    nonce: env.nonce    || env.security   || window.CG_NONCE || null\r\n  };\r\n}\r\n\r\n/**\r\n * Normalize raw builder data into a flat \u201Ccore\u201D object with the key names\r\n * the PHP handler expects. Also JSON-encode any structured blobs.\r\n */\r\nfunction normalizeCore(raw = {}) {\r\n  // IMPORTANT: accept either species/career OR species_id/career_id OR trait_* fallbacks\r\n  const species = raw.species ?? raw.species_id ?? raw.trait_species ?? '';\r\n  const career  = raw.career  ?? raw.career_id  ?? raw.trait_career  ?? '';\r\n\r\n  return {\r\n    id:          raw.id || '',\r\n    name:        raw.name || '',\r\n    player_name: raw.player_name || '',\r\n    age:         raw.age || '',\r\n    gender:      raw.gender || '',\r\n    motto:       raw.motto || '',\r\n    will:        raw.will ?? '',\r\n    body:        raw.body ?? '',\r\n    mind:        raw.mind ?? '',\r\n    speed:       raw.speed ?? '',\r\n    species,\r\n    career,\r\n\r\n    // optional structured blobs (keep them available to PHP if needed)\r\n    skill_marks: raw.skillMarks ? JSON.stringify(raw.skillMarks) : '',\r\n    traits_list: raw.traitsList ? JSON.stringify(raw.traitsList) : '',\r\n    skills_list: raw.skillsList ? JSON.stringify(raw.skillsList) : '',\r\n    gifts:       raw.gifts      ? JSON.stringify(raw.gifts)      : '',\r\n\r\n    // keep the free_gifts array as-is if present\r\n    free_gifts:  Array.isArray(raw.free_gifts) ? raw.free_gifts : undefined\r\n  };\r\n}\r\n\r\n/**\r\n * Build a \u201Cbelt-and-suspenders\u201D payload:\r\n *  - flat fields (name, species, career, \u2026)\r\n *  - nested character[...] fields (same content)\r\n *  - character_json full JSON fallback\r\n * and include all common nonce keys.\r\n */\r\nfunction buildPayload(raw) {\r\n  const core = normalizeCore(raw);\r\n  const { nonce } = ajaxEnv();\r\n\r\n  const base = { action: 'cg_save_character' };\r\n  if (nonce) {\r\n    base.security    = nonce;       // typical check_ajax_referer key\r\n    base.nonce       = nonce;       // some handlers look for this\r\n    base._ajax_nonce = nonce;       // legacy WP key\r\n  }\r\n\r\n  // Flat fields \u2014 only include when present/non-empty\r\n  const flat = {\r\n    ...base,\r\n    ...(core.id            ? { id: core.id } : {}),\r\n    ...(core.name          ? { name: core.name } : {}),\r\n    ...(core.player_name   ? { player_name: core.player_name } : {}),\r\n    ...(core.age           ? { age: core.age } : {}),\r\n    ...(core.gender        ? { gender: core.gender } : {}),\r\n    ...(core.motto         ? { motto: core.motto } : {}),\r\n    ...(core.will  !== ''  ? { will: core.will }   : {}),\r\n    ...(core.body  !== ''  ? { body: core.body }   : {}),\r\n    ...(core.mind  !== ''  ? { mind: core.mind }   : {}),\r\n    ...(core.speed !== ''  ? { speed: core.speed } : {}),\r\n    ...(core.species       ? { species: core.species } : {}),\r\n    ...(core.career        ? { career:  core.career  } : {}),\r\n    ...(core.skill_marks   ? { skill_marks: core.skill_marks } : {}),\r\n    ...(core.traits_list   ? { traits_list: core.traits_list } : {}),\r\n    ...(core.skills_list   ? { skills_list: core.skills_list } : {}),\r\n    ...(core.gifts         ? { gifts: core.gifts } : {}),\r\n  };\r\n\r\n  // Nested character[...] mirrors the same fields\r\n  const character = {};\r\n  if (core.id)           character.id           = core.id;\r\n  if (core.name)         character.name         = core.name;\r\n  if (core.player_name)  character.player_name  = core.player_name;\r\n  if (core.age)          character.age          = core.age;\r\n  if (core.gender)       character.gender       = core.gender;\r\n  if (core.motto)        character.motto        = core.motto;\r\n  if (core.will !== '')  character.will         = core.will;\r\n  if (core.body !== '')  character.body         = core.body;\r\n  if (core.mind !== '')  character.mind         = core.mind;\r\n  if (core.speed !== '') character.speed        = core.speed;\r\n  if (core.species)      character.species      = core.species;\r\n  if (core.career)       character.career       = core.career;\r\n\r\n  if (core.skill_marks)  character.skill_marks  = core.skill_marks;\r\n  if (core.traits_list)  character.traits_list  = core.traits_list;\r\n  if (core.skills_list)  character.skills_list  = core.skills_list;\r\n  if (core.gifts)        character.gifts        = core.gifts;\r\n  if (Array.isArray(core.free_gifts)) character.free_gifts = core.free_gifts;\r\n\r\n  flat.character = character;\r\n\r\n  // Full JSON fallback\r\n  flat.character_json = JSON.stringify({ ...core });\r\n\r\n  return flat;\r\n}\r\n\r\nconst FormBuilderAPI = {\r\n  _data:   {},\r\n  isNew:   true,\r\n  hasData: false,\r\n\r\n  /**\r\n   * Initialize the builder state and render the form.\r\n   *\r\n   * @param {Object} payload\r\n   */\r\n  init(payload = {}) {\r\n    this._data   = { ...payload };\r\n    this.isNew   = Boolean(payload.isNew);\r\n    this.hasData = !this.isNew;\r\n\r\n    $('#cg-form-container').html(\r\n      FormBuilder.buildForm(this._data)\r\n    );\r\n  },\r\n\r\n  /**\r\n   * Return a shallow copy of the in-memory data.\r\n   */\r\n  getData() {\r\n    return { ...this._data };\r\n  },\r\n\r\n  /**\r\n   * Read every form field from the DOM into a single payload object,\r\n   * merging in-memory skillMarks to avoid losing them when inputs\r\n   * aren't present on the current tab.\r\n   */\r\n  collectFormData() {\r\n    const d = {};\r\n\r\n    // Preserve existing ID (for updates)\r\n    if (this._data.id) {\r\n      d.id = this._data.id;\r\n    }\r\n\r\n    // Basic fields\r\n    d.name        = $('#cg-name').val();\r\n    d.player_name = $('#cg-player-name').val();\r\n    d.age         = $('#cg-age').val();\r\n    d.gender      = $('#cg-gender').val();\r\n    d.motto       = $('#cg-motto').val();\r\n    d.goal1       = $('#cg-goal1').val();\r\n    d.goal2       = $('#cg-goal2').val();\r\n    d.goal3       = $('#cg-goal3').val();\r\n    d.description = $('#cg-description').val();\r\n    d.backstory   = $('#cg-backstory').val();\r\n\r\n    // Species & Career \u2014 collect under BOTH names for compatibility\r\n    const speciesVal = $('#cg-species').val() || '';\r\n    const careerVal  = $('#cg-career').val()  || '';\r\n    d.species_id = speciesVal;\r\n    d.career_id  = careerVal;\r\n    d.species    = speciesVal; // <-- added so PHP sees expected keys\r\n    d.career     = careerVal;  // <-- added so PHP sees expected keys\r\n\r\n    // Traits (will, speed, body, mind, trait_species, trait_career)\r\n    TraitsService.TRAITS.forEach(key => {\r\n      d[key] = $(`#cg-${key}`).val();\r\n    });\r\n\r\n    // Skill marks: start with whatever is in-memory,\r\n    // then overwrite from any <input class=\"skill-marks\">\r\n    const mergedMarks = { ...(this._data.skillMarks || {}) };\r\n    $('input.skill-marks').each((i, el) => {\r\n      const skillId = $(el).data('skill-id');\r\n      const val     = parseInt($(el).val(), 10) || 0;\r\n      mergedMarks[skillId] = val;\r\n    });\r\n    d.skillMarks = mergedMarks;\r\n\r\n    // Free\u2010choice gifts\r\n    d.free_gifts = [\r\n      $('#cg-free-choice-0').val() || '',\r\n      $('#cg-free-choice-1').val() || '',\r\n      $('#cg-free-choice-2').val() || ''\r\n    ];\r\n\r\n    // Bubble through any preloaded lists if present (helps PHP optionally persist)\r\n    if (Array.isArray(window.CG_SKILLS_LIST)) d.skillsList = window.CG_SKILLS_LIST;\r\n\r\n    return d;\r\n  },\r\n\r\n  /**\r\n   * Save the character via WP-AJAX and optionally close builder.\r\n   * Posts flat + nested character[...] + JSON as a compatibility belt & suspenders.\r\n   *\r\n   * @param {boolean} shouldClose\r\n   * @returns {Promise}\r\n   */\r\n  save(shouldClose = false) {\r\n    const raw = this.collectFormData();\r\n    console.log('[FormBuilderAPI] \u25B6 save()', raw);\r\n\r\n    const { url } = ajaxEnv();\r\n    if (!url) {\r\n      console.error('[FormBuilderAPI] save(): No AJAX URL available');\r\n      alert('Save error: missing AJAX URL');\r\n      return $.Deferred().reject('no-url').promise();\r\n    }\r\n\r\n    const data = buildPayload(raw);\r\n\r\n    return $.post(url, data)\r\n      .done(res => {\r\n        try { res = (typeof res === 'string') ? JSON.parse(res) : res; } catch (_) {}\r\n        if (!res || res.success !== true) {\r\n          console.error('[FormBuilderAPI] save.error()', res);\r\n          alert('Save failed: ' + (res?.data || 'Invalid payload.'));\r\n          return;\r\n        }\r\n\r\n        // Update ID in-memory\r\n        if (res.data?.id) {\r\n          this._data = { ...this._data, id: res.data.id };\r\n        }\r\n        this.isNew   = false;\r\n        this.hasData = true;\r\n\r\n        BuilderUI.markClean();\r\n        if (shouldClose) {\r\n          BuilderUI.closeBuilder();\r\n        } else {\r\n          alert('Character saved');\r\n        }\r\n\r\n        // notify others (e.g., reload list)\r\n        document.dispatchEvent(new CustomEvent('cg:character:saved',    { detail: { id: res.data?.id || raw.id || null, record: raw } }));\r\n        document.dispatchEvent(new CustomEvent('cg:characters:refresh', { detail: {} }));\r\n      })\r\n      .fail((xhr, status, err) => {\r\n        console.error('[FormBuilderAPI] save.fail()', status, err, xhr?.responseText);\r\n        alert('Save failed\u2014check console for details.');\r\n      });\r\n  },\r\n\r\n  /**\r\n   * Fetch a list of saved characters (for the Load splash).\r\n   */\r\n  listCharacters() {\r\n    const { url, nonce } = ajaxEnv();\r\n    return $.ajax({\r\n      url,\r\n      method: 'POST',\r\n      data: {\r\n        action:   'cg_load_characters',\r\n        security: nonce\r\n      }\r\n    });\r\n  },\r\n\r\n  /**\r\n   * Fetch one character\u2019s full data by ID.\r\n   *\r\n   * @param {number|string} id\r\n   */\r\n  fetchCharacter(id) {\r\n    const { url, nonce } = ajaxEnv();\r\n    console.log('[FormBuilderAPI] fetchCharacter() called with ID:', id);\r\n    return $.ajax({\r\n      url,\r\n      method: 'POST',\r\n      data: {\r\n        action:   'cg_get_character',\r\n        id,\r\n        security: nonce\r\n      }\r\n    });\r\n  }\r\n};\r\n\r\nexport default FormBuilderAPI;\r\n", "// assets/js/src/core/species/events.js\r\n// One-time, namespaced bindings for Species select.\r\n// Fetches + normalizes profile, stores it on SpeciesAPI.currentProfile,\r\n// renders Profile tab species gifts, and announces via cg:species:changed.\r\n\r\nimport SpeciesAPI from './api.js';\r\n\r\nconst $ = window.jQuery;\r\nlet _bound = false;\r\n\r\n// Normalize various backend shapes into something our renderers expect.\r\nfunction normalizeSpeciesProfile(raw = {}) {\r\n  const out = { ...raw };\r\n\r\n  // A readable name used by Skills/Summary headers\r\n  out.speciesName =\r\n    raw.speciesName ||\r\n    raw.species_name ||\r\n    raw.ct_species_name ||\r\n    raw.name ||\r\n    raw.title ||\r\n    '';\r\n\r\n  // Ensure skill ids are strings (Skills module compares as strings)\r\n  if (raw.skill_one   != null) out.skill_one   = String(raw.skill_one);\r\n  if (raw.skill_two   != null) out.skill_two   = String(raw.skill_two);\r\n  if (raw.skill_three != null) out.skill_three = String(raw.skill_three);\r\n\r\n  // Gifts referenced by Traits service (id fields)\r\n  ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\r\n    if (raw[k] != null) out[k] = String(raw[k]);\r\n  });\r\n\r\n  // Manifold counts (default 1)\r\n  ['manifold_1', 'manifold_2', 'manifold_3'].forEach(k => {\r\n    if (raw[k] != null) out[k] = parseInt(raw[k], 10) || 1;\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\nfunction renderGiftList($ul, items = []) {\r\n  if (!$ul || !$ul.length) return;\r\n  $ul.empty();\r\n  items.forEach(txt => {\r\n    if (!txt) return;\r\n    $ul.append(`<li>${txt}</li>`);\r\n  });\r\n}\r\n\r\nfunction namesFromProfile(profile = {}) {\r\n  // Prefer gift_1..gift_3 (names), otherwise nothing\r\n  const names = [profile.gift_1, profile.gift_2, profile.gift_3]\r\n    .map(v => (v == null ? '' : String(v)))\r\n    .filter(Boolean);\r\n  // Add \u00D7 manifold if > 1\r\n  return names.map((name, i) => {\r\n    const m = profile[`manifold_${i+1}`];\r\n    const mult = parseInt(m, 10) || 1;\r\n    return mult > 1 ? `${name} \u00D7 ${mult}` : name;\r\n  });\r\n}\r\n\r\nexport default function bindSpeciesEvents() {\r\n  if (_bound) return;\r\n  _bound = true;\r\n\r\n  $(document)\r\n    .off('change.cg', '#cg-species')\r\n    .on('change.cg', '#cg-species', e => {\r\n      const val = (e.currentTarget && e.currentTarget.value) || '';\r\n      console.log('[SpeciesEvents] selected species \u2192', val);\r\n\r\n      if (!val) {\r\n        SpeciesAPI.currentProfile = null;\r\n        renderGiftList($('#species-gift-block'), []);\r\n        $(document).trigger('cg:species:changed', [{ id: '', profile: null }]);\r\n        return;\r\n      }\r\n\r\n      SpeciesAPI.fetchProfile(val).done(profileRaw => {\r\n        const profile = normalizeSpeciesProfile(profileRaw || {});\r\n        SpeciesAPI.currentProfile = profile;\r\n\r\n        // Render gifts (from profile)\r\n        const giftNames = namesFromProfile(profile);\r\n        renderGiftList($('#species-gift-block'), giftNames);\r\n\r\n        $(document).trigger('cg:species:changed', [{ id: String(val), profile }]);\r\n      });\r\n    });\r\n}\r\n", "// assets/js/src/core/species/index.js\r\n// Coordinates Species API + events + select population/refetch\r\n\r\nimport SpeciesAPI from './api.js';\r\nimport bindSpeciesEvents from './events.js';\r\n\r\nconst SpeciesIndex = {\r\n  _init: false,\r\n\r\n  /**\r\n   * One-time init: bind change events and populate the select if present.\r\n   */\r\n  init() {\r\n    if (this._init) return;\r\n    this._init = true;\r\n\r\n    // Bind the #cg-species change handler (idempotent inside the module)\r\n    bindSpeciesEvents();\r\n\r\n    // Initial population if the select exists\r\n    const sel = document.querySelector('#cg-species');\r\n    if (sel) {\r\n      SpeciesAPI.populateSelect(sel);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Refresh the species <select>. Will repopulate if empty or when force=true.\r\n   * @param {{force?: boolean}} opts\r\n   * @returns {Promise<void>|void}\r\n   */\r\n  refresh(opts = {}) {\r\n    const sel = document.querySelector('#cg-species');\r\n    if (!sel) return;\r\n\r\n    const force = !!opts.force || (sel.options.length <= 1);\r\n    return SpeciesAPI.populateSelect(sel, { force });\r\n  }\r\n};\r\n\r\nexport default SpeciesIndex;\r\n", "// assets/js/src/core/career/events.js\r\n// One-time, namespaced bindings for Career select.\r\n// Fetches + normalizes profile, stores it on CareerAPI.currentProfile,\r\n// renders Profile tab gifts, and announces via cg:career:changed.\r\n\r\nimport CareerAPI from './api.js';\r\n\r\nconst $ = window.jQuery;\r\nlet _bound = false;\r\n\r\nfunction normalizeCareerProfile(raw = {}) {\r\n  const out = { ...raw };\r\n\r\n  // Readable name used by Skills/Summary headers\r\n  out.careerName =\r\n    raw.careerName ||\r\n    raw.career_name ||\r\n    raw.ct_career_name ||\r\n    raw.name ||\r\n    raw.title ||\r\n    '';\r\n\r\n  // Ensure skill ids are strings (Skills module compares as strings)\r\n  if (raw.skill_one   != null) out.skill_one   = String(raw.skill_one);\r\n  if (raw.skill_two   != null) out.skill_two   = String(raw.skill_two);\r\n  if (raw.skill_three != null) out.skill_three = String(raw.skill_three);\r\n\r\n  // Gifts (keep id fields if present; Traits service references gift_id_*)\r\n  ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\r\n    if (raw[k] != null) out[k] = String(raw[k]);\r\n  });\r\n\r\n  // Manifold counts (default 1)\r\n  ['manifold_1', 'manifold_2', 'manifold_3'].forEach(k => {\r\n    if (raw[k] != null) out[k] = parseInt(raw[k], 10) || 1;\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\nfunction renderGiftList($ul, items = []) {\r\n  if (!$ul || !$ul.length) return;\r\n  $ul.empty();\r\n  items.forEach(txt => {\r\n    if (!txt) return;\r\n    $ul.append(`<li>${txt}</li>`);\r\n  });\r\n}\r\n\r\nfunction namesFromProfile(profile = {}) {\r\n  // Prefer gift_1..gift_3 (names), otherwise nothing\r\n  const names = [profile.gift_1, profile.gift_2, profile.gift_3]\r\n    .map(v => (v == null ? '' : String(v)))\r\n    .filter(Boolean);\r\n  // Add \u00D7 manifold if > 1\r\n  return names.map((name, i) => {\r\n    const m = profile[`manifold_${i+1}`];\r\n    const mult = parseInt(m, 10) || 1;\r\n    return mult > 1 ? `${name} \u00D7 ${mult}` : name;\r\n  });\r\n}\r\n\r\nexport default function bindCareerEvents() {\r\n  if (_bound) return;\r\n  _bound = true;\r\n\r\n  $(document)\r\n    .off('change.cg', '#cg-career')\r\n    .on('change.cg', '#cg-career', e => {\r\n      const val = (e.currentTarget && e.currentTarget.value) || '';\r\n      console.log('[CareerEvents] selected career \u2192', val);\r\n\r\n      // Clear UI when nothing selected\r\n      if (!val) {\r\n        CareerAPI.currentProfile = null;\r\n        renderGiftList($('#career-gifts'), []);\r\n        $(document).trigger('cg:career:changed', [{ id: '', profile: null }]);\r\n        return;\r\n      }\r\n\r\n      // Fetch the profile, store it, show gifts, and broadcast\r\n      CareerAPI.fetchProfile(val).done(profileRaw => {\r\n        const profile = normalizeCareerProfile(profileRaw || {});\r\n        CareerAPI.currentProfile = profile;\r\n\r\n        // Try to render gifts from profile; if empty, fall back to gifts endpoint\r\n        const $ul = $('#career-gifts');\r\n        const fromProfile = namesFromProfile(profile);\r\n\r\n        if (fromProfile.length) {\r\n          renderGiftList($ul, fromProfile);\r\n          $(document).trigger('cg:career:changed', [{ id: String(val), profile }]);\r\n        } else {\r\n          CareerAPI.fetchGifts(val).done(gifts => {\r\n            const giftNames = []\r\n              .concat(gifts || [])\r\n              .map(g => (g && typeof g === 'object') ? (g.name || g.title || g.ct_gift_name || '') : String(g))\r\n              .filter(Boolean);\r\n            renderGiftList($ul, giftNames);\r\n            $(document).trigger('cg:career:changed', [{ id: String(val), profile }]);\r\n          });\r\n        }\r\n      });\r\n    });\r\n}\r\n", "// assets/js/src/core/career/index.js\r\n// Coordinates Career API + events + select population/refetch\r\n\r\nimport CareerAPI from './api.js';\r\nimport bindCareerEvents from './events.js';\r\n\r\nconst CareerIndex = {\r\n  _init: false,\r\n\r\n  /**\r\n   * One-time init: bind change events and populate the select if present.\r\n   */\r\n  init() {\r\n    if (this._init) return;\r\n    this._init = true;\r\n\r\n    // Bind the #cg-career change handler (idempotent inside the module)\r\n    bindCareerEvents();\r\n\r\n    // Initial population if the select exists\r\n    const sel = document.querySelector('#cg-career');\r\n    if (sel) {\r\n      CareerAPI.populateSelect(sel).catch?.(() => {});\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Refresh the career <select>. Will repopulate if empty or when force=true.\r\n   * @param {{force?: boolean}} opts\r\n   * @returns {Promise<void>|void}\r\n   */\r\n  refresh(opts = {}) {\r\n    const sel = document.querySelector('#cg-career');\r\n    if (!sel) return;\r\n\r\n    const force = !!opts.force || (sel.options.length <= 1);\r\n    return CareerAPI.populateSelect(sel, { force }).catch?.(() => {});\r\n  }\r\n};\r\n\r\nexport default CareerIndex;\r\n", "// assets/js/src/core/main/builder-ui.js\r\n// Ensures Species/Career lists populate on open and on load,\r\n// binds robust change flows so gifts/other tabs refresh.\r\n\r\nimport FormBuilderAPI from '../formBuilder';\r\nimport SpeciesIndex   from '../species';\r\nimport CareerIndex    from '../career';\r\n\r\nconst $ = window.jQuery;\r\n\r\nlet isDirty = false;\r\n\r\nconst SELECTORS = {\r\n  species: ['select[name=\"species\"]', 'select[data-cg=\"species\"]', 'select.cg-species'],\r\n  career:  ['select[name=\"career\"]',  'select[data-cg=\"career\"]',  'select.cg-career'],\r\n};\r\n\r\nfunction first(selectorList, root = document) {\r\n  for (let i = 0; i < selectorList.length; i++) {\r\n    const el = root.querySelector(selectorList[i]);\r\n    if (el) return el;\r\n  }\r\n  return null;\r\n}\r\n\r\nfunction waitForSelects(timeoutMs = 2000) {\r\n  return new Promise(resolve => {\r\n    const start = Date.now();\r\n    (function tick() {\r\n      const speciesEl = first(SELECTORS.species);\r\n      const careerEl  = first(SELECTORS.career);\r\n      if (speciesEl && careerEl) return resolve({ speciesEl, careerEl });\r\n      if (Date.now() - start > timeoutMs) return resolve({ speciesEl, careerEl });\r\n      setTimeout(tick, 50);\r\n    })();\r\n  });\r\n}\r\n\r\nasync function ensureListsThenApply(record = {}) {\r\n  // Ask feature modules to build/bind (idempotent).\r\n  SpeciesIndex.init();\r\n  CareerIndex.init();\r\n\r\n  // Wait for selects to exist (form may render async).\r\n  const { speciesEl, careerEl } = await waitForSelects();\r\n\r\n  // Populate options if empty (feature modules handle globals/AJAX and dedupe).\r\n  if (speciesEl && speciesEl.options.length <= 1) SpeciesIndex.refresh();\r\n  if (careerEl  && careerEl.options.length  <= 1) CareerIndex.refresh();\r\n\r\n  // Apply record selections (id or name), then fire change so downstream recalcs run.\r\n  if (speciesEl) {\r\n    const want = record.species ?? record.species_id ?? '';\r\n    if (want) {\r\n      $(speciesEl).val(String(want));\r\n      if ($(speciesEl).val() !== String(want)) {\r\n        // try by visible text as fallback\r\n        const byName = [...speciesEl.options].find(o => o.textContent === String(want));\r\n        if (byName) $(speciesEl).val(byName.value);\r\n      }\r\n      $(speciesEl).trigger('change');\r\n    }\r\n  }\r\n\r\n  if (careerEl) {\r\n    const want = record.career ?? record.career_id ?? '';\r\n    if (want) {\r\n      $(careerEl).val(String(want));\r\n      if ($(careerEl).val() !== String(want)) {\r\n        const byName = [...careerEl.options].find(o => o.textContent === String(want));\r\n        if (byName) $(careerEl).val(byName.value);\r\n      }\r\n      $(careerEl).trigger('change');\r\n    }\r\n  }\r\n}\r\n\r\nfunction openBuilder({ isNew = false, payload = {} } = {}) {\r\n  console.log('[BuilderUI] openBuilder()', { isNew, payload });\r\n\r\n  isDirty = false;\r\n  $('#cg-unsaved-confirm, #cg-unsaved-backdrop').hide().css('display', 'none');\r\n\r\n  try { FormBuilderAPI?.init?.({ ...payload, isNew }); } catch (e) {\r\n    console.error('[BuilderUI] FormBuilderAPI.init error', e);\r\n  }\r\n\r\n  $('#cg-modal-overlay, #cg-modal')\r\n    .removeClass('cg-hidden')\r\n    .addClass('cg-visible')\r\n    .css('display', 'block');\r\n\r\n  if (isNew) $('#cg-modal .cg-tabs li[data-tab=\"tab-traits\"]').trigger('click');\r\n\r\n  // Critically: (re)build species/career options and push changes downstream.\r\n  ensureListsThenApply(payload).then(() => {\r\n    document.dispatchEvent(new CustomEvent('cg:builder:opened', { detail: { isNew, payload } }));\r\n  });\r\n}\r\n\r\nfunction closeBuilder() {\r\n  $('#cg-unsaved-backdrop').hide().css('display', 'none');\r\n  $('#cg-unsaved-confirm').removeClass('cg-visible').addClass('cg-hidden').hide().css('display', 'none');\r\n  $('#cg-modal, #cg-modal-overlay')\r\n    .removeClass('cg-visible')\r\n    .addClass('cg-hidden')\r\n    .fadeOut(200, () => {\r\n      $('#cg-form-container').empty();\r\n      document.dispatchEvent(new CustomEvent('cg:builder:closed'));\r\n    });\r\n  isDirty = false;\r\n}\r\n\r\nfunction markDirty()  { isDirty = true;  }\r\nfunction markClean()  { isDirty = false; }\r\nfunction getIsDirty() { return isDirty;  }\r\n\r\nfunction showUnsaved() {\r\n  if (!$('#cg-unsaved-backdrop').length) $('<div id=\"cg-unsaved-backdrop\"></div>').appendTo('body');\r\n  const $b = $('#cg-unsaved-backdrop'); const $p = $('#cg-unsaved-confirm');\r\n  if (!$p.parent().is('body')) $p.appendTo('body');\r\n  $b.show().css('display', 'block');\r\n  $p.removeClass('cg-hidden').addClass('cg-visible').show().css('display', 'block');\r\n}\r\n\r\nfunction hideUnsaved() {\r\n  $('#cg-unsaved-backdrop').hide().css('display', 'none');\r\n  $('#cg-unsaved-confirm').removeClass('cg-visible').addClass('cg-hidden').hide().css('display', 'none');\r\n}\r\n\r\n// When a character is fetched, rehydrate lists & selections and fire changes.\r\ndocument.addEventListener('cg:character:loaded', (ev) => {\r\n  const record = ev?.detail || {};\r\n  console.log('[BuilderUI] cg:character:loaded \u2192 rehydrate for record', record);\r\n  ensureListsThenApply(record);\r\n});\r\n\r\nexport default {\r\n  open: openBuilder,\r\n  openBuilder,\r\n  close: closeBuilder,\r\n  closeBuilder,\r\n  showUnsaved,\r\n  hideUnsaved,\r\n  markDirty,\r\n  markClean,\r\n  getIsDirty,\r\n};\r\n", "// binds DOM events for traits\r\n\r\nimport TraitsService from './service.js';\r\n\r\nconst $ = window.jQuery;\r\nlet bound = false;\r\n\r\nexport default {\r\n  bind() {\r\n    if (bound) return;\r\n    bound = true;\r\n\r\n    // on initial page load (or panel insert)\r\n    $(function(){\r\n      TraitsService.refreshAll();\r\n    });\r\n\r\n    // re-apply limits & labels on any dropdown change\r\n    $(document)\r\n      .off('change', '.cg-trait-select')\r\n      .on('change', '.cg-trait-select', () => {\r\n        TraitsService.refreshAll();\r\n      });\r\n  }\r\n};\r\n", "// public API for Traits\r\n\r\nimport TraitsService from './service.js';\r\nimport TraitsEvents  from './events.js';\r\n\r\nexport default {\r\n  init() {\r\n    // Enforce and display initial trait limits\r\n    TraitsService.refreshAll();\r\n\r\n    // Wire up change handlers\r\n    TraitsEvents.bind();\r\n  },\r\n\r\n  // Expose for other modules\r\n  getBoostedDie: TraitsService.getBoostedDie.bind(TraitsService)\r\n};\r\n", "// assets/js/src/core/gifts/free-choices.js\n//\n// Free-choice gifts dropdowns (3).\n// - Mounts into Profile tab placeholder #cg-free-choices when present.\n// - Ensures expected IDs exist (#cg-free-choice-0..2) so collectFormData() can read them.\n// - Safe remount when builder DOM is re-rendered (detached nodes).\n// - Syncs gift rows into State.gifts so TraitsService can read ct_gifts_manifold.\n// - Filters options by prereqs: ct_gifts_requires .. ct_gifts_requires_nineteen.\n// - A gift with NO prereqs is always eligible.\n// - If prereqs exist, ALL non-empty prereq IDs must already be acquired (free/species/career).\n//\n// Exposes: window.CG_FreeChoices (+ window.CG_FormBuilderAPI for debugging)\n\nimport State from './state.js';\nimport FormBuilderAPI from '../formBuilder';\nimport SpeciesAPI from '../species/api.js';\nimport CareerAPI from '../career/api.js';\n\nconst $ = window.jQuery;\n\nconst log  = (...a) => (window.CG_DEBUG_GIFTS ? console.log('[FreeChoices]', ...a) : null);\nconst warn = (...a) => console.warn('[FreeChoices]', ...a);\nconst err  = (...a) => console.error('[FreeChoices]', ...a);\n\nconst REQ_SUFFIXES = [\n  '', 'two','three','four','five','six',\n  'seven','eight','nine','ten','eleven',\n  'twelve','thirteen','fourteen','fifteen',\n  'sixteen','seventeen','eighteen','nineteen'\n];\n\n// These appear to be \u201Calways present\u201D gifts in your UI/endpoint set.\nconst ALWAYS_ACQUIRED_GIFT_IDS = ['242', '236']; // Local Knowledge, Language\n\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  const url =\n    env.ajax_url ||\n    window.ajaxurl ||\n    document.body?.dataset?.ajaxUrl ||\n    '/wp-admin/admin-ajax.php';\n\n  // Prefer per-action nonce if available\n  const perAction = (window.CG_NONCES && window.CG_NONCES.cg_get_free_gifts)\n    ? window.CG_NONCES.cg_get_free_gifts\n    : null;\n\n  const generic = env.nonce || env.security || env._ajax_nonce || window.CG_NONCE || null;\n  return { url, nonce: (perAction || generic) };\n}\n\nfunction parseJsonMaybe(res) {\n  try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n  catch (_) { return res; }\n}\n\nfunction isTruthyBool(v) {\n  if (v === true) return true;\n  if (v === false) return false;\n  if (v == null) return false;\n  const s = String(v).trim().toLowerCase();\n  return (s === '1' || s === 'true' || s === 'yes' || s === 'y' || s === 'on');\n}\n\nfunction splitIds(val) {\n  if (val == null) return [];\n  if (Array.isArray(val)) return val.flatMap(splitIds);\n  const s = String(val).trim();\n  if (!s) return [];\n  // split on commas/whitespace\n  return s.split(/[,\\s]+/g)\n    .map(t => t.trim())\n    .filter(Boolean)\n    // only keep \u201Cnumber-ish\u201D tokens\n    .map(t => (String(parseInt(t, 10)) === 'NaN' ? '' : String(parseInt(t, 10))))\n    .filter(Boolean);\n}\n\nfunction extractRequires(rawGift) {\n  const req = [];\n  REQ_SUFFIXES.forEach(suf => {\n    const key = suf ? `ct_gifts_requires_${suf}` : 'ct_gifts_requires';\n    if (!Object.prototype.hasOwnProperty.call(rawGift, key)) return;\n    req.push(...splitIds(rawGift[key]));\n  });\n  // de-dupe\n  return Array.from(new Set(req));\n}\n\nfunction normalizeGiftForState(g) {\n  if (!g || typeof g !== 'object') return null;\n\n  const idRaw =\n    g.id ?? g.ct_id ?? g.gift_id ?? g.ct_gift_id ?? g.ct_gifts_id ?? null;\n\n  if (idRaw == null || String(idRaw) === '') return null;\n\n  const manifoldRaw =\n    g.ct_gifts_manifold ?? g.manifold ?? g.manifold_count ?? g.ct_manifold ?? 1;\n\n  const id = String(idRaw);\n\n  return {\n    ...g,\n    id,\n    ct_gifts_manifold: parseInt(manifoldRaw, 10) || 1,\n    name: (g.name || g.ct_gifts_name || g.title || '').toString() || `Gift #${id}`,\n    allows_multiple: isTruthyBool(g.allows_multiple ?? g.ct_gifts_allows_multiple ?? 0),\n    requires: extractRequires(g),\n  };\n}\n\nfunction inDom(node) {\n  return !!(node && document.contains(node));\n}\n\nconst FreeChoices = {\n  _inited: false,\n  _mounted: false,\n\n  _root: null,     // placeholder (#cg-free-choices or fallback section)\n  _host: null,     // row wrapper\n  _selects: [],\n\n  _allGifts: [],   // normalized full gifts from endpoint (includes requires/allows_multiple)\n  _refreshInFlight: false,\n  _lastRefreshAt: 0,\n  _retryCount: 0,\n  _maxRetries: 2,\n\n  _mountTimer: null,\n  _mountTries: 0,\n  _maxMountTries: 80, // 80 * 250ms = 20s\n\n  _suppressEmit: false,\n\n  init() {\n    if (this._inited) return;\n    this._inited = true;\n\n    window.CG_FormBuilderAPI = FormBuilderAPI;\n\n    try { State.init(); } catch (_) {}\n\n    this._ensureMounted();\n\n    // Re-mount + refresh when builder opens\n    document.addEventListener('cg:builder:opened', () => {\n      this._ensureMounted();\n      this.refresh({ force: false });\n    });\n\n    // React to changes that affect prereqs\n    if ($) {\n      $(document)\n        .off('cg:species:changed.cgfree cg:career:changed.cgfree cg:free-gift:changed.cgfree')\n        .on('cg:species:changed.cgfree cg:career:changed.cgfree cg:free-gift:changed.cgfree', () => {\n          // No refetch needed; just re-filter options\n          this._fillSelectsFiltered();\n        });\n    }\n    document.addEventListener('cg:free-gift:changed', () => this._fillSelectsFiltered());\n\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', () => this._ensureMounted());\n    }\n  },\n\n  _resetMount() {\n    this._mounted = false;\n    this._root = null;\n    this._host = null;\n    this._selects = [];\n  },\n\n  _ensureMounted() {\n    if (this._mounted && (!inDom(this._root) || !inDom(this._host))) {\n      warn('mounted root was detached; remounting');\n      this._resetMount();\n    }\n    if (this._mounted) return true;\n\n    const ok = this._tryMount();\n    if (ok) return true;\n\n    if (this._mountTimer) return false;\n\n    this._mountTries = 0;\n    this._mountTimer = setInterval(() => {\n      this._mountTries++;\n      if (this._tryMount()) {\n        clearInterval(this._mountTimer);\n        this._mountTimer = null;\n        this.refresh({ force: false });\n        return;\n      }\n      if (this._mountTries >= this._maxMountTries) {\n        clearInterval(this._mountTimer);\n        this._mountTimer = null;\n      }\n    }, 250);\n\n    return false;\n  },\n\n  _tryMount() {\n    let root = document.querySelector('#cg-free-choices');\n\n    if (!root) {\n      const container = document.querySelector('#cg-form-container');\n      if (!container) return false;\n\n      let section = document.getElementById('cg-free-gifts');\n      if (!section) {\n        section = document.createElement('section');\n        section.id = 'cg-free-gifts';\n        section.innerHTML = `<h3>Free Gifts (3)</h3><div class=\"cg-free-row\"></div>`;\n        container.appendChild(section);\n      }\n      root = section;\n    }\n\n    if (!root) return false;\n\n    let row = root.querySelector('.cg-free-row');\n    if (!row) {\n      row = document.createElement('div');\n      row.className = 'cg-free-row';\n      root.appendChild(row);\n    }\n\n    row.style.display = 'flex';\n    row.style.flexWrap = 'wrap';\n    row.style.gap = '12px';\n    row.style.marginTop = '8px';\n    row.style.width = '100%';\n    row.style.maxWidth = '100%';\n    row.style.boxSizing = 'border-box';\n    row.style.alignItems = 'flex-start';\n\n    const ensureSelect = (slot) => {\n      const id = `cg-free-choice-${slot}`;\n      let sel = row.querySelector(`#${id}`);\n      if (!sel) {\n        sel = document.createElement('select');\n        sel.id = id;\n        sel.className = 'cg-free-select';\n        sel.setAttribute('data-slot', String(slot));\n        row.appendChild(sel);\n      }\n\n      sel.style.flex = '1 1 240px';\n      sel.style.minWidth = '200px';\n      sel.style.maxWidth = '100%';\n      sel.style.width = '100%';\n      sel.style.boxSizing = 'border-box';\n\n      return sel;\n    };\n\n    const s0 = ensureSelect(0);\n    const s1 = ensureSelect(1);\n    const s2 = ensureSelect(2);\n\n    this._root = root;\n    this._host = row;\n    this._selects = [s0, s1, s2];\n\n    // Bind once\n    this._selects.forEach(sel => {\n      if ($) {\n        $(sel).off('change.cgfree').on('change.cgfree', () => this._onSelectChange(sel));\n      } else {\n        sel.onchange = () => this._onSelectChange(sel);\n      }\n    });\n\n    this._mounted = true;\n    this._drawPlaceholders();\n    return true;\n  },\n\n  _drawPlaceholders() {\n    if (!this._mounted) return;\n    const placeholders = [\n      '\u2014 Select gift #1 \u2014',\n      '\u2014 Select gift #2 \u2014',\n      '\u2014 Select gift #3 \u2014'\n    ];\n    this._selects.forEach((sel, idx) => {\n      sel.innerHTML = '';\n      sel.appendChild(new Option(placeholders[idx], ''));\n    });\n  },\n\n  _readSelections() {\n    let src = null;\n\n    try {\n      if (FormBuilderAPI && FormBuilderAPI._data) {\n        src = FormBuilderAPI._data.free_gifts || FormBuilderAPI._data.freeGifts || null;\n      }\n    } catch (_) {}\n\n    if (!Array.isArray(src)) {\n      try { if (Array.isArray(State.selected)) src = State.selected; } catch (_) {}\n    }\n    if (!Array.isArray(src)) src = this._selects.map(s => s.value || '');\n\n    const out = (Array.isArray(src) ? src : [])\n      .slice(0, 3)\n      .map(v => (v ? String(v) : ''));\n    while (out.length < 3) out.push('');\n    return out;\n  },\n\n  _writeSelections(arrStr) {\n    const normalized = (Array.isArray(arrStr) ? arrStr : [])\n      .slice(0, 3)\n      .map(v => (v ? String(v) : ''));\n    while (normalized.length < 3) normalized.push('');\n\n    try {\n      if (FormBuilderAPI && FormBuilderAPI._data) {\n        FormBuilderAPI._data.free_gifts = normalized.slice();\n        FormBuilderAPI._data.freeGifts  = normalized.slice();\n      }\n    } catch (_) {}\n\n    try { State.setSelected(normalized); } catch (_) {}\n\n    if (this._suppressEmit) return;\n\n    document.dispatchEvent(new CustomEvent('cg:free-gift:changed', {\n      detail: { free_gifts: normalized }\n    }));\n    if ($) $(document).trigger('cg:free-gift:changed', [{ free_gifts: normalized }]);\n  },\n\n  _onSelectChange(sel) {\n    const slot = parseInt(sel.getAttribute('data-slot') || '0', 10);\n    const cur = this._readSelections();\n    cur[slot] = sel.value || '';\n\n    // Persist, then re-filter so newly unlocked gifts appear immediately\n    this._writeSelections(cur);\n    this._fillSelectsFiltered();\n  },\n\n  _acquiredGiftIdSet(selections) {\n    const set = new Set();\n\n    // Always-acquired gifts (if your rules want these)\n    ALWAYS_ACQUIRED_GIFT_IDS.forEach(id => set.add(String(id)));\n\n    // Free choices\n    (selections || []).forEach(id => { if (id) set.add(String(id)); });\n\n    // Species gifts\n    const sp = SpeciesAPI?.currentProfile || null;\n    if (sp) {\n      ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\n        if (sp[k] != null && String(sp[k])) set.add(String(sp[k]));\n      });\n    }\n\n    // Career gifts\n    const cp = CareerAPI?.currentProfile || null;\n    if (cp) {\n      ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\n        if (cp[k] != null && String(cp[k])) set.add(String(cp[k]));\n      });\n    }\n\n    return set;\n  },\n\n  _isEligibleGift(g, acquiredSet) {\n    const req = Array.isArray(g.requires) ? g.requires : [];\n    if (!req.length) return true;\n    // AND semantics: all prereqs must be acquired\n    return req.every(id => acquiredSet.has(String(id)));\n  },\n\n  _optionsForSlot(slot, selections, acquiredSet) {\n    const cur = selections[slot] || '';\n    const otherSelected = new Set(\n      selections.map((id, i) => (i === slot ? '' : (id || ''))).filter(Boolean)\n    );\n\n    return (this._allGifts || [])\n      .filter(g => {\n        if (!g || !g.id) return false;\n        if (!this._isEligibleGift(g, acquiredSet)) return false;\n\n        // Prevent duplicates unless allows_multiple OR it is the current selection\n        if (!g.allows_multiple && otherSelected.has(String(g.id)) && String(g.id) !== String(cur)) {\n          return false;\n        }\n        return true;\n      })\n      .map(g => ({ id: String(g.id), name: String(g.name || `Gift #${g.id}`) }));\n  },\n\n  _fillSelectsFiltered() {\n    if (!this._mounted) return;\n    if (!Array.isArray(this._allGifts) || !this._allGifts.length) {\n      this._drawPlaceholders();\n      return;\n    }\n\n    const placeholders = [\n      '\u2014 Select gift #1 \u2014',\n      '\u2014 Select gift #2 \u2014',\n      '\u2014 Select gift #3 \u2014'\n    ];\n\n    // Iterate a few times to clear any now-invalid selections (after species/career changes)\n    let selections = this._readSelections().slice();\n    let changed = false;\n\n    for (let pass = 0; pass < 3; pass++) {\n      changed = false;\n      const acquired = this._acquiredGiftIdSet(selections);\n\n      for (let slot = 0; slot < this._selects.length; slot++) {\n        const opts = this._optionsForSlot(slot, selections, acquired);\n        const cur  = selections[slot] || '';\n        const isCurValid = !cur || opts.some(o => o.id === String(cur));\n\n        if (cur && !isCurValid) {\n          log('Clearing invalid selection', { slot, cur });\n          selections[slot] = '';\n          changed = true;\n        }\n      }\n\n      if (!changed) break;\n    }\n\n    // If we had to clear anything, persist silently first\n    const before = this._readSelections().slice();\n    if (selections.join('|') !== before.join('|')) {\n      this._suppressEmit = true;\n      this._writeSelections(selections);\n      this._suppressEmit = false;\n    }\n\n    const acquiredFinal = this._acquiredGiftIdSet(selections);\n\n    const fillSelect = (sel, options, placeholder, prior) => {\n      sel.innerHTML = '';\n      sel.appendChild(new Option(placeholder, ''));\n\n      options.forEach(opt => sel.appendChild(new Option(opt.name, opt.id)));\n\n      if (prior && options.some(o => o.id === String(prior))) {\n        sel.value = String(prior);\n      } else {\n        sel.value = '';\n      }\n    };\n\n    this._selects.forEach((sel, idx) => {\n      const options = this._optionsForSlot(idx, selections, acquiredFinal);\n      fillSelect(sel, options, placeholders[idx], selections[idx]);\n    });\n\n    // Sync state (silently; DOM is authoritative here)\n    const nowSel = this._selects.map(s => s.value || '');\n    if (nowSel.join('|') !== selections.join('|')) {\n      this._suppressEmit = true;\n      this._writeSelections(nowSel);\n      this._suppressEmit = false;\n    }\n  },\n\n  refresh({ force = false } = {}) {\n    this._ensureMounted();\n    if (!this._mounted) return;\n\n    const now = Date.now();\n    if (!force && (now - this._lastRefreshAt) < 3000) return;\n    if (this._refreshInFlight) return;\n    this._refreshInFlight = true;\n\n    const { url, nonce } = ajaxEnv();\n    const payload = { action: 'cg_get_free_gifts' };\n    if (nonce) {\n      payload.security = nonce;\n      payload.nonce = nonce;\n      payload._ajax_nonce = nonce;\n    }\n\n    const onDone = (res) => {\n      this._refreshInFlight = false;\n      this._lastRefreshAt = Date.now();\n\n      const json = parseJsonMaybe(res);\n\n      if (!json || json.success !== true || !Array.isArray(json.data)) {\n        warn('Unexpected response:', json);\n        this._drawPlaceholders();\n        this._maybeRetry();\n        return;\n      }\n\n      const giftRows = json.data\n        .map(normalizeGiftForState)\n        .filter(Boolean);\n\n      // Keep full list for filtering + state lookups\n      this._allGifts = giftRows;\n\n      // TraitsService needs the master list\n      try { State.setList(giftRows); } catch (_) {}\n\n      this._retryCount = 0;\n      this._fillSelectsFiltered();\n    };\n\n    const onFail = (status, errorText, responseText) => {\n      this._refreshInFlight = false;\n      this._lastRefreshAt = Date.now();\n      err('AJAX failed', status, errorText, responseText || '');\n      this._drawPlaceholders();\n      this._maybeRetry();\n    };\n\n    if ($ && $.post) {\n      $.post(url, payload)\n        .done(onDone)\n        .fail((xhr, status, e) => onFail(status, e, xhr?.responseText));\n    } else {\n      const body = new URLSearchParams(payload).toString();\n      fetch(url, {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },\n        body,\n        credentials: 'same-origin'\n      })\n        .then(r => r.text().then(t => ({ status: r.status, text: t })))\n        .then(({ status, text }) => {\n          let j = null;\n          try { j = JSON.parse(text); } catch (_) {}\n          if (status >= 200 && status < 300) onDone(j);\n          else onFail(status, 'http_error', text);\n        })\n        .catch(e => onFail('fetch_error', e?.message || String(e), ''));\n    }\n  },\n\n  _maybeRetry() {\n    if (!this._mounted) return;\n    if (this._retryCount >= this._maxRetries) return;\n\n    this._retryCount++;\n    const delay = 600 * this._retryCount;\n    setTimeout(() => {\n      if (!this._allGifts || !this._allGifts.length) {\n        this.refresh({ force: true });\n      }\n    }, delay);\n  }\n};\n\n// Expose globally\nwindow.CG_FreeChoices = FreeChoices;\n\nexport default FreeChoices;\n", "// assets/js/src/core/gifts/index.js\n//\n// Core-owned Gifts module (no self-boot).\n// BuilderEvents/Core should call GiftsAPI.init().\n\nimport FreeChoices from './free-choices.js';\nimport State from './state.js';\n\nexport function init() {\n  try { State.init(); } catch (_) {}\n  try { FreeChoices.init(); } catch (_) {}\n}\n\nexport function refresh(opts = {}) {\n  try { FreeChoices.refresh(opts); } catch (_) {}\n}\n\nexport function getSelected() {\n  return (Array.isArray(State.selected) ? State.selected : []);\n}\n\nconst GiftsAPI = { init, refresh, getSelected };\nexport default GiftsAPI;\n", "// assets/js/src/core/skills/render.js\r\nimport FormBuilderAPI from '../formBuilder';\r\nimport SpeciesAPI     from '../species/api.js';\r\nimport CareerAPI      from '../career/api.js';\r\n\r\nconst $ = window.jQuery;\r\n\r\n// Map #marks \u2192 die\r\nconst MARK_DIE = {\r\n  1: 'd4',\r\n  2: 'd6',\r\n  3: 'd8'\r\n};\r\n\r\n/** -----------------------------\r\n * Tolerant utilities\r\n * ------------------------------*/\r\nfunction pickFirst(obj, keys) {\r\n  for (const k of keys) {\r\n    if (obj && Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null && obj[k] !== '') {\r\n      return obj[k];\r\n    }\r\n  }\r\n  return null;\r\n}\r\n\r\n/**\r\n * Extract up to 3 skill IDs from *any* shape:\r\n * - flat keys: skill_one/two/three, skill_id_1..3, career_skill_1..3, etc.\r\n * - arrays (of ids or objects with id/skill_id/value)\r\n * - nested under .skills / .career_skills / .data\r\n */\r\nfunction extractSkillTripletFromAny(input) {\r\n  const asStr = v => (v == null ? '' : String(v));\r\n\r\n  if (Array.isArray(input)) {\r\n    const ids = input\r\n      .map(x => (typeof x === 'object') ? (x.id ?? x.skill_id ?? x.value ?? null) : x)\r\n      .filter(v => v != null)\r\n      .slice(0, 3)\r\n      .map(asStr);\r\n    while (ids.length < 3) ids.push('');\r\n    return ids;\r\n  }\r\n\r\n  if (input && typeof input === 'object') {\r\n    if (input.skills != null)         return extractSkillTripletFromAny(input.skills);\r\n    if (input.career_skills != null)  return extractSkillTripletFromAny(input.career_skills);\r\n    if (input.species_skills != null) return extractSkillTripletFromAny(input.species_skills);\r\n    if (input.data != null)           return extractSkillTripletFromAny(input.data);\r\n\r\n    const id1 = pickFirst(input, [\r\n      'skill_one', 'skill1', 'skill_id_1', 'skill_one_id', 'career_skill_1', 'career_skill_one'\r\n    ]);\r\n    const id2 = pickFirst(input, [\r\n      'skill_two', 'skill2', 'skill_id_2', 'skill_two_id', 'career_skill_2', 'career_skill_two'\r\n    ]);\r\n    const id3 = pickFirst(input, [\r\n      'skill_three', 'skill3', 'skill_id_3', 'skill_three_id', 'career_skill_3', 'career_skill_three'\r\n    ]);\r\n    return [asStr(id1), asStr(id2), asStr(id3)];\r\n  }\r\n\r\n  return ['', '', ''];\r\n}\r\n\r\n/** Best-effort name helpers */\r\nfunction speciesNameOf(sp) {\r\n  return (\r\n    sp?.speciesName ||\r\n    sp?.species_name ||\r\n    sp?.name ||\r\n    ''\r\n  );\r\n}\r\n\r\nfunction careerNameOf(cp) {\r\n  return (\r\n    cp?.careerName ||\r\n    cp?.career_name ||\r\n    cp?.name ||\r\n    ''\r\n  );\r\n}\r\n\r\nexport default {\r\n  render() {\r\n    const data    = FormBuilderAPI.getData();\r\n    const skills  = data.skillsList || window.CG_SKILLS_LIST || [];\r\n    const species = SpeciesAPI.currentProfile || {};\r\n    const career  = CareerAPI.currentProfile  || {};\r\n\r\n    // Read marks state & remaining budget\r\n    data.skillMarks = data.skillMarks || {};\r\n    const MAX_MARKS = 13;\r\n    const usedMarks = Object.values(data.skillMarks)\r\n      .reduce((sum, v) => sum + (parseInt(v, 10) || 0), 0);\r\n    const marksRemain = Math.max(0, MAX_MARKS - usedMarks);\r\n\r\n    // Inject \u201CMarks Remaining\u201D display\r\n    $('#marks-remaining').remove();\r\n    $('#skills-table').before(`\r\n      <div id=\"marks-remaining\" class=\"marks-remaining\">\r\n        Marks Remaining: <strong>${marksRemain}</strong>\r\n      </div>\r\n    `);\r\n\r\n    // Build table header\r\n    const $thead = $('<thead>');\r\n    $('<tr>')\r\n      .append('<th>Skill</th>')\r\n      .append(`<th>${speciesNameOf(species) || ''}</th>`)\r\n      .append(`<th>${careerNameOf(career) || ''}</th>`)\r\n      .append('<th>Marks</th>')\r\n      .append('<th>Dice Pool</th>')\r\n      .appendTo($thead);\r\n\r\n    // Species & Career skill IDs (tolerant)\r\n    const spSkills = extractSkillTripletFromAny(species).map(String);\r\n    const cpSkills = extractSkillTripletFromAny(career).map(String);\r\n\r\n    const $tbody = $('<tbody>');\r\n\r\n    skills.forEach(skill => {\r\n      const id   = String(skill.id);\r\n      const name = skill.name;\r\n\r\n      // base dice\r\n      const spDie = spSkills.includes(id) ? 'd4' : '';\r\n      const cpDie = cpSkills.includes(id) ? 'd6' : '';\r\n\r\n      // mark buttons: empty content, active if mark index \u2264 myMarks\r\n      const myMarks = parseInt(data.skillMarks[id], 10) || 0;\r\n      let buttonsHtml = '';\r\n      [1, 2, 3].forEach(n => {\r\n        // disable any button above remaining budget (unless already active)\r\n        const disabled = (usedMarks >= MAX_MARKS && myMarks < n) ? ' disabled' : '';\r\n        const active   = myMarks >= n ? ' active' : '';\r\n        buttonsHtml += `<button\r\n          type=\"button\"\r\n          class=\"skill-mark-btn${active}\"\r\n          data-skill-id=\"${id}\"\r\n          data-mark=\"${n}\"\r\n          ${disabled}\r\n        ></button>`;\r\n      });\r\n\r\n      const markDie     = myMarks ? MARK_DIE[myMarks] : '';\r\n      const markDisplay = markDie || '\u2013';\r\n\r\n      // dice pool = species + career + marks\r\n      const poolDice = [spDie, cpDie, markDie].filter(Boolean);\r\n      const poolStr  = poolDice.length ? poolDice.join(' + ') : '\u2013';\r\n\r\n      const $row = $('<tr>')\r\n        .append(`<td>${name}</td>`)\r\n        .append(`<td>${spDie || '\u2013'}</td>`)\r\n        .append(`<td>${cpDie || '\u2013'}</td>`)\r\n        .append(`<td>\r\n                   <div class=\"marks-buttons\">${buttonsHtml}</div>\r\n                   <div class=\"marks-display\">${markDisplay}</div>\r\n                 </td>`)\r\n        .append(`<td>${poolStr}</td>`);\r\n\r\n      $tbody.append($row);\r\n    });\r\n\r\n    // Inject into DOM\r\n    $('#skills-table')\r\n      .empty()\r\n      .append($thead)\r\n      .append($tbody);\r\n  }\r\n};\r\n", "// assets/js/src/core/skills/events.js\r\n\r\nimport FormBuilderAPI from '../formBuilder';\r\nimport SkillsRender   from './render.js';\r\n\r\nconst $ = window.jQuery;\r\n\r\nexport default {\r\n  bind() {\r\n    // On tab click or species/career change, re-render\r\n    $(document)\r\n      .off('click', '#tab-skills, #cg-species, #cg-career')\r\n      .on('click change', '#tab-skills, #cg-species, #cg-career', () => {\r\n        SkillsRender.render();\r\n      });\r\n\r\n    // Handle mark\u2010button clicks\r\n    $(document)\r\n      .off('click', '.skill-mark-btn')\r\n      .on('click', '.skill-mark-btn', function() {\r\n        const skillId = String($(this).data('skill-id'));\r\n        const mark    = parseInt($(this).data('mark'), 10);\r\n        const data    = FormBuilderAPI.getData();\r\n\r\n        data.skillMarks = data.skillMarks || {};\r\n        data.skillMarks[skillId] = mark;\r\n\r\n        // Re-render to update buttons, marks remaining & dice pools\r\n        SkillsRender.render();\r\n      });\r\n  }\r\n};\r\n", "// assets/js/src/core/skills/index.js\r\n\r\nimport FormBuilderAPI from '../formBuilder';\r\nimport SkillsEvents   from './events.js';\r\nimport SkillsRender   from './render.js';\r\n\r\nexport default {\r\n  init() {\r\n    // 1) Logging the initial builder state\r\n    console.log('[SkillsIndex] init \u2014 builder state:', FormBuilderAPI._data);\r\n\r\n    // 2) Ensure we have the localized skills list\r\n    if (!Array.isArray(FormBuilderAPI._data.skillsList)) {\r\n      FormBuilderAPI._data.skillsList = window.CG_SKILLS_LIST || [];\r\n    }\r\n\r\n    // 3) Initialize marks\u2010allocation storage if missing\r\n    if (typeof FormBuilderAPI._data.skillMarks !== 'object') {\r\n      FormBuilderAPI._data.skillMarks = {};\r\n    }\r\n\r\n    // 4) Wire up click/change handlers for tab, species, career, and mark buttons\r\n    SkillsEvents.bind();\r\n\r\n    // 5) Initial render of the full skills table (headers, buttons, pools, marks remaining)\r\n    SkillsRender.render();\r\n  }\r\n};\r\n", "// Shared utilities for Summary\r\n\r\n/**\r\n * Capitalize first letter and replace underscores/dashes with spaces.\r\n */\r\nexport function capitalize(str) {\r\n  if (typeof str !== 'string') return '';\r\n  const cleaned = str.replace(/[_\\-]/g, ' ');\r\n  return cleaned.charAt(0).toUpperCase() + cleaned.slice(1);\r\n}\r\n\r\n/**\r\n * Given a die string like \"d8\", return half (rounded up) as a \"dX\".\r\n */\r\nexport function halfDie(die) {\r\n  if (typeof die !== 'string' || die[0] !== 'd') return '';\r\n  const n = parseInt(die.slice(1), 10);\r\n  return `d${Math.ceil(n / 2)}`;\r\n}\r\n\r\n/**\r\n * Maximum values for dice types.\r\n */\r\nexport const DIE_MAX = {\r\n  d4:  4,\r\n  d6:  6,\r\n  d8:  8,\r\n  d10: 10,\r\n  d12: 12\r\n};\r\n", "// assets/js/src/core/summary/api.js\r\n\r\nimport FormBuilderAPI from '../formBuilder';\r\nimport * as Utils     from './utils.js';\r\nimport TraitsService  from '../traits/service.js';\r\nimport SpeciesAPI     from '../species/api.js';\r\nimport CareerAPI      from '../career/api.js';\r\n\r\nconst $ = window.jQuery;\r\nconst TRAITS   = TraitsService.TRAITS;\r\nconst MARK_DIE = { 1: 'd4', 2: 'd6', 3: 'd8' };\r\n\r\nconst SummaryAPI = {\r\n  /**\r\n   * Entry point when the Summary tab is shown.\r\n   */\r\n  init() {\r\n    const data = FormBuilderAPI.getData();\r\n    console.log('[SummaryAPI] init \u2014 builder state:', data);\r\n\r\n    // 1) Render all summary sections\r\n    this.renderSummary(data);\r\n\r\n    // 2) Wire up the Export to PDF button\r\n    this.bindExportButton();\r\n  },\r\n\r\n  /**\r\n   * Build and inject the full summary into #cg-summary-sheet.\r\n   */\r\n  renderSummary(data = {}) {\r\n    const $sheet = $('#cg-summary-sheet').empty();\r\n\r\n    // Basic Info\r\n    const name   = data.name   || '\u2014';\r\n    const age    = data.age    || '\u2014';\r\n    const gender = data.gender || '\u2014';\r\n    const motto  = data.motto  || '\u2014';\r\n\r\n    // Goals\r\n    const goals = [1, 2, 3]\r\n      .map(i => data[`goal${i}`] || '\u2014')\r\n      .filter(v => v !== '\u2014')\r\n      .join(', ')\r\n      || '\u2014';\r\n\r\n    // Description & Backstory\r\n    const description = data.description || '\u2014';\r\n    const backstory   = data.backstory   || '\u2014';\r\n\r\n    // Species & Career\r\n    const species = SpeciesAPI.currentProfile || {};\r\n    const career  = CareerAPI.currentProfile  || {};\r\n\r\n    // Skills, Marks, Battle\r\n    const skills = window.CG_SKILLS_LIST || [];\r\n    const marks  = data.skillMarks  || {};\r\n    const battle = data.battle      || [];\r\n\r\n    // Assemble HTML\r\n    let html = `\r\n      <div class=\"summary-section summary-basic\">\r\n        <h2>${name}</h2>\r\n        <p><strong>Age:</strong> ${age}</p>\r\n        <p><strong>Gender:</strong> ${gender}</p>\r\n        <p><strong>Motto:</strong> ${motto}</p>\r\n      </div>\r\n\r\n      <div class=\"summary-section summary-goals\">\r\n        <p><strong>Goals:</strong> ${goals}</p>\r\n      </div>\r\n\r\n      <div class=\"summary-section summary-description\">\r\n        <p><strong>Description:</strong> ${description}</p>\r\n      </div>\r\n\r\n      <div class=\"summary-section summary-backstory\">\r\n        <p><strong>Backstory:</strong> ${backstory}</p>\r\n      </div>\r\n\r\n      <div class=\"summary-section summary-species\">\r\n        <h3>Species: ${species.speciesName || '\u2014'}</h3>\r\n        <ul>\r\n    `;\r\n    ['gift_1','gift_2','gift_3'].forEach((_, idx) => {\r\n      const gift = species[`gift_${idx+1}`];\r\n      const mult = species[`manifold_${idx+1}`] || 1;\r\n      if (gift) {\r\n        html += `<li><strong>Gift ${idx+1}:</strong> ${gift} \u00D7 ${mult}</li>`;\r\n      }\r\n    });\r\n    html += `</ul></div>`;\r\n\r\n    html += `\r\n      <div class=\"summary-section summary-career\">\r\n        <h3>Career: ${career.careerName || '\u2014'}</h3>\r\n        <ul>\r\n    `;\r\n    ['gift_1','gift_2','gift_3'].forEach((_, idx) => {\r\n      const gift = career[`gift_${idx+1}`];\r\n      const mult = career[`manifold_${idx+1}`] || 1;\r\n      if (gift) {\r\n        html += `<li><strong>Gift ${idx+1}:</strong> ${gift} \u00D7 ${mult}</li>`;\r\n      }\r\n    });\r\n    html += `</ul></div>`;\r\n\r\n    html += `\r\n      <div class=\"summary-section summary-traits\">\r\n        <h3>Traits</h3>\r\n        <ul>\r\n    `;\r\n    TRAITS.forEach(key => {\r\n      let label = key.replace(/^trait_/, '');\r\n      if (label === 'species') label = 'Species';\r\n      else if (label === 'career') label = 'Career';\r\n      else label = Utils.capitalize(label);\r\n\r\n      const base  = data[key] || '\u2014';\r\n      const boost = TraitsService.getBoostedDie(key);\r\n      const display = boost ? `${base} \u2192 ${boost}` : base;\r\n\r\n      html += `<li><strong>${label}:</strong> ${display}</li>`;\r\n    });\r\n    html += `</ul></div>`;\r\n\r\n    html += `\r\n      <div class=\"summary-section summary-skills\">\r\n        <h3>Skills</h3>\r\n        <table class=\"cg-summary-skills\">\r\n          <thead><tr><th>Skill</th><th>Dice Pool</th></tr></thead>\r\n          <tbody>\r\n    `;\r\n    const spIds = [species.skill_one, species.skill_two, species.skill_three].map(String);\r\n    const cpIds = [career.skill_one,  career.skill_two,  career.skill_three].map(String);\r\n\r\n    skills.forEach(skill => {\r\n      const id = String(skill.id);\r\n      const sp = spIds.includes(id) ? 'd4' : '';\r\n      const cp = cpIds.includes(id) ? 'd6' : '';\r\n      const mk = MARK_DIE[marks[id]] || '';\r\n      const pool = [sp, cp, mk].filter(Boolean).join(' + ') || '\u2014';\r\n      html += `<tr><td>${skill.name}</td><td>${pool}</td></tr>`;\r\n    });\r\n    html += `\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n    `;\r\n\r\n    if (battle.length) {\r\n      html += `\r\n        <div class=\"summary-section summary-battle\">\r\n          <h3>Battle</h3>\r\n          <ul>\r\n      `;\r\n      battle.forEach(item => {\r\n        html += `<li><strong>${Utils.capitalize(item.key)}:</strong> ${item.value}</li>`;\r\n      });\r\n      html += `</ul></div>`;\r\n    }\r\n\r\n    // Inject all HTML\r\n    $sheet.html(html);\r\n  },\r\n\r\n  /**\r\n   * Open a new window, inject the summary + CSS, and print it.\r\n   */\r\n  bindExportButton() {\r\n    $(document)\r\n      .off('click', '#cg-export-pdf')\r\n      .on('click', '#cg-export-pdf', e => {\r\n        e.preventDefault();\r\n        console.log('[SummaryAPI] Export to PDF clicked');\r\n\r\n        // 1) Grab the summary HTML\r\n        const sheetHtml = document\r\n          .getElementById('cg-summary-sheet')\r\n          .outerHTML;\r\n\r\n        // 2) Collect current <link rel=\"stylesheet\"> tags\r\n        const cssLinks = Array.from(\r\n          document.querySelectorAll('link[rel=\"stylesheet\"]')\r\n        )\r\n        .map(link => link.outerHTML)\r\n        .join('\\n');\r\n\r\n        // 3) Open a print window and write minimal HTML\r\n        const printWin = window.open('', '_blank', 'width=800,height=600');\r\n        printWin.document.open();\r\n        printWin.document.write(`\r\n          <!doctype html>\r\n          <html>\r\n            <head>\r\n              <meta charset=\"utf-8\">\r\n              <title>Character Sheet</title>\r\n              ${cssLinks}\r\n              <style>\r\n                @page { margin: 1cm; }\r\n                body { margin:0; padding:0; }\r\n              </style>\r\n            </head>\r\n            <body>\r\n              ${sheetHtml}\r\n            </body>\r\n          </html>\r\n        `);\r\n        printWin.document.close();\r\n        printWin.focus();\r\n\r\n        // 4) Trigger print and close window\r\n        setTimeout(() => {\r\n          printWin.print();\r\n          printWin.close();\r\n        }, 300);\r\n      });\r\n  }\r\n};\r\n\r\nexport default SummaryAPI;\r\n", "// assets/js/src/core/summary/index.js\r\n\r\nimport SummaryAPI from './api.js';\r\n\r\nexport default {\r\n  init() {\r\n    SummaryAPI.init();\r\n  }\r\n};\r\n", "import TraitsAPI      from '../traits';\nimport SpeciesIndex   from '../species';\nimport CareerIndex    from '../career';\nimport GiftsAPI       from '../gifts';\nimport SkillsAPI      from '../skills';\nimport SummaryAPI     from '../summary';\n\nconst $ = window.jQuery;\n\n// Only re-init the active tab\u2019s logic (no DOM\u2192state merging here)\nexport default function refreshTab() {\n  const tab = $('#cg-modal .cg-tabs li.active').data('tab');\n\n  switch (tab) {\n    case 'tab-traits':\n      TraitsAPI.init();\n      break;\n    case 'tab-profile':\n      SpeciesIndex.init();\n      CareerIndex.init();\n      GiftsAPI.init();\n      break;\n    case 'tab-skills':\n      SkillsAPI.init();\n      break;\n    case 'tab-summary':\n      SummaryAPI.init();\n      break;\n  }\n}\n", "// assets/js/src/core/main/builder-load.js\n// Robust splash-load dropdown population (jQuery-safe):\n// - Splash UI may be injected after bundle runs (select absent at init).\n// - Observe DOM until it appears, then populate once.\n// - Supports refresh after saves via cg:characters:refresh.\n// - IMPORTANT: jQuery Deferred doesn't support Promise.finally() -> use .always().\n\nconst $    = window.jQuery;\nconst LOG  = (...a) => console.log('[BuilderLoad]', ...a);\nconst WARN = (...a) => console.warn('[BuilderLoad]', ...a);\n\nlet _inited   = false;\nlet _observer = null;\nlet _inFlight = false;\n\n/** Prefer per-action nonce if available */\nfunction nonceFor(action) {\n  const per = (window.CG_NONCES && window.CG_NONCES[action]) ? window.CG_NONCES[action] : null;\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  return per || env.nonce || env.security || env._ajax_nonce || window.CG_NONCE || null;\n}\n\nfunction ajaxUrl() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  return env.ajax_url || window.ajaxurl || document.body?.dataset?.ajaxUrl || '/wp-admin/admin-ajax.php';\n}\n\nfunction parseJsonMaybe(res) {\n  try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n  catch (_) { return res; }\n}\n\nfunction normalizeItems(arr) {\n  if (!Array.isArray(arr)) return [];\n  return arr.map(it => {\n    if (it && typeof it === 'object') {\n      return { id: String(it.id ?? it.value ?? ''), name: String(it.name ?? it.title ?? '') };\n    }\n    return { id: String(it), name: String(it) };\n  }).filter(it => it.id && it.name);\n}\n\nfunction getSelect() {\n  if (!$) return null;\n  const $sel = $('#cg-splash-load-select').first();\n  return ($sel && $sel.length) ? $sel : null;\n}\n\nfunction populateSelect($sel, items, { preserveSelection = true } = {}) {\n  if (!$sel || !$sel.length) return;\n\n  const prior = preserveSelection ? ($sel.val() || '') : '';\n  $sel.empty();\n  $sel.append(new Option('\u2014 Select a character \u2014', ''));\n\n  const normalized = normalizeItems(items);\n  normalized.forEach(it => $sel.append(new Option(it.name, it.id)));\n\n  if (preserveSelection && prior && normalized.some(x => x.id === String(prior))) {\n    $sel.val(String(prior));\n  }\n}\n\n/**\n * Fetch characters list (returns jqXHR / jQuery promise)\n * Expects WP-style response: { success:true, data:[...] }\n */\nfunction fetchCharacters() {\n  const url   = ajaxUrl();\n  const nonce = nonceFor('cg_load_characters');\n\n  const payload = { action: 'cg_load_characters' };\n  if (nonce) {\n    payload.security    = nonce;\n    payload.nonce       = nonce;\n    payload._ajax_nonce = nonce;\n  }\n\n  // Return a jQuery promise that resolves to the array\n  return $.post(url, payload).then(res => {\n    const json = parseJsonMaybe(res);\n    if (!json || json.success !== true) {\n      // Reject in a jQuery-friendly way\n      return $.Deferred().reject(json).promise();\n    }\n    return Array.isArray(json.data) ? json.data : [];\n  });\n}\n\n/**\n * Populate when the select exists.\n * - If already populated (options > 1) and not forced, do nothing.\n */\nfunction ensurePopulated({ force = false, preserveSelection = false } = {}) {\n  if (!$) return;\n\n  const $sel = getSelect();\n  if (!$sel) return; // observer will handle late insertion\n\n  const optCount = $sel.find('option').length;\n  if (!force && optCount > 1) return;\n\n  // Use preloaded list if present; otherwise AJAX.\n  const preload = window.CG_DATA?.characters || window.cgCharacters || null;\n  if (preload && Array.isArray(preload)) {\n    LOG('using preloaded characters:', preload.length);\n    populateSelect($sel, preload, { preserveSelection });\n    return;\n  }\n\n  if (_inFlight) return;\n  _inFlight = true;\n\n  LOG('fetching characters via AJAX\u2026');\n\n  fetchCharacters()\n    .done(items => {\n      LOG('fetched', (items || []).length, 'records');\n      populateSelect($sel, items, { preserveSelection });\n    })\n    .fail((a, b, c) => {\n      // a may be jqXHR, or may be the rejected json object from above\n      const msg =\n        (a && a.data) ? String(a.data) :\n        (a && a.responseText) ? String(a.responseText) :\n        (typeof a === 'string') ? a :\n        (b || c || 'unknown error');\n      WARN('character list fetch failed:', msg);\n      populateSelect($sel, [], { preserveSelection: false });\n    })\n    .always(() => {\n      _inFlight = false;\n    });\n}\n\n/**\n * Watch DOM for the splash select to appear (because splash is often injected by JS).\n */\nfunction startObserver() {\n  if (_observer || !window.MutationObserver) return;\n\n  const tryNow = () => {\n    const $sel = getSelect();\n    if ($sel) {\n      LOG('found #cg-splash-load-select (late) \u2014 populating');\n      ensurePopulated({ force: false, preserveSelection: false });\n      return true;\n    }\n    return false;\n  };\n\n  if (tryNow()) return;\n\n  LOG('waiting for #cg-splash-load-select to appear\u2026');\n  _observer = new MutationObserver(() => {\n    if (tryNow()) {\n      _observer.disconnect();\n      _observer = null;\n    }\n  });\n\n  _observer.observe(document.body, { childList: true, subtree: true });\n\n  // Safety stop (don\u2019t watch forever)\n  setTimeout(() => {\n    if (_observer) {\n      _observer.disconnect();\n      _observer = null;\n      LOG('stop waiting (timeout) \u2014 splash select never appeared on this page');\n    }\n  }, 15000);\n}\n\nexport default function bindLoadEvents() {\n  if (_inited) return;\n  _inited = true;\n\n  LOG('init');\n\n  if (!$) {\n    WARN('jQuery not present; load dropdown will not populate.');\n    return;\n  }\n\n  // If select exists now, populate; otherwise observe for late insertion.\n  ensurePopulated({ force: false, preserveSelection: false });\n  startObserver();\n\n  // Manual refresh button (if present in splash markup)\n  $(document)\n    .off('click.cgload', '#cg-load-refresh')\n    .on('click.cgload', '#cg-load-refresh', e => {\n      e.preventDefault();\n      LOG('manual refresh');\n      ensurePopulated({ force: true, preserveSelection: true });\n    });\n\n  // Auto-refresh after a successful save\n  document.addEventListener('cg:characters:refresh', () => {\n    LOG('received cg:characters:refresh \u2192 repopulating load list');\n    ensurePopulated({ force: true, preserveSelection: true });\n  });\n}\n", "// assets/js/src/core/main/builder-save.js\r\n// Sends flat fields, nested `character[...]`, and JSON `character_json` for max compatibility.\r\n\r\nimport BuilderUI      from './builder-ui.js';\r\nimport FormBuilderAPI from '../formBuilder';\r\n\r\nconst $ = window.jQuery;\r\n\r\nfunction ajaxEnv() {\r\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\r\n  return {\r\n    url:   env.ajax_url || window.ajaxurl || document.body?.dataset?.ajaxUrl || '/wp-admin/admin-ajax.php',\r\n    nonce: env.nonce || env.security || window.CG_NONCE || null\r\n  };\r\n}\r\n\r\n/**\r\n * Normalize raw builder data into a flat \"core\" object the server expects.\r\n * - Prefer *_id for species/career but fall back to other keys if needed.\r\n * - JSON-stringify complex blobs so PHP can decode safely.\r\n */\r\nfunction normalizeCore(raw = {}) {\r\n  const species = (raw.species_id ?? raw.species ?? raw.trait_species ?? '');\r\n  const career  = (raw.career_id  ?? raw.career  ?? raw.trait_career  ?? '');\r\n\r\n  return {\r\n    id:           raw.id || '',\r\n    name:         raw.name || '',\r\n    player_name:  raw.player_name || '',\r\n    age:          raw.age || '',\r\n    gender:       raw.gender || '',\r\n    motto:        raw.motto || '',\r\n    will:         raw.will ?? '',\r\n    speed:        raw.speed ?? '',\r\n    body:         raw.body ?? '',\r\n    mind:         raw.mind ?? '',\r\n    trait_species: raw.trait_species ?? '',\r\n    trait_career:  raw.trait_career ?? '',\r\n    species,\r\n    career,\r\n\r\n    // structured blobs (stringify to be safe for PHP)\r\n    skill_marks: raw.skillMarks ? JSON.stringify(raw.skillMarks) : '',\r\n    free_gifts:  raw.free_gifts  ? JSON.stringify(raw.free_gifts)  : '',\r\n    traits_list: raw.traitsList  ? JSON.stringify(raw.traitsList)  : '',\r\n    skills_list: raw.skillsList  ? JSON.stringify(raw.skillsList)  : '',\r\n    gifts:       raw.gifts       ? JSON.stringify(raw.gifts)       : ''\r\n  };\r\n}\r\n\r\n/**\r\n * Build a payload that works with varying server handlers:\r\n *  - Flat fields\r\n *  - Nested `character[...]`\r\n *  - `character_json` string\r\n *  - Always include security/nonce variations if available\r\n */\r\nfunction buildPayload(raw) {\r\n  const core       = normalizeCore(raw);\r\n  const { nonce }  = ajaxEnv();\r\n\r\n  // Base + nonce variations\r\n  const base = { action: 'cg_save_character' };\r\n  if (nonce) {\r\n    base.security    = nonce;       // common check_ajax_referer(..., 'security')\r\n    base.nonce       = nonce;       // some handlers expect 'nonce'\r\n    base._ajax_nonce = nonce;       // legacy compatibility\r\n  }\r\n\r\n  // Flat fields (only include when non-empty to avoid clobbering)\r\n  const flat = {\r\n    ...base,\r\n    ...(core.id            ? { id: core.id } : {}),\r\n    ...(core.name          ? { name: core.name } : {}),\r\n    ...(core.player_name   ? { player_name: core.player_name } : {}),\r\n    ...(core.age           ? { age: core.age } : {}),\r\n    ...(core.gender        ? { gender: core.gender } : {}),\r\n    ...(core.motto         ? { motto: core.motto } : {}),\r\n    ...(core.will  !== ''  ? { will: core.will } : {}),\r\n    ...(core.speed !== ''  ? { speed: core.speed } : {}),\r\n    ...(core.body  !== ''  ? { body: core.body } : {}),\r\n    ...(core.mind  !== ''  ? { mind: core.mind } : {}),\r\n    ...(core.trait_species !== '' ? { trait_species: core.trait_species } : {}),\r\n    ...(core.trait_career  !== '' ? { trait_career:  core.trait_career }  : {}),\r\n    ...(core.species       ? { species: core.species } : {}),\r\n    ...(core.career        ? { career:  core.career }  : {}),\r\n\r\n    ...(core.skill_marks   ? { skill_marks: core.skill_marks } : {}),\r\n    ...(core.free_gifts    ? { free_gifts:  core.free_gifts }  : {}),\r\n    ...(core.traits_list   ? { traits_list: core.traits_list } : {}),\r\n    ...(core.skills_list   ? { skills_list: core.skills_list } : {}),\r\n    ...(core.gifts         ? { gifts:       core.gifts }       : {})\r\n  };\r\n\r\n  // Nested array under character[...]\r\n  const character = {};\r\n  if (core.id)            character.id            = core.id;\r\n  if (core.name)          character.name          = core.name;\r\n  if (core.player_name)   character.player_name   = core.player_name;\r\n  if (core.age)           character.age           = core.age;\r\n  if (core.gender)        character.gender        = core.gender;\r\n  if (core.motto)         character.motto         = core.motto;\r\n  if (core.will  !== '')  character.will          = core.will;\r\n  if (core.speed !== '')  character.speed         = core.speed;\r\n  if (core.body  !== '')  character.body          = core.body;\r\n  if (core.mind  !== '')  character.mind          = core.mind;\r\n  if (core.trait_species !== '') character.trait_species = core.trait_species;\r\n  if (core.trait_career  !== '') character.trait_career  = core.trait_career;\r\n  if (core.species)       character.species       = core.species;\r\n  if (core.career)        character.career        = core.career;\r\n\r\n  if (core.skill_marks)   character.skill_marks   = core.skill_marks;\r\n  if (core.free_gifts)    character.free_gifts    = core.free_gifts;\r\n  if (core.traits_list)   character.traits_list   = core.traits_list;\r\n  if (core.skills_list)   character.skills_list   = core.skills_list;\r\n  if (core.gifts)         character.gifts         = core.gifts;\r\n\r\n  flat.character = character;\r\n\r\n  // JSON blob as a final fallback (server can json_decode)\r\n  flat.character_json = JSON.stringify({ ...core });\r\n\r\n  return flat;\r\n}\r\n\r\nexport default function bindSaveEvents() {\r\n  $(document)\r\n    .off('click.cg', '.cg-save-button')\r\n    .on('click.cg', '.cg-save-button', function(e) {\r\n      e.preventDefault();\r\n\r\n      const closeAfter = $(this).hasClass('cg-close-after-save');\r\n      const raw        = FormBuilderAPI.collectFormData();\r\n\r\n      console.log('[BuilderSave] \u25B6 saving payload:', raw);\r\n\r\n      const { url } = ajaxEnv();\r\n      if (!url) {\r\n        console.error('[BuilderSave] No AJAX URL available');\r\n        alert('Save error: missing AJAX URL');\r\n        return;\r\n      }\r\n\r\n      const data = buildPayload(raw);\r\n\r\n      $.post(url, data)\r\n        .done(res => {\r\n          try { res = (typeof res === 'string') ? JSON.parse(res) : res; } catch (_) {}\r\n\r\n          if (!res || res.success !== true) {\r\n            console.error('[BuilderSave] save failed:', res);\r\n            alert('Save error: ' + (res?.data || 'Invalid payload.'));\r\n            return;\r\n          }\r\n\r\n          // persist new ID if returned\r\n          if (res.data?.id) {\r\n            raw.id = res.data.id;\r\n            FormBuilderAPI._data = { ...FormBuilderAPI._data, id: res.data.id };\r\n          }\r\n\r\n          BuilderUI.markClean();\r\n          if (closeAfter) {\r\n            BuilderUI.closeBuilder();\r\n          } else {\r\n            alert('Character saved');\r\n          }\r\n\r\n          // Broadcast for any listeners (e.g., refresh load list)\r\n          document.dispatchEvent(new CustomEvent('cg:character:saved',    { detail: { id: res.data?.id || raw.id || null, record: raw } }));\r\n          document.dispatchEvent(new CustomEvent('cg:characters:refresh', { detail: {} }));\r\n        })\r\n        .fail((xhr, status, err) => {\r\n          console.error('[BuilderSave] AJAX error:', status, err, xhr?.responseText);\r\n          alert('AJAX save error \u2014 see console');\r\n        });\r\n    });\r\n}\r\n", "// assets/js/src/core/main/builder-events.js\n// Maintains original builder wiring and adds safe hydration for Species/Career\n// across New, Load, tab switches, and post-save refreshes.\n\nimport bindOnce, { makeInitGuard } from '../utils/bind-once.js';\nimport BuilderUI       from './builder-ui.js';\nimport FormBuilderAPI  from '../formBuilder';\nimport refreshTab      from './builder-refresh.js';\nimport bindLoadEvents  from './builder-load.js';\nimport bindSaveEvents  from './builder-save.js';\nimport TraitsAPI       from '../traits';\nimport SpeciesIndex    from '../species';\nimport CareerIndex     from '../career';\nimport GiftsAPI        from '../gifts';\nimport SkillsAPI       from '../skills';\nimport SummaryAPI      from '../summary';\n\n// Fallback APIs (used only if Index modules don't populate)\nimport SpeciesAPI      from '../species/api.js';\nimport CareerAPI       from '../career/api.js';\n\nconst $ = window.jQuery;\n\nconst LOG = (...a) => console.log('[BuilderEvents]', ...a);\nconst ERR = (...a) => console.error('[BuilderEvents]', ...a);\n\n// Broad selectors to match your actual controls no matter how they\u2019re rendered\nconst SEL = {\n  species: '#cg-species, select[name=\"species\"], select[name=\"trait_species\"], select[data-cg=\"species\"], .cg-species',\n  career:  '#cg-career,  select[name=\"career\"],  select[name=\"trait_career\"],  select[data-cg=\"career\"],  .cg-career',\n};\n\nfunction firstSelect(selector) {\n  const $sel = $(selector);\n  // prefer in-modal elements if multiple exist\n  const $modalSel = $('#cg-modal').find(selector);\n  if ($modalSel.length) return $modalSel.first();\n  return $sel.length ? $sel.first() : null;\n}\n\nfunction setSelectValue($sel, want) {\n  if (!$sel || !$sel.length || !want) return false;\n  const val = String(want);\n  $sel.val(val);\n  if ($sel.val() === val) return true;\n\n  // fallback: try by visible text\n  const $byText = $sel.find('option').filter(function () {\n    return $(this).text() === val;\n  }).first();\n  if ($byText.length) {\n    $sel.val($byText.val());\n    return true;\n  }\n  return false;\n}\n\nfunction triggerDownstream() {\n  try { TraitsAPI?.Service?.updateAdjustedDisplays?.(); } catch (_) {}\n  try { GiftsAPI?.refresh?.(); }   catch (_) {}\n  try { SkillsAPI?.refresh?.(); }  catch (_) {}\n  try { SummaryAPI?.refresh?.(); } catch (_) {}\n}\n\n/**\n * hydrateSelect(kind: 'species'|'career', { force, record })\n * - Calls your Index module first (render/refresh); if empty, falls back to API.populateSelect\n * - Applies record\u2019s saved selection (id or name) and triggers change \u2192 downstream recompute\n */\nfunction hydrateSelect(kind, { force = false, record = null } = {}) {\n  const key      = kind === 'species' ? 'species' : 'career';\n  const selector = kind === 'species' ? SEL.species : SEL.career;\n  const $sel     = firstSelect(selector);\n\n  if (!$sel) { LOG(`no ${kind} select found`); return $.Deferred().resolve().promise(); }\n\n  const el       = $sel.get(0);\n  const hadCount = el.options.length;\n\n  // Prefer project modules\n  try {\n    const Index = (kind === 'species') ? SpeciesIndex : CareerIndex;\n    if (Index?.refresh) Index.refresh();\n    else if (Index?.render) Index.render();\n  } catch (e) { /* non-fatal */ }\n\n  const doApply = () => {\n    // Apply record selection if provided\n    if (record) {\n      const want = record[key] ?? record[`${key}_id`] ?? '';\n      if (want) setSelectValue($sel, want);\n    }\n    // If options were newly injected or we applied a value, trigger change\n    if (el.options.length > hadCount || (record && (record[key] || record[`${key}_id`]))) {\n      $sel.trigger('change');\n      triggerDownstream();\n    }\n  };\n\n  // Fallback populate via API if still empty\n  const ensureOptions = () => {\n    if (el.options.length > 1 && !force) return $.Deferred().resolve().promise();\n    const API = (kind === 'species') ? SpeciesAPI : CareerAPI;\n    if (typeof API?.populateSelect !== 'function') return $.Deferred().resolve().promise();\n    return API.populateSelect(el, { force: !!force });\n  };\n\n  // Give the DOM a tick in case Index.render() appended later in the event loop\n  return $.Deferred(function (dfr) {\n    setTimeout(() => {\n      ensureOptions()\n        .then(() => { doApply(); dfr.resolve(); })\n        .catch(() => dfr.resolve());\n    }, 0);\n  }).promise();\n}\n\nfunction hydrateSpeciesAndCareer(opts = {}) {\n  return $.when(\n    hydrateSelect('species', opts),\n    hydrateSelect('career',  opts)\n  );\n}\n\nexport default function bindUIEvents() {\n  LOG('bindUIEvents() called');\n\n  // Core-owned Gifts module init (idempotent)\n  try { GiftsAPI?.init?.(); } catch (_) {}\n\n  // 1) Mark form dirty on change & sync into FormBuilderAPI._data\n  $(document)\n    .off('input.cg change.cg', '#cg-modal input, #cg-modal select, #cg-modal textarea')\n    .on('input.cg change.cg', '#cg-modal input, #cg-modal select, #cg-modal textarea', function() {\n      BuilderUI.markDirty();\n\n      const $el = $(this);\n\n      // Skill-marks inputs don\u2019t have an ID, so handle them explicitly\n      if ($el.hasClass('skill-marks')) {\n        const skillId = $el.data('skill-id');\n        const val     = parseInt($el.val(), 10) || 0;\n        FormBuilderAPI._data.skillMarks = FormBuilderAPI._data.skillMarks || {};\n        FormBuilderAPI._data.skillMarks[skillId] = val;\n        return;\n      }\n\n      // All other fields map by stripping \u201Ccg-\u201D off the ID\n      const id  = this.id;     // e.g. \u201Ccg-name\u201D, \u201Ccg-body\u201D, \u201Ccg-species\u201D\n      if (!id) return;\n      const key = id.replace(/^cg-/, '');\n      FormBuilderAPI._data[key] = $el.val();\n    });\n\n  // 2) Show splash (dropdown population is owned by builder-load.js)\n  $(document)\n    .off('click.cg', '#cg-open-builder')\n    .on('click.cg', '#cg-open-builder', e => {\n      e.preventDefault();\n      $('#cg-modal-splash').removeClass('cg-hidden').addClass('visible');\n\n      // If the dropdown exists but is still empty, ask BuilderLoad to populate ONCE.\n      try {\n        const $sel = $('#cg-splash-load-select');\n        const optCount = $sel.length ? $sel.find('option').length : 0;\n        if ($sel.length && optCount <= 1) {\n          document.dispatchEvent(new CustomEvent('cg:characters:refresh', { detail: { source: 'splash-open' } }));\n        }\n      } catch (_) {}\n    });\n\n  // 3) Open blank builder (NEW CHARACTER) and purge previous state\n  $(document)\n    .off('click.cg', '#cg-new-splash')\n    .on('click.cg', '#cg-new-splash', e => {\n      e.preventDefault();\n\n      // Hide the splash\n      $('#cg-modal-splash').removeClass('visible').addClass('cg-hidden');\n\n      // Clear all builder state\n      BuilderUI.openBuilder({ isNew: true, payload: {} });\n\n      // Reset skill marks\n      FormBuilderAPI._data.skillMarks = {};\n\n      // Reset species/career\n      FormBuilderAPI._data.species = '';\n      FormBuilderAPI._data.career  = '';\n\n      // Reset gifts state\n      if (window.CG_FreeChoicesState) {\n        window.CG_FreeChoicesState.selected = ['', '', ''];\n        // keep gifts list unless you explicitly want it purged\n        // window.CG_FreeChoicesState.gifts    = [];\n      }\n\n      // Ensure species/career lists exist for the new form\n      setTimeout(() => {\n        hydrateSpeciesAndCareer({ force: false, record: {} });\n      }, 0);\n    });\n\n  // 4) Load character by ID and launch builder\n  $(document)\n    .off('click.cg', '#cg-load-splash')\n    .on('click.cg', '#cg-load-splash', e => {\n      e.preventDefault();\n      const charId = $('#cg-splash-load-select').val();\n      if (!charId) {\n        alert('Please select a character to load.');\n        return;\n      }\n\n      FormBuilderAPI.fetchCharacter(charId)\n        .done(resp => {\n          console.log('\uD83D\uDD0E [AJAX] raw cg_get_character response:', resp);\n          const parsed = typeof resp === 'string' ? JSON.parse(resp) : resp;\n          console.log('\uD83D\uDD0D [AJAX] parsed.data:', parsed?.data);\n\n          const record = parsed?.data || parsed;\n          if (!record || !record.id) {\n            alert('Character could not be loaded.');\n            return;\n          }\n\n          // Hide the splash, open builder, and seed state from record\n          $('#cg-modal-splash').removeClass('visible').addClass('cg-hidden');\n\n          BuilderUI.openBuilder({ isNew: false, payload: record });\n\n          // Rehydrate lists and apply record selections, fire downstream recompute\n          setTimeout(() => {\n            hydrateSpeciesAndCareer({ force: true, record });\n          }, 0);\n        })\n        .fail((xhr) => {\n          console.error('Load failed:', xhr?.responseText || xhr);\n          alert('Could not load character. Check console for details.');\n        });\n    });\n\n  // 5) Wire up Save & Load inside builder\n  bindLoadEvents();\n  bindSaveEvents();\n\n  // 6) Tab navigation \u2192 highlight panel + run refreshTab() and gently rehydrate lists\n  $(document)\n    .off('click.cg', '#cg-modal .cg-tabs li')\n    .on('click.cg', '#cg-modal .cg-tabs li', function(e) {\n      e.preventDefault();\n      const tabName = $(this).data('tab');\n\n      $('#cg-modal .cg-tabs li').removeClass('active');\n      $(this).addClass('active');\n\n      $('.tab-panel').removeClass('active');\n      $(`#${tabName}`).addClass('active');\n\n      refreshTab();\n\n      // Some tabs rebuild DOM; ensure selects remain populated\n      setTimeout(() => {\n        hydrateSpeciesAndCareer({ force: false });\n      }, 0);\n    });\n\n  // 7a) Modal close (X)\n  $(document)\n    .off('click.cg', '#cg-modal-close')\n    .on('click.cg', '#cg-modal-close', e => {\n      e.preventDefault();\n      BuilderUI.showUnsaved();\n    });\n\n  // 7b) Modal overlay click\n  $(document)\n    .off('click.cg', '#cg-modal-overlay')\n    .on('click.cg', '#cg-modal-overlay', function(e) {\n      if (e.target !== this) return;\n      BuilderUI.showUnsaved();\n    });\n\n  // 7c) Prompt: Save & Exit\n  $(document)\n    .off('click.cg', '#unsaved-save')\n    .on('click.cg', '#unsaved-save', e => {\n      e.preventDefault();\n      console.log('[BuilderEvents] Prompt: SAVE & EXIT clicked');\n      FormBuilderAPI.save(true);\n    });\n\n  // 7d) Prompt: Exit Without Save\n  $(document)\n    .off('click.cg', '#unsaved-exit')\n    .on('click.cg', '#unsaved-exit', e => {\n      e.preventDefault();\n      BuilderUI.closeBuilder();\n    });\n\n  // 7e) Prompt: Cancel\n  $(document)\n    .off('click.cg', '#unsaved-cancel')\n    .on('click.cg', '#unsaved-cancel', e => {\n      e.preventDefault();\n      BuilderUI.hideUnsaved();\n    });\n\n  // 8) After saves trigger list refresh elsewhere, gently rehydrate here too\n  document.addEventListener('cg:characters:refresh', () => {\n    setTimeout(() => {\n      hydrateSpeciesAndCareer({ force: true });\n    }, 0);\n  });\n}\n", "// assets/js/src/core/main/index.js\r\n\r\nimport bindUIEvents from './builder-events.js';\r\n\r\nconst MainAPI = {\r\n  init() {\r\n    console.log('[MainAPI] init() called');\r\n    // now bind all your UI events\r\n    bindUIEvents();\r\n  }\r\n};\r\n\r\nexport default MainAPI;\r\n", "import MainAPI from './main';\r\n\r\nconst Core = {\r\n  init() {\r\n    console.log('[Core] init() called');           // \u2190 you should see this\r\n    MainAPI.init();\r\n  }\r\n};\r\n\r\n// log when the bundle loads\r\nconsole.log('[Core] bundle loaded');\r\n\r\n// fire when DOM is ready\r\nif (document.readyState === 'loading') {\r\n  document.addEventListener('DOMContentLoaded', Core.init);\r\n} else {\r\n  Core.init();\r\n}\r\n\r\nimport SkillsModule from './skills/index.js';\r\n// \u2026 other imports \u2026\r\n\r\nexport default function initCore() {\r\n  // \u2026 existing binds \u2026\r\n  SkillsModule.init();\r\n  // \u2026 builder\u2010events \u2026\r\n}\r\n\r\n\n\nimport SpeciesAPI from './species/api.js';\nif (typeof window !== 'undefined') window.SpeciesAPI = SpeciesAPI;\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AACA,MAAM,IAAI,OAAO;;;ACMjB,MAAM,QAAQ;AAAA;AAAA,IAEZ,UAAU,CAAC,IAAI,IAAI,EAAE;AAAA;AAAA,IAGrB,OAAO,CAAC;AAAA;AAAA;AAAA;AAAA,IAKR,OAAO;AAjBT;AAkBI,YAAM,MAAO,uBAAkB,OAAO,wBAAmB,YAAY,oBAAe,QAChF,oBAAe,QACd,SAAO,gDAAgB,aAAY,aAAa,oBAAe,QAAQ,IAAI,CAAC;AAEjF,YAAM,MACJ,MAAM,QAAQ,IAAI,UAAU,IAAI,IAAI,aACpC,MAAM,QAAQ,IAAI,SAAS,IAAK,IAAI,YACpC;AAEF,YAAM,cAAc,MAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,GAC7C,MAAM,GAAG,CAAC,EACV,IAAI,OAAM,IAAI,OAAO,CAAC,IAAI,EAAG;AAChC,aAAO,WAAW,SAAS;AAAG,mBAAW,KAAK,EAAE;AAEhD,WAAK,WAAW;AAAA,IAClB;AAAA;AAAA;AAAA;AAAA,IAKA,IAAI,OAAO,IAAI;AACb,WAAK,SAAS,KAAK,IAAI,KAAK,OAAO,EAAE,IAAI;AAEzC,UAAI,uBAAkB,oBAAe,OAAO;AAC1C,4BAAe,MAAM,aAAa,KAAK,SAAS,MAAM;AAEtD,4BAAe,MAAM,YAAa,KAAK,SAAS,MAAM;AAAA,MACxD;AAAA,IACF;AAAA;AAAA;AAAA;AAAA,IAKA,YAAY,OAAO,CAAC,GAAG;AACrB,YAAM,cAAc,MAAM,QAAQ,IAAI,IAAI,OAAO,CAAC,GAC/C,MAAM,GAAG,CAAC,EACV,IAAI,OAAM,IAAI,OAAO,CAAC,IAAI,EAAG;AAChC,aAAO,WAAW,SAAS;AAAG,mBAAW,KAAK,EAAE;AAEhD,WAAK,WAAW;AAEhB,UAAI,uBAAkB,oBAAe,OAAO;AAC1C,4BAAe,MAAM,aAAa,KAAK,SAAS,MAAM;AACtD,4BAAe,MAAM,YAAa,KAAK,SAAS,MAAM;AAAA,MACxD;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA,QAAQ,WAAW,CAAC,GAAG;AACrB,eAAS,QAAQ,OAAK;AAtE1B;AAuEM,YAAI,CAAC;AAAG;AAER,cAAM,QAAQ,QAAO,yBAAE,OAAF,YAAQ,EAAE,UAAV,YAAmB,EAAE,YAArB,YAAgC,EAAE,eAAlC,YAAgD,EAAE;AACvE,YAAI,CAAC;AAAO;AAEZ,cAAM,MAAM,KAAK,MAAM,UAAU,OAAK,OAAO,EAAE,EAAE,MAAM,KAAK;AAC5D,YAAI,MAAM,IAAI;AACZ,eAAK,MAAM,GAAG,IAAI,gDAAK,KAAK,MAAM,GAAG,IAAM,IAAzB,EAA4B,IAAI,MAAM;AAAA,QAC1D,OAAO;AACL,eAAK,MAAM,KAAK,iCAAK,IAAL,EAAQ,IAAI,MAAM,EAAC;AAAA,QACrC;AAAA,MACF,CAAC;AAAA,IACH;AAAA;AAAA;AAAA;AAAA,IAKA,YAAY,IAAI;AACd,aAAO,KAAK,MAAM,KAAK,OAAK,OAAO,EAAE,EAAE,MAAM,OAAO,EAAE,CAAC;AAAA,IACzD;AAAA,EACF;AAGA,SAAO,sBAAsB;AAE7B,MAAO,gBAAQ;;;AC1Ff,MAAM,MAAO,IAAI,MAAM,QAAQ,IAAI,gBAAgB,GAAG,CAAC;AACvD,MAAM,OAAO,IAAI,MAAM,QAAQ,KAAK,gBAAgB,GAAG,CAAC;AACxD,MAAMA,KAAO,OAAO;AAKpB,WAAS,UAAU;AAbnB;AAcE,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,UAAM,WACJ,IAAI,YACJ,OAAO,aACP,oBAAS,SAAT,mBAAe,YAAf,mBAAwB,YACxB;AACF,UAAM,QAAQ,IAAI,SAAS,IAAI,YAAY,OAAO,YAAY;AAC9D,WAAO,EAAE,UAAU,MAAM;AAAA,EAC3B;AAKA,WAAS,cAAc,KAAK;AAC1B,QAAI,CAAC,MAAM,QAAQ,GAAG;AAAG,aAAO,CAAC;AACjC,WAAO,IAAI,IAAI,QAAM;AA7BvB;AA8BI,UAAI,MAAM,OAAO,OAAO,UAAU;AAChC,eAAO;AAAA,UACL,IAAM,QAAO,cAAG,OAAH,YAAS,GAAG,UAAZ,YAAqB,EAAE;AAAA,UACpC,MAAM,QAAO,cAAG,SAAH,YAAW,GAAG,UAAd,YAAuB,EAAE;AAAA,QACxC;AAAA,MACF;AACA,aAAO,EAAE,IAAI,OAAO,EAAE,GAAG,MAAM,OAAO,EAAE,EAAE;AAAA,IAC5C,CAAC,EAAE,OAAO,OAAK,EAAE,MAAM,EAAE,IAAI;AAAA,EAC/B;AAKA,WAAS,gBAAgB;AACvB,QAAI,MAAM,QAAQ,OAAO,eAAe,KAAK,OAAO,gBAAgB,QAAQ;AAC1E,aAAO,cAAc,OAAO,eAAe;AAAA,IAC7C;AACA,QAAI,OAAO,WAAW,MAAM,QAAQ,OAAO,QAAQ,OAAO,KAAK,OAAO,QAAQ,QAAQ,QAAQ;AAC5F,aAAO,cAAc,OAAO,QAAQ,OAAO;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,OAAO,SAAS,KAAK,OAAO,UAAU,QAAQ;AAC9D,aAAO,cAAc,OAAO,SAAS;AAAA,IACvC;AACA,WAAO;AAAA,EACT;AAGA,WAAS,SAAS,KAAK,MAAM;AAC3B,WAAOA,GAAE,KAAK,KAAK,IAAI,EAAE,KAAK,SAAO;AACnC,UAAI;AAAE,eAAQ,OAAO,QAAQ,WAAY,KAAK,MAAM,GAAG,IAAI;AAAA,MAAK,SACzD,GAAG;AAAE,eAAO;AAAA,MAAK;AAAA,IAC1B,CAAC;AAAA,EACH;AAEA,MAAM,aAAa;AAAA,IACjB,QAAQ,EAAE,MAAM,MAAM,aAAa,KAAK;AAAA,IACxC,gBAAgB;AAAA,IAEhB,aAAa;AACX,WAAK,OAAO,OAAO;AACnB,WAAK,OAAO,cAAc;AAAA,IAC5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,QAAQ,QAAQ,OAAO;AAErB,UAAI,CAAC,OAAO;AACV,cAAM,MAAM,cAAc;AAC1B,YAAI,OAAO,IAAI,QAAQ;AACrB,eAAK,OAAO,OAAO,IAAI,MAAM;AAC7B,iBAAOA,GAAE,SAAS,EAAE,QAAQ,KAAK,OAAO,IAAI,EAAE,QAAQ;AAAA,QACxD;AAAA,MACF;AAGA,UAAI,CAAC,SAAS,KAAK,OAAO,MAAM;AAC9B,eAAOA,GAAE,SAAS,EAAE,QAAQ,KAAK,OAAO,IAAI,EAAE,QAAQ;AAAA,MACxD;AAIA,UAAI,KAAK,OAAO,aAAa;AAC3B,eAAO,KAAK,OAAO;AAAA,MACrB;AAGA,YAAM,EAAE,UAAU,MAAM,IAAI,QAAQ;AACpC,UAAI,CAAC,UAAU;AACb,aAAK,8CAA8C;AACnD,eAAOA,GAAE,SAAS,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ;AAAA,MAC1C;AAEA,UAAI,iCAA4B;AAChC,YAAM,UAAU;AAAA,QACd,QAAa;AAAA,QACb,UAAa;AAAA;AAAA,QACb;AAAA;AAAA,QACA,aAAa;AAAA;AAAA,MACf;AAGA,YAAM,IAAI,SAAS,UAAU,OAAO,EACjC,KAAK,SAAO;AACX,cAAM,UAAU,MAAM,QAAQ,GAAG,IAAI,OAAO,2BAAK,SAAQ,CAAC;AAC1D,cAAM,OAAU,cAAc,OAAO;AACrC,aAAK,OAAO,OAAO;AACnB,YAAI,yBAAyB,KAAK,MAAM;AACxC,eAAO;AAAA,MACT,CAAC,EACA,KAAK,CAAC,KAAK,QAAQC,SAAQ;AAC1B,aAAK,6BAA6B,QAAQA,MAAK,2BAAK,YAAY;AAChE,eAAO,CAAC;AAAA,MACV,CAAC,EACA,OAAO,MAAM;AAEZ,aAAK,OAAO,cAAc;AAAA,MAC5B,CAAC;AAEH,WAAK,OAAO,cAAc;AAC1B,aAAO;AAAA,IACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASA,eAAe,KAAK,EAAE,QAAQ,MAAM,IAAI,CAAC,GAAG;AAC1C,YAAM,KAAM,eAAe,UAAW,MAAM,SAAS,cAAc,GAAG;AACtE,UAAI,CAAC;AAAI,eAAOD,GAAE,SAAS,EAAE,QAAQ,IAAI,EAAE,QAAQ;AAEnD,YAAM,QAAQ,GAAG,SAAS;AAC1B,SAAG,YAAY;AACf,YAAM,KAAK,SAAS,cAAc,QAAQ;AAC1C,SAAG,QAAQ;AACX,SAAG,cAAc;AACjB,SAAG,YAAY,EAAE;AAEjB,aAAO,KAAK,QAAQ,KAAK,EAAE,KAAK,UAAQ;AACtC,aAAK,QAAQ,CAAC,EAAE,IAAI,KAAK,MAAM;AAC7B,gBAAM,IAAI,SAAS,cAAc,QAAQ;AACzC,YAAE,QAAQ;AACV,YAAE,cAAc;AAChB,aAAG,YAAY,CAAC;AAAA,QAClB,CAAC;AACD,YAAI,SAAS,KAAK,KAAK,OAAK,OAAO,EAAE,EAAE,MAAM,OAAO,KAAK,CAAC,GAAG;AAC3D,aAAG,QAAQ,OAAO,KAAK;AAAA,QACzB;AACA,eAAO;AAAA,MACT,CAAC;AAAA,IACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQA,aAAa,WAAW;AACtB,UAAI,CAAC,WAAW;AACd,aAAK,iBAAiB;AACtB,eAAOA,GAAE,SAAS,EAAE,QAAQ,IAAI,EAAE,QAAQ;AAAA,MAC5C;AAEA,YAAM,EAAE,UAAU,MAAM,IAAI,QAAQ;AACpC,UAAI,CAAC,UAAU;AACb,aAAK,yCAAyC;AAC9C,eAAOA,GAAE,SAAS,EAAE,QAAQ,IAAI,EAAE,QAAQ;AAAA,MAC5C;AAEA,UAAI,4BAA4B,SAAS;AACzC,YAAM,UAAU;AAAA,QACd,QAAa;AAAA,QACb,YAAa;AAAA;AAAA,QACb,IAAa;AAAA;AAAA,QACb,UAAa;AAAA,QACb;AAAA,QACA,aAAa;AAAA,MACf;AAEA,aAAO,SAAS,UAAU,OAAO,EAC9B,KAAK,SAAO;AACX,cAAM,WAAU,2BAAK,SAAQ,OAAO;AACpC,aAAK,iBAAiB,WAAW;AACjC,iBAAS,cAAc,IAAI,YAAY,sBAAsB;AAAA,UAC3D,QAAQ,EAAE,IAAI,OAAO,SAAS,GAAG,SAAS,KAAK,eAAe;AAAA,QAChE,CAAC,CAAC;AACF,eAAO,KAAK;AAAA,MACd,CAAC,EACA,KAAK,CAAC,KAAK,QAAQC,SAAQ;AAC1B,aAAK,gCAAgC,QAAQA,MAAK,2BAAK,YAAY;AACnE,aAAK,iBAAiB;AACtB,eAAO;AAAA,MACT,CAAC;AAAA,IACL;AAAA,EACF;AAGA,MAAI,OAAO,WAAW,aAAa;AACjC,WAAO,aAAa;AAAA,EACtB;AAEA,MAAO,cAAQ;;;ACnNf,MAAMC,OAAO,IAAI,MAAM,QAAQ,IAAI,eAAe,GAAG,CAAC;AACtD,MAAMC,QAAO,IAAI,MAAM,QAAQ,KAAK,eAAe,GAAG,CAAC;AACvD,MAAMC,KAAO,OAAO;AAGpB,WAASC,WAAU;AAZnB;AAaE,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,UAAM,WACJ,IAAI,YACJ,OAAO,aACP,oBAAS,SAAT,mBAAe,YAAf,mBAAwB,YACxB;AACF,UAAM,QAAQ,IAAI,SAAS,IAAI,YAAY,OAAO,YAAY;AAC9D,WAAO,EAAE,UAAU,MAAM;AAAA,EAC3B;AAGA,WAASC,eAAc,KAAK;AAC1B,QAAI,CAAC,MAAM,QAAQ,GAAG;AAAG,aAAO,CAAC;AACjC,WAAO,IAAI,IAAI,QAAM;AA1BvB;AA2BI,UAAI,MAAM,OAAO,OAAO,UAAU;AAChC,eAAO;AAAA,UACL,IAAM,QAAO,cAAG,OAAH,YAAS,GAAG,UAAZ,YAAqB,EAAE;AAAA,UACpC,MAAM,QAAO,cAAG,SAAH,YAAW,GAAG,UAAd,YAAuB,EAAE;AAAA,QACxC;AAAA,MACF;AACA,aAAO,EAAE,IAAI,OAAO,EAAE,GAAG,MAAM,OAAO,EAAE,EAAE;AAAA,IAC5C,CAAC,EAAE,OAAO,OAAK,EAAE,MAAM,EAAE,IAAI;AAAA,EAC/B;AAOA,WAASC,iBAAgB;AAEvB,QAAI,MAAM,QAAQ,OAAO,eAAe,KAAK,OAAO,gBAAgB,QAAQ;AAC1E,aAAOD,eAAc,OAAO,eAAe;AAAA,IAC7C;AAGA,QAAI,MAAM,QAAQ,OAAO,cAAc,KAAK,OAAO,eAAe,QAAQ;AACxE,aAAOA,eAAc,OAAO,cAAc;AAAA,IAC5C;AAGA,QAAI,OAAO,WAAW,MAAM,QAAQ,OAAO,QAAQ,OAAO,KAAK,OAAO,QAAQ,QAAQ,QAAQ;AAC5F,aAAOA,eAAc,OAAO,QAAQ,OAAO;AAAA,IAC7C;AACA,QAAI,MAAM,QAAQ,OAAO,SAAS,KAAK,OAAO,UAAU,QAAQ;AAC9D,aAAOA,eAAc,OAAO,SAAS;AAAA,IACvC;AACA,WAAO;AAAA,EACT;AAGA,WAASE,UAAS,KAAK,MAAM;AAC3B,WAAOJ,GAAE,KAAK,KAAK,IAAI,EAAE,KAAK,SAAO;AACnC,UAAI;AAAE,eAAQ,OAAO,QAAQ,WAAY,KAAK,MAAM,GAAG,IAAI;AAAA,MAAK,SACzD,GAAG;AAAE,eAAO;AAAA,MAAK;AAAA,IAC1B,CAAC;AAAA,EACH;AAGA,WAAS,4BAA4B,UAAU,CAAC,GAAG;AACjD,UAAM,IAAK,WAAW,OAAO,YAAY,WAAY,mBAAK,WAAY,CAAC;AAGvE,QAAI,CAAC,EAAE,cAAc,EAAE;AAAa,QAAE,aAAa,EAAE;AACrD,QAAI,CAAC,EAAE,eAAe,EAAE;AAAY,QAAE,cAAc,EAAE;AACtD,QAAI,CAAC,EAAE,cAAc,CAAC,EAAE,eAAe,EAAE;AAAM,QAAE,aAAa,EAAE;AAGhE,KAAC,aAAa,aAAa,aAAa,EAAE,QAAQ,OAAK;AACrD,UAAI,EAAE,CAAC,KAAK;AAAM,UAAE,CAAC,IAAI,OAAO,EAAE,CAAC,CAAC;AAAA,IACtC,CAAC;AAGD,KAAC,aAAa,aAAa,WAAW,EAAE,QAAQ,OAAK;AACnD,UAAI,EAAE,CAAC,KAAK;AAAM,UAAE,CAAC,IAAI,OAAO,EAAE,CAAC,CAAC;AAAA,IACtC,CAAC;AAGD,KAAC,cAAc,cAAc,YAAY,EAAE,QAAQ,OAAK;AACtD,UAAI,EAAE,CAAC,KAAK;AAAM,UAAE,CAAC,IAAI,SAAS,EAAE,CAAC,GAAG,EAAE,KAAK;AAAA,IACjD,CAAC;AAED,WAAO;AAAA,EACT;AAGA,WAAS,qBAAqB,UAAU,CAAC,GAAG;AAC1C,UAAM,QAAQ,CAAC,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ,MAAM,EAC1D,IAAI,OAAM,KAAK,OAAO,KAAK,OAAO,CAAC,CAAE,EACrC,OAAO,OAAO;AAEjB,WAAO,MAAM,IAAI,CAAC,MAAM,MAAM;AAC5B,YAAM,IAAI,QAAQ,YAAY,IAAI,CAAC,EAAE;AACrC,YAAM,OAAO,SAAS,GAAG,EAAE,KAAK;AAChC,aAAO,OAAO,IAAI,GAAG,IAAI,SAAM,IAAI,KAAK;AAAA,IAC1C,CAAC;AAAA,EACH;AAEA,MAAM,YAAY;AAAA,IAChB,QAAQ,EAAE,MAAM,MAAM,aAAa,KAAK;AAAA,IACxC,gBAAgB;AAAA,IAEhB,aAAa;AACX,WAAK,OAAO,OAAO;AACnB,WAAK,OAAO,cAAc;AAAA,IAC5B;AAAA;AAAA,IAGA,QAAQ,QAAQ,OAAO;AAErB,UAAI,CAAC,OAAO;AACV,cAAM,MAAMG,eAAc;AAC1B,YAAI,OAAO,IAAI,QAAQ;AACrB,eAAK,OAAO,OAAO,IAAI,MAAM;AAC7B,iBAAOH,GAAE,SAAS,EAAE,QAAQ,KAAK,OAAO,IAAI,EAAE,QAAQ;AAAA,QACxD;AAAA,MACF;AAGA,UAAI,CAAC,SAAS,KAAK,OAAO,MAAM;AAC9B,eAAOA,GAAE,SAAS,EAAE,QAAQ,KAAK,OAAO,IAAI,EAAE,QAAQ;AAAA,MACxD;AAIA,UAAI,KAAK,OAAO,aAAa;AAC3B,eAAO,KAAK,OAAO;AAAA,MACrB;AAGA,YAAM,EAAE,UAAU,MAAM,IAAIC,SAAQ;AACpC,UAAI,CAAC,UAAU;AACb,QAAAF,MAAK,8CAA8C;AACnD,eAAOC,GAAE,SAAS,EAAE,QAAQ,CAAC,CAAC,EAAE,QAAQ;AAAA,MAC1C;AAEA,MAAAF,KAAI,iCAA4B;AAChC,YAAM,UAAU;AAAA,QACd,QAAa;AAAA,QACb,UAAa;AAAA,QACb;AAAA,QACA,aAAa;AAAA,MACf;AAEA,YAAM,IAAIM,UAAS,UAAU,OAAO,EACjC,KAAK,SAAO;AACX,cAAM,UAAU,MAAM,QAAQ,GAAG,IAAI,OAAO,2BAAK,SAAQ,CAAC;AAC1D,cAAM,OAAUF,eAAc,OAAO;AACrC,aAAK,OAAO,OAAO;AACnB,QAAAJ,KAAI,wBAAwB,KAAK,MAAM;AACvC,eAAO;AAAA,MACT,CAAC,EACA,KAAK,CAAC,KAAK,QAAQO,SAAQ;AAC1B,QAAAN,MAAK,4BAA4B,QAAQM,MAAK,2BAAK,YAAY;AAC/D,eAAO,CAAC;AAAA,MACV,CAAC,EACA,OAAO,MAAM;AACZ,aAAK,OAAO,cAAc;AAAA,MAC5B,CAAC;AAEH,WAAK,OAAO,cAAc;AAC1B,aAAO;AAAA,IACT;AAAA;AAAA,IAGA,eAAe,KAAK,EAAE,QAAQ,MAAM,IAAI,CAAC,GAAG;AAC1C,YAAM,KAAM,eAAe,UAAW,MAAM,SAAS,cAAc,GAAG;AACtE,UAAI,CAAC;AAAI,eAAOL,GAAE,SAAS,EAAE,QAAQ,IAAI,EAAE,QAAQ;AAEnD,YAAM,QAAQ,GAAG,SAAS;AAC1B,SAAG,YAAY;AACf,YAAM,KAAK,SAAS,cAAc,QAAQ;AAC1C,SAAG,QAAQ;AACX,SAAG,cAAc;AACjB,SAAG,YAAY,EAAE;AAEjB,aAAO,KAAK,QAAQ,KAAK,EAAE,KAAK,UAAQ;AACtC,aAAK,QAAQ,CAAC,EAAE,IAAI,KAAK,MAAM;AAC7B,gBAAM,IAAI,SAAS,cAAc,QAAQ;AACzC,YAAE,QAAQ;AACV,YAAE,cAAc;AAChB,aAAG,YAAY,CAAC;AAAA,QAClB,CAAC;AACD,YAAI,SAAS,KAAK,KAAK,OAAK,OAAO,EAAE,EAAE,MAAM,OAAO,KAAK,CAAC,GAAG;AAC3D,aAAG,QAAQ,OAAO,KAAK;AAAA,QACzB;AACA,eAAO;AAAA,MACT,CAAC;AAAA,IACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,aAAa,UAAU;AACrB,UAAI,CAAC,UAAU;AACb,aAAK,iBAAiB;AACtB,eAAOA,GAAE,SAAS,EAAE,QAAQ,IAAI,EAAE,QAAQ;AAAA,MAC5C;AAEA,YAAM,EAAE,UAAU,MAAM,IAAIC,SAAQ;AACpC,UAAI,CAAC,UAAU;AACb,QAAAF,MAAK,yCAAyC;AAC9C,eAAOC,GAAE,SAAS,EAAE,QAAQ,IAAI,EAAE,QAAQ;AAAA,MAC5C;AAEA,MAAAF,KAAI,2BAA2B,QAAQ;AACvC,YAAM,UAAU;AAAA,QACd,QAAa;AAAA,QACb,IAAa;AAAA,QACb,UAAa;AAAA,QACb;AAAA,QACA,aAAa;AAAA,MACf;AAEA,aAAOM,UAAS,UAAU,OAAO,EAC9B,KAAK,SAAO;AACX,cAAM,UACH,OAAO,IAAI,YAAY,OAAQ,IAAI,OACnC,OAAO,IAAI,YAAY,SAAa,MACrC;AAEF,YAAI,CAAC,SAAS;AACZ,UAAAL,MAAK,4CAA4C,GAAG;AACpD,eAAK,iBAAiB;AACtB,iBAAO;AAAA,QACT;AAEA,cAAM,aAAa,4BAA4B,OAAO;AACtD,aAAK,iBAAiB;AACtB,eAAO;AAAA,MACT,CAAC,EACA,KAAK,CAAC,KAAK,QAAQM,SAAQ;AAC1B,QAAAN,MAAK,+BAA+B,QAAQM,MAAK,2BAAK,YAAY;AAClE,aAAK,iBAAiB;AACtB,eAAO;AAAA,MACT,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA,WAAW,UAAU;AACnB,aAAO,KAAK,aAAa,QAAQ,EAAE,KAAK,aAAW;AACjD,YAAI,CAAC;AAAS,iBAAO,CAAC;AACtB,eAAO,qBAAqB,OAAO;AAAA,MACrC,CAAC;AAAA,IACH;AAAA,EACF;AAGA,MAAI,OAAO,WAAW,aAAa;AACjC,WAAO,YAAY;AAAA,EACrB;AAEA,MAAOC,eAAQ;;;ACxQf,MAAM,YAAY,CAAC,MAAK,MAAK,MAAK,OAAM,KAAK;AAM7C,MAAM,SAAS;AAAA,IACb,IAAK;AAAA,IACL,IAAK;AAAA,IACL,IAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,IACL,KAAK;AAAA,EACP;AAEA,MAAM,SAAa,CAAC,QAAO,SAAQ,QAAO,QAAO,iBAAgB,cAAc;AAC/E,MAAM,aAAa,CAAC,MAAK,MAAK,IAAI;AAClC,MAAM,YAAa,EAAE,IAAG,GAAG,IAAG,GAAG,IAAG,EAAE;AAEtC,MAAM,gBAAgB;AAAA,IACpB;AAAA,IACA;AAAA;AAAA;AAAA;AAAA;AAAA,IAMA,oBAAoB;AAClB,YAAM,MAAM,CAAC;AAMb,eAAS,QAAQ,QAAQ;AACvB,YAAI,CAAC;AAAQ;AAEb,cAAM,OAAO,cAAW,YAAY,MAAM;AAC1C,YAAI,CAAC;AAAM;AAGX,cAAM,WAAW,OAAO,KAAK,EAAE;AAC/B,YAAI,CAAC;AAAU;AAGf,cAAM,QAAQ,SAAS,KAAK,mBAAmB,EAAE,KAAK;AAEtD,YAAI,QAAQ,KAAK,IAAI,QAAQ,KAAK,KAAK;AAAA,MACzC;AAGA,oBAAW,SAAS,QAAQ,OAAO;AAGnC,YAAM,KAAK,YAAe;AAC1B,UAAI,IAAI;AACN,SAAC,aAAY,aAAY,WAAW,EAAE,QAAQ,SAAO;AACnD,kBAAQ,GAAG,GAAG,CAAC;AAAA,QACjB,CAAC;AAAA,MACH;AAGA,YAAM,KAAKC,aAAc;AACzB,UAAI,IAAI;AACN,SAAC,aAAY,aAAY,WAAW,EAAE,QAAQ,SAAO;AACnD,kBAAQ,GAAG,GAAG,CAAC;AAAA,QACjB,CAAC;AAAA,MACH;AAEA,cAAQ,IAAI,6BAAwB,GAAG;AACvC,aAAO;AAAA,IACT;AAAA;AAAA;AAAA;AAAA,IAKA,gBAAgB;AACd,YAAMC,MAAO,OAAO;AACpB,YAAM,OAAO,EAAE,IAAG,GAAG,IAAG,GAAG,IAAG,EAAE;AAEhC,MAAAA,IAAE,kBAAkB,EAAE,KAAK,WAAU;AACnC,cAAM,IAAIA,IAAE,IAAI,EAAE,IAAI;AACtB,YAAI,KAAK,KAAK;AAAM,eAAK,CAAC;AAAA,MAC5B,CAAC;AAED,MAAAA,IAAE,kBAAkB,EAAE,KAAK,WAAU;AACnC,cAAM,OAAUA,IAAE,IAAI;AACtB,cAAM,UAAU,KAAK,IAAI,KAAK;AAC9B,YAAI,UAAY;AAEhB,mBAAW,QAAQ,SAAO;AACxB,cAAI,KAAK,GAAG,IAAI,UAAU,GAAG,KAAK,YAAY,KAAK;AACjD,kBAAM,MAAM,YAAY,MAAM,cAAc;AAC5C,uBAAW,kBAAkB,GAAG,IAAI,GAAG,IAAI,GAAG;AAAA,UAChD;AAAA,QACF,CAAC;AAED,aAAK,KAAK,OAAO;AAAA,MACnB,CAAC;AAAA,IACH;AAAA;AAAA;AAAA;AAAA,IAKA,yBAAyB;AACvB,YAAMA,MAAS,OAAO;AACtB,YAAM,SAAS,KAAK,kBAAkB;AAEtC,aAAO,QAAQ,cAAY;AACzB,cAAM,OAASA,IAAE,OAAO,QAAQ,EAAE;AAClC,cAAM,OAAS,KAAK,IAAI,KAAK;AAC7B,cAAM,MAAS,UAAU,QAAQ,IAAI;AACrC,cAAM,QAAS,OAAO,QAAQ,KAAK;AACnC,cAAM,UAAU,UAAU,KAAK,IAAI,MAAM,OAAO,UAAU,SAAS,CAAC,CAAC;AACrE,QAAAA,IAAE,OAAO,QAAQ,WAAW,EAAE,KAAK,OAAO;AAAA,MAC5C,CAAC;AAAA,IACH;AAAA;AAAA;AAAA;AAAA,IAKA,aAAa;AACX,WAAK,cAAc;AACnB,WAAK,uBAAuB;AAAA,IAC9B;AAAA;AAAA;AAAA;AAAA,IAKA,cAAc,UAAU;AACtB,YAAM,SAAS,KAAK,kBAAkB;AACtC,YAAM,MAAS,OAAO,QAAQ,KAAK;AACnC,UAAI,CAAC;AAAK,eAAO;AACjB,YAAM,OAAO,OAAO,OAAO,OAAO,QAAQ,EAAE,EAAE,IAAI,KAAK;AACvD,YAAM,MAAO,UAAU,QAAQ,IAAI;AACnC,aAAO,UAAU,KAAK,IAAI,MAAM,KAAK,UAAU,SAAS,CAAC,CAAC;AAAA,IAC5D;AAAA,EACF;AAEA,MAAO,kBAAQ;;;AC7If,MAAMC,UAAS,gBAAc;AAC7B,MAAM,OAAS,gBAAc;AAE7B,WAAS,OAAO,KAAK;AACnB,UAAM,IAAI,OAAO,OAAO,KAAK,OAAO,GAAG;AACvC,WAAO,EACJ,QAAQ,MAAM,OAAO,EACrB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,QAAQ,EACtB,QAAQ,MAAM,OAAO;AAAA,EAC1B;AAEA,WAAS,WAAW,MAAM,IAAI;AAC5B,WAAO,IAAI,OAAO,CAAC,EAAE,YAAY,IAAI,IAAI,MAAM,CAAC;AAAA,EAClD;AAEA,MAAO,yBAAQ;AAAA,IACb,aAAa;AACX,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAQT;AAAA,IAEA,cAAc,OAAO,CAAC,GAAG;AAGvB,YAAM,cAAcA,QAAO,IAAI,WAAS;AApC5C;AAqCM,cAAM,MAAQ,QAAO,UAAK,KAAK,MAAV,YAAe,EAAE;AACtC,cAAM,QAAQ,UAAU,kBAAkB,YAC5B,UAAU,iBAAkB,WAC5B,WAAW,KAAK;AAE9B,cAAM,UAAU,KAAK,IAAI,SAAO;AAC9B,gBAAM,MAAO,QAAQ,MAAO,cAAc;AAC1C,iBAAO,kBAAkB,GAAG,IAAI,GAAG,IAAI,GAAG;AAAA,QAC5C,CAAC,EAAE,KAAK,EAAE;AAEV,eAAO;AAAA;AAAA,mBAEM,KAAK;AAAA,2BACG,KAAK;AAAA;AAAA,cAElB,OAAO;AAAA;AAAA;AAAA;AAAA,qBAIA,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,MAKtB,CAAC,EAAE,KAAK,EAAE;AAEV,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yDAS8C,OAAO,KAAK,IAAI,CAAC;AAAA;AAAA;AAAA;AAAA,gEAIV,OAAO,KAAK,WAAW,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6CAO3C,KAAK,WAAW,SAAa,aAAa,EAAE;AAAA,6CAC5C,KAAK,WAAW,WAAa,aAAa,EAAE;AAAA,6CAC5C,KAAK,WAAW,cAAa,aAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA,wDAKjC,OAAO,KAAK,GAAG,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,sDAKlB,OAAO,KAAK,KAAK,CAAC;AAAA;AAAA;AAAA,sDAGlB,OAAO,KAAK,KAAK,CAAC;AAAA;AAAA,sDAElB,OAAO,KAAK,KAAK,CAAC;AAAA;AAAA,sDAElB,OAAO,KAAK,KAAK,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAMxD,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,4CAOiB,OAAO,KAAK,WAAW,CAAC;AAAA;AAAA,0CAE1B,OAAO,KAAK,SAAS,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,IAK9D;AAAA,EACF;;;ACpHA,MAAO,yBAAQ;AAAA,IACb,cAAc,OAAO,CAAC,GAAG;AACvB,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BASkB,KAAK,cAAc,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAQrB,KAAK,aAAa,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IA0B/C;AAAA,EACF;;;AC/CA,WAASC,QAAO,MAAM,IAAI;AACxB,WAAO,OAAO,GAAG,EACd,QAAQ,MAAM,OAAO,EACrB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,MAAM,EACpB,QAAQ,MAAM,QAAQ,EACtB,QAAQ,MAAM,QAAQ;AAAA,EAC3B;AAEA,MAAO,wBAAQ;AAAA,IACb,cAAc,OAAO,CAAC,GAAG;AAhB3B;AAiBI,YAAM,gBAAe,iBAAe,mBAAf,mBAA+B,iBAAgB;AACpE,YAAM,eAAe,KAAAC,aAAc,mBAAd,mBAA8B,gBAAgB;AACnE,YAAM,eAAe,KAAK,gBAAgB,CAAC;AAC3C,YAAM,YAAe,KAAK,cAAc,CAAC;AAGzC,YAAM,aAAa,CAAC,eAAeD,QAAO,UAAU,CAAC,OAAO,EACzD;AAAA,QACC,aAAa;AAAA,UAAI,CAAC,GAAE,MAClB,cAAc,IAAE,CAAC,KAAKA,QAAO,EAAE,IAAI,CAAC;AAAA,QACtC;AAAA,MACF,EAAE,KAAK,EAAE;AAGX,YAAM,OAAO,UAAU,IAAI,WAAM;AA/BrC,YAAAE;AA+BwC;AAAA,2BACb,MAAM,EAAE;AAAA,cACrBF,QAAO,MAAM,IAAI,CAAC;AAAA;AAAA,UAEtB,aAAa,IAAI,MAAM,WAAW,EAAE,KAAK,EAAE,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,6BAKzB,MAAM,EAAE;AAAA;AAAA,qBAEhBA,UAAOE,MAAA,KAAK,eAAL,gBAAAA,IAAkB,MAAM,QAAK,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAKtD,EAAE,KAAK,EAAE;AAEV,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,6BAMkBF,QAAO,WAAW,CAAC;AAAA,gBAChC,UAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAMZ,IAAI;AAAA;AAAA;AAAA;AAAA;AAAA,IAKhB;AAAA,EACF;;;AC/DA,MAAO,yBAAQ;AAAA,IACb,cAAc,OAAO,CAAC,GAAG;AACvB,aAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAUT;AAAA,EACF;;;ACjBA,MAAMG,KAAI,OAAO;AAOjB,MAAM,cAAc;AAAA,IAClB,UAAU,OAAO,CAAC,GAAG;AACnB,cAAQ,IAAI,gDAAoC,IAAI;AAGpD,YAAM,OAAO;AAAA;AAAA;AAAA,IAGb,uBAAmB,WAAW,CAAC;AAAA;AAAA,MAE7B,uBAAmB,cAAc,IAAI,CAAC;AAAA,MACtC,uBAAmB,cAAc,IAAI,CAAC;AAAA,MACtC,sBAAkB,cAAc,IAAI,CAAC;AAAA,MACrC,uBAAmB,cAAc,IAAI,CAAC;AAAA;AAAA;AAAA,+CAGG,KAAK,MAAM,EAAE;AAAA;AAAA;AAAA;AAAA;AAAA;AASxD,iBAAW,MAAM;AACf,gBAAQ,IAAI,qDAA8C;AAAA,UACxD,MAAiBA,GAAE,UAAU,EAAE,IAAI;AAAA,UACnC,OAAiBA,GAAE,WAAW,EAAE,IAAI;AAAA,UACpC,MAAiBA,GAAE,UAAU,EAAE,IAAI;AAAA,UACnC,MAAiBA,GAAE,UAAU,EAAE,IAAI;AAAA,UACnC,eAAiBA,GAAE,mBAAmB,EAAE,IAAI;AAAA,UAC5C,cAAiBA,GAAE,kBAAkB,EAAE,IAAI;AAAA,UAC3C,gBAAiBA,GAAE,aAAa,EAAE,IAAI;AAAA,UACtC,eAAiBA,GAAE,YAAY,EAAE,IAAI;AAAA,QACvC,CAAC;AAAA,MACH,GAAG,CAAC;AAGJ,aAAO;AAAA,IACT;AAAA,EACF;AAEA,MAAO,uBAAQ;;;ACjDf,MAAMC,KAAI,OAAO;AAQjB,WAASC,WAAU;AAVnB;AAWE,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,WAAO;AAAA,MACL,KAAO,IAAI,YAAY,OAAO,aAAW,oBAAS,SAAT,mBAAe,YAAf,mBAAwB,YAAW;AAAA,MAC5E,OAAO,IAAI,SAAY,IAAI,YAAc,OAAO,YAAY;AAAA,IAC9D;AAAA,EACF;AAMA,WAAS,cAAc,MAAM,CAAC,GAAG;AAtBjC;AAwBE,UAAM,WAAU,qBAAI,YAAJ,YAAe,IAAI,eAAnB,YAAiC,IAAI,kBAArC,YAAsD;AACtE,UAAM,UAAU,qBAAI,WAAJ,YAAe,IAAI,cAAnB,YAAiC,IAAI,iBAArC,YAAsD;AAEtE,WAAO;AAAA,MACL,IAAa,IAAI,MAAM;AAAA,MACvB,MAAa,IAAI,QAAQ;AAAA,MACzB,aAAa,IAAI,eAAe;AAAA,MAChC,KAAa,IAAI,OAAO;AAAA,MACxB,QAAa,IAAI,UAAU;AAAA,MAC3B,OAAa,IAAI,SAAS;AAAA,MAC1B,OAAa,SAAI,SAAJ,YAAY;AAAA,MACzB,OAAa,SAAI,SAAJ,YAAY;AAAA,MACzB,OAAa,SAAI,SAAJ,YAAY;AAAA,MACzB,QAAa,SAAI,UAAJ,YAAa;AAAA,MAC1B;AAAA,MACA;AAAA;AAAA,MAGA,aAAa,IAAI,aAAa,KAAK,UAAU,IAAI,UAAU,IAAI;AAAA,MAC/D,aAAa,IAAI,aAAa,KAAK,UAAU,IAAI,UAAU,IAAI;AAAA,MAC/D,aAAa,IAAI,aAAa,KAAK,UAAU,IAAI,UAAU,IAAI;AAAA,MAC/D,OAAa,IAAI,QAAa,KAAK,UAAU,IAAI,KAAK,IAAS;AAAA;AAAA,MAG/D,YAAa,MAAM,QAAQ,IAAI,UAAU,IAAI,IAAI,aAAa;AAAA,IAChE;AAAA,EACF;AASA,WAAS,aAAa,KAAK;AACzB,UAAM,OAAO,cAAc,GAAG;AAC9B,UAAM,EAAE,MAAM,IAAIA,SAAQ;AAE1B,UAAM,OAAO,EAAE,QAAQ,oBAAoB;AAC3C,QAAI,OAAO;AACT,WAAK,WAAc;AACnB,WAAK,QAAc;AACnB,WAAK,cAAc;AAAA,IACrB;AAGA,UAAM,OAAO,mQACR,OACC,KAAK,KAAgB,EAAE,IAAI,KAAK,GAAG,IAAI,CAAC,IACxC,KAAK,OAAgB,EAAE,MAAM,KAAK,KAAK,IAAI,CAAC,IAC5C,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,MAAgB,EAAE,KAAK,KAAK,IAAI,IAAI,CAAC,IAC1C,KAAK,SAAgB,EAAE,QAAQ,KAAK,OAAO,IAAI,CAAC,IAChD,KAAK,QAAgB,EAAE,OAAO,KAAK,MAAM,IAAI,CAAC,IAC9C,KAAK,SAAU,KAAM,EAAE,MAAM,KAAK,KAAK,IAAM,CAAC,IAC9C,KAAK,SAAU,KAAM,EAAE,MAAM,KAAK,KAAK,IAAM,CAAC,IAC9C,KAAK,SAAU,KAAM,EAAE,MAAM,KAAK,KAAK,IAAM,CAAC,IAC9C,KAAK,UAAU,KAAM,EAAE,OAAO,KAAK,MAAM,IAAI,CAAC,IAC9C,KAAK,UAAgB,EAAE,SAAS,KAAK,QAAQ,IAAI,CAAC,IAClD,KAAK,SAAgB,EAAE,QAAS,KAAK,OAAQ,IAAI,CAAC,IAClD,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,QAAgB,EAAE,OAAO,KAAK,MAAM,IAAI,CAAC;AAIpD,UAAM,YAAY,CAAC;AACnB,QAAI,KAAK;AAAc,gBAAU,KAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,OAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,cAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,MAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,SAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,QAAe,KAAK;AACrD,QAAI,KAAK,SAAS;AAAK,gBAAU,OAAe,KAAK;AACrD,QAAI,KAAK,SAAS;AAAK,gBAAU,OAAe,KAAK;AACrD,QAAI,KAAK,SAAS;AAAK,gBAAU,OAAe,KAAK;AACrD,QAAI,KAAK,UAAU;AAAI,gBAAU,QAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,UAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,SAAe,KAAK;AAErD,QAAI,KAAK;AAAc,gBAAU,cAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,cAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,cAAe,KAAK;AACrD,QAAI,KAAK;AAAc,gBAAU,QAAe,KAAK;AACrD,QAAI,MAAM,QAAQ,KAAK,UAAU;AAAG,gBAAU,aAAa,KAAK;AAEhE,SAAK,YAAY;AAGjB,SAAK,iBAAiB,KAAK,UAAU,mBAAK,KAAM;AAEhD,WAAO;AAAA,EACT;AAEA,MAAM,iBAAiB;AAAA,IACrB,OAAS,CAAC;AAAA,IACV,OAAS;AAAA,IACT,SAAS;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOT,KAAK,UAAU,CAAC,GAAG;AACjB,WAAK,QAAU,mBAAK;AACpB,WAAK,QAAU,QAAQ,QAAQ,KAAK;AACpC,WAAK,UAAU,CAAC,KAAK;AAErB,MAAAD,GAAE,oBAAoB,EAAE;AAAA,QACtB,qBAAY,UAAU,KAAK,KAAK;AAAA,MAClC;AAAA,IACF;AAAA;AAAA;AAAA;AAAA,IAKA,UAAU;AACR,aAAO,mBAAK,KAAK;AAAA,IACnB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,kBAAkB;AAChB,YAAM,IAAI,CAAC;AAGX,UAAI,KAAK,MAAM,IAAI;AACjB,UAAE,KAAK,KAAK,MAAM;AAAA,MACpB;AAGA,QAAE,OAAcA,GAAE,UAAU,EAAE,IAAI;AAClC,QAAE,cAAcA,GAAE,iBAAiB,EAAE,IAAI;AACzC,QAAE,MAAcA,GAAE,SAAS,EAAE,IAAI;AACjC,QAAE,SAAcA,GAAE,YAAY,EAAE,IAAI;AACpC,QAAE,QAAcA,GAAE,WAAW,EAAE,IAAI;AACnC,QAAE,QAAcA,GAAE,WAAW,EAAE,IAAI;AACnC,QAAE,QAAcA,GAAE,WAAW,EAAE,IAAI;AACnC,QAAE,QAAcA,GAAE,WAAW,EAAE,IAAI;AACnC,QAAE,cAAcA,GAAE,iBAAiB,EAAE,IAAI;AACzC,QAAE,YAAcA,GAAE,eAAe,EAAE,IAAI;AAGvC,YAAM,aAAaA,GAAE,aAAa,EAAE,IAAI,KAAK;AAC7C,YAAM,YAAaA,GAAE,YAAY,EAAE,IAAI,KAAM;AAC7C,QAAE,aAAa;AACf,QAAE,YAAa;AACf,QAAE,UAAa;AACf,QAAE,SAAa;AAGf,sBAAc,OAAO,QAAQ,SAAO;AAClC,UAAE,GAAG,IAAIA,GAAE,OAAO,GAAG,EAAE,EAAE,IAAI;AAAA,MAC/B,CAAC;AAID,YAAM,cAAc,mBAAM,KAAK,MAAM,cAAc,CAAC;AACpD,MAAAA,GAAE,mBAAmB,EAAE,KAAK,CAAC,GAAG,OAAO;AACrC,cAAM,UAAUA,GAAE,EAAE,EAAE,KAAK,UAAU;AACrC,cAAM,MAAU,SAASA,GAAE,EAAE,EAAE,IAAI,GAAG,EAAE,KAAK;AAC7C,oBAAY,OAAO,IAAI;AAAA,MACzB,CAAC;AACD,QAAE,aAAa;AAGf,QAAE,aAAa;AAAA,QACbA,GAAE,mBAAmB,EAAE,IAAI,KAAK;AAAA,QAChCA,GAAE,mBAAmB,EAAE,IAAI,KAAK;AAAA,QAChCA,GAAE,mBAAmB,EAAE,IAAI,KAAK;AAAA,MAClC;AAGA,UAAI,MAAM,QAAQ,OAAO,cAAc;AAAG,UAAE,aAAa,OAAO;AAEhE,aAAO;AAAA,IACT;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IASA,KAAK,cAAc,OAAO;AACxB,YAAM,MAAM,KAAK,gBAAgB;AACjC,cAAQ,IAAI,kCAA6B,GAAG;AAE5C,YAAM,EAAE,IAAI,IAAIC,SAAQ;AACxB,UAAI,CAAC,KAAK;AACR,gBAAQ,MAAM,gDAAgD;AAC9D,cAAM,8BAA8B;AACpC,eAAOD,GAAE,SAAS,EAAE,OAAO,QAAQ,EAAE,QAAQ;AAAA,MAC/C;AAEA,YAAM,OAAO,aAAa,GAAG;AAE7B,aAAOA,GAAE,KAAK,KAAK,IAAI,EACpB,KAAK,SAAO;AArOnB;AAsOQ,YAAI;AAAE,gBAAO,OAAO,QAAQ,WAAY,KAAK,MAAM,GAAG,IAAI;AAAA,QAAK,SAAS,GAAG;AAAA,QAAC;AAC5E,YAAI,CAAC,OAAO,IAAI,YAAY,MAAM;AAChC,kBAAQ,MAAM,iCAAiC,GAAG;AAClD,gBAAM,oBAAmB,2BAAK,SAAQ,mBAAmB;AACzD;AAAA,QACF;AAGA,aAAI,SAAI,SAAJ,mBAAU,IAAI;AAChB,eAAK,QAAQ,iCAAK,KAAK,QAAV,EAAiB,IAAI,IAAI,KAAK,GAAG;AAAA,QAChD;AACA,aAAK,QAAU;AACf,aAAK,UAAU;AAEf,2BAAU,UAAU;AACpB,YAAI,aAAa;AACf,6BAAU,aAAa;AAAA,QACzB,OAAO;AACL,gBAAM,iBAAiB;AAAA,QACzB;AAGA,iBAAS,cAAc,IAAI,YAAY,sBAAyB,EAAE,QAAQ,EAAE,MAAI,SAAI,SAAJ,mBAAU,OAAM,IAAI,MAAM,MAAM,QAAQ,IAAI,EAAE,CAAC,CAAC;AAChI,iBAAS,cAAc,IAAI,YAAY,yBAAyB,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC;AAAA,MACjF,CAAC,EACA,KAAK,CAAC,KAAK,QAAQE,SAAQ;AAC1B,gBAAQ,MAAM,gCAAgC,QAAQA,MAAK,2BAAK,YAAY;AAC5E,cAAM,6CAAwC;AAAA,MAChD,CAAC;AAAA,IACL;AAAA;AAAA;AAAA;AAAA,IAKA,iBAAiB;AACf,YAAM,EAAE,KAAK,MAAM,IAAID,SAAQ;AAC/B,aAAOD,GAAE,KAAK;AAAA,QACZ;AAAA,QACA,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ,QAAU;AAAA,UACV,UAAU;AAAA,QACZ;AAAA,MACF,CAAC;AAAA,IACH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,eAAe,IAAI;AACjB,YAAM,EAAE,KAAK,MAAM,IAAIC,SAAQ;AAC/B,cAAQ,IAAI,qDAAqD,EAAE;AACnE,aAAOD,GAAE,KAAK;AAAA,QACZ;AAAA,QACA,QAAQ;AAAA,QACR,MAAM;AAAA,UACJ,QAAU;AAAA,UACV;AAAA,UACA,UAAU;AAAA,QACZ;AAAA,MACF,CAAC;AAAA,IACH;AAAA,EACF;AAEA,MAAO,sBAAQ;;;ACjSf,MAAMG,KAAI,OAAO;AACjB,MAAI,SAAS;AAGb,WAAS,wBAAwB,MAAM,CAAC,GAAG;AACzC,UAAM,MAAM,mBAAK;AAGjB,QAAI,cACF,IAAI,eACJ,IAAI,gBACJ,IAAI,mBACJ,IAAI,QACJ,IAAI,SACJ;AAGF,QAAI,IAAI,aAAe;AAAM,UAAI,YAAc,OAAO,IAAI,SAAS;AACnE,QAAI,IAAI,aAAe;AAAM,UAAI,YAAc,OAAO,IAAI,SAAS;AACnE,QAAI,IAAI,eAAe;AAAM,UAAI,cAAc,OAAO,IAAI,WAAW;AAGrE,KAAC,aAAa,aAAa,WAAW,EAAE,QAAQ,OAAK;AACnD,UAAI,IAAI,CAAC,KAAK;AAAM,YAAI,CAAC,IAAI,OAAO,IAAI,CAAC,CAAC;AAAA,IAC5C,CAAC;AAGD,KAAC,cAAc,cAAc,YAAY,EAAE,QAAQ,OAAK;AACtD,UAAI,IAAI,CAAC,KAAK;AAAM,YAAI,CAAC,IAAI,SAAS,IAAI,CAAC,GAAG,EAAE,KAAK;AAAA,IACvD,CAAC;AAED,WAAO;AAAA,EACT;AAEA,WAAS,eAAe,KAAK,QAAQ,CAAC,GAAG;AACvC,QAAI,CAAC,OAAO,CAAC,IAAI;AAAQ;AACzB,QAAI,MAAM;AACV,UAAM,QAAQ,SAAO;AACnB,UAAI,CAAC;AAAK;AACV,UAAI,OAAO,OAAO,GAAG,OAAO;AAAA,IAC9B,CAAC;AAAA,EACH;AAEA,WAAS,iBAAiB,UAAU,CAAC,GAAG;AAEtC,UAAM,QAAQ,CAAC,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ,MAAM,EAC1D,IAAI,OAAM,KAAK,OAAO,KAAK,OAAO,CAAC,CAAE,EACrC,OAAO,OAAO;AAEjB,WAAO,MAAM,IAAI,CAAC,MAAM,MAAM;AAC5B,YAAM,IAAI,QAAQ,YAAY,IAAE,CAAC,EAAE;AACnC,YAAM,OAAO,SAAS,GAAG,EAAE,KAAK;AAChC,aAAO,OAAO,IAAI,GAAG,IAAI,SAAM,IAAI,KAAK;AAAA,IAC1C,CAAC;AAAA,EACH;AAEe,WAAR,oBAAqC;AAC1C,QAAI;AAAQ;AACZ,aAAS;AAET,IAAAA,GAAE,QAAQ,EACP,IAAI,aAAa,aAAa,EAC9B,GAAG,aAAa,eAAe,OAAK;AACnC,YAAM,MAAO,EAAE,iBAAiB,EAAE,cAAc,SAAU;AAC1D,cAAQ,IAAI,2CAAsC,GAAG;AAErD,UAAI,CAAC,KAAK;AACR,oBAAW,iBAAiB;AAC5B,uBAAeA,GAAE,qBAAqB,GAAG,CAAC,CAAC;AAC3C,QAAAA,GAAE,QAAQ,EAAE,QAAQ,sBAAsB,CAAC,EAAE,IAAI,IAAI,SAAS,KAAK,CAAC,CAAC;AACrE;AAAA,MACF;AAEA,kBAAW,aAAa,GAAG,EAAE,KAAK,gBAAc;AAC9C,cAAM,UAAU,wBAAwB,cAAc,CAAC,CAAC;AACxD,oBAAW,iBAAiB;AAG5B,cAAM,YAAY,iBAAiB,OAAO;AAC1C,uBAAeA,GAAE,qBAAqB,GAAG,SAAS;AAElD,QAAAA,GAAE,QAAQ,EAAE,QAAQ,sBAAsB,CAAC,EAAE,IAAI,OAAO,GAAG,GAAG,QAAQ,CAAC,CAAC;AAAA,MAC1E,CAAC;AAAA,IACH,CAAC;AAAA,EACL;;;ACrFA,MAAM,eAAe;AAAA,IACnB,OAAO;AAAA;AAAA;AAAA;AAAA,IAKP,OAAO;AACL,UAAI,KAAK;AAAO;AAChB,WAAK,QAAQ;AAGb,wBAAkB;AAGlB,YAAM,MAAM,SAAS,cAAc,aAAa;AAChD,UAAI,KAAK;AACP,oBAAW,eAAe,GAAG;AAAA,MAC/B;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,QAAQ,OAAO,CAAC,GAAG;AACjB,YAAM,MAAM,SAAS,cAAc,aAAa;AAChD,UAAI,CAAC;AAAK;AAEV,YAAM,QAAQ,CAAC,CAAC,KAAK,SAAU,IAAI,QAAQ,UAAU;AACrD,aAAO,YAAW,eAAe,KAAK,EAAE,MAAM,CAAC;AAAA,IACjD;AAAA,EACF;AAEA,MAAO,kBAAQ;;;ACjCf,MAAMC,KAAI,OAAO;AACjB,MAAIC,UAAS;AAEb,WAAS,uBAAuB,MAAM,CAAC,GAAG;AACxC,UAAM,MAAM,mBAAK;AAGjB,QAAI,aACF,IAAI,cACJ,IAAI,eACJ,IAAI,kBACJ,IAAI,QACJ,IAAI,SACJ;AAGF,QAAI,IAAI,aAAe;AAAM,UAAI,YAAc,OAAO,IAAI,SAAS;AACnE,QAAI,IAAI,aAAe;AAAM,UAAI,YAAc,OAAO,IAAI,SAAS;AACnE,QAAI,IAAI,eAAe;AAAM,UAAI,cAAc,OAAO,IAAI,WAAW;AAGrE,KAAC,aAAa,aAAa,WAAW,EAAE,QAAQ,OAAK;AACnD,UAAI,IAAI,CAAC,KAAK;AAAM,YAAI,CAAC,IAAI,OAAO,IAAI,CAAC,CAAC;AAAA,IAC5C,CAAC;AAGD,KAAC,cAAc,cAAc,YAAY,EAAE,QAAQ,OAAK;AACtD,UAAI,IAAI,CAAC,KAAK;AAAM,YAAI,CAAC,IAAI,SAAS,IAAI,CAAC,GAAG,EAAE,KAAK;AAAA,IACvD,CAAC;AAED,WAAO;AAAA,EACT;AAEA,WAASC,gBAAe,KAAK,QAAQ,CAAC,GAAG;AACvC,QAAI,CAAC,OAAO,CAAC,IAAI;AAAQ;AACzB,QAAI,MAAM;AACV,UAAM,QAAQ,SAAO;AACnB,UAAI,CAAC;AAAK;AACV,UAAI,OAAO,OAAO,GAAG,OAAO;AAAA,IAC9B,CAAC;AAAA,EACH;AAEA,WAASC,kBAAiB,UAAU,CAAC,GAAG;AAEtC,UAAM,QAAQ,CAAC,QAAQ,QAAQ,QAAQ,QAAQ,QAAQ,MAAM,EAC1D,IAAI,OAAM,KAAK,OAAO,KAAK,OAAO,CAAC,CAAE,EACrC,OAAO,OAAO;AAEjB,WAAO,MAAM,IAAI,CAAC,MAAM,MAAM;AAC5B,YAAM,IAAI,QAAQ,YAAY,IAAE,CAAC,EAAE;AACnC,YAAM,OAAO,SAAS,GAAG,EAAE,KAAK;AAChC,aAAO,OAAO,IAAI,GAAG,IAAI,SAAM,IAAI,KAAK;AAAA,IAC1C,CAAC;AAAA,EACH;AAEe,WAAR,mBAAoC;AACzC,QAAIF;AAAQ;AACZ,IAAAA,UAAS;AAET,IAAAD,GAAE,QAAQ,EACP,IAAI,aAAa,YAAY,EAC7B,GAAG,aAAa,cAAc,OAAK;AAClC,YAAM,MAAO,EAAE,iBAAiB,EAAE,cAAc,SAAU;AAC1D,cAAQ,IAAI,yCAAoC,GAAG;AAGnD,UAAI,CAAC,KAAK;AACR,QAAAI,aAAU,iBAAiB;AAC3B,QAAAF,gBAAeF,GAAE,eAAe,GAAG,CAAC,CAAC;AACrC,QAAAA,GAAE,QAAQ,EAAE,QAAQ,qBAAqB,CAAC,EAAE,IAAI,IAAI,SAAS,KAAK,CAAC,CAAC;AACpE;AAAA,MACF;AAGA,MAAAI,aAAU,aAAa,GAAG,EAAE,KAAK,gBAAc;AAC7C,cAAM,UAAU,uBAAuB,cAAc,CAAC,CAAC;AACvD,QAAAA,aAAU,iBAAiB;AAG3B,cAAM,MAAMJ,GAAE,eAAe;AAC7B,cAAM,cAAcG,kBAAiB,OAAO;AAE5C,YAAI,YAAY,QAAQ;AACtB,UAAAD,gBAAe,KAAK,WAAW;AAC/B,UAAAF,GAAE,QAAQ,EAAE,QAAQ,qBAAqB,CAAC,EAAE,IAAI,OAAO,GAAG,GAAG,QAAQ,CAAC,CAAC;AAAA,QACzE,OAAO;AACL,UAAAI,aAAU,WAAW,GAAG,EAAE,KAAK,WAAS;AACtC,kBAAM,YAAY,CAAC,EAChB,OAAO,SAAS,CAAC,CAAC,EAClB,IAAI,OAAM,KAAK,OAAO,MAAM,WAAa,EAAE,QAAQ,EAAE,SAAS,EAAE,gBAAgB,KAAM,OAAO,CAAC,CAAC,EAC/F,OAAO,OAAO;AACjB,YAAAF,gBAAe,KAAK,SAAS;AAC7B,YAAAF,GAAE,QAAQ,EAAE,QAAQ,qBAAqB,CAAC,EAAE,IAAI,OAAO,GAAG,GAAG,QAAQ,CAAC,CAAC;AAAA,UACzE,CAAC;AAAA,QACH;AAAA,MACF,CAAC;AAAA,IACH,CAAC;AAAA,EACL;;;AClGA,MAAM,cAAc;AAAA,IAClB,OAAO;AAAA;AAAA;AAAA;AAAA,IAKP,OAAO;AAZT;AAaI,UAAI,KAAK;AAAO;AAChB,WAAK,QAAQ;AAGb,uBAAiB;AAGjB,YAAM,MAAM,SAAS,cAAc,YAAY;AAC/C,UAAI,KAAK;AACP,oBAAAK,aAAU,eAAe,GAAG,GAAE,UAA9B,4BAAsC,MAAM;AAAA,QAAC;AAAA,MAC/C;AAAA,IACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAOA,QAAQ,OAAO,CAAC,GAAG;AA/BrB;AAgCI,YAAM,MAAM,SAAS,cAAc,YAAY;AAC/C,UAAI,CAAC;AAAK;AAEV,YAAM,QAAQ,CAAC,CAAC,KAAK,SAAU,IAAI,QAAQ,UAAU;AACrD,cAAO,WAAAA,aAAU,eAAe,KAAK,EAAE,MAAM,CAAC,GAAE,UAAzC,4BAAiD,MAAM;AAAA,MAAC;AAAA,IACjE;AAAA,EACF;AAEA,MAAO,iBAAQ;;;AChCf,MAAMC,KAAI,OAAO;AAEjB,MAAI,UAAU;AAEd,MAAM,YAAY;AAAA,IAChB,SAAS,CAAC,0BAA0B,6BAA6B,mBAAmB;AAAA,IACpF,QAAS,CAAC,yBAA0B,4BAA6B,kBAAkB;AAAA,EACrF;AAEA,WAAS,MAAM,cAAc,OAAO,UAAU;AAC5C,aAAS,IAAI,GAAG,IAAI,aAAa,QAAQ,KAAK;AAC5C,YAAM,KAAK,KAAK,cAAc,aAAa,CAAC,CAAC;AAC7C,UAAI;AAAI,eAAO;AAAA,IACjB;AACA,WAAO;AAAA,EACT;AAEA,WAAS,eAAe,YAAY,KAAM;AACxC,WAAO,IAAI,QAAQ,aAAW;AAC5B,YAAM,QAAQ,KAAK,IAAI;AACvB,OAAC,SAAS,OAAO;AACf,cAAM,YAAY,MAAM,UAAU,OAAO;AACzC,cAAM,WAAY,MAAM,UAAU,MAAM;AACxC,YAAI,aAAa;AAAU,iBAAO,QAAQ,EAAE,WAAW,SAAS,CAAC;AACjE,YAAI,KAAK,IAAI,IAAI,QAAQ;AAAW,iBAAO,QAAQ,EAAE,WAAW,SAAS,CAAC;AAC1E,mBAAW,MAAM,EAAE;AAAA,MACrB,GAAG;AAAA,IACL,CAAC;AAAA,EACH;AAEA,WAAe,uBAAkC;AAAA,+CAAb,SAAS,CAAC,GAAG;AAtCjD;AAwCE,sBAAa,KAAK;AAClB,qBAAY,KAAK;AAGjB,YAAM,EAAE,WAAW,SAAS,IAAI,MAAM,eAAe;AAGrD,UAAI,aAAa,UAAU,QAAQ,UAAU;AAAG,wBAAa,QAAQ;AACrE,UAAI,YAAa,SAAS,QAAQ,UAAW;AAAG,uBAAY,QAAQ;AAGpE,UAAI,WAAW;AACb,cAAM,QAAO,kBAAO,YAAP,YAAkB,OAAO,eAAzB,YAAuC;AACpD,YAAI,MAAM;AACR,UAAAA,GAAE,SAAS,EAAE,IAAI,OAAO,IAAI,CAAC;AAC7B,cAAIA,GAAE,SAAS,EAAE,IAAI,MAAM,OAAO,IAAI,GAAG;AAEvC,kBAAM,SAAS,CAAC,GAAG,UAAU,OAAO,EAAE,KAAK,OAAK,EAAE,gBAAgB,OAAO,IAAI,CAAC;AAC9E,gBAAI;AAAQ,cAAAA,GAAE,SAAS,EAAE,IAAI,OAAO,KAAK;AAAA,UAC3C;AACA,UAAAA,GAAE,SAAS,EAAE,QAAQ,QAAQ;AAAA,QAC/B;AAAA,MACF;AAEA,UAAI,UAAU;AACZ,cAAM,QAAO,kBAAO,WAAP,YAAiB,OAAO,cAAxB,YAAqC;AAClD,YAAI,MAAM;AACR,UAAAA,GAAE,QAAQ,EAAE,IAAI,OAAO,IAAI,CAAC;AAC5B,cAAIA,GAAE,QAAQ,EAAE,IAAI,MAAM,OAAO,IAAI,GAAG;AACtC,kBAAM,SAAS,CAAC,GAAG,SAAS,OAAO,EAAE,KAAK,OAAK,EAAE,gBAAgB,OAAO,IAAI,CAAC;AAC7E,gBAAI;AAAQ,cAAAA,GAAE,QAAQ,EAAE,IAAI,OAAO,KAAK;AAAA,UAC1C;AACA,UAAAA,GAAE,QAAQ,EAAE,QAAQ,QAAQ;AAAA,QAC9B;AAAA,MACF;AAAA,IACF;AAAA;AAEA,WAAS,YAAY,EAAE,QAAQ,OAAO,UAAU,CAAC,EAAE,IAAI,CAAC,GAAG;AA7E3D;AA8EE,YAAQ,IAAI,6BAA6B,EAAE,OAAO,QAAQ,CAAC;AAE3D,cAAU;AACV,IAAAA,GAAE,2CAA2C,EAAE,KAAK,EAAE,IAAI,WAAW,MAAM;AAE3E,QAAI;AAAE,6DAAgB,SAAhB,4BAAuB,iCAAK,UAAL,EAAc,MAAM;AAAA,IAAI,SAAS,GAAG;AAC/D,cAAQ,MAAM,yCAAyC,CAAC;AAAA,IAC1D;AAEA,IAAAA,GAAE,8BAA8B,EAC7B,YAAY,WAAW,EACvB,SAAS,YAAY,EACrB,IAAI,WAAW,OAAO;AAEzB,QAAI;AAAO,MAAAA,GAAE,8CAA8C,EAAE,QAAQ,OAAO;AAG5E,yBAAqB,OAAO,EAAE,KAAK,MAAM;AACvC,eAAS,cAAc,IAAI,YAAY,qBAAqB,EAAE,QAAQ,EAAE,OAAO,QAAQ,EAAE,CAAC,CAAC;AAAA,IAC7F,CAAC;AAAA,EACH;AAEA,WAAS,eAAe;AACtB,IAAAA,GAAE,sBAAsB,EAAE,KAAK,EAAE,IAAI,WAAW,MAAM;AACtD,IAAAA,GAAE,qBAAqB,EAAE,YAAY,YAAY,EAAE,SAAS,WAAW,EAAE,KAAK,EAAE,IAAI,WAAW,MAAM;AACrG,IAAAA,GAAE,8BAA8B,EAC7B,YAAY,YAAY,EACxB,SAAS,WAAW,EACpB,QAAQ,KAAK,MAAM;AAClB,MAAAA,GAAE,oBAAoB,EAAE,MAAM;AAC9B,eAAS,cAAc,IAAI,YAAY,mBAAmB,CAAC;AAAA,IAC7D,CAAC;AACH,cAAU;AAAA,EACZ;AAEA,WAAS,YAAa;AAAE,cAAU;AAAA,EAAO;AACzC,WAAS,YAAa;AAAE,cAAU;AAAA,EAAO;AACzC,WAAS,aAAa;AAAE,WAAO;AAAA,EAAU;AAEzC,WAAS,cAAc;AACrB,QAAI,CAACA,GAAE,sBAAsB,EAAE;AAAQ,MAAAA,GAAE,sCAAsC,EAAE,SAAS,MAAM;AAChG,UAAM,KAAKA,GAAE,sBAAsB;AAAG,UAAM,KAAKA,GAAE,qBAAqB;AACxE,QAAI,CAAC,GAAG,OAAO,EAAE,GAAG,MAAM;AAAG,SAAG,SAAS,MAAM;AAC/C,OAAG,KAAK,EAAE,IAAI,WAAW,OAAO;AAChC,OAAG,YAAY,WAAW,EAAE,SAAS,YAAY,EAAE,KAAK,EAAE,IAAI,WAAW,OAAO;AAAA,EAClF;AAEA,WAAS,cAAc;AACrB,IAAAA,GAAE,sBAAsB,EAAE,KAAK,EAAE,IAAI,WAAW,MAAM;AACtD,IAAAA,GAAE,qBAAqB,EAAE,YAAY,YAAY,EAAE,SAAS,WAAW,EAAE,KAAK,EAAE,IAAI,WAAW,MAAM;AAAA,EACvG;AAGA,WAAS,iBAAiB,uBAAuB,CAAC,OAAO;AACvD,UAAM,UAAS,yBAAI,WAAU,CAAC;AAC9B,YAAQ,IAAI,+DAA0D,MAAM;AAC5E,yBAAqB,MAAM;AAAA,EAC7B,CAAC;AAED,MAAO,qBAAQ;AAAA,IACb,MAAM;AAAA,IACN;AAAA,IACA,OAAO;AAAA,IACP;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACF;;;AC/IA,MAAMC,KAAI,OAAO;AACjB,MAAI,QAAQ;AAEZ,MAAO,iBAAQ;AAAA,IACb,OAAO;AACL,UAAI;AAAO;AACX,cAAQ;AAGR,MAAAA,GAAE,WAAU;AACV,wBAAc,WAAW;AAAA,MAC3B,CAAC;AAGD,MAAAA,GAAE,QAAQ,EACP,IAAI,UAAU,kBAAkB,EAChC,GAAG,UAAU,oBAAoB,MAAM;AACtC,wBAAc,WAAW;AAAA,MAC3B,CAAC;AAAA,IACL;AAAA,EACF;;;ACnBA,MAAO,iBAAQ;AAAA,IACb,OAAO;AAEL,sBAAc,WAAW;AAGzB,qBAAa,KAAK;AAAA,IACpB;AAAA;AAAA,IAGA,eAAe,gBAAc,cAAc,KAAK,eAAa;AAAA,EAC/D;;;ACEA,MAAMC,MAAI,OAAO;AAEjB,MAAMC,OAAO,IAAI,MAAO,OAAO,iBAAiB,QAAQ,IAAI,iBAAiB,GAAG,CAAC,IAAI;AACrF,MAAMC,QAAO,IAAI,MAAM,QAAQ,KAAK,iBAAiB,GAAG,CAAC;AACzD,MAAM,MAAO,IAAI,MAAM,QAAQ,MAAM,iBAAiB,GAAG,CAAC;AAE1D,MAAM,eAAe;AAAA,IACnB;AAAA,IAAI;AAAA,IAAM;AAAA,IAAQ;AAAA,IAAO;AAAA,IAAO;AAAA,IAChC;AAAA,IAAQ;AAAA,IAAQ;AAAA,IAAO;AAAA,IAAM;AAAA,IAC7B;AAAA,IAAS;AAAA,IAAW;AAAA,IAAW;AAAA,IAC/B;AAAA,IAAU;AAAA,IAAY;AAAA,IAAW;AAAA,EACnC;AAGA,MAAM,2BAA2B,CAAC,OAAO,KAAK;AAE9C,WAASC,WAAU;AAlCnB;AAmCE,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,UAAM,MACJ,IAAI,YACJ,OAAO,aACP,oBAAS,SAAT,mBAAe,YAAf,mBAAwB,YACxB;AAGF,UAAM,YAAa,OAAO,aAAa,OAAO,UAAU,oBACpD,OAAO,UAAU,oBACjB;AAEJ,UAAM,UAAU,IAAI,SAAS,IAAI,YAAY,IAAI,eAAe,OAAO,YAAY;AACnF,WAAO,EAAE,KAAK,OAAQ,aAAa,QAAS;AAAA,EAC9C;AAEA,WAAS,eAAe,KAAK;AAC3B,QAAI;AAAE,aAAQ,OAAO,QAAQ,WAAY,KAAK,MAAM,GAAG,IAAI;AAAA,IAAK,SACzD,GAAG;AAAE,aAAO;AAAA,IAAK;AAAA,EAC1B;AAEA,WAAS,aAAa,GAAG;AACvB,QAAI,MAAM;AAAM,aAAO;AACvB,QAAI,MAAM;AAAO,aAAO;AACxB,QAAI,KAAK;AAAM,aAAO;AACtB,UAAM,IAAI,OAAO,CAAC,EAAE,KAAK,EAAE,YAAY;AACvC,WAAQ,MAAM,OAAO,MAAM,UAAU,MAAM,SAAS,MAAM,OAAO,MAAM;AAAA,EACzE;AAEA,WAAS,SAAS,KAAK;AACrB,QAAI,OAAO;AAAM,aAAO,CAAC;AACzB,QAAI,MAAM,QAAQ,GAAG;AAAG,aAAO,IAAI,QAAQ,QAAQ;AACnD,UAAM,IAAI,OAAO,GAAG,EAAE,KAAK;AAC3B,QAAI,CAAC;AAAG,aAAO,CAAC;AAEhB,WAAO,EAAE,MAAM,SAAS,EACrB,IAAI,OAAK,EAAE,KAAK,CAAC,EACjB,OAAO,OAAO,EAEd,IAAI,OAAM,OAAO,SAAS,GAAG,EAAE,CAAC,MAAM,QAAQ,KAAK,OAAO,SAAS,GAAG,EAAE,CAAC,CAAE,EAC3E,OAAO,OAAO;AAAA,EACnB;AAEA,WAAS,gBAAgB,SAAS;AAChC,UAAM,MAAM,CAAC;AACb,iBAAa,QAAQ,SAAO;AAC1B,YAAM,MAAM,MAAM,qBAAqB,GAAG,KAAK;AAC/C,UAAI,CAAC,OAAO,UAAU,eAAe,KAAK,SAAS,GAAG;AAAG;AACzD,UAAI,KAAK,GAAG,SAAS,QAAQ,GAAG,CAAC,CAAC;AAAA,IACpC,CAAC;AAED,WAAO,MAAM,KAAK,IAAI,IAAI,GAAG,CAAC;AAAA,EAChC;AAEA,WAAS,sBAAsB,GAAG;AAzFlC;AA0FE,QAAI,CAAC,KAAK,OAAO,MAAM;AAAU,aAAO;AAExC,UAAM,SACJ,+BAAE,OAAF,YAAQ,EAAE,UAAV,YAAmB,EAAE,YAArB,YAAgC,EAAE,eAAlC,YAAgD,EAAE,gBAAlD,YAAiE;AAEnE,QAAI,SAAS,QAAQ,OAAO,KAAK,MAAM;AAAI,aAAO;AAElD,UAAM,eACJ,yBAAE,sBAAF,YAAuB,EAAE,aAAzB,YAAqC,EAAE,mBAAvC,YAAyD,EAAE,gBAA3D,YAA0E;AAE5E,UAAM,KAAK,OAAO,KAAK;AAEvB,WAAO,iCACF,IADE;AAAA,MAEL;AAAA,MACA,mBAAmB,SAAS,aAAa,EAAE,KAAK;AAAA,MAChD,OAAO,EAAE,QAAQ,EAAE,iBAAiB,EAAE,SAAS,IAAI,SAAS,KAAK,SAAS,EAAE;AAAA,MAC5E,iBAAiB,cAAa,aAAE,oBAAF,YAAqB,EAAE,6BAAvB,YAAmD,CAAC;AAAA,MAClF,UAAU,gBAAgB,CAAC;AAAA,IAC7B;AAAA,EACF;AAEA,WAAS,MAAM,MAAM;AACnB,WAAO,CAAC,EAAE,QAAQ,SAAS,SAAS,IAAI;AAAA,EAC1C;AAEA,MAAM,cAAc;AAAA,IAClB,SAAS;AAAA,IACT,UAAU;AAAA,IAEV,OAAO;AAAA;AAAA,IACP,OAAO;AAAA;AAAA,IACP,UAAU,CAAC;AAAA,IAEX,WAAW,CAAC;AAAA;AAAA,IACZ,kBAAkB;AAAA,IAClB,gBAAgB;AAAA,IAChB,aAAa;AAAA,IACb,aAAa;AAAA,IAEb,aAAa;AAAA,IACb,aAAa;AAAA,IACb,gBAAgB;AAAA;AAAA,IAEhB,eAAe;AAAA,IAEf,OAAO;AACL,UAAI,KAAK;AAAS;AAClB,WAAK,UAAU;AAEf,aAAO,oBAAoB;AAE3B,UAAI;AAAE,sBAAM,KAAK;AAAA,MAAG,SAAS,GAAG;AAAA,MAAC;AAEjC,WAAK,eAAe;AAGpB,eAAS,iBAAiB,qBAAqB,MAAM;AACnD,aAAK,eAAe;AACpB,aAAK,QAAQ,EAAE,OAAO,MAAM,CAAC;AAAA,MAC/B,CAAC;AAGD,UAAIH,KAAG;AACL,QAAAA,IAAE,QAAQ,EACP,IAAI,gFAAgF,EACpF,GAAG,kFAAkF,MAAM;AAE1F,eAAK,qBAAqB;AAAA,QAC5B,CAAC;AAAA,MACL;AACA,eAAS,iBAAiB,wBAAwB,MAAM,KAAK,qBAAqB,CAAC;AAEnF,UAAI,SAAS,eAAe,WAAW;AACrC,iBAAS,iBAAiB,oBAAoB,MAAM,KAAK,eAAe,CAAC;AAAA,MAC3E;AAAA,IACF;AAAA,IAEA,cAAc;AACZ,WAAK,WAAW;AAChB,WAAK,QAAQ;AACb,WAAK,QAAQ;AACb,WAAK,WAAW,CAAC;AAAA,IACnB;AAAA,IAEA,iBAAiB;AACf,UAAI,KAAK,aAAa,CAAC,MAAM,KAAK,KAAK,KAAK,CAAC,MAAM,KAAK,KAAK,IAAI;AAC/D,QAAAE,MAAK,uCAAuC;AAC5C,aAAK,YAAY;AAAA,MACnB;AACA,UAAI,KAAK;AAAU,eAAO;AAE1B,YAAM,KAAK,KAAK,UAAU;AAC1B,UAAI;AAAI,eAAO;AAEf,UAAI,KAAK;AAAa,eAAO;AAE7B,WAAK,cAAc;AACnB,WAAK,cAAc,YAAY,MAAM;AACnC,aAAK;AACL,YAAI,KAAK,UAAU,GAAG;AACpB,wBAAc,KAAK,WAAW;AAC9B,eAAK,cAAc;AACnB,eAAK,QAAQ,EAAE,OAAO,MAAM,CAAC;AAC7B;AAAA,QACF;AACA,YAAI,KAAK,eAAe,KAAK,gBAAgB;AAC3C,wBAAc,KAAK,WAAW;AAC9B,eAAK,cAAc;AAAA,QACrB;AAAA,MACF,GAAG,GAAG;AAEN,aAAO;AAAA,IACT;AAAA,IAEA,YAAY;AACV,UAAI,OAAO,SAAS,cAAc,kBAAkB;AAEpD,UAAI,CAAC,MAAM;AACT,cAAM,YAAY,SAAS,cAAc,oBAAoB;AAC7D,YAAI,CAAC;AAAW,iBAAO;AAEvB,YAAI,UAAU,SAAS,eAAe,eAAe;AACrD,YAAI,CAAC,SAAS;AACZ,oBAAU,SAAS,cAAc,SAAS;AAC1C,kBAAQ,KAAK;AACb,kBAAQ,YAAY;AACpB,oBAAU,YAAY,OAAO;AAAA,QAC/B;AACA,eAAO;AAAA,MACT;AAEA,UAAI,CAAC;AAAM,eAAO;AAElB,UAAI,MAAM,KAAK,cAAc,cAAc;AAC3C,UAAI,CAAC,KAAK;AACR,cAAM,SAAS,cAAc,KAAK;AAClC,YAAI,YAAY;AAChB,aAAK,YAAY,GAAG;AAAA,MACtB;AAEA,UAAI,MAAM,UAAU;AACpB,UAAI,MAAM,WAAW;AACrB,UAAI,MAAM,MAAM;AAChB,UAAI,MAAM,YAAY;AACtB,UAAI,MAAM,QAAQ;AAClB,UAAI,MAAM,WAAW;AACrB,UAAI,MAAM,YAAY;AACtB,UAAI,MAAM,aAAa;AAEvB,YAAM,eAAe,CAAC,SAAS;AAC7B,cAAM,KAAK,kBAAkB,IAAI;AACjC,YAAI,MAAM,IAAI,cAAc,IAAI,EAAE,EAAE;AACpC,YAAI,CAAC,KAAK;AACR,gBAAM,SAAS,cAAc,QAAQ;AACrC,cAAI,KAAK;AACT,cAAI,YAAY;AAChB,cAAI,aAAa,aAAa,OAAO,IAAI,CAAC;AAC1C,cAAI,YAAY,GAAG;AAAA,QACrB;AAEA,YAAI,MAAM,OAAO;AACjB,YAAI,MAAM,WAAW;AACrB,YAAI,MAAM,WAAW;AACrB,YAAI,MAAM,QAAQ;AAClB,YAAI,MAAM,YAAY;AAEtB,eAAO;AAAA,MACT;AAEA,YAAM,KAAK,aAAa,CAAC;AACzB,YAAM,KAAK,aAAa,CAAC;AACzB,YAAM,KAAK,aAAa,CAAC;AAEzB,WAAK,QAAQ;AACb,WAAK,QAAQ;AACb,WAAK,WAAW,CAAC,IAAI,IAAI,EAAE;AAG3B,WAAK,SAAS,QAAQ,SAAO;AAC3B,YAAIF,KAAG;AACL,UAAAA,IAAE,GAAG,EAAE,IAAI,eAAe,EAAE,GAAG,iBAAiB,MAAM,KAAK,gBAAgB,GAAG,CAAC;AAAA,QACjF,OAAO;AACL,cAAI,WAAW,MAAM,KAAK,gBAAgB,GAAG;AAAA,QAC/C;AAAA,MACF,CAAC;AAED,WAAK,WAAW;AAChB,WAAK,kBAAkB;AACvB,aAAO;AAAA,IACT;AAAA,IAEA,oBAAoB;AAClB,UAAI,CAAC,KAAK;AAAU;AACpB,YAAM,eAAe;AAAA,QACnB;AAAA,QACA;AAAA,QACA;AAAA,MACF;AACA,WAAK,SAAS,QAAQ,CAAC,KAAK,QAAQ;AAClC,YAAI,YAAY;AAChB,YAAI,YAAY,IAAI,OAAO,aAAa,GAAG,GAAG,EAAE,CAAC;AAAA,MACnD,CAAC;AAAA,IACH;AAAA,IAEA,kBAAkB;AAChB,UAAI,MAAM;AAEV,UAAI;AACF,YAAI,uBAAkB,oBAAe,OAAO;AAC1C,gBAAM,oBAAe,MAAM,cAAc,oBAAe,MAAM,aAAa;AAAA,QAC7E;AAAA,MACF,SAAS,GAAG;AAAA,MAAC;AAEb,UAAI,CAAC,MAAM,QAAQ,GAAG,GAAG;AACvB,YAAI;AAAE,cAAI,MAAM,QAAQ,cAAM,QAAQ;AAAG,kBAAM,cAAM;AAAA,QAAU,SAAS,GAAG;AAAA,QAAC;AAAA,MAC9E;AACA,UAAI,CAAC,MAAM,QAAQ,GAAG;AAAG,cAAM,KAAK,SAAS,IAAI,OAAK,EAAE,SAAS,EAAE;AAEnE,YAAM,OAAO,MAAM,QAAQ,GAAG,IAAI,MAAM,CAAC,GACtC,MAAM,GAAG,CAAC,EACV,IAAI,OAAM,IAAI,OAAO,CAAC,IAAI,EAAG;AAChC,aAAO,IAAI,SAAS;AAAG,YAAI,KAAK,EAAE;AAClC,aAAO;AAAA,IACT;AAAA,IAEA,iBAAiB,QAAQ;AACvB,YAAM,cAAc,MAAM,QAAQ,MAAM,IAAI,SAAS,CAAC,GACnD,MAAM,GAAG,CAAC,EACV,IAAI,OAAM,IAAI,OAAO,CAAC,IAAI,EAAG;AAChC,aAAO,WAAW,SAAS;AAAG,mBAAW,KAAK,EAAE;AAEhD,UAAI;AACF,YAAI,uBAAkB,oBAAe,OAAO;AAC1C,8BAAe,MAAM,aAAa,WAAW,MAAM;AACnD,8BAAe,MAAM,YAAa,WAAW,MAAM;AAAA,QACrD;AAAA,MACF,SAAS,GAAG;AAAA,MAAC;AAEb,UAAI;AAAE,sBAAM,YAAY,UAAU;AAAA,MAAG,SAAS,GAAG;AAAA,MAAC;AAElD,UAAI,KAAK;AAAe;AAExB,eAAS,cAAc,IAAI,YAAY,wBAAwB;AAAA,QAC7D,QAAQ,EAAE,YAAY,WAAW;AAAA,MACnC,CAAC,CAAC;AACF,UAAIA;AAAG,QAAAA,IAAE,QAAQ,EAAE,QAAQ,wBAAwB,CAAC,EAAE,YAAY,WAAW,CAAC,CAAC;AAAA,IACjF;AAAA,IAEA,gBAAgB,KAAK;AACnB,YAAM,OAAO,SAAS,IAAI,aAAa,WAAW,KAAK,KAAK,EAAE;AAC9D,YAAM,MAAM,KAAK,gBAAgB;AACjC,UAAI,IAAI,IAAI,IAAI,SAAS;AAGzB,WAAK,iBAAiB,GAAG;AACzB,WAAK,qBAAqB;AAAA,IAC5B;AAAA,IAEA,mBAAmB,YAAY;AA7VjC;AA8VI,YAAM,MAAM,oBAAI,IAAI;AAGpB,+BAAyB,QAAQ,QAAM,IAAI,IAAI,OAAO,EAAE,CAAC,CAAC;AAG1D,OAAC,cAAc,CAAC,GAAG,QAAQ,QAAM;AAAE,YAAI;AAAI,cAAI,IAAI,OAAO,EAAE,CAAC;AAAA,MAAG,CAAC;AAGjE,YAAM,OAAK,wCAAY,mBAAkB;AACzC,UAAI,IAAI;AACN,SAAC,aAAa,aAAa,WAAW,EAAE,QAAQ,OAAK;AACnD,cAAI,GAAG,CAAC,KAAK,QAAQ,OAAO,GAAG,CAAC,CAAC;AAAG,gBAAI,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC;AAAA,QAC3D,CAAC;AAAA,MACH;AAGA,YAAM,OAAK,KAAAI,iBAAA,mBAAW,mBAAkB;AACxC,UAAI,IAAI;AACN,SAAC,aAAa,aAAa,WAAW,EAAE,QAAQ,OAAK;AACnD,cAAI,GAAG,CAAC,KAAK,QAAQ,OAAO,GAAG,CAAC,CAAC;AAAG,gBAAI,IAAI,OAAO,GAAG,CAAC,CAAC,CAAC;AAAA,QAC3D,CAAC;AAAA,MACH;AAEA,aAAO;AAAA,IACT;AAAA,IAEA,gBAAgB,GAAG,aAAa;AAC9B,YAAM,MAAM,MAAM,QAAQ,EAAE,QAAQ,IAAI,EAAE,WAAW,CAAC;AACtD,UAAI,CAAC,IAAI;AAAQ,eAAO;AAExB,aAAO,IAAI,MAAM,QAAM,YAAY,IAAI,OAAO,EAAE,CAAC,CAAC;AAAA,IACpD;AAAA,IAEA,gBAAgB,MAAM,YAAY,aAAa;AAC7C,YAAM,MAAM,WAAW,IAAI,KAAK;AAChC,YAAM,gBAAgB,IAAI;AAAA,QACxB,WAAW,IAAI,CAAC,IAAI,MAAO,MAAM,OAAO,KAAM,MAAM,EAAI,EAAE,OAAO,OAAO;AAAA,MAC1E;AAEA,cAAQ,KAAK,aAAa,CAAC,GACxB,OAAO,OAAK;AACX,YAAI,CAAC,KAAK,CAAC,EAAE;AAAI,iBAAO;AACxB,YAAI,CAAC,KAAK,gBAAgB,GAAG,WAAW;AAAG,iBAAO;AAGlD,YAAI,CAAC,EAAE,mBAAmB,cAAc,IAAI,OAAO,EAAE,EAAE,CAAC,KAAK,OAAO,EAAE,EAAE,MAAM,OAAO,GAAG,GAAG;AACzF,iBAAO;AAAA,QACT;AACA,eAAO;AAAA,MACT,CAAC,EACA,IAAI,QAAM,EAAE,IAAI,OAAO,EAAE,EAAE,GAAG,MAAM,OAAO,EAAE,QAAQ,SAAS,EAAE,EAAE,EAAE,EAAE,EAAE;AAAA,IAC7E;AAAA,IAEA,uBAAuB;AACrB,UAAI,CAAC,KAAK;AAAU;AACpB,UAAI,CAAC,MAAM,QAAQ,KAAK,SAAS,KAAK,CAAC,KAAK,UAAU,QAAQ;AAC5D,aAAK,kBAAkB;AACvB;AAAA,MACF;AAEA,YAAM,eAAe;AAAA,QACnB;AAAA,QACA;AAAA,QACA;AAAA,MACF;AAGA,UAAI,aAAa,KAAK,gBAAgB,EAAE,MAAM;AAC9C,UAAI,UAAU;AAEd,eAAS,OAAO,GAAG,OAAO,GAAG,QAAQ;AACnC,kBAAU;AACV,cAAM,WAAW,KAAK,mBAAmB,UAAU;AAEnD,iBAAS,OAAO,GAAG,OAAO,KAAK,SAAS,QAAQ,QAAQ;AACtD,gBAAM,OAAO,KAAK,gBAAgB,MAAM,YAAY,QAAQ;AAC5D,gBAAM,MAAO,WAAW,IAAI,KAAK;AACjC,gBAAM,aAAa,CAAC,OAAO,KAAK,KAAK,OAAK,EAAE,OAAO,OAAO,GAAG,CAAC;AAE9D,cAAI,OAAO,CAAC,YAAY;AACtB,YAAAH,KAAI,8BAA8B,EAAE,MAAM,IAAI,CAAC;AAC/C,uBAAW,IAAI,IAAI;AACnB,sBAAU;AAAA,UACZ;AAAA,QACF;AAEA,YAAI,CAAC;AAAS;AAAA,MAChB;AAGA,YAAM,SAAS,KAAK,gBAAgB,EAAE,MAAM;AAC5C,UAAI,WAAW,KAAK,GAAG,MAAM,OAAO,KAAK,GAAG,GAAG;AAC7C,aAAK,gBAAgB;AACrB,aAAK,iBAAiB,UAAU;AAChC,aAAK,gBAAgB;AAAA,MACvB;AAEA,YAAM,gBAAgB,KAAK,mBAAmB,UAAU;AAExD,YAAM,aAAa,CAAC,KAAK,SAAS,aAAa,UAAU;AACvD,YAAI,YAAY;AAChB,YAAI,YAAY,IAAI,OAAO,aAAa,EAAE,CAAC;AAE3C,gBAAQ,QAAQ,SAAO,IAAI,YAAY,IAAI,OAAO,IAAI,MAAM,IAAI,EAAE,CAAC,CAAC;AAEpE,YAAI,SAAS,QAAQ,KAAK,OAAK,EAAE,OAAO,OAAO,KAAK,CAAC,GAAG;AACtD,cAAI,QAAQ,OAAO,KAAK;AAAA,QAC1B,OAAO;AACL,cAAI,QAAQ;AAAA,QACd;AAAA,MACF;AAEA,WAAK,SAAS,QAAQ,CAAC,KAAK,QAAQ;AAClC,cAAM,UAAU,KAAK,gBAAgB,KAAK,YAAY,aAAa;AACnE,mBAAW,KAAK,SAAS,aAAa,GAAG,GAAG,WAAW,GAAG,CAAC;AAAA,MAC7D,CAAC;AAGD,YAAM,SAAS,KAAK,SAAS,IAAI,OAAK,EAAE,SAAS,EAAE;AACnD,UAAI,OAAO,KAAK,GAAG,MAAM,WAAW,KAAK,GAAG,GAAG;AAC7C,aAAK,gBAAgB;AACrB,aAAK,iBAAiB,MAAM;AAC5B,aAAK,gBAAgB;AAAA,MACvB;AAAA,IACF;AAAA,IAEA,QAAQ,EAAE,QAAQ,MAAM,IAAI,CAAC,GAAG;AAC9B,WAAK,eAAe;AACpB,UAAI,CAAC,KAAK;AAAU;AAEpB,YAAM,MAAM,KAAK,IAAI;AACrB,UAAI,CAAC,SAAU,MAAM,KAAK,iBAAkB;AAAM;AAClD,UAAI,KAAK;AAAkB;AAC3B,WAAK,mBAAmB;AAExB,YAAM,EAAE,KAAK,MAAM,IAAIE,SAAQ;AAC/B,YAAM,UAAU,EAAE,QAAQ,oBAAoB;AAC9C,UAAI,OAAO;AACT,gBAAQ,WAAW;AACnB,gBAAQ,QAAQ;AAChB,gBAAQ,cAAc;AAAA,MACxB;AAEA,YAAM,SAAS,CAAC,QAAQ;AACtB,aAAK,mBAAmB;AACxB,aAAK,iBAAiB,KAAK,IAAI;AAE/B,cAAM,OAAO,eAAe,GAAG;AAE/B,YAAI,CAAC,QAAQ,KAAK,YAAY,QAAQ,CAAC,MAAM,QAAQ,KAAK,IAAI,GAAG;AAC/D,UAAAD,MAAK,wBAAwB,IAAI;AACjC,eAAK,kBAAkB;AACvB,eAAK,YAAY;AACjB;AAAA,QACF;AAEA,cAAM,WAAW,KAAK,KACnB,IAAI,qBAAqB,EACzB,OAAO,OAAO;AAGjB,aAAK,YAAY;AAGjB,YAAI;AAAE,wBAAM,QAAQ,QAAQ;AAAA,QAAG,SAAS,GAAG;AAAA,QAAC;AAE5C,aAAK,cAAc;AACnB,aAAK,qBAAqB;AAAA,MAC5B;AAEA,YAAM,SAAS,CAAC,QAAQ,WAAW,iBAAiB;AAClD,aAAK,mBAAmB;AACxB,aAAK,iBAAiB,KAAK,IAAI;AAC/B,YAAI,eAAe,QAAQ,WAAW,gBAAgB,EAAE;AACxD,aAAK,kBAAkB;AACvB,aAAK,YAAY;AAAA,MACnB;AAEA,UAAIF,OAAKA,IAAE,MAAM;AACf,QAAAA,IAAE,KAAK,KAAK,OAAO,EAChB,KAAK,MAAM,EACX,KAAK,CAAC,KAAK,QAAQ,MAAM,OAAO,QAAQ,GAAG,2BAAK,YAAY,CAAC;AAAA,MAClE,OAAO;AACL,cAAM,OAAO,IAAI,gBAAgB,OAAO,EAAE,SAAS;AACnD,cAAM,KAAK;AAAA,UACT,QAAQ;AAAA,UACR,SAAS,EAAE,gBAAgB,mDAAmD;AAAA,UAC9E;AAAA,UACA,aAAa;AAAA,QACf,CAAC,EACE,KAAK,OAAK,EAAE,KAAK,EAAE,KAAK,QAAM,EAAE,QAAQ,EAAE,QAAQ,MAAM,EAAE,EAAE,CAAC,EAC7D,KAAK,CAAC,EAAE,QAAQ,KAAK,MAAM;AAC1B,cAAI,IAAI;AACR,cAAI;AAAE,gBAAI,KAAK,MAAM,IAAI;AAAA,UAAG,SAAS,GAAG;AAAA,UAAC;AACzC,cAAI,UAAU,OAAO,SAAS;AAAK,mBAAO,CAAC;AAAA;AACtC,mBAAO,QAAQ,cAAc,IAAI;AAAA,QACxC,CAAC,EACA,MAAM,OAAK,OAAO,gBAAe,uBAAG,YAAW,OAAO,CAAC,GAAG,EAAE,CAAC;AAAA,MAClE;AAAA,IACF;AAAA,IAEA,cAAc;AACZ,UAAI,CAAC,KAAK;AAAU;AACpB,UAAI,KAAK,eAAe,KAAK;AAAa;AAE1C,WAAK;AACL,YAAM,QAAQ,MAAM,KAAK;AACzB,iBAAW,MAAM;AACf,YAAI,CAAC,KAAK,aAAa,CAAC,KAAK,UAAU,QAAQ;AAC7C,eAAK,QAAQ,EAAE,OAAO,KAAK,CAAC;AAAA,QAC9B;AAAA,MACF,GAAG,KAAK;AAAA,IACV;AAAA,EACF;AAGA,SAAO,iBAAiB;AAExB,MAAO,uBAAQ;;;ACjjBR,WAAS,OAAO;AACrB,QAAI;AAAE,oBAAM,KAAK;AAAA,IAAG,SAAS,GAAG;AAAA,IAAC;AACjC,QAAI;AAAE,2BAAY,KAAK;AAAA,IAAG,SAAS,GAAG;AAAA,IAAC;AAAA,EACzC;AAEO,WAAS,QAAQ,OAAO,CAAC,GAAG;AACjC,QAAI;AAAE,2BAAY,QAAQ,IAAI;AAAA,IAAG,SAAS,GAAG;AAAA,IAAC;AAAA,EAChD;AAEO,WAAS,cAAc;AAC5B,WAAQ,MAAM,QAAQ,cAAM,QAAQ,IAAI,cAAM,WAAW,CAAC;AAAA,EAC5D;AAEA,MAAM,WAAW,EAAE,MAAM,SAAS,YAAY;AAC9C,MAAO,gBAAQ;;;ACjBf,MAAMK,MAAI,OAAO;AAGjB,MAAM,WAAW;AAAA,IACf,GAAG;AAAA,IACH,GAAG;AAAA,IACH,GAAG;AAAA,EACL;AAKA,WAAS,UAAU,KAAK,MAAM;AAC5B,eAAW,KAAK,MAAM;AACpB,UAAI,OAAO,OAAO,UAAU,eAAe,KAAK,KAAK,CAAC,KAAK,IAAI,CAAC,KAAK,QAAQ,IAAI,CAAC,MAAM,IAAI;AAC1F,eAAO,IAAI,CAAC;AAAA,MACd;AAAA,IACF;AACA,WAAO;AAAA,EACT;AAQA,WAAS,2BAA2B,OAAO;AACzC,UAAM,QAAQ,OAAM,KAAK,OAAO,KAAK,OAAO,CAAC;AAE7C,QAAI,MAAM,QAAQ,KAAK,GAAG;AACxB,YAAM,MAAM,MACT,IAAI,OAAE;AArCb;AAqCiB,sBAAO,MAAM,YAAa,mBAAE,OAAF,YAAQ,EAAE,aAAV,YAAsB,EAAE,UAAxB,YAAiC,OAAQ;AAAA,OAAC,EAC9E,OAAO,OAAK,KAAK,IAAI,EACrB,MAAM,GAAG,CAAC,EACV,IAAI,KAAK;AACZ,aAAO,IAAI,SAAS;AAAG,YAAI,KAAK,EAAE;AAClC,aAAO;AAAA,IACT;AAEA,QAAI,SAAS,OAAO,UAAU,UAAU;AACtC,UAAI,MAAM,UAAU;AAAc,eAAO,2BAA2B,MAAM,MAAM;AAChF,UAAI,MAAM,iBAAiB;AAAO,eAAO,2BAA2B,MAAM,aAAa;AACvF,UAAI,MAAM,kBAAkB;AAAM,eAAO,2BAA2B,MAAM,cAAc;AACxF,UAAI,MAAM,QAAQ;AAAgB,eAAO,2BAA2B,MAAM,IAAI;AAE9E,YAAM,MAAM,UAAU,OAAO;AAAA,QAC3B;AAAA,QAAa;AAAA,QAAU;AAAA,QAAc;AAAA,QAAgB;AAAA,QAAkB;AAAA,MACzE,CAAC;AACD,YAAM,MAAM,UAAU,OAAO;AAAA,QAC3B;AAAA,QAAa;AAAA,QAAU;AAAA,QAAc;AAAA,QAAgB;AAAA,QAAkB;AAAA,MACzE,CAAC;AACD,YAAM,MAAM,UAAU,OAAO;AAAA,QAC3B;AAAA,QAAe;AAAA,QAAU;AAAA,QAAc;AAAA,QAAkB;AAAA,QAAkB;AAAA,MAC7E,CAAC;AACD,aAAO,CAAC,MAAM,GAAG,GAAG,MAAM,GAAG,GAAG,MAAM,GAAG,CAAC;AAAA,IAC5C;AAEA,WAAO,CAAC,IAAI,IAAI,EAAE;AAAA,EACpB;AAGA,WAAS,cAAc,IAAI;AACzB,YACE,yBAAI,iBACJ,yBAAI,kBACJ,yBAAI,SACJ;AAAA,EAEJ;AAEA,WAAS,aAAa,IAAI;AACxB,YACE,yBAAI,gBACJ,yBAAI,iBACJ,yBAAI,SACJ;AAAA,EAEJ;AAEA,MAAO,iBAAQ;AAAA,IACb,SAAS;AACP,YAAM,OAAU,oBAAe,QAAQ;AACvC,YAAM,SAAU,KAAK,cAAc,OAAO,kBAAkB,CAAC;AAC7D,YAAM,UAAU,YAAW,kBAAkB,CAAC;AAC9C,YAAM,SAAUC,aAAU,kBAAmB,CAAC;AAG9C,WAAK,aAAa,KAAK,cAAc,CAAC;AACtC,YAAM,YAAY;AAClB,YAAM,YAAY,OAAO,OAAO,KAAK,UAAU,EAC5C,OAAO,CAAC,KAAK,MAAM,OAAO,SAAS,GAAG,EAAE,KAAK,IAAI,CAAC;AACrD,YAAM,cAAc,KAAK,IAAI,GAAG,YAAY,SAAS;AAGrD,MAAAD,IAAE,kBAAkB,EAAE,OAAO;AAC7B,MAAAA,IAAE,eAAe,EAAE,OAAO;AAAA;AAAA,mCAEK,WAAW;AAAA;AAAA,KAEzC;AAGD,YAAM,SAASA,IAAE,SAAS;AAC1B,MAAAA,IAAE,MAAM,EACL,OAAO,gBAAgB,EACvB,OAAO,OAAO,cAAc,OAAO,KAAK,EAAE,OAAO,EACjD,OAAO,OAAO,aAAa,MAAM,KAAK,EAAE,OAAO,EAC/C,OAAO,gBAAgB,EACvB,OAAO,oBAAoB,EAC3B,SAAS,MAAM;AAGlB,YAAM,WAAW,2BAA2B,OAAO,EAAE,IAAI,MAAM;AAC/D,YAAM,WAAW,2BAA2B,MAAM,EAAE,IAAI,MAAM;AAE9D,YAAM,SAASA,IAAE,SAAS;AAE1B,aAAO,QAAQ,WAAS;AACtB,cAAM,KAAO,OAAO,MAAM,EAAE;AAC5B,cAAM,OAAO,MAAM;AAGnB,cAAM,QAAQ,SAAS,SAAS,EAAE,IAAI,OAAO;AAC7C,cAAM,QAAQ,SAAS,SAAS,EAAE,IAAI,OAAO;AAG7C,cAAM,UAAU,SAAS,KAAK,WAAW,EAAE,GAAG,EAAE,KAAK;AACrD,YAAI,cAAc;AAClB,SAAC,GAAG,GAAG,CAAC,EAAE,QAAQ,OAAK;AAErB,gBAAM,WAAY,aAAa,aAAa,UAAU,IAAK,cAAc;AACzE,gBAAM,SAAW,WAAW,IAAI,YAAY;AAC5C,yBAAe;AAAA;AAAA,iCAEU,MAAM;AAAA,2BACZ,EAAE;AAAA,uBACN,CAAC;AAAA,YACZ,QAAQ;AAAA;AAAA,QAEd,CAAC;AAED,cAAM,UAAc,UAAU,SAAS,OAAO,IAAI;AAClD,cAAM,cAAc,WAAW;AAG/B,cAAM,WAAW,CAAC,OAAO,OAAO,OAAO,EAAE,OAAO,OAAO;AACvD,cAAM,UAAW,SAAS,SAAS,SAAS,KAAK,KAAK,IAAI;AAE1D,cAAM,OAAOA,IAAE,MAAM,EAClB,OAAO,OAAO,IAAI,OAAO,EACzB,OAAO,OAAO,SAAS,QAAG,OAAO,EACjC,OAAO,OAAO,SAAS,QAAG,OAAO,EACjC,OAAO;AAAA,gDACgC,WAAW;AAAA,gDACX,WAAW;AAAA,uBACpC,EACd,OAAO,OAAO,OAAO,OAAO;AAE/B,eAAO,OAAO,IAAI;AAAA,MACpB,CAAC;AAGD,MAAAA,IAAE,eAAe,EACd,MAAM,EACN,OAAO,MAAM,EACb,OAAO,MAAM;AAAA,IAClB;AAAA,EACF;;;ACxKA,MAAME,MAAI,OAAO;AAEjB,MAAOC,kBAAQ;AAAA,IACb,OAAO;AAEL,MAAAD,IAAE,QAAQ,EACP,IAAI,SAAS,sCAAsC,EACnD,GAAG,gBAAgB,wCAAwC,MAAM;AAChE,uBAAa,OAAO;AAAA,MACtB,CAAC;AAGH,MAAAA,IAAE,QAAQ,EACP,IAAI,SAAS,iBAAiB,EAC9B,GAAG,SAAS,mBAAmB,WAAW;AACzC,cAAM,UAAU,OAAOA,IAAE,IAAI,EAAE,KAAK,UAAU,CAAC;AAC/C,cAAM,OAAU,SAASA,IAAE,IAAI,EAAE,KAAK,MAAM,GAAG,EAAE;AACjD,cAAM,OAAU,oBAAe,QAAQ;AAEvC,aAAK,aAAa,KAAK,cAAc,CAAC;AACtC,aAAK,WAAW,OAAO,IAAI;AAG3B,uBAAa,OAAO;AAAA,MACtB,CAAC;AAAA,IACL;AAAA,EACF;;;ACzBA,MAAO,iBAAQ;AAAA,IACb,OAAO;AAEL,cAAQ,IAAI,4CAAuC,oBAAe,KAAK;AAGvE,UAAI,CAAC,MAAM,QAAQ,oBAAe,MAAM,UAAU,GAAG;AACnD,4BAAe,MAAM,aAAa,OAAO,kBAAkB,CAAC;AAAA,MAC9D;AAGA,UAAI,OAAO,oBAAe,MAAM,eAAe,UAAU;AACvD,4BAAe,MAAM,aAAa,CAAC;AAAA,MACrC;AAGA,MAAAE,gBAAa,KAAK;AAGlB,qBAAa,OAAO;AAAA,IACtB;AAAA,EACF;;;ACtBO,WAASC,YAAW,KAAK;AAC9B,QAAI,OAAO,QAAQ;AAAU,aAAO;AACpC,UAAM,UAAU,IAAI,QAAQ,UAAU,GAAG;AACzC,WAAO,QAAQ,OAAO,CAAC,EAAE,YAAY,IAAI,QAAQ,MAAM,CAAC;AAAA,EAC1D;;;ACDA,MAAMC,MAAI,OAAO;AACjB,MAAMC,UAAW,gBAAc;AAC/B,MAAMC,YAAW,EAAE,GAAG,MAAM,GAAG,MAAM,GAAG,KAAK;AAE7C,MAAM,aAAa;AAAA;AAAA;AAAA;AAAA,IAIjB,OAAO;AACL,YAAM,OAAO,oBAAe,QAAQ;AACpC,cAAQ,IAAI,2CAAsC,IAAI;AAGtD,WAAK,cAAc,IAAI;AAGvB,WAAK,iBAAiB;AAAA,IACxB;AAAA;AAAA;AAAA;AAAA,IAKA,cAAc,OAAO,CAAC,GAAG;AACvB,YAAM,SAASF,IAAE,mBAAmB,EAAE,MAAM;AAG5C,YAAM,OAAS,KAAK,QAAU;AAC9B,YAAM,MAAS,KAAK,OAAU;AAC9B,YAAM,SAAS,KAAK,UAAU;AAC9B,YAAM,QAAS,KAAK,SAAU;AAG9B,YAAM,QAAQ,CAAC,GAAG,GAAG,CAAC,EACnB,IAAI,OAAK,KAAK,OAAO,CAAC,EAAE,KAAK,QAAG,EAChC,OAAO,OAAK,MAAM,QAAG,EACrB,KAAK,IAAI,KACP;AAGL,YAAM,cAAc,KAAK,eAAe;AACxC,YAAM,YAAc,KAAK,aAAe;AAGxC,YAAM,UAAU,YAAW,kBAAkB,CAAC;AAC9C,YAAM,SAAUG,aAAU,kBAAmB,CAAC;AAG9C,YAAM,SAAS,OAAO,kBAAkB,CAAC;AACzC,YAAM,QAAS,KAAK,cAAe,CAAC;AACpC,YAAM,SAAS,KAAK,UAAe,CAAC;AAGpC,UAAI,OAAO;AAAA;AAAA,cAED,IAAI;AAAA,mCACiB,GAAG;AAAA,sCACA,MAAM;AAAA,qCACP,KAAK;AAAA;AAAA;AAAA;AAAA,qCAIL,KAAK;AAAA;AAAA;AAAA;AAAA,2CAIC,WAAW;AAAA;AAAA;AAAA;AAAA,yCAIb,SAAS;AAAA;AAAA;AAAA;AAAA,uBAI3B,QAAQ,eAAe,QAAG;AAAA;AAAA;AAG7C,OAAC,UAAS,UAAS,QAAQ,EAAE,QAAQ,CAAC,GAAG,QAAQ;AAC/C,cAAM,OAAO,QAAQ,QAAQ,MAAI,CAAC,EAAE;AACpC,cAAM,OAAO,QAAQ,YAAY,MAAI,CAAC,EAAE,KAAK;AAC7C,YAAI,MAAM;AACR,kBAAQ,oBAAoB,MAAI,CAAC,cAAc,IAAI,SAAM,IAAI;AAAA,QAC/D;AAAA,MACF,CAAC;AACD,cAAQ;AAER,cAAQ;AAAA;AAAA,sBAEU,OAAO,cAAc,QAAG;AAAA;AAAA;AAG1C,OAAC,UAAS,UAAS,QAAQ,EAAE,QAAQ,CAAC,GAAG,QAAQ;AAC/C,cAAM,OAAO,OAAO,QAAQ,MAAI,CAAC,EAAE;AACnC,cAAM,OAAO,OAAO,YAAY,MAAI,CAAC,EAAE,KAAK;AAC5C,YAAI,MAAM;AACR,kBAAQ,oBAAoB,MAAI,CAAC,cAAc,IAAI,SAAM,IAAI;AAAA,QAC/D;AAAA,MACF,CAAC;AACD,cAAQ;AAER,cAAQ;AAAA;AAAA;AAAA;AAAA;AAKR,MAAAF,QAAO,QAAQ,SAAO;AACpB,YAAI,QAAQ,IAAI,QAAQ,WAAW,EAAE;AACrC,YAAI,UAAU;AAAW,kBAAQ;AAAA,iBACxB,UAAU;AAAU,kBAAQ;AAAA;AAChC,kBAAcG,YAAW,KAAK;AAEnC,cAAM,OAAQ,KAAK,GAAG,KAAK;AAC3B,cAAM,QAAQ,gBAAc,cAAc,GAAG;AAC7C,cAAM,UAAU,QAAQ,GAAG,IAAI,WAAM,KAAK,KAAK;AAE/C,gBAAQ,eAAe,KAAK,cAAc,OAAO;AAAA,MACnD,CAAC;AACD,cAAQ;AAER,cAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOR,YAAM,QAAQ,CAAC,QAAQ,WAAW,QAAQ,WAAW,QAAQ,WAAW,EAAE,IAAI,MAAM;AACpF,YAAM,QAAQ,CAAC,OAAO,WAAY,OAAO,WAAY,OAAO,WAAW,EAAE,IAAI,MAAM;AAEnF,aAAO,QAAQ,WAAS;AACtB,cAAM,KAAK,OAAO,MAAM,EAAE;AAC1B,cAAM,KAAK,MAAM,SAAS,EAAE,IAAI,OAAO;AACvC,cAAM,KAAK,MAAM,SAAS,EAAE,IAAI,OAAO;AACvC,cAAM,KAAKF,UAAS,MAAM,EAAE,CAAC,KAAK;AAClC,cAAM,OAAO,CAAC,IAAI,IAAI,EAAE,EAAE,OAAO,OAAO,EAAE,KAAK,KAAK,KAAK;AACzD,gBAAQ,WAAW,MAAM,IAAI,YAAY,IAAI;AAAA,MAC/C,CAAC;AACD,cAAQ;AAAA;AAAA;AAAA;AAAA;AAMR,UAAI,OAAO,QAAQ;AACjB,gBAAQ;AAAA;AAAA;AAAA;AAAA;AAKR,eAAO,QAAQ,UAAQ;AACrB,kBAAQ,eAAqBE,YAAW,KAAK,GAAG,CAAC,cAAc,KAAK,KAAK;AAAA,QAC3E,CAAC;AACD,gBAAQ;AAAA,MACV;AAGA,aAAO,KAAK,IAAI;AAAA,IAClB;AAAA;AAAA;AAAA;AAAA,IAKA,mBAAmB;AACjB,MAAAJ,IAAE,QAAQ,EACP,IAAI,SAAS,gBAAgB,EAC7B,GAAG,SAAS,kBAAkB,OAAK;AAClC,UAAE,eAAe;AACjB,gBAAQ,IAAI,oCAAoC;AAGhD,cAAM,YAAY,SACf,eAAe,kBAAkB,EACjC;AAGH,cAAM,WAAW,MAAM;AAAA,UACrB,SAAS,iBAAiB,wBAAwB;AAAA,QACpD,EACC,IAAI,UAAQ,KAAK,SAAS,EAC1B,KAAK,IAAI;AAGV,cAAM,WAAW,OAAO,KAAK,IAAI,UAAU,sBAAsB;AACjE,iBAAS,SAAS,KAAK;AACvB,iBAAS,SAAS,MAAM;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAMhB,QAAQ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBAOR,SAAS;AAAA;AAAA;AAAA,SAGhB;AACD,iBAAS,SAAS,MAAM;AACxB,iBAAS,MAAM;AAGf,mBAAW,MAAM;AACf,mBAAS,MAAM;AACf,mBAAS,MAAM;AAAA,QACjB,GAAG,GAAG;AAAA,MACR,CAAC;AAAA,IACL;AAAA,EACF;AAEA,MAAOG,eAAQ;;;ACxNf,MAAO,kBAAQ;AAAA,IACb,OAAO;AACL,MAAAE,aAAW,KAAK;AAAA,IAClB;AAAA,EACF;;;ACDA,MAAMC,MAAI,OAAO;AAGF,WAAR,aAA8B;AACnC,UAAM,MAAMA,IAAE,8BAA8B,EAAE,KAAK,KAAK;AAExD,YAAQ,KAAK;AAAA,MACX,KAAK;AACH,uBAAU,KAAK;AACf;AAAA,MACF,KAAK;AACH,wBAAa,KAAK;AAClB,uBAAY,KAAK;AACjB,sBAAS,KAAK;AACd;AAAA,MACF,KAAK;AACH,uBAAU,KAAK;AACf;AAAA,MACF,KAAK;AACH,wBAAW,KAAK;AAChB;AAAA,IACJ;AAAA,EACF;;;ACtBA,MAAMC,MAAO,OAAO;AACpB,MAAM,MAAO,IAAI,MAAM,QAAQ,IAAI,iBAAiB,GAAG,CAAC;AACxD,MAAM,OAAO,IAAI,MAAM,QAAQ,KAAK,iBAAiB,GAAG,CAAC;AAEzD,MAAI,UAAY;AAChB,MAAI,YAAY;AAChB,MAAI,YAAY;AAGhB,WAAS,SAAS,QAAQ;AACxB,UAAM,MAAO,OAAO,aAAa,OAAO,UAAU,MAAM,IAAK,OAAO,UAAU,MAAM,IAAI;AACxF,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,WAAO,OAAO,IAAI,SAAS,IAAI,YAAY,IAAI,eAAe,OAAO,YAAY;AAAA,EACnF;AAEA,WAAS,UAAU;AAtBnB;AAuBE,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,WAAO,IAAI,YAAY,OAAO,aAAW,oBAAS,SAAT,mBAAe,YAAf,mBAAwB,YAAW;AAAA,EAC9E;AAEA,WAASC,gBAAe,KAAK;AAC3B,QAAI;AAAE,aAAQ,OAAO,QAAQ,WAAY,KAAK,MAAM,GAAG,IAAI;AAAA,IAAK,SACzD,GAAG;AAAE,aAAO;AAAA,IAAK;AAAA,EAC1B;AAEA,WAAS,eAAe,KAAK;AAC3B,QAAI,CAAC,MAAM,QAAQ,GAAG;AAAG,aAAO,CAAC;AACjC,WAAO,IAAI,IAAI,QAAM;AAlCvB;AAmCI,UAAI,MAAM,OAAO,OAAO,UAAU;AAChC,eAAO,EAAE,IAAI,QAAO,cAAG,OAAH,YAAS,GAAG,UAAZ,YAAqB,EAAE,GAAG,MAAM,QAAO,cAAG,SAAH,YAAW,GAAG,UAAd,YAAuB,EAAE,EAAE;AAAA,MACxF;AACA,aAAO,EAAE,IAAI,OAAO,EAAE,GAAG,MAAM,OAAO,EAAE,EAAE;AAAA,IAC5C,CAAC,EAAE,OAAO,QAAM,GAAG,MAAM,GAAG,IAAI;AAAA,EAClC;AAEA,WAAS,YAAY;AACnB,QAAI,CAACD;AAAG,aAAO;AACf,UAAM,OAAOA,IAAE,wBAAwB,EAAE,MAAM;AAC/C,WAAQ,QAAQ,KAAK,SAAU,OAAO;AAAA,EACxC;AAEA,WAAS,eAAe,MAAM,OAAO,EAAE,oBAAoB,KAAK,IAAI,CAAC,GAAG;AACtE,QAAI,CAAC,QAAQ,CAAC,KAAK;AAAQ;AAE3B,UAAM,QAAQ,oBAAqB,KAAK,IAAI,KAAK,KAAM;AACvD,SAAK,MAAM;AACX,SAAK,OAAO,IAAI,OAAO,oCAA0B,EAAE,CAAC;AAEpD,UAAM,aAAa,eAAe,KAAK;AACvC,eAAW,QAAQ,QAAM,KAAK,OAAO,IAAI,OAAO,GAAG,MAAM,GAAG,EAAE,CAAC,CAAC;AAEhE,QAAI,qBAAqB,SAAS,WAAW,KAAK,OAAK,EAAE,OAAO,OAAO,KAAK,CAAC,GAAG;AAC9E,WAAK,IAAI,OAAO,KAAK,CAAC;AAAA,IACxB;AAAA,EACF;AAMA,WAAS,kBAAkB;AACzB,UAAM,MAAQ,QAAQ;AACtB,UAAM,QAAQ,SAAS,oBAAoB;AAE3C,UAAM,UAAU,EAAE,QAAQ,qBAAqB;AAC/C,QAAI,OAAO;AACT,cAAQ,WAAc;AACtB,cAAQ,QAAc;AACtB,cAAQ,cAAc;AAAA,IACxB;AAGA,WAAOA,IAAE,KAAK,KAAK,OAAO,EAAE,KAAK,SAAO;AACtC,YAAM,OAAOC,gBAAe,GAAG;AAC/B,UAAI,CAAC,QAAQ,KAAK,YAAY,MAAM;AAElC,eAAOD,IAAE,SAAS,EAAE,OAAO,IAAI,EAAE,QAAQ;AAAA,MAC3C;AACA,aAAO,MAAM,QAAQ,KAAK,IAAI,IAAI,KAAK,OAAO,CAAC;AAAA,IACjD,CAAC;AAAA,EACH;AAMA,WAAS,gBAAgB,EAAE,QAAQ,OAAO,oBAAoB,MAAM,IAAI,CAAC,GAAG;AA7F5E;AA8FE,QAAI,CAACA;AAAG;AAER,UAAM,OAAO,UAAU;AACvB,QAAI,CAAC;AAAM;AAEX,UAAM,WAAW,KAAK,KAAK,QAAQ,EAAE;AACrC,QAAI,CAAC,SAAS,WAAW;AAAG;AAG5B,UAAM,YAAU,YAAO,YAAP,mBAAgB,eAAc,OAAO,gBAAgB;AACrE,QAAI,WAAW,MAAM,QAAQ,OAAO,GAAG;AACrC,UAAI,+BAA+B,QAAQ,MAAM;AACjD,qBAAe,MAAM,SAAS,EAAE,kBAAkB,CAAC;AACnD;AAAA,IACF;AAEA,QAAI;AAAW;AACf,gBAAY;AAEZ,QAAI,oCAA+B;AAEnC,oBAAgB,EACb,KAAK,WAAS;AACb,UAAI,YAAY,SAAS,CAAC,GAAG,QAAQ,SAAS;AAC9C,qBAAe,MAAM,OAAO,EAAE,kBAAkB,CAAC;AAAA,IACnD,CAAC,EACA,KAAK,CAAC,GAAG,GAAG,MAAM;AAEjB,YAAM,MACH,KAAK,EAAE,OAAQ,OAAO,EAAE,IAAI,IAC5B,KAAK,EAAE,eAAgB,OAAO,EAAE,YAAY,IAC5C,OAAO,MAAM,WAAY,IACzB,KAAK,KAAK;AACb,WAAK,gCAAgC,GAAG;AACxC,qBAAe,MAAM,CAAC,GAAG,EAAE,mBAAmB,MAAM,CAAC;AAAA,IACvD,CAAC,EACA,OAAO,MAAM;AACZ,kBAAY;AAAA,IACd,CAAC;AAAA,EACL;AAKA,WAAS,gBAAgB;AACvB,QAAI,aAAa,CAAC,OAAO;AAAkB;AAE3C,UAAM,SAAS,MAAM;AACnB,YAAM,OAAO,UAAU;AACvB,UAAI,MAAM;AACR,YAAI,uDAAkD;AACtD,wBAAgB,EAAE,OAAO,OAAO,mBAAmB,MAAM,CAAC;AAC1D,eAAO;AAAA,MACT;AACA,aAAO;AAAA,IACT;AAEA,QAAI,OAAO;AAAG;AAEd,QAAI,oDAA+C;AACnD,gBAAY,IAAI,iBAAiB,MAAM;AACrC,UAAI,OAAO,GAAG;AACZ,kBAAU,WAAW;AACrB,oBAAY;AAAA,MACd;AAAA,IACF,CAAC;AAED,cAAU,QAAQ,SAAS,MAAM,EAAE,WAAW,MAAM,SAAS,KAAK,CAAC;AAGnE,eAAW,MAAM;AACf,UAAI,WAAW;AACb,kBAAU,WAAW;AACrB,oBAAY;AACZ,YAAI,yEAAoE;AAAA,MAC1E;AAAA,IACF,GAAG,IAAK;AAAA,EACV;AAEe,WAAR,iBAAkC;AACvC,QAAI;AAAS;AACb,cAAU;AAEV,QAAI,MAAM;AAEV,QAAI,CAACA,KAAG;AACN,WAAK,sDAAsD;AAC3D;AAAA,IACF;AAGA,oBAAgB,EAAE,OAAO,OAAO,mBAAmB,MAAM,CAAC;AAC1D,kBAAc;AAGd,IAAAA,IAAE,QAAQ,EACP,IAAI,gBAAgB,kBAAkB,EACtC,GAAG,gBAAgB,oBAAoB,OAAK;AAC3C,QAAE,eAAe;AACjB,UAAI,gBAAgB;AACpB,sBAAgB,EAAE,OAAO,MAAM,mBAAmB,KAAK,CAAC;AAAA,IAC1D,CAAC;AAGH,aAAS,iBAAiB,yBAAyB,MAAM;AACvD,UAAI,8DAAyD;AAC7D,sBAAgB,EAAE,OAAO,MAAM,mBAAmB,KAAK,CAAC;AAAA,IAC1D,CAAC;AAAA,EACH;;;ACpMA,MAAME,MAAI,OAAO;AAEjB,WAASC,WAAU;AARnB;AASE,UAAM,MAAM,OAAO,WAAW,OAAO,WAAW,OAAO,UAAU,CAAC;AAClE,WAAO;AAAA,MACL,KAAO,IAAI,YAAY,OAAO,aAAW,oBAAS,SAAT,mBAAe,YAAf,mBAAwB,YAAW;AAAA,MAC5E,OAAO,IAAI,SAAS,IAAI,YAAY,OAAO,YAAY;AAAA,IACzD;AAAA,EACF;AAOA,WAASC,eAAc,MAAM,CAAC,GAAG;AArBjC;AAsBE,UAAM,WAAW,qBAAI,eAAJ,YAAkB,IAAI,YAAtB,YAAiC,IAAI,kBAArC,YAAsD;AACvE,UAAM,UAAW,qBAAI,cAAJ,YAAkB,IAAI,WAAtB,YAAiC,IAAI,iBAArC,YAAsD;AAEvE,WAAO;AAAA,MACL,IAAc,IAAI,MAAM;AAAA,MACxB,MAAc,IAAI,QAAQ;AAAA,MAC1B,aAAc,IAAI,eAAe;AAAA,MACjC,KAAc,IAAI,OAAO;AAAA,MACzB,QAAc,IAAI,UAAU;AAAA,MAC5B,OAAc,IAAI,SAAS;AAAA,MAC3B,OAAc,SAAI,SAAJ,YAAY;AAAA,MAC1B,QAAc,SAAI,UAAJ,YAAa;AAAA,MAC3B,OAAc,SAAI,SAAJ,YAAY;AAAA,MAC1B,OAAc,SAAI,SAAJ,YAAY;AAAA,MAC1B,gBAAe,SAAI,kBAAJ,YAAqB;AAAA,MACpC,eAAe,SAAI,iBAAJ,YAAoB;AAAA,MACnC;AAAA,MACA;AAAA;AAAA,MAGA,aAAa,IAAI,aAAa,KAAK,UAAU,IAAI,UAAU,IAAI;AAAA,MAC/D,YAAa,IAAI,aAAc,KAAK,UAAU,IAAI,UAAU,IAAK;AAAA,MACjE,aAAa,IAAI,aAAc,KAAK,UAAU,IAAI,UAAU,IAAK;AAAA,MACjE,aAAa,IAAI,aAAc,KAAK,UAAU,IAAI,UAAU,IAAK;AAAA,MACjE,OAAa,IAAI,QAAc,KAAK,UAAU,IAAI,KAAK,IAAU;AAAA,IACnE;AAAA,EACF;AASA,WAASC,cAAa,KAAK;AACzB,UAAM,OAAaD,eAAc,GAAG;AACpC,UAAM,EAAE,MAAM,IAAKD,SAAQ;AAG3B,UAAM,OAAO,EAAE,QAAQ,oBAAoB;AAC3C,QAAI,OAAO;AACT,WAAK,WAAc;AACnB,WAAK,QAAc;AACnB,WAAK,cAAc;AAAA,IACrB;AAGA,UAAM,OAAO,gTACR,OACC,KAAK,KAAgB,EAAE,IAAI,KAAK,GAAG,IAAI,CAAC,IACxC,KAAK,OAAgB,EAAE,MAAM,KAAK,KAAK,IAAI,CAAC,IAC5C,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,MAAgB,EAAE,KAAK,KAAK,IAAI,IAAI,CAAC,IAC1C,KAAK,SAAgB,EAAE,QAAQ,KAAK,OAAO,IAAI,CAAC,IAChD,KAAK,QAAgB,EAAE,OAAO,KAAK,MAAM,IAAI,CAAC,IAC9C,KAAK,SAAU,KAAM,EAAE,MAAM,KAAK,KAAK,IAAI,CAAC,IAC5C,KAAK,UAAU,KAAM,EAAE,OAAO,KAAK,MAAM,IAAI,CAAC,IAC9C,KAAK,SAAU,KAAM,EAAE,MAAM,KAAK,KAAK,IAAI,CAAC,IAC5C,KAAK,SAAU,KAAM,EAAE,MAAM,KAAK,KAAK,IAAI,CAAC,IAC5C,KAAK,kBAAkB,KAAK,EAAE,eAAe,KAAK,cAAc,IAAI,CAAC,IACrE,KAAK,iBAAkB,KAAK,EAAE,cAAe,KAAK,aAAa,IAAK,CAAC,IACrE,KAAK,UAAgB,EAAE,SAAS,KAAK,QAAQ,IAAI,CAAC,IAClD,KAAK,SAAgB,EAAE,QAAS,KAAK,OAAO,IAAK,CAAC,IAElD,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,aAAgB,EAAE,YAAa,KAAK,WAAW,IAAK,CAAC,IAC1D,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,cAAgB,EAAE,aAAa,KAAK,YAAY,IAAI,CAAC,IAC1D,KAAK,QAAgB,EAAE,OAAa,KAAK,MAAM,IAAU,CAAC;AAIhE,UAAM,YAAY,CAAC;AACnB,QAAI,KAAK;AAAe,gBAAU,KAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,OAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,cAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,MAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,SAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,QAAgB,KAAK;AACvD,QAAI,KAAK,SAAU;AAAK,gBAAU,OAAgB,KAAK;AACvD,QAAI,KAAK,UAAU;AAAK,gBAAU,QAAgB,KAAK;AACvD,QAAI,KAAK,SAAU;AAAK,gBAAU,OAAgB,KAAK;AACvD,QAAI,KAAK,SAAU;AAAK,gBAAU,OAAgB,KAAK;AACvD,QAAI,KAAK,kBAAkB;AAAI,gBAAU,gBAAgB,KAAK;AAC9D,QAAI,KAAK,iBAAkB;AAAI,gBAAU,eAAgB,KAAK;AAC9D,QAAI,KAAK;AAAe,gBAAU,UAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,SAAgB,KAAK;AAEvD,QAAI,KAAK;AAAe,gBAAU,cAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,aAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,cAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,cAAgB,KAAK;AACvD,QAAI,KAAK;AAAe,gBAAU,QAAgB,KAAK;AAEvD,SAAK,YAAY;AAGjB,SAAK,iBAAiB,KAAK,UAAU,mBAAK,KAAM;AAEhD,WAAO;AAAA,EACT;AAEe,WAAR,iBAAkC;AACvC,IAAAD,IAAE,QAAQ,EACP,IAAI,YAAY,iBAAiB,EACjC,GAAG,YAAY,mBAAmB,SAAS,GAAG;AAC7C,QAAE,eAAe;AAEjB,YAAM,aAAaA,IAAE,IAAI,EAAE,SAAS,qBAAqB;AACzD,YAAM,MAAa,oBAAe,gBAAgB;AAElD,cAAQ,IAAI,wCAAmC,GAAG;AAElD,YAAM,EAAE,IAAI,IAAIC,SAAQ;AACxB,UAAI,CAAC,KAAK;AACR,gBAAQ,MAAM,qCAAqC;AACnD,cAAM,8BAA8B;AACpC;AAAA,MACF;AAEA,YAAM,OAAOE,cAAa,GAAG;AAE7B,MAAAH,IAAE,KAAK,KAAK,IAAI,EACb,KAAK,SAAO;AAlJrB;AAmJU,YAAI;AAAE,gBAAO,OAAO,QAAQ,WAAY,KAAK,MAAM,GAAG,IAAI;AAAA,QAAK,SAAS,GAAG;AAAA,QAAC;AAE5E,YAAI,CAAC,OAAO,IAAI,YAAY,MAAM;AAChC,kBAAQ,MAAM,8BAA8B,GAAG;AAC/C,gBAAM,mBAAkB,2BAAK,SAAQ,mBAAmB;AACxD;AAAA,QACF;AAGA,aAAI,SAAI,SAAJ,mBAAU,IAAI;AAChB,cAAI,KAAK,IAAI,KAAK;AAClB,8BAAe,QAAQ,iCAAK,oBAAe,QAApB,EAA2B,IAAI,IAAI,KAAK,GAAG;AAAA,QACpE;AAEA,2BAAU,UAAU;AACpB,YAAI,YAAY;AACd,6BAAU,aAAa;AAAA,QACzB,OAAO;AACL,gBAAM,iBAAiB;AAAA,QACzB;AAGA,iBAAS,cAAc,IAAI,YAAY,sBAAyB,EAAE,QAAQ,EAAE,MAAI,SAAI,SAAJ,mBAAU,OAAM,IAAI,MAAM,MAAM,QAAQ,IAAI,EAAE,CAAC,CAAC;AAChI,iBAAS,cAAc,IAAI,YAAY,yBAAyB,EAAE,QAAQ,CAAC,EAAE,CAAC,CAAC;AAAA,MACjF,CAAC,EACA,KAAK,CAAC,KAAK,QAAQI,SAAQ;AAC1B,gBAAQ,MAAM,6BAA6B,QAAQA,MAAK,2BAAK,YAAY;AACzE,cAAM,oCAA+B;AAAA,MACvC,CAAC;AAAA,IACL,CAAC;AAAA,EACL;;;AC5JA,MAAMC,MAAI,OAAO;AAEjB,MAAMC,OAAM,IAAI,MAAM,QAAQ,IAAI,mBAAmB,GAAG,CAAC;AAIzD,MAAM,MAAM;AAAA,IACV,SAAS;AAAA,IACT,QAAS;AAAA,EACX;AAEA,WAAS,YAAY,UAAU;AAC7B,UAAM,OAAOC,IAAE,QAAQ;AAEvB,UAAM,YAAYA,IAAE,WAAW,EAAE,KAAK,QAAQ;AAC9C,QAAI,UAAU;AAAQ,aAAO,UAAU,MAAM;AAC7C,WAAO,KAAK,SAAS,KAAK,MAAM,IAAI;AAAA,EACtC;AAEA,WAAS,eAAe,MAAM,MAAM;AAClC,QAAI,CAAC,QAAQ,CAAC,KAAK,UAAU,CAAC;AAAM,aAAO;AAC3C,UAAM,MAAM,OAAO,IAAI;AACvB,SAAK,IAAI,GAAG;AACZ,QAAI,KAAK,IAAI,MAAM;AAAK,aAAO;AAG/B,UAAM,UAAU,KAAK,KAAK,QAAQ,EAAE,OAAO,WAAY;AACrD,aAAOA,IAAE,IAAI,EAAE,KAAK,MAAM;AAAA,IAC5B,CAAC,EAAE,MAAM;AACT,QAAI,QAAQ,QAAQ;AAClB,WAAK,IAAI,QAAQ,IAAI,CAAC;AACtB,aAAO;AAAA,IACT;AACA,WAAO;AAAA,EACT;AAEA,WAAS,oBAAoB;AAzD7B;AA0DE,QAAI;AAAE,8DAAW,YAAX,mBAAoB,2BAApB;AAAA,IAAgD,SAAS,GAAG;AAAA,IAAC;AACnE,QAAI;AAAE,uDAAU,YAAV;AAAA,IAAuB,SAAW,GAAG;AAAA,IAAC;AAC5C,QAAI;AAAE,wDAAW,YAAX;AAAA,IAAwB,SAAU,GAAG;AAAA,IAAC;AAC5C,QAAI;AAAE,yDAAY,YAAZ;AAAA,IAAyB,SAAS,GAAG;AAAA,IAAC;AAAA,EAC9C;AAOA,WAAS,cAAc,MAAM,EAAE,QAAQ,OAAO,SAAS,KAAK,IAAI,CAAC,GAAG;AAClE,UAAM,MAAW,SAAS,YAAY,YAAY;AAClD,UAAM,WAAW,SAAS,YAAY,IAAI,UAAU,IAAI;AACxD,UAAM,OAAW,YAAY,QAAQ;AAErC,QAAI,CAAC,MAAM;AAAE,MAAAC,KAAI,MAAM,IAAI,eAAe;AAAG,aAAOD,IAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ;AAAA,IAAG;AAEtF,UAAM,KAAW,KAAK,IAAI,CAAC;AAC3B,UAAM,WAAW,GAAG,QAAQ;AAG5B,QAAI;AACF,YAAM,QAAS,SAAS,YAAa,kBAAe;AACpD,UAAI,+BAAO;AAAS,cAAM,QAAQ;AAAA,eACzB,+BAAO;AAAQ,cAAM,OAAO;AAAA,IACvC,SAAS,GAAG;AAAA,IAAkB;AAE9B,UAAM,UAAU,MAAM;AAtFxB;AAwFI,UAAI,QAAQ;AACV,cAAM,QAAO,kBAAO,GAAG,MAAV,YAAe,OAAO,GAAG,GAAG,KAAK,MAAjC,YAAsC;AACnD,YAAI;AAAM,yBAAe,MAAM,IAAI;AAAA,MACrC;AAEA,UAAI,GAAG,QAAQ,SAAS,YAAa,WAAW,OAAO,GAAG,KAAK,OAAO,GAAG,GAAG,KAAK,IAAK;AACpF,aAAK,QAAQ,QAAQ;AACrB,0BAAkB;AAAA,MACpB;AAAA,IACF;AAGA,UAAM,gBAAgB,MAAM;AAC1B,UAAI,GAAG,QAAQ,SAAS,KAAK,CAAC;AAAO,eAAOA,IAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ;AAC3E,YAAM,MAAO,SAAS,YAAa,cAAaE;AAChD,UAAI,QAAO,2BAAK,oBAAmB;AAAY,eAAOF,IAAE,SAAS,EAAE,QAAQ,EAAE,QAAQ;AACrF,aAAO,IAAI,eAAe,IAAI,EAAE,OAAO,CAAC,CAAC,MAAM,CAAC;AAAA,IAClD;AAGA,WAAOA,IAAE,SAAS,SAAU,KAAK;AAC/B,iBAAW,MAAM;AACf,sBAAc,EACX,KAAK,MAAM;AAAE,kBAAQ;AAAG,cAAI,QAAQ;AAAA,QAAG,CAAC,EACxC,MAAM,MAAM,IAAI,QAAQ,CAAC;AAAA,MAC9B,GAAG,CAAC;AAAA,IACN,CAAC,EAAE,QAAQ;AAAA,EACb;AAEA,WAAS,wBAAwB,OAAO,CAAC,GAAG;AAC1C,WAAOA,IAAE;AAAA,MACP,cAAc,WAAW,IAAI;AAAA,MAC7B,cAAc,UAAW,IAAI;AAAA,IAC/B;AAAA,EACF;AAEe,WAAR,eAAgC;AA5HvC;AA6HE,IAAAC,KAAI,uBAAuB;AAG3B,QAAI;AAAE,uDAAU,SAAV;AAAA,IAAoB,SAAS,GAAG;AAAA,IAAC;AAGvC,IAAAD,IAAE,QAAQ,EACP,IAAI,sBAAsB,uDAAuD,EACjF,GAAG,sBAAsB,yDAAyD,WAAW;AAC5F,yBAAU,UAAU;AAEpB,YAAM,MAAMA,IAAE,IAAI;AAGlB,UAAI,IAAI,SAAS,aAAa,GAAG;AAC/B,cAAM,UAAU,IAAI,KAAK,UAAU;AACnC,cAAM,MAAU,SAAS,IAAI,IAAI,GAAG,EAAE,KAAK;AAC3C,4BAAe,MAAM,aAAa,oBAAe,MAAM,cAAc,CAAC;AACtE,4BAAe,MAAM,WAAW,OAAO,IAAI;AAC3C;AAAA,MACF;AAGA,YAAM,KAAM,KAAK;AACjB,UAAI,CAAC;AAAI;AACT,YAAM,MAAM,GAAG,QAAQ,QAAQ,EAAE;AACjC,0BAAe,MAAM,GAAG,IAAI,IAAI,IAAI;AAAA,IACtC,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,kBAAkB,EAClC,GAAG,YAAY,oBAAoB,OAAK;AACvC,QAAE,eAAe;AACjB,MAAAA,IAAE,kBAAkB,EAAE,YAAY,WAAW,EAAE,SAAS,SAAS;AAGjE,UAAI;AACF,cAAM,OAAOA,IAAE,wBAAwB;AACvC,cAAM,WAAW,KAAK,SAAS,KAAK,KAAK,QAAQ,EAAE,SAAS;AAC5D,YAAI,KAAK,UAAU,YAAY,GAAG;AAChC,mBAAS,cAAc,IAAI,YAAY,yBAAyB,EAAE,QAAQ,EAAE,QAAQ,cAAc,EAAE,CAAC,CAAC;AAAA,QACxG;AAAA,MACF,SAAS,GAAG;AAAA,MAAC;AAAA,IACf,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,gBAAgB,EAChC,GAAG,YAAY,kBAAkB,OAAK;AACrC,QAAE,eAAe;AAGjB,MAAAA,IAAE,kBAAkB,EAAE,YAAY,SAAS,EAAE,SAAS,WAAW;AAGjE,yBAAU,YAAY,EAAE,OAAO,MAAM,SAAS,CAAC,EAAE,CAAC;AAGlD,0BAAe,MAAM,aAAa,CAAC;AAGnC,0BAAe,MAAM,UAAU;AAC/B,0BAAe,MAAM,SAAU;AAG/B,UAAI,OAAO,qBAAqB;AAC9B,eAAO,oBAAoB,WAAW,CAAC,IAAI,IAAI,EAAE;AAAA,MAGnD;AAGA,iBAAW,MAAM;AACf,gCAAwB,EAAE,OAAO,OAAO,QAAQ,CAAC,EAAE,CAAC;AAAA,MACtD,GAAG,CAAC;AAAA,IACN,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,iBAAiB,EACjC,GAAG,YAAY,mBAAmB,OAAK;AACtC,QAAE,eAAe;AACjB,YAAM,SAASA,IAAE,wBAAwB,EAAE,IAAI;AAC/C,UAAI,CAAC,QAAQ;AACX,cAAM,oCAAoC;AAC1C;AAAA,MACF;AAEA,0BAAe,eAAe,MAAM,EACjC,KAAK,UAAQ;AACZ,gBAAQ,IAAI,mDAA4C,IAAI;AAC5D,cAAM,SAAS,OAAO,SAAS,WAAW,KAAK,MAAM,IAAI,IAAI;AAC7D,gBAAQ,IAAI,iCAA0B,iCAAQ,IAAI;AAElD,cAAM,UAAS,iCAAQ,SAAQ;AAC/B,YAAI,CAAC,UAAU,CAAC,OAAO,IAAI;AACzB,gBAAM,gCAAgC;AACtC;AAAA,QACF;AAGA,QAAAA,IAAE,kBAAkB,EAAE,YAAY,SAAS,EAAE,SAAS,WAAW;AAEjE,2BAAU,YAAY,EAAE,OAAO,OAAO,SAAS,OAAO,CAAC;AAGvD,mBAAW,MAAM;AACf,kCAAwB,EAAE,OAAO,MAAM,OAAO,CAAC;AAAA,QACjD,GAAG,CAAC;AAAA,MACN,CAAC,EACA,KAAK,CAAC,QAAQ;AACb,gBAAQ,MAAM,iBAAgB,2BAAK,iBAAgB,GAAG;AACtD,cAAM,sDAAsD;AAAA,MAC9D,CAAC;AAAA,IACL,CAAC;AAGH,mBAAe;AACf,mBAAe;AAGf,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,uBAAuB,EACvC,GAAG,YAAY,yBAAyB,SAAS,GAAG;AACnD,QAAE,eAAe;AACjB,YAAM,UAAUA,IAAE,IAAI,EAAE,KAAK,KAAK;AAElC,MAAAA,IAAE,uBAAuB,EAAE,YAAY,QAAQ;AAC/C,MAAAA,IAAE,IAAI,EAAE,SAAS,QAAQ;AAEzB,MAAAA,IAAE,YAAY,EAAE,YAAY,QAAQ;AACpC,MAAAA,IAAE,IAAI,OAAO,EAAE,EAAE,SAAS,QAAQ;AAElC,iBAAW;AAGX,iBAAW,MAAM;AACf,gCAAwB,EAAE,OAAO,MAAM,CAAC;AAAA,MAC1C,GAAG,CAAC;AAAA,IACN,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,iBAAiB,EACjC,GAAG,YAAY,mBAAmB,OAAK;AACtC,QAAE,eAAe;AACjB,yBAAU,YAAY;AAAA,IACxB,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,mBAAmB,EACnC,GAAG,YAAY,qBAAqB,SAAS,GAAG;AAC/C,UAAI,EAAE,WAAW;AAAM;AACvB,yBAAU,YAAY;AAAA,IACxB,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,eAAe,EAC/B,GAAG,YAAY,iBAAiB,OAAK;AACpC,QAAE,eAAe;AACjB,cAAQ,IAAI,6CAA6C;AACzD,0BAAe,KAAK,IAAI;AAAA,IAC1B,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,eAAe,EAC/B,GAAG,YAAY,iBAAiB,OAAK;AACpC,QAAE,eAAe;AACjB,yBAAU,aAAa;AAAA,IACzB,CAAC;AAGH,IAAAA,IAAE,QAAQ,EACP,IAAI,YAAY,iBAAiB,EACjC,GAAG,YAAY,mBAAmB,OAAK;AACtC,QAAE,eAAe;AACjB,yBAAU,YAAY;AAAA,IACxB,CAAC;AAGH,aAAS,iBAAiB,yBAAyB,MAAM;AACvD,iBAAW,MAAM;AACf,gCAAwB,EAAE,OAAO,KAAK,CAAC;AAAA,MACzC,GAAG,CAAC;AAAA,IACN,CAAC;AAAA,EACH;;;ACtTA,MAAM,UAAU;AAAA,IACd,OAAO;AACL,cAAQ,IAAI,yBAAyB;AAErC,mBAAa;AAAA,IACf;AAAA,EACF;AAEA,MAAO,eAAQ;;;ACVf,MAAM,OAAO;AAAA,IACX,OAAO;AACL,cAAQ,IAAI,sBAAsB;AAClC,mBAAQ,KAAK;AAAA,IACf;AAAA,EACF;AAGA,UAAQ,IAAI,sBAAsB;AAGlC,MAAI,SAAS,eAAe,WAAW;AACrC,aAAS,iBAAiB,oBAAoB,KAAK,IAAI;AAAA,EACzD,OAAO;AACL,SAAK,KAAK;AAAA,EACZ;AAKe,WAAR,WAA4B;AAEjC,mBAAa,KAAK;AAAA,EAEpB;AAKA,MAAI,OAAO,WAAW;AAAa,WAAO,aAAa;",
  "names": ["$", "err", "log", "warn", "$", "ajaxEnv", "normalizeList", "preloadedList", "postJSON", "err", "api_default", "api_default", "$", "TRAITS", "escape", "api_default", "_a", "$", "$", "ajaxEnv", "err", "$", "$", "_bound", "renderGiftList", "namesFromProfile", "api_default", "api_default", "$", "$", "$", "log", "warn", "ajaxEnv", "api_default", "$", "api_default", "$", "events_default", "events_default", "capitalize", "$", "TRAITS", "MARK_DIE", "api_default", "capitalize", "api_default", "$", "$", "parseJsonMaybe", "$", "ajaxEnv", "normalizeCore", "buildPayload", "err", "$", "LOG", "$", "LOG", "api_default"]
}
