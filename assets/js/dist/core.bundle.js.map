{
  "version": 3,
  "sources": ["../src/core/species/api.js", "../src/core/career/api.js", "../src/core/gifts/state.js", "../src/core/traits/service.js", "../src/core/formBuilder/render-details.js", "../src/core/formBuilder/render-profile.js", "../src/core/formBuilder/render-skills.js", "../src/core/formBuilder/render-summary.js", "../src/core/formBuilder/form-builder.js", "../src/core/formBuilder/index.js", "../src/core/species/events.js", "../src/core/species/index.js", "../src/core/career/events.js", "../src/core/career/extra.js", "../src/core/career/index.js", "../src/core/main/builder-ui.js", "../src/core/traits/events.js", "../src/core/traits/index.js", "../src/core/quals/catalog.js", "../src/core/quals/index.js", "../src/core/quals/state.js", "../src/core/gifts/free-choices.js", "../src/core/quals/ui.js", "../src/core/gifts/index.js", "../src/core/skills/render.js", "../src/core/skills/events.js", "../src/core/skills/index.js", "../src/core/summary/utils.js", "../src/core/summary/api.js", "../src/core/summary/index.js", "../src/core/main/builder-refresh.js", "../src/core/main/builder-load.js", "../src/core/main/builder-save.js", "../src/core/main/builder-events.js", "../src/core/main/index.js", "../src/core/index.js"],
  "sourcesContent": ["// assets/js/src/core/species/api.js\n// Reliable Species data access with localized-globals first and AJAX fallback.\n// IMPORTANT: adds in-flight de-dupe so multiple callers don't spam AJAX.\n// Preserves behavior, supports both CG_AJAX & CG_Ajax, and sends all common nonce keys.\n// Exposes window.SpeciesAPI for console debugging.\n\nconst log  = (...a) => console.log('[SpeciesAPI]', ...a);\nconst warn = (...a) => console.warn('[SpeciesAPI]', ...a);\nconst $    = window.jQuery;\n\n/**\n * Collect AJAX env (mu-plugin, legacy, or WP ajaxurl)\n */\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  const ajax_url =\n    env.ajax_url ||\n    window.ajaxurl ||\n    document.body?.dataset?.ajaxUrl ||\n    '/wp-admin/admin-ajax.php';\n  const nonce = env.nonce || env.security || window.CG_NONCE || null;\n  return { ajax_url, nonce };\n}\n\n/**\n * Normalize various list shapes into [{id,name}]\n */\nfunction normalizeList(raw) {\n  if (!Array.isArray(raw)) return [];\n  return raw\n    .map((it) => {\n      if (it && typeof it === 'object') {\n        return {\n          id:   String(it.id ?? it.value ?? ''),\n          name: String(it.name ?? it.title ?? ''),\n        };\n      }\n      return { id: String(it), name: String(it) };\n    })\n    .filter((x) => x.id && x.name);\n}\n\n/**\n * Try preloaded globals (fast path)\n */\nfunction preloadedList() {\n  if (Array.isArray(window.CG_SPECIES_LIST) && window.CG_SPECIES_LIST.length) {\n    return normalizeList(window.CG_SPECIES_LIST);\n  }\n  if (window.CG_DATA && Array.isArray(window.CG_DATA.species) && window.CG_DATA.species.length) {\n    return normalizeList(window.CG_DATA.species);\n  }\n  if (Array.isArray(window.cgSpecies) && window.cgSpecies.length) {\n    return normalizeList(window.cgSpecies);\n  }\n  return null;\n}\n\n/** Post + lenient JSON parse (stay in jQuery Deferred world) */\nfunction postJSON(url, data) {\n  return $.post(url, data).then((res) => {\n    try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n    catch (_) { return res; }\n  });\n}\n\nconst SpeciesAPI = {\n  _cache: { list: null, listPromise: null },\n  currentProfile: null,\n\n  clearCache() {\n    this._cache.list = null;\n    this._cache.listPromise = null;\n  },\n\n  /**\n   * Get the species list.\n   * @param {boolean} force If true, bypasses globals/cache and hits AJAX.\n   * @returns {jQuery.Promise<array>}\n   */\n  getList(force = false) {\n    // 1) Globals (no network)\n    if (!force) {\n      const pre = preloadedList();\n      if (pre && pre.length) {\n        this._cache.list = pre.slice();\n        return $.Deferred().resolve(this._cache.list).promise();\n      }\n    }\n\n    // 2) Cached\n    if (!force && this._cache.list) {\n      return $.Deferred().resolve(this._cache.list).promise();\n    }\n\n    // 2.5) In-flight de-dupe (CRITICAL)\n    // If a request is already running, reuse it (even if force=true) to avoid parallel spam.\n    if (this._cache.listPromise) {\n      return this._cache.listPromise;\n    }\n\n    // 3) AJAX\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available; returning empty list.');\n      return $.Deferred().resolve([]).promise();\n    }\n\n    log('Fetching species via AJAX\u2026');\n    const payload = {\n      action:      'cg_get_species_list',\n      security:    nonce, // check_ajax_referer(...,'security')\n      nonce:       nonce, // some handlers read `nonce`\n      _ajax_nonce: nonce, // and some rely on WP\u2019s default key\n    };\n\n    // Use .then(success, failure) so failure converts to a resolved [] for callers.\n    const p = postJSON(ajax_url, payload)\n      .then(\n        (res) => {\n          const listRaw = Array.isArray(res) ? res : (res?.data || []);\n          const list = normalizeList(listRaw);\n          this._cache.list = list;\n          log('Species list fetched:', list.length);\n          return list;\n        },\n        (xhr, status, err) => {\n          warn('AJAX species list failed:', status, err, xhr?.responseText);\n          this._cache.list = [];\n          return [];\n        }\n      )\n      .always(() => {\n        // Clear in-flight marker once resolved/rejected\n        this._cache.listPromise = null;\n      });\n\n    this._cache.listPromise = p;\n    return p;\n  },\n\n  /**\n   * Populate a <select> with the species list.\n   * Keeps prior selection if still present.\n   * @param {HTMLElement|string} sel element or query selector\n   * @param {{force?: boolean}} opts\n   * @returns {jQuery.Promise<HTMLElement|null>}\n   */\n  populateSelect(sel, { force = false } = {}) {\n    const el = (sel instanceof Element) ? sel : document.querySelector(sel);\n    if (!el) return $.Deferred().resolve(null).promise();\n\n    const prior = el.value || '';\n    el.innerHTML = '';\n    const ph = document.createElement('option');\n    ph.value = '';\n    ph.textContent = '\u2014 Select Species \u2014';\n    el.appendChild(ph);\n\n    return this.getList(force).then((list) => {\n      (list || []).forEach(({ id, name }) => {\n        const o = document.createElement('option');\n        o.value = id;\n        o.textContent = name;\n        el.appendChild(o);\n      });\n\n      if (prior && (list || []).some((x) => String(x.id) === String(prior))) {\n        el.value = String(prior);\n      }\n      return el;\n    });\n  },\n\n  /**\n   * Fetch the full profile for one species (gifts, skills, etc).\n   * Caches to `currentProfile` and emits a DOM event.\n   * @param {string|number} speciesId\n   * @returns {jQuery.Promise<object|null>}\n   */\n  fetchProfile(speciesId) {\n    if (!speciesId) {\n      this.currentProfile = null;\n      return $.Deferred().resolve(null).promise();\n    }\n\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available for fetchProfile.');\n      return $.Deferred().resolve(null).promise();\n    }\n\n    log('Fetching species profile', speciesId);\n    const payload = {\n      action:      'cg_get_species_profile',\n      species_id:  speciesId, // preferred key\n      id:          speciesId, // fallback\n      security:    nonce,\n      nonce:       nonce,\n      _ajax_nonce: nonce,\n    };\n\n    return postJSON(ajax_url, payload).then(\n      (res) => {\n        const profile = res?.data || res || null;\n        this.currentProfile = profile || null;\n\n        document.dispatchEvent(new CustomEvent('cg:species:profile', {\n          detail: { id: String(speciesId), profile: this.currentProfile },\n        }));\n\n        return this.currentProfile;\n      },\n      (xhr, status, err) => {\n        warn('AJAX species profile failed:', status, err, xhr?.responseText);\n        this.currentProfile = null;\n        return null;\n      }\n    );\n  },\n};\n\n// Expose for console debugging\nif (typeof window !== 'undefined') {\n  window.SpeciesAPI = SpeciesAPI;\n}\n\nexport default SpeciesAPI;\n", "// assets/js/src/core/career/api.js\n// Reliable Career data access with localized-globals first and AJAX fallback.\n// IMPORTANT: adds in-flight de-dupe so multiple callers don't spam AJAX.\n// Matches your PHP endpoints:\n//   - cg_get_career_list   \u2192 [{ id, name }]\n//   - cg_get_career_gifts  \u2192 profile object (careerName, gift_*, gift_id_*, manifold_*, skill_one/two/three)\n\nconst log  = (...a) => console.log('[CareerAPI]', ...a);\nconst warn = (...a) => console.warn('[CareerAPI]', ...a);\nconst $    = window.jQuery;\n\n/** Collect AJAX env (mu-plugin, legacy, or WP ajaxurl) */\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  const ajax_url =\n    env.ajax_url ||\n    window.ajaxurl ||\n    document.body?.dataset?.ajaxUrl ||\n    '/wp-admin/admin-ajax.php';\n  const nonce = env.nonce || env.security || window.CG_NONCE || null;\n  return { ajax_url, nonce };\n}\n\n/** Normalize various list shapes into [{id,name}] */\nfunction normalizeList(raw) {\n  if (!Array.isArray(raw)) return [];\n  return raw.map(it => {\n    if (it && typeof it === 'object') {\n      const out = {\n        id:   String(it.id ?? it.value ?? ''),\n        name: String(it.name ?? it.title ?? '')\n      };\n\n      // CG_CAREERLIST_EXTFIELDS: preserve extra fields returned by PHP list endpoint\n      // so Extra Careers can compute eligibility without N AJAX calls.\n      ['gift_id_1','gift_id_2','gift_id_3','skill_one','skill_two','skill_three'].forEach(k => {\n        if (it[k] != null && String(it[k]) !== '') out[k] = String(it[k]);\n      });\n\n      return out;\n    }\n    return { id: String(it), name: String(it) };\n  }).filter(x => x.id && x.name);\n}\n\n\n/**\n * Try preloaded globals (fast path)\n * NOTE: hardener localizes CG_CAREERS_LIST (plural). Older code sometimes used CG_CAREER_LIST (singular).\n * We accept both to avoid unnecessary AJAX calls.\n */\nfunction preloadedList() {\n  // Preferred (hardener)\n  if (Array.isArray(window.CG_CAREERS_LIST) && window.CG_CAREERS_LIST.length) {\n    return normalizeList(window.CG_CAREERS_LIST);\n  }\n\n  // Legacy/singular\n  if (Array.isArray(window.CG_CAREER_LIST) && window.CG_CAREER_LIST.length) {\n    return normalizeList(window.CG_CAREER_LIST);\n  }\n\n  // Other legacy shapes\n  if (window.CG_DATA && Array.isArray(window.CG_DATA.careers) && window.CG_DATA.careers.length) {\n    return normalizeList(window.CG_DATA.careers);\n  }\n  if (Array.isArray(window.cgCareers) && window.cgCareers.length) {\n    return normalizeList(window.cgCareers);\n  }\n  return null;\n}\n\n/** Post + lenient JSON parse (stay in jQuery Deferred world) */\nfunction postJSON(url, data) {\n  return $.post(url, data).then(res => {\n    try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n    catch (_) { return res; }\n  });\n}\n\n/** Coerce profile so downstream code always has predictable keys */\nfunction normalizeCareerProfileShape(profile = {}) {\n  const p = (profile && typeof profile === 'object') ? { ...profile } : {};\n\n  // Name aliases\n  if (!p.careerName && p.career_name) p.careerName = p.career_name;\n  if (!p.career_name && p.careerName) p.career_name = p.careerName;\n  if (!p.careerName && !p.career_name && p.name) p.careerName = p.name;\n\n  // Ensure skill ids are strings\n  ['skill_one', 'skill_two', 'skill_three'].forEach(k => {\n    if (p[k] != null) p[k] = String(p[k]);\n  });\n\n  // Gift IDs as strings\n  ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\n    if (p[k] != null) p[k] = String(p[k]);\n  });\n\n  // Manifolds as Numbers (default 1)\n  ['manifold_1', 'manifold_2', 'manifold_3'].forEach(k => {\n    if (p[k] != null) p[k] = parseInt(p[k], 10) || 1;\n  });\n\n  return p;\n}\n\n/** Convert normalized profile \u2192 array of gift names (with \u00D7 manifold if >1) */\nfunction giftNamesFromProfile(profile = {}) {\n  const names = [profile.gift_1, profile.gift_2, profile.gift_3]\n    .map(v => (v == null ? '' : String(v)))\n    .filter(Boolean);\n\n  return names.map((name, i) => {\n    const m = profile[`manifold_${i + 1}`];\n    const mult = parseInt(m, 10) || 1;\n    return mult > 1 ? `${name} \u00D7 ${mult}` : name;\n  });\n}\n\nconst CareerAPI = {\n  _cache: { list: null, listPromise: null },\n  currentProfile: null,\n    currentProfileId: null, // CG_CAREERAPI_PROFILE_RACE_GUARD\n\n  clearCache() {\n    this._cache.list = null;\n    this._cache.listPromise = null;\n  },\n\n  /** getList(force=false) \u2192 Promise resolving to [{id,name}] */\n  getList(force = false) {\n    // 1) Globals (no network)\n    if (!force) {\n      const pre = preloadedList();\n      if (pre && pre.length) {\n        this._cache.list = pre.slice();\n        return $.Deferred().resolve(this._cache.list).promise();\n      }\n    }\n\n    // 2) Cached\n    if (!force && this._cache.list) {\n      return $.Deferred().resolve(this._cache.list).promise();\n    }\n\n    // 2.5) In-flight de-dupe (CRITICAL)\n    // If a request is already running, reuse it (even if force=true) to avoid parallel spam.\n    if (this._cache.listPromise) {\n      return this._cache.listPromise;\n    }\n\n    // 3) AJAX\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available; returning empty list.');\n      return $.Deferred().resolve([]).promise();\n    }\n\n    log('Fetching careers via AJAX\u2026');\n    const payload = {\n      action:      'cg_get_career_list',\n      security:    nonce,\n      nonce:       nonce,\n      _ajax_nonce: nonce\n    };\n\n    const p = postJSON(ajax_url, payload)\n      .then(res => {\n        const listRaw = Array.isArray(res) ? res : (res?.data || []);\n        const list    = normalizeList(listRaw);\n        this._cache.list = list;\n        log('Career list fetched:', list.length);\n        return list;\n      })\n      .fail((xhr, status, err) => {\n        warn('AJAX career list failed:', status, err, xhr?.responseText);\n        return [];\n      })\n      .always(() => {\n        this._cache.listPromise = null;\n      });\n\n    this._cache.listPromise = p;\n    return p;\n  },\n\n  /** populateSelect(sel) \u2192 Promise resolving to the populated select */\n  populateSelect(sel, { force = false } = {}) {\n    const el = (sel instanceof Element) ? sel : document.querySelector(sel);\n    if (!el) return $.Deferred().resolve(null).promise();\n\n    const prior = el.value || '';\n    el.innerHTML = '';\n    const ph = document.createElement('option');\n    ph.value = '';\n    ph.textContent = '\u2014 Select Career \u2014';\n    el.appendChild(ph);\n\n    return this.getList(force).then(list => {\n      list.forEach(({ id, name }) => {\n        const o = document.createElement('option');\n        o.value = id;\n        o.textContent = name;\n        el.appendChild(o);\n      });\n      if (prior && list.some(x => String(x.id) === String(prior))) {\n        el.value = String(prior);\n      }\n      return el;\n    });\n  },\n\n  /**\n   * fetchProfile(careerId) \u2192 Promise resolving to normalized profile (or null)\n   * IMPORTANT: Your PHP returns the full profile from `cg_get_career_gifts`,\n   * so we call that here and treat the response as the profile.\n   */\n  fetchProfile(careerId) {\n    // CG_CAREERAPI_PROFILE_RACE_GUARD: guard against out-of-order AJAX profile responses\n    const wantedId = String(careerId || '');\n    if (!wantedId) {\n      this.currentProfile = null;\n      this.currentProfileId = null;\n      return $.Deferred().resolve(null).promise();\n    }\n    this.currentProfileId = wantedId;\n\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) {\n      warn('No AJAX URL available for fetchProfile.');\n      return $.Deferred().resolve(null).promise();\n    }\n\n    log('Fetching career profile', careerId);\n    const payload = {\n      action:      'cg_get_career_gifts',\n      id:          careerId,\n      security:    nonce,\n      nonce:       nonce,\n      _ajax_nonce: nonce\n    };\n\n    return postJSON(ajax_url, payload)\n      .then(res => {\n        const profRaw =\n          (res && res.success === true) ? res.data :\n          (res && res.success === undefined) ? res :\n          null;\n\n        if (!profRaw) {\n          warn('Career profile response missing/invalid:', res);\n          if (String(this.currentProfileId || '') === String(wantedId)) {\n            this.currentProfile = null;\n          }\n          return null;\n        }\n\n        const normalized = normalizeCareerProfileShape(profRaw);\n        this.currentProfile = normalized;\n        return normalized;\n      })\n      .fail((xhr, status, err) => {\n        warn('AJAX career profile failed:', status, err, xhr?.responseText);\n        this.currentProfile = null;\n        return null;\n      });\n  },\n\n  /**\n   * fetchGifts(careerId) \u2192 Promise<string[]>\n   * For compatibility with callers that \u201Cjust want gift names\u201D\n   */\n  fetchGifts(careerId) {\n    return this.fetchProfile(careerId).then(profile => {\n      if (!profile) return [];\n      return giftNamesFromProfile(profile);\n    });\n  }\n};\n\n// Expose for console debugging\nif (typeof window !== 'undefined') {\n  window.CareerAPI = CareerAPI;\n}\n\nexport default CareerAPI;\n", "// assets/js/src/core/gifts/state.js\n//\n// Shared Gifts state used by TraitsService to look up gifts by ID.\n// Fix: ensure NEW character starts clean (no bleed from previous session),\n// including clearing cached Species/Career profiles used by Traits calculations.\n\nimport FormBuilderAPI from '../formBuilder';\nimport SpeciesAPI from '../species/api.js';\nimport CareerAPI  from '../career/api.js';\n\nconst $ = window.jQuery;\n\nconst State = {\n  // currently selected free-gift IDs (strings; '' means none)\n  selected: ['', '', ''],\n\n  // master list of gift objects (must include id; may include ct_gifts_manifold, etc.)\n  gifts: [],\n\n  /**\n   * Pull any previously saved free_gifts/freeGifts from the builder\u2019s data.\n   */\n  init() {\n    const src =\n      (FormBuilderAPI && typeof FormBuilderAPI === 'object' && FormBuilderAPI._data)\n        ? FormBuilderAPI._data\n        : (typeof FormBuilderAPI?.getData === 'function' ? FormBuilderAPI.getData() : {});\n\n    const arr =\n      Array.isArray(src.free_gifts) ? src.free_gifts :\n      Array.isArray(src.freeGifts)  ? src.freeGifts  :\n      null;\n\n    const normalized = (Array.isArray(arr) ? arr : [])\n      .slice(0, 3)\n      .map(v => (v ? String(v) : ''));\n    while (normalized.length < 3) normalized.push('');\n\n    this.selected = normalized;\n  },\n\n  /**\n   * Update one slot and persist back into FormBuilder\u2019s live _data (when available).\n   */\n  set(index, id) {\n    this.selected[index] = id ? String(id) : '';\n\n    if (FormBuilderAPI && FormBuilderAPI._data) {\n      FormBuilderAPI._data.free_gifts = this.selected.slice();\n      FormBuilderAPI._data.freeGifts  = this.selected.slice();\n    }\n  },\n\n  /**\n   * Replace selected list (normalized), and persist into builder _data if present.\n   */\n  setSelected(list = []) {\n    const normalized = (Array.isArray(list) ? list : [])\n      .slice(0, 3)\n      .map(v => (v ? String(v) : ''));\n    while (normalized.length < 3) normalized.push('');\n\n    this.selected = normalized;\n\n    if (FormBuilderAPI && FormBuilderAPI._data) {\n      FormBuilderAPI._data.free_gifts = this.selected.slice();\n      FormBuilderAPI._data.freeGifts  = this.selected.slice();\n    }\n  },\n\n  /**\n   * Merge incoming gift objects into our master list.\n   */\n  setList(giftList = []) {\n    giftList.forEach(g => {\n      if (!g) return;\n\n      const idStr = String(g.id ?? g.ct_id ?? g.gift_id ?? g.ct_gift_id ?? '');\n      if (!idStr) return;\n\n      const idx = this.gifts.findIndex(x => String(x.id) === idStr);\n      if (idx > -1) {\n        this.gifts[idx] = { ...this.gifts[idx], ...g, id: idStr };\n      } else {\n        this.gifts.push({ ...g, id: idStr });\n      }\n    });\n  },\n\n  /**\n   * Find one gift object by its ID.\n   */\n  getGiftById(id) {\n    return this.gifts.find(g => String(g.id) === String(id));\n  }\n};\n\n// --- HARDENING: re-sync/reset between character sessions ---\n//\n// Problem: State.selected is a singleton and can bleed between sessions.\n// ALSO: SpeciesAPI/CareerAPI currentProfile can remain populated even when UI selects are blank.\n// Solution: on builder open/load, re-sync from FormBuilder data.\n// On NEW character, force-clear free gifts + wipe boost-target keys + clear cached profiles,\n// then fire refresh events.\n(function bindGiftStateResyncOnce(){\n  if (window.__CG_GIFT_STATE_BOUND__) return;\n  window.__CG_GIFT_STATE_BOUND__ = true;\n\n  function isNewCharacter(evt) {\n    try {\n      if (evt && evt.detail && typeof evt.detail.isNew !== 'undefined') return !!evt.detail.isNew;\n    } catch (_) {}\n    try {\n      const d = (FormBuilderAPI && FormBuilderAPI._data) ? FormBuilderAPI._data : {};\n      return !!d.isNew;\n    } catch (_) {}\n    return false;\n  }\n\n  function wipeBoostTargetKeys() {\n    try {\n      const d = (FormBuilderAPI && FormBuilderAPI._data) ? FormBuilderAPI._data : null;\n      if (!d) return;\n\n      delete d.increased_trait_career_target;\n      delete d.increased_trait_career_target_0;\n      delete d.increased_trait_career_target_1;\n      delete d.increased_trait_career_target_2;\n    } catch (_) {}\n  }\n\n  function clearCachedProfiles() {\n    // These cached profiles are used by TraitsService boost calculation.\n    try {\n      if (SpeciesAPI) {\n        SpeciesAPI.currentProfile = null;\n        SpeciesAPI.currentProfileId = '';\n        SpeciesAPI.currentId = '';\n      }\n    } catch (_) {}\n    try {\n      if (CareerAPI) {\n        CareerAPI.currentProfile = null;\n        CareerAPI.currentProfileId = '';\n        CareerAPI.currentId = '';\n      }\n    } catch (_) {}\n  }\n\n  function emitRefresh(reason) {\n    try {\n      const detail = { reason: String(reason || ''), free_gifts: State.selected.slice() };\n\n      document.dispatchEvent(new CustomEvent('cg:free-gift:changed', { detail }));\n      document.dispatchEvent(new CustomEvent('cg:traits:changed', { detail }));\n\n      // Also notify dependents that species/career are effectively blank now\n      document.dispatchEvent(new CustomEvent('cg:species:changed', { detail: { id: '' } }));\n      document.dispatchEvent(new CustomEvent('cg:career:changed',  { detail: { id: '' } }));\n\n      if ($) {\n        $(document).trigger('cg:free-gift:changed', [detail]);\n        $(document).trigger('cg:traits:changed', [detail]);\n        $(document).trigger('cg:species:changed', [{ id: '' }]);\n        $(document).trigger('cg:career:changed',  [{ id: '' }]);\n      }\n    } catch (_) {}\n  }\n\n  function clearSelectIfPresent(selector) {\n    try {\n      const el = document.querySelector(selector);\n      if (!el) return false;\n      if (String(el.value || '') !== '') {\n        el.value = '';\n      }\n      el.dispatchEvent(new Event('change', { bubbles: true }));\n      return true;\n    } catch (_) {}\n    return false;\n  }\n\n  function resync(evt) {\n    try { State.init(); } catch (_) {}\n\n    if (isNewCharacter(evt)) {\n      try { State.setSelected(['', '', '']); } catch (_) {}\n      wipeBoostTargetKeys();\n      clearCachedProfiles();\n\n      // Ensure the UI clears AND its change handlers run (some modules only clear on change)\n      // Delay slightly in case builder just re-rendered the form.\n      setTimeout(() => {\n        clearSelectIfPresent('#cg-species');\n        clearSelectIfPresent('#cg-career');\n        emitRefresh('new-character-reset');\n      }, 0);\n\n      return;\n    }\n\n    // Non-new: still ensure Traits reacts to hydrated state\n    emitRefresh('resync');\n  }\n// CG HARDEN: idempotent native listeners (gifts/state resync)\n// Use a stable handler reference so we can remove old listeners if this module is evaluated twice.\ntry {\n  window.__CG_EVT__ = window.__CG_EVT__ || {};\n  if (window.__CG_EVT__.giftsStateResync) {\n    document.removeEventListener('cg:builder:opened',  window.__CG_EVT__.giftsStateResync);\n    document.removeEventListener('cg:character:loaded', window.__CG_EVT__.giftsStateResync);\n  }\n} catch (_) {}\n\ntry {\n  window.__CG_EVT__ = window.__CG_EVT__ || {};\n  window.__CG_EVT__.giftsStateResync = resync;\n  document.addEventListener('cg:builder:opened',  window.__CG_EVT__.giftsStateResync);\n  document.addEventListener('cg:character:loaded', window.__CG_EVT__.giftsStateResync);\n} catch (_) {}\n\n})();\n\nwindow.CG_FreeChoicesState = State;\nexport default State;\n", "// assets/js/src/core/traits/service.js\n\nimport GiftsState     from '../gifts/state.js';\nimport SpeciesService from '../species/api.js';\nimport CareerService  from '../career/api.js';\n\nconst DIE_ORDER = ['d4','d6','d8','d10','d12'];\n\n/**\n * Map of gift IDs \u2192 traitKey\n * (these IDs correspond to \u201Cincreased trait\u201D gifts)\n */\nconst BOOSTS = {\n  78:  'will',\n  89:  'speed',\n  85:  'body',\n  100: 'mind',\n  224: 'trait_species',\n  223: 'trait_career'\n};\n\nconst TRAITS     = ['will','speed','body','mind','trait_species','trait_career'];\nconst DICE_TYPES = ['d8','d6','d4'];\nconst MAX_COUNT  = { d8:2, d6:3, d4:1 };\n\nfunction boostedDie(baseDie, steps) {\n  const base = String(baseDie || '').toLowerCase().trim();\n  const idx  = DIE_ORDER.indexOf(base);\n  if (idx === -1) return baseDie || '';\n  const s = Math.max(0, parseInt(steps, 10) || 0);\n  return DIE_ORDER[Math.min(idx + s, DIE_ORDER.length - 1)];\n}\n\nfunction readFormBuilderData() {\n  const fb = window.CG_FormBuilderAPI || window.FormBuilderAPI || null;\n  return (fb && fb._data && typeof fb._data === 'object') ? fb._data : {};\n}\n\nfunction readSelectedExtraCareerIds() {\n  const d = readFormBuilderData();\n  const ids = new Set();\n  const arr = Array.isArray(d.extraCareers) ? d.extraCareers : [];\n  arr.forEach(x => {\n    const id = x && x.id != null ? String(x.id) : '';\n    if (id) ids.add(id);\n  });\n  return ids;\n}\n\nfunction computeCareerBoostCounts(totalBoosts) {\n  const total = Math.max(0, parseInt(totalBoosts || 0, 10) || 0);\n  const counts = Object.create(null);\n  counts.main = 0;\n\n  if (total <= 0) return counts;\n\n  const d = readFormBuilderData();\n  const extraIds = readSelectedExtraCareerIds();\n\n  // Per-copy assignment only for free-choice slots that are set to 223\n  let assigned = 0;\n\n  for (let slot = 0; slot <= 2; slot++) {\n    const sel = document.getElementById(`cg-free-choice-${slot}`);\n    if (!sel) continue;\n    if (String(sel.value || '') !== '223') continue;\n\n    if (assigned >= total) break;\n\n    const key = `increased_trait_career_target_${slot}`;\n    let v = (d[key] != null) ? String(d[key]).trim() : '';\n\n    // legacy fallback if present\n    if (!v && d.increased_trait_career_target != null) v = String(d.increased_trait_career_target).trim();\n\n    if (!v) v = 'main';\n    if (v !== 'main' && !extraIds.has(String(v))) v = 'main';\n\n    counts[v] = (counts[v] || 0) + 1;\n    assigned++;\n  }\n\n  // Remaining copies default to main\n  const remaining = Math.max(0, total - assigned);\n  if (remaining) counts.main = (counts.main || 0) + remaining;\n\n  return counts;\n}\n\nconst TraitsService = {\n  TRAITS,\n  DICE_TYPES,\n\n  /**\n   * Build a map: { traitKey: totalBoostCount }\n   * counting free, species, and career gifts, including any manifold multipliers.\n   */\n  calculateBoostMap() {\n    const map = Object.create(null);\n\n    function addGift(giftId) {\n      if (giftId == null) return;\n      const id = String(giftId).trim();\n      if (!id || id === '0') return;\n\n      const gift = GiftsState.getGiftById(id);\n      if (!gift) return;\n\n      const traitKey = BOOSTS[gift.id];\n      if (!traitKey) return;\n\n      const count = parseInt(gift.ct_gifts_manifold, 10) || 1;\n      map[traitKey] = (map[traitKey] || 0) + count;\n    }\n\n    // 1) Free-choice gifts\n    (Array.isArray(GiftsState.selected) ? GiftsState.selected : []).forEach(addGift);\n\n    // 2) Species gifts\n    const sp = (SpeciesService && SpeciesService.currentProfile) ? SpeciesService.currentProfile : null;\n    if (sp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => addGift(sp[k]));\n    }\n\n    // 3) Career gifts (+ replacement gifts, counted ONCE)\n    const cp = (CareerService && CareerService.currentProfile) ? CareerService.currentProfile : null;\n    if (cp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => addGift(cp[k]));\n\n      if (cp.career_gift_replacements && typeof cp.career_gift_replacements === 'object') {\n        Object.values(cp.career_gift_replacements).forEach(v => addGift(v));\n      }\n    }\n\n    try {\n      if (window && window.CG_DEBUG && window.CG_DEBUG.traits_boost_map) {\n        console.log('[Traits] boost map \u2192', map);\n      }\n    } catch (_) {}\n\n    return map;\n  },\n\n  enforceCounts() {\n    const $    = window.jQuery;\n    const freq = { d8:0, d6:0, d4:0 };\n\n    $('.cg-trait-select').each(function(){\n      const v = $(this).val();\n      if (v && v in freq) freq[v]++;\n    });\n\n    $('.cg-trait-select').each(function(){\n      const $sel    = $(this);\n      const current = $sel.val() || '';\n      let options   = '<option value=\"\">\u2014 Select \u2014</option>';\n\n      DICE_TYPES.forEach(die => {\n        if (freq[die] < MAX_COUNT[die] || current === die) {\n          const sel = current === die ? ' selected' : '';\n          options += `<option value=\"${die}\"${sel}>${die}</option>`;\n        }\n      });\n\n      $sel.html(options);\n    });\n  },\n\n  updateAdjustedDisplays() {\n    const $ = window.jQuery;\n    const boosts = this.calculateBoostMap();\n\n    // Career boosts are per-copy targeted; only MAIN-career badge/note should reflect boosts targeting main\n    const totalCareerBoosts = boosts.trait_career || 0;\n    const careerCounts = computeCareerBoostCounts(totalCareerBoosts);\n    const careerMainBoosts = careerCounts.main || 0;\n\n    TRAITS.forEach(traitKey => {\n      const $sel = $(`#cg-${traitKey}`);\n      if (!$sel.length) return;\n\n      const rawBase = String($sel.val() || '').trim();\n\n      let count = boosts[traitKey] || 0;\n\n      if (traitKey === 'trait_career') {\n        count = careerMainBoosts;\n      }\n\n      let badgeText = '\u2013';\n      if (rawBase) {\n        badgeText = (count > 0) ? boostedDie(rawBase, count) : rawBase;\n      }\n\n      const $badge = $(`#cg-${traitKey}-badge`);\n      if ($badge.length) $badge.text(badgeText);\n\n      if (traitKey === 'trait_career') {\n        const $pb = $('#cg-profile-trait_career-badge');\n        if ($pb.length) $pb.text(badgeText);\n      }\n\n      let note = '';\n\n      if (traitKey === 'trait_career') {\n        if (careerMainBoosts > 0) {\n          note = careerMainBoosts === 1 ? 'Increased by gift' : `Increased by gift \u00D7${careerMainBoosts}`;\n        }\n      } else {\n        const origBoosts = boosts[traitKey] || 0;\n        if (origBoosts > 0) {\n          note = origBoosts === 1 ? 'Increased by gift' : `Increased by gift \u00D7${origBoosts}`;\n        }\n      }\n\n      const $note = $(`#cg-${traitKey}-adjusted`);\n      if ($note.length) $note.text(note);\n\n      if (traitKey === 'trait_career') {\n        const $pn = $('#cg-profile-trait_career-note');\n        if ($pn.length) $pn.text(note);\n      }\n    });\n  },\n\n  refreshAll() {\n    this.enforceCounts();\n    this.updateAdjustedDisplays();\n  },\n\n  getBoostedDie(traitKey) {\n    const boosts = this.calculateBoostMap();\n    let cnt = boosts[traitKey] || 0;\n\n    if (traitKey === 'trait_career') {\n      const total = boosts.trait_career || 0;\n      const counts = computeCareerBoostCounts(total);\n      cnt = counts.main || 0;\n    }\n\n    if (!cnt) return '';\n\n    const base = window.jQuery(`#cg-${traitKey}`).val() || 'd4';\n    return boostedDie(base, cnt);\n  }\n};\n\nexport default TraitsService;\n", "// assets/js/src/core/formBuilder/render-details.js\n\nimport TraitsService from '../traits/service.js';\n\nconst TRAITS = TraitsService.TRAITS;       // [\"will\",\"speed\",\"body\",\"mind\",\"trait_species\",\"trait_career\"]\nconst DICE   = TraitsService.DICE_TYPES;   // [\"d8\",\"d6\",\"d4\"]\n\nfunction escape(val) {\n  const s = val == null ? '' : String(val);\n  return s\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction capitalize(str = '') {\n  return str.charAt(0).toUpperCase() + str.slice(1);\n}\n\nexport default {\n  renderTabs() {\n    return `\n      <ul class=\"cg-tabs\">\n        <li data-tab=\"tab-details\" class=\"active\">Details</li>\n        <li data-tab=\"tab-traits\">Traits, Species, Careers</li>\n        <li data-tab=\"tab-gifts\">Gifts</li>\n        <li data-tab=\"tab-skills\">Skills</li>\n        <li data-tab=\"tab-trappings\">Trappings &amp; Equipment</li>\n        <li data-tab=\"tab-description\">Description</li>\n        <li data-tab=\"tab-summary\">Character Sheet</li>\n      </ul>\n    `;\n  },\n\n  renderContent(data = {}) {\n    const speciesSelected =\n      (data && (data.species_id || data.species || (data.profile && data.profile.species))) || '';\n    const careerSelected =\n      (data && (data.career_id || data.career || (data.profile && data.profile.career))) || '';\n\n    const traitFields = TRAITS.map(trait => {\n      const val   = String(data[trait] ?? '');\n      const label = trait === 'trait_species' ? 'Species'\n                  : trait === 'trait_career'  ? 'Career'\n                  : capitalize(trait);\n\n      const options = DICE.map(die => {\n        const sel = (die === val) ? ' selected' : '';\n        return `<option value=\"${die}\"${sel}>${die}</option>`;\n      }).join('');\n\n      return `\n        <div class=\"cg-trait\">\n          <label for=\"cg-${trait}\">${label} <small>(choose one)</small></label>\n\n          <div class=\"cg-trait-control\">\n            <select id=\"cg-${trait}\" class=\"cg-trait-select\" data-trait=\"${trait}\">\n              <option value=\"\">\u2014 Select \u2014</option>\n              ${options}\n            </select>\n\n            <span\n              class=\"cg-trait-badge\"\n              id=\"cg-${trait}-badge\"\n              aria-label=\"${escape(label)} die\"\n              aria-live=\"polite\"\n            >\u2013</span>\n          </div>\n\n          <div class=\"trait-adjusted\" id=\"cg-${trait}-adjusted\"></div>\n        </div>\n      `;\n    }).join('');\n\n    return `\n      <div id=\"tab-details\" class=\"tab-panel active\">\n        <div class=\"cg-details-panel\">\n\n          <div class=\"cg-details-box\">\n            <h3>Details</h3>\n            <div class=\"cg-profile-grid\">\n              <div>\n                <label>Character Name</label>\n                <input type=\"text\" id=\"cg-name\" value=\"${escape(data.name)}\" required />\n              </div>\n              <div>\n                <label>Player Name</label>\n                <input type=\"text\" id=\"cg-player-name\" value=\"${escape(data.player_name)}\" />\n              </div>\n\n              <div>\n                <label>Gender</label>\n                <select id=\"cg-gender\">\n                  <option value=\"\">&mdash; Select &mdash;</option>\n                  <option value=\"Male\"      ${data.gender === 'Male'      ? 'selected' : ''}>Male</option>\n                  <option value=\"Female\"    ${data.gender === 'Female'    ? 'selected' : ''}>Female</option>\n                  <option value=\"Nonbinary\" ${data.gender === 'Nonbinary' ? 'selected' : ''}>Nonbinary</option>\n                </select>\n              </div>\n              <div>\n                <label>Age</label>\n                <input type=\"text\" id=\"cg-age\" value=\"${escape(data.age)}\" required />\n              </div>\n            </div>\n\n            <label>Motto</label>\n            <input type=\"text\" id=\"cg-motto\" value=\"${escape(data.motto)}\" />\n\n            <label>Goal 1</label>\n            <input type=\"text\" id=\"cg-goal1\" value=\"${escape(data.goal1)}\" />\n            <label>Goal 2</label>\n            <input type=\"text\" id=\"cg-goal2\" value=\"${escape(data.goal2)}\" />\n            <label>Goal 3</label>\n            <input type=\"text\" id=\"cg-goal3\" value=\"${escape(data.goal3)}\" />\n          </div>\n\n        </div>\n      </div>\n\n      <div id=\"tab-traits\" class=\"tab-panel\">\n        <div class=\"cg-details-panel\">\n\n          <div class=\"cg-profile-box\">\n            <h3>Species and Career</h3>\n\n            <label for=\"cg-species\">Species</label>\n            <select\n              id=\"cg-species\"\n              class=\"cg-profile-select\"\n              data-selected=\"${escape(speciesSelected)}\"\n            ></select>\n\n            <ul id=\"species-gifts\" class=\"cg-gift-item\"></ul>\n\n            <label for=\"cg-career\">Career</label>\n            <div class=\"cg-trait-control cg-trait-control--profile\">\n              <select\n                id=\"cg-career\"\n                class=\"cg-profile-select\"\n                data-selected=\"${escape(careerSelected)}\"\n              ></select>\n\n              <span\n                class=\"cg-trait-badge\"\n                id=\"cg-profile-trait_career-badge\"\n                aria-label=\"Career trait die\"\n                aria-live=\"polite\"\n              >\u2013</span>\n            </div>\n\n            <div class=\"trait-adjusted\" id=\"cg-profile-trait_career-note\"></div>\n            <div id=\"cg-extra-careers\" class=\"cg-profile-grid\"></div>\n          </div>\n\n          <div class=\"cg-traits-box\">\n            <h3>Traits</h3>\n            <div class=\"cg-profile-grid\">\n              ${traitFields}\n            </div>\n\n            <!-- Read-only display of extra-career trait dice (populated by career/extra.js) -->\n            <div id=\"cg-extra-career-traits\" class=\"cg-extra-career-traits-box\"></div>\n          </div>\n\n        </div>\n      </div>\n\n      <div id=\"tab-description\" class=\"tab-panel\">\n        <div class=\"cg-details-panel\">\n          <div class=\"cg-text-box\">\n            <h3>Description &amp; Backstory</h3>\n            <label>Description</label>\n            <textarea id=\"cg-description\">${escape(data.description)}</textarea>\n            <label>Backstory</label>\n            <textarea id=\"cg-backstory\">${escape(data.backstory)}</textarea>\n          </div>\n        </div>\n      </div>\n    `;\n  }\n};\n", "// assets/js/src/core/formBuilder/render-profile.js\n//\n// \u201CGifts\u201D + \u201CTrappings\u201D panels\n// NOTE: Element IDs are intentionally unchanged so existing APIs keep working.\n\nexport default {\n  renderContent(_data = {}) {\n    return `\n      <div id=\"tab-gifts\" class=\"tab-panel\">\n\n        <div class=\"cg-profile-box\">\n          <h3>Gifts</h3>\n\n          <div class=\"cg-gift-label\">Local Knowledge</div>\n          <div id=\"cg-local-knowledge\" class=\"cg-gift-item\"></div>\n\n          <div style=\"display:flex; align-items:center; gap:10px; margin-top:1em;\">\n            <div class=\"cg-gift-label\" style=\"margin-top:0;\">Language</div>\n            <div id=\"cg-language\" class=\"cg-gift-item\" style=\"margin:0;\"></div>\n          </div>\n\n          <div class=\"cg-gift-label\">Species Gifts</div>\n          <ul id=\"species-gift-block\" class=\"cg-gift-item\"></ul>\n\n          <div class=\"cg-gift-label\">Career Gifts</div>\n          <ul id=\"career-gifts\" class=\"cg-gift-item\"></ul>\n\n          <div class=\"cg-gift-label\">Chosen</div>\n          <div id=\"cg-free-choices\" class=\"cg-gift-item\"></div>\n        </div>\n\n      </div>\n\n      <div id=\"tab-trappings\" class=\"tab-panel\">\n        <div class=\"cg-profile-box\">\n          <h3>Trappings &amp; Equipment</h3>\n          <p><em>Coming soon.</em></p>\n        </div>\n      </div>\n    `;\n  }\n};\n", "// assets/js/src/core/formBuilder/render-skills.js\n//\n// TAB-RESTRUCTURE HARDENING (Dec 2025):\n// - FormBuilder should NOT pre-render/populate the Skills table rows.\n// - This file now renders ONLY the Skills tab shell (panel + empty table).\n// - The real Skills UI is populated by assets/js/src/core/skills/render.js\n//   when (and only when) the Skills tab is active.\n//\n// This prevents Skills DOM from being built while the user is on Traits/Profile/Summary.\n\nexport default {\n  renderContent(_data = {}) {\n    return `\n      <div id=\"tab-skills\" class=\"tab-panel\">\n        <table id=\"skills-table\" class=\"cg-skills-table\">\n          <thead></thead>\n          <tbody></tbody>\n        </table>\n      </div>\n    `;\n  }\n};\n", "// assets/js/src/core/formBuilder/render-summary.js\r\n\r\n/**\r\n * \u201CSummary\u201D tab & panel skeleton\r\n */\r\nexport default {\r\n  renderContent(data = {}) {\r\n    return `\r\n      <div id=\"tab-summary\" class=\"tab-panel\">\r\n        <div class=\"summary-header\">\r\n          <button id=\"cg-export-pdf\" type=\"button\" class=\"button primary\">\r\n            \uD83D\uDDA8\uFE0F Export to PDF\r\n          </button>\r\n        </div>\r\n        <div id=\"cg-summary-sheet\"></div>\r\n      </div>\r\n    `;\r\n  }\r\n};\r\n", "// assets/js/src/core/formBuilder/form-builder.js\r\nconst $ = window.jQuery;\r\n\r\nimport DetailsTabRenderer   from './render-details.js';\r\nimport ProfileTabRenderer   from './render-profile.js';\r\nimport SkillsTabRenderer    from './render-skills.js';\r\nimport SummaryTabRenderer   from './render-summary.js';\r\n\r\nconst FormBuilder = {\r\n  buildForm(data = {}) {\r\n    console.log('\uD83D\uDEE0\uFE0F FormBuilder.buildForm fired:', data);\r\n\r\n    // 1) Build the HTML into a variable\r\n    const html = `\r\n<form id=\"cg-form\">\r\n\r\n  ${DetailsTabRenderer.renderTabs()}\r\n  <div class=\"cg-tab-wrap\">\r\n    ${DetailsTabRenderer.renderContent(data)}\r\n    ${ProfileTabRenderer.renderContent(data)}\r\n    ${SkillsTabRenderer.renderContent(data)}\r\n    ${SummaryTabRenderer.renderContent(data)}\r\n  </div>\r\n\r\n  <input type=\"hidden\" id=\"cg-id\"     value=\"${data.id || ''}\" />\r\n  <div class=\"cg-form-buttons\">\r\n    <button type=\"button\" class=\"cg-save-button\">\uD83D\uDCBE Save</button>\r\n    <button type=\"button\" class=\"cg-save-button cg-close-after-save\">\uD83D\uDCBE Save & Close</button>\r\n  </div>\r\n</form>`;\r\n\r\n    // 2) AFTER the form is injected into the DOM, give the browser a tick\r\n    //    then read every <select> value out of the rendered HTML:\r\n    setTimeout(() => {\r\n      console.log('\uD83D\uDD3D [buildForm] SELECT VALUES AFTER RENDER:', {\r\n        will:            $('#cg-will').val(),\r\n        speed:           $('#cg-speed').val(),\r\n        body:            $('#cg-body').val(),\r\n        mind:            $('#cg-mind').val(),\r\n        trait_species:   $('#cg-trait_species').val(),\r\n        trait_career:    $('#cg-trait_career').val(),\r\n        profileSpecies:  $('#cg-species').val(),\r\n        profileCareer:   $('#cg-career').val(),\r\n      });\r\n    }, 0);\r\n\r\n    // 3) Return the HTML string to the caller\r\n    return html;\r\n  }\r\n};\r\n\r\nexport default FormBuilder;\r\n", "// assets/js/src/core/formBuilder/index.js\n//\n// SAVE HARDENING (Dec 2025 \u2192 Jan 2026):\n// - Tabs may be detached/rebuilt; DOM fields may not exist when saving.\n// - collectFormData() MUST fall back to in-memory _data to avoid clobbering.\n// - ALWAYS send species_id/career_id (PHP expects these), plus species/career as fallback.\n// - Send free_gift_1..3 + free-choice-0..2 for PHP compatibility.\n// - Global in-flight guard prevents double-save from multiple handlers.\n//\n// CAREER GIFT REPLACEMENTS (Jan 2026):\n// - Collect career_gift_replacements from DOM dropdowns (.cg-career-gift-replace)\n// - Persist to DB and restore on character load\n\nimport BuilderUI     from '../main/builder-ui.js';\nimport TraitsService from '../traits/service.js';\nimport FormBuilder   from './form-builder.js';\n\nconst $ = window.jQuery;\n\nfunction asString(v) {\n  return (v == null) ? '' : String(v);\n}\n\nfunction firstNonEmpty(...vals) {\n  for (const v of vals) {\n    if (v == null) continue;\n    const s = String(v);\n    if (s !== '') return s; // NOTE: \"0\" is valid and should be kept\n  }\n  return '';\n}\n\nfunction normalizeFreeGifts(arr) {\n  const out = Array.isArray(arr) ? arr.slice(0, 3).map(asString) : [];\n  while (out.length < 3) out.push('');\n  return out;\n}\n\n/**\n * Normalize skill marks into an object map { \"skillId\": n, ... }.\n * Accepts:\n *  - object map\n *  - array of [id, val] or objects\n *  - JSON string of either of the above\n */\nfunction normalizeSkillMarks(src) {\n  if (!src) return {};\n\n  // JSON string?\n  if (typeof src === 'string') {\n    try { src = JSON.parse(src); }\n    catch (_) { return {}; }\n  }\n\n  const out = {};\n\n  if (Array.isArray(src)) {\n    for (const x of src) {\n      if (x == null) continue;\n\n      if (Array.isArray(x) && x.length >= 2) {\n        const k = x[0];\n        const v = x[1];\n        if (k != null) out[String(k)] = parseInt(v, 10) || 0;\n        continue;\n      }\n\n      if (typeof x === 'object') {\n        const k = x.skillId ?? x.skill_id ?? x.id ?? x.key ?? null;\n        const v = x.mark ?? x.value ?? x.val ?? x.marks ?? x.count ?? null;\n        if (k != null && v != null) out[String(k)] = parseInt(v, 10) || 0;\n      }\n    }\n    return out;\n  }\n\n  if (typeof src === 'object') {\n    for (const k of Object.keys(src)) {\n      out[String(k)] = parseInt(src[k], 10) || 0;\n    }\n    return out;\n  }\n\n  return {};\n}\n\n/**\n * Normalize career gift replacements into an object map { \"slot\": \"giftId\", ... }.\n * Accepts object map, JSON string, or empty.\n */\nfunction normalizeGiftReplacements(src) {\n  if (!src) return {};\n\n  // JSON string?\n  if (typeof src === 'string') {\n    try { src = JSON.parse(src); }\n    catch (_) { return {}; }\n  }\n\n  if (typeof src !== 'object' || Array.isArray(src)) return {};\n\n  const out = {};\n  for (const k of Object.keys(src)) {\n    const slot = String(k).trim();\n    const val = String(src[k] || '').trim();\n    // Only slots 1-3 with non-empty values\n    if (['1','2','3'].includes(slot) && val && val !== '0') {\n      out[slot] = val;\n    }\n  }\n  return out;\n}\n\n/**\n * Resolve AJAX URL + nonce from any of the bridges we've set up.\n */\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  return {\n    url:   env.ajax_url || window.ajaxurl || document.body?.dataset?.ajaxUrl || '/wp-admin/admin-ajax.php',\n    nonce: env.nonce    || env.security   || window.CG_NONCE || null\n  };\n}\n\n/**\n * Normalize raw builder data into a flat \"core\" object with the key names\n * the PHP handler expects. Also JSON-encode any structured blobs.\n */\nfunction normalizeCore(raw = {}) {\n  // IMPORTANT: species/career are IDs, NOT trait_species/trait_career dice.\n  const species = firstNonEmpty(\n    raw.species_id,\n    raw.species,\n    raw.profile?.species,\n    raw.profileSpecies\n  );\n\n  const career = firstNonEmpty(\n    raw.career_id,\n    raw.career,\n    raw.profile?.career,\n    raw.profileCareer\n  );\n\n  const freeArr = normalizeFreeGifts(\n    Array.isArray(raw.free_gifts) ? raw.free_gifts :\n    Array.isArray(raw.freeGifts)  ? raw.freeGifts  :\n    (raw.free_gift_1 != null || raw.free_gift_2 != null || raw.free_gift_3 != null)\n      ? [raw.free_gift_1, raw.free_gift_2, raw.free_gift_3]\n      : (raw['free-choice-0'] != null || raw['free-choice-1'] != null || raw['free-choice-2'] != null)\n        ? [raw['free-choice-0'], raw['free-choice-1'], raw['free-choice-2']]\n        : []\n  );\n\n  // IMPORTANT: PHP expects character.skillMarks (object map)\n  const marksObj = normalizeSkillMarks(\n    raw.skillMarks ??\n    raw.skill_marks ??\n    raw.skill_marks_json ??\n    ''\n  );\n\n  // Career gift replacements\n  const giftReplacements = normalizeGiftReplacements(raw.career_gift_replacements);\n\n  return {\n    id:          raw.id || '',\n    name:        raw.name || '',\n    player_name: raw.player_name || '',\n    age:         raw.age || '',\n    gender:      raw.gender || '',\n    motto:       raw.motto || '',\n\n    // Persistable narrative fields (PHP saves these)\n    goal1:       raw.goal1 ?? '',\n    goal2:       raw.goal2 ?? '',\n    goal3:       raw.goal3 ?? '',\n    description: raw.description ?? '',\n    backstory:   raw.backstory ?? '',\n\n    // Optional fields PHP also supports\n    local_area:  raw.local_area ?? '',\n    language:    raw.language ?? '',\n\n    will:        raw.will ?? '',\n    body:        raw.body ?? '',\n    mind:        raw.mind ?? '',\n    speed:       raw.speed ?? '',\n    trait_species: raw.trait_species ?? '',\n    trait_career:  raw.trait_career  ?? '',\n\n    // Canonical IDs (what PHP expects)\n    species_id: species,\n    career_id:  career,\n\n    // Compatibility fallbacks (older handlers / older code paths)\n    species,\n    career,\n\n    // structured blobs\n    // - send BOTH:\n    //   - skillMarks (object) for PHP cg_save_character()\n    //   - skill_marks (JSON string) for older/legacy paths (if any)\n    skillMarks:  marksObj,\n    skill_marks: JSON.stringify(marksObj),\n\n    // Career gift replacements (duplicate -> increase trait selections)\n    career_gift_replacements: giftReplacements,\n\n    traits_list: raw.traitsList ? JSON.stringify(raw.traitsList) : (raw.traits_list || ''),\n    skills_list: raw.skillsList ? JSON.stringify(raw.skillsList) : (raw.skills_list || ''),\n    gifts:       raw.gifts      ? JSON.stringify(raw.gifts)      : (raw.gifts || ''),\n\n    // free gifts (array + convenience slots)\n    free_gifts: freeArr,\n    free_gifts_json: JSON.stringify(freeArr),\n    free_gift_1: freeArr[0] || '',\n    free_gift_2: freeArr[1] || '',\n    free_gift_3: freeArr[2] || '',\n    'free-choice-0': freeArr[0] || '',\n    'free-choice-1': freeArr[1] || '',\n    'free-choice-2': freeArr[2] || ''\n  };\n}\n\n/**\n * Build a \"belt-and-suspenders\" payload:\n *  - flat fields\n *  - nested character[...] fields\n *  - character_json full JSON fallback\n * and include all common nonce keys.\n */\nfunction buildPayload(raw) {\n  const core = normalizeCore(raw);\n  const { nonce } = ajaxEnv();\n\n  const base = { action: 'cg_save_character' };\n  if (nonce) {\n    base.security    = nonce;\n    base.nonce       = nonce;\n    base._ajax_nonce = nonce;\n  }\n\n  // Flat fields \u2014 only include when present/non-empty\n  // (Primary save path is nested character[...] \u2014 flat is extra compatibility only.)\n  const flat = {\n    ...base,\n    ...(core.id            ? { id: core.id } : {}),\n    ...(core.name          ? { name: core.name } : {}),\n    ...(core.player_name   ? { player_name: core.player_name } : {}),\n    ...(core.age           ? { age: core.age } : {}),\n    ...(core.gender        ? { gender: core.gender } : {}),\n    ...(core.motto         ? { motto: core.motto } : {}),\n\n    ...(core.goal1 !== '' ? { goal1: core.goal1 } : {}),\n    ...(core.goal2 !== '' ? { goal2: core.goal2 } : {}),\n    ...(core.goal3 !== '' ? { goal3: core.goal3 } : {}),\n    ...(core.description !== '' ? { description: core.description } : {}),\n    ...(core.backstory   !== '' ? { backstory: core.backstory } : {}),\n\n    ...(core.will  !== ''  ? { will: core.will }   : {}),\n    ...(core.body  !== ''  ? { body: core.body }   : {}),\n    ...(core.mind  !== ''  ? { mind: core.mind }   : {}),\n    ...(core.speed !== ''  ? { speed: core.speed } : {}),\n    ...(core.trait_species !== '' ? { trait_species: core.trait_species } : {}),\n    ...(core.trait_career  !== '' ? { trait_career:  core.trait_career  } : {}),\n\n    // IMPORTANT: PHP expects these\n    ...(core.species_id    ? { species_id: core.species_id } : {}),\n    ...(core.career_id     ? { career_id:  core.career_id  } : {}),\n\n    // Back-compat\n    ...(core.species       ? { species: core.species } : {}),\n    ...(core.career        ? { career:  core.career  } : {}),\n\n    // Legacy JSON blobs (harmless even if unused)\n    ...(core.skill_marks   ? { skill_marks: core.skill_marks } : {}),\n    ...(core.traits_list   ? { traits_list: core.traits_list } : {}),\n    ...(core.skills_list   ? { skills_list: core.skills_list } : {}),\n    ...(core.gifts         ? { gifts: core.gifts } : {}),\n\n    // Free gifts: send JSON + per-slot keys\n    ...(core.free_gifts_json ? { free_gifts: core.free_gifts_json } : {}),\n    ...(core.free_gift_1     ? { free_gift_1: core.free_gift_1 } : {}),\n    ...(core.free_gift_2     ? { free_gift_2: core.free_gift_2 } : {}),\n    ...(core.free_gift_3     ? { free_gift_3: core.free_gift_3 } : {}),\n    ...(core['free-choice-0'] ? { 'free-choice-0': core['free-choice-0'] } : {}),\n    ...(core['free-choice-1'] ? { 'free-choice-1': core['free-choice-1'] } : {}),\n    ...(core['free-choice-2'] ? { 'free-choice-2': core['free-choice-2'] } : {})\n  };\n\n  // Nested character[...] mirrors the same fields (THIS is what PHP reads)\n  const character = {};\n\n\n  // CG_EC_PERSIST_REGEX_V1: payload \u2014 ensure PHP receives extra careers via character[...]\n  try {\n    const domVals = [];\n    try {\n      document.querySelectorAll('select.cg-extra-career-select').forEach(sel => {\n        const v = String(sel?.value || '').trim();\n        const n = parseInt(v, 10) || 0;\n        domVals.push(n > 0 ? String(n) : '');\n      });\n    } catch (_) {}\n    while (domVals.length < 2) domVals.push('');\n\n    const pick = (...vals) => {\n      for (const v of vals) {\n        if (v == null) continue;\n        const sv = String(v).trim();\n        const nv = parseInt(sv, 10) || 0;\n        if (nv > 0) return String(nv);\n      }\n      return '';\n    };\n\n    const arg0 = (arguments && arguments.length) ? (arguments[0] || {}) : {};\n    const ec1 = pick(arg0.extra_career_1, domVals[0]);\n    const ec2 = pick(arg0.extra_career_2, domVals[1]);\n\n    // authoritative (PHP reads character[...])\n    character.extra_career_1 = ec1;\n    character.extra_career_2 = ec2;\n\n    // flat compatibility (harmless)\n    flat.extra_career_1 = ec1;\n    flat.extra_career_2 = ec2;\n  } catch (_) {}\n\n  if (core.id)          character.id          = core.id;\n  if (core.name)        character.name        = core.name;\n\n  character.player_name = core.player_name || '';\n  character.age         = core.age || '';\n  character.gender      = core.gender || '';\n  character.motto       = core.motto || '';\n\n  character.goal1       = (core.goal1 ?? '');\n  character.goal2       = (core.goal2 ?? '');\n  character.goal3       = (core.goal3 ?? '');\n  character.description = (core.description ?? '');\n  character.backstory   = (core.backstory ?? '');\n\n  character.local_area  = (core.local_area ?? '');\n  character.language    = (core.language ?? '');\n\n  character.will          = (core.will ?? '');\n  character.body          = (core.body ?? '');\n  character.mind          = (core.mind ?? '');\n  character.speed         = (core.speed ?? '');\n  character.trait_species = (core.trait_species ?? '');\n  character.trait_career  = (core.trait_career  ?? '');\n\n  if (core.species_id)   character.species_id   = core.species_id;\n  if (core.career_id)    character.career_id    = core.career_id;\n\n  if (core.species)      character.species      = core.species;\n  if (core.career)       character.career       = core.career;\n\n  // IMPORTANT: what PHP reads for marks\n  character.skillMarks = core.skillMarks || {};\n\n  // Legacy JSON blobs (kept for compatibility with any older storage paths)\n  if (core.skill_marks)  character.skill_marks  = core.skill_marks;\n  if (core.traits_list)  character.traits_list  = core.traits_list;\n  if (core.skills_list)  character.skills_list  = core.skills_list;\n  if (core.gifts)        character.gifts        = core.gifts;\n\n  character.free_gifts      = core.free_gifts; // array\n  character.free_gift_1     = core.free_gift_1;\n  character.free_gift_2     = core.free_gift_2;\n  character.free_gift_3     = core.free_gift_3;\n  character['free-choice-0'] = core['free-choice-0'];\n  character['free-choice-1'] = core['free-choice-1'];\n  character['free-choice-2'] = core['free-choice-2'];\n\n  // Career gift replacements (duplicate -> increase trait selections)\n  character.career_gift_replacements = core.career_gift_replacements || {};\n\n  flat.character = character;\n\n  flat.character_json = JSON.stringify({ ...core });\n\n  return flat;\n}\n\nconst FormBuilderAPI = {\n  _data:   {},\n  isNew:   true,\n  hasData: false,\n\n  init(payload = {}) {\n    this._data   = { ...payload };\n    this.isNew   = Boolean(payload.isNew);\n    this.hasData = !this.isNew;\n\n    $('#cg-form-container').html(\n      FormBuilder.buildForm(this._data)\n    );\n  },\n\n  getData() {\n    return { ...this._data };\n  },\n\n  /**\n   * Read every form field from the DOM into a single payload object.\n   * HARDENED: if a field is not present in DOM (tab detached), fall back to in-memory _data.\n   */\n  collectFormData() {\n    const d = { ...(this._data || {}) };\n\n    const readIfExists = (selector) => {\n      const $el = $(selector);\n      if (!$el.length) return undefined;\n      const v = $el.val();\n      return (v == null) ? '' : v;\n    };\n\n    const normalize3 = (arr) => {\n      const out = Array.isArray(arr) ? arr.slice(0, 3) : [];\n      while (out.length < 3) out.push('');\n      return out.map(v => (v == null ? '' : String(v)));\n    };\n\n    const normalizeMarks = (src) => {\n      const out = {};\n      if (!src) return out;\n\n      if (Array.isArray(src)) {\n        for (const x of src) {\n          if (x == null) continue;\n\n          if (Array.isArray(x) && x.length >= 2) {\n            const k = x[0];\n            const v = x[1];\n            if (k != null) out[String(k)] = parseInt(v, 10) || 0;\n            continue;\n          }\n\n          if (typeof x === 'object') {\n            const k = x.skillId ?? x.skill_id ?? x.id ?? x.key ?? null;\n            const v = x.mark ?? x.value ?? x.val ?? x.marks ?? x.count ?? null;\n            if (k != null && v != null) out[String(k)] = parseInt(v, 10) || 0;\n          }\n        }\n        return out;\n      }\n\n      if (typeof src === 'object') {\n        for (const k of Object.keys(src)) {\n          out[String(k)] = parseInt(src[k], 10) || 0;\n        }\n        return out;\n      }\n\n      return out;\n    };\n\n    // Preserve existing ID (for updates)\n    if (this._data && this._data.id) d.id = this._data.id;\n\n    // Basic fields \u2014 only overwrite if the element exists\n    const basic = [\n      ['name',        '#cg-name'],\n      ['player_name', '#cg-player-name'],\n      ['age',         '#cg-age'],\n      ['gender',      '#cg-gender'],\n      ['motto',       '#cg-motto'],\n      ['goal1',       '#cg-goal1'],\n      ['goal2',       '#cg-goal2'],\n      ['goal3',       '#cg-goal3'],\n      ['description', '#cg-description'],\n      ['backstory',   '#cg-backstory']\n    ];\n\n    basic.forEach(([key, sel]) => {\n      const v = readIfExists(sel);\n      if (v !== undefined) d[key] = v;\n      if (d[key] == null) d[key] = '';\n    });\n\n    // Species & Career \u2014 prefer DOM if present; else fall back to memory/profile\n    const memSpecies = (this._data?.species_id ?? this._data?.species ?? this._data?.profile?.species ?? d.profile?.species ?? '');\n    const memCareer  = (this._data?.career_id  ?? this._data?.career  ?? this._data?.profile?.career  ?? d.profile?.career  ?? '');\n\n    const domSpecies = readIfExists('#cg-species');\n    const domCareer  = readIfExists('#cg-career');\n\n    const speciesVal = String((domSpecies !== undefined ? domSpecies : memSpecies) ?? '');\n    const careerVal  = String((domCareer  !== undefined ? domCareer  : memCareer ) ?? '');\n\n    d.species_id = speciesVal;\n    d.career_id  = careerVal;\n\n    d.species    = speciesVal;\n    d.career     = careerVal;\n\n    d.profile = (d.profile && typeof d.profile === 'object') ? d.profile : {};\n    d.profile.species = speciesVal;\n    d.profile.career  = careerVal;\n\n    this._data = this._data || {};\n    this._data.species_id = speciesVal;\n    this._data.career_id  = careerVal;\n    this._data.species    = speciesVal;\n    this._data.career     = careerVal;\n    this._data.profile    = (this._data.profile && typeof this._data.profile === 'object') ? this._data.profile : {};\n    this._data.profile.species = speciesVal;\n    this._data.profile.career  = careerVal;\n\n    // Traits \u2014 only overwrite if the select exists\n    TraitsService.TRAITS.forEach(key => {\n      const sel = `#cg-${key}`;\n      const v = readIfExists(sel);\n      if (v !== undefined) {\n        d[key] = v;\n        this._data[key] = v;\n      } else if (d[key] == null && this._data && this._data[key] != null) {\n        d[key] = this._data[key];\n      } else if (d[key] == null) {\n        d[key] = '';\n      }\n    });\n\n    // Skill marks:\n    // 1) start with in-memory (normalize array/object)\n    // 2) merge legacy inputs if present\n    // 3) CG_SKILLMARKS_DOMSCAN: merge from active mark buttons (Skills UI uses buttons)\n    const mergedMarks = { ...normalizeMarks(this._data.skillMarks) };\n\n    $('input.skill-marks').each((i, el) => {\n      const skillId = $(el).data('skill-id');\n      const val     = parseInt($(el).val(), 10) || 0;\n      if (skillId != null) mergedMarks[String(skillId)] = val;\n    });\n\n    // CG_SKILLMARKS_DOMSCAN:\n    // Skills UI uses buttons like .skill-mark-btn with data-skill-id + data-mark.\n    // Use any \"active/selected\" cue to infer current marks.\n    const btnMarks = {};\n    $('.skill-mark-btn').each((i, el) => {\n      const $b = $(el);\n      const isOn =\n        $b.hasClass('active') ||\n        $b.hasClass('is-active') ||\n        $b.hasClass('selected') ||\n        String($b.attr('aria-pressed') || '') === 'true' ||\n        String($b.data('active') || '') === '1' ||\n        String($b.attr('data-active') || '') === '1';\n\n      if (!isOn) return;\n\n      const sid = $b.data('skill-id');\n      const mk  = parseInt($b.data('mark'), 10) || 0;\n      const key = (sid == null) ? '' : String(sid);\n      if (!key) return;\n\n      if (btnMarks[key] == null || btnMarks[key] < mk) btnMarks[key] = mk;\n    });\n\n    if (Object.keys(btnMarks).length) {\n      Object.keys(btnMarks).forEach(k => { mergedMarks[String(k)] = btnMarks[k]; });\n    }\n\n    d.skillMarks = mergedMarks;\n    this._data.skillMarks = mergedMarks;\n\n    // Free-choice gifts:\n    const s0 = readIfExists('#cg-free-choice-0');\n    const s1 = readIfExists('#cg-free-choice-1');\n    const s2 = readIfExists('#cg-free-choice-2');\n\n    let freeArr;\n    if (s0 !== undefined || s1 !== undefined || s2 !== undefined) {\n      freeArr = normalize3([s0 ?? '', s1 ?? '', s2 ?? '']);\n    } else if (Array.isArray(this._data.free_gifts)) {\n      freeArr = normalize3(this._data.free_gifts);\n    } else if (Array.isArray(this._data.freeGifts)) {\n      freeArr = normalize3(this._data.freeGifts);\n    } else if (\n      this._data['free-choice-0'] != null ||\n      this._data['free-choice-1'] != null ||\n      this._data['free-choice-2'] != null\n    ) {\n      freeArr = normalize3([this._data['free-choice-0'], this._data['free-choice-1'], this._data['free-choice-2']]);\n    } else {\n      freeArr = normalize3([this._data.free_gift_1, this._data.free_gift_2, this._data.free_gift_3]);\n    }\n\n    d.free_gifts  = freeArr;\n    d.freeGifts   = freeArr.slice();\n    d.free_gift_1 = freeArr[0] || '';\n    d.free_gift_2 = freeArr[1] || '';\n    d.free_gift_3 = freeArr[2] || '';\n\n    d['free-choice-0'] = d.free_gift_1;\n    d['free-choice-1'] = d.free_gift_2;\n    d['free-choice-2'] = d.free_gift_3;\n\n    this._data.free_gifts   = freeArr.slice();\n    this._data.freeGifts    = freeArr.slice();\n    this._data.free_gift_1  = d.free_gift_1;\n    this._data.free_gift_2  = d.free_gift_2;\n    this._data.free_gift_3  = d.free_gift_3;\n    this._data['free-choice-0'] = d['free-choice-0'];\n    this._data['free-choice-1'] = d['free-choice-1'];\n    this._data['free-choice-2'] = d['free-choice-2'];\n\n    if (Array.isArray(window.CG_SKILLS_LIST)) d.skillsList = window.CG_SKILLS_LIST;\n\n    // CG_EC_PERSIST_REGEX_V1: persist extra-career ids (write into returned `d`; DOM is source-of-truth)\n    try {\n      const domVals = [];\n      try {\n        document.querySelectorAll('select.cg-extra-career-select').forEach(sel => {\n          const v = String(sel?.value || '').trim();\n          const n = parseInt(v, 10) || 0;\n          domVals.push(n > 0 ? String(n) : '');\n        });\n      } catch (_) {}\n      while (domVals.length < 2) domVals.push('');\n\n      const pick = (...vals) => {\n        for (const v of vals) {\n          if (v == null) continue;\n          const sv = String(v).trim();\n          const nv = parseInt(sv, 10) || 0;\n          if (nv > 0) return String(nv);\n        }\n        return '';\n      };\n\n      const ecs = Array.isArray(this._data?.extraCareers) ? this._data.extraCareers : null;\n      const v1 = pick(d.extra_career_1, this._data?.extra_career_1, ecs?.[0]?.id, domVals[0]);\n      const v2 = pick(d.extra_career_2, this._data?.extra_career_2, ecs?.[1]?.id, domVals[1]);\n\n      d.extra_career_1 = v1;\n      d.extra_career_2 = v2;\n      this._data.extra_career_1 = v1;\n      this._data.extra_career_2 = v2;\n    } catch (_) {}\n\n    // CG_CAREER_GIFT_REPLACEMENTS_PERSIST: collect replacement gift selections\n    try {\n      // Priority: DOM dropdowns > memory > empty\n      const domReplacements = {};\n      document.querySelectorAll('.cg-career-gift-replace').forEach(sel => {\n        const slot = sel.getAttribute('data-slot');\n        const val = sel.value;\n        if (slot && val && val !== '0') {\n          domReplacements[String(slot)] = String(val);\n        }\n      });\n\n      const memReplacements = this._data?.career_gift_replacements || {};\n\n      // Merge: DOM wins if present, but keep memory values for slots not in DOM\n      const merged = { ...memReplacements };\n      Object.keys(domReplacements).forEach(k => {\n        if (domReplacements[k]) {\n          merged[k] = domReplacements[k];\n        }\n      });\n\n      // Clean: only keep slots with non-empty values\n      const cleaned = {};\n      Object.keys(merged).forEach(k => {\n        const v = merged[k];\n        if (v && String(v).trim() && String(v) !== '0') {\n          cleaned[k] = String(v);\n        }\n      });\n\n      d.career_gift_replacements = cleaned;\n      this._data.career_gift_replacements = cleaned;\n    } catch (_) {\n      d.career_gift_replacements = this._data?.career_gift_replacements || {};\n    }\n\n    return d;\n  },\n\n  /**\n   * Save the character via WP-AJAX and optionally close builder.\n   * Guarded to prevent double-save if multiple click handlers exist.\n   */\n  save(shouldClose = false) {\n    if (window.CG_SAVE_IN_FLIGHT) {\n      console.warn('[FormBuilderAPI] save() blocked: CG_SAVE_IN_FLIGHT already true');\n      return $.Deferred().reject('in-flight').promise();\n    }\n\n    window.CG_SAVE_IN_FLIGHT = true;\n\n    const raw = this.collectFormData();\n    console.log(\"[CG_SAVE_DEBUG_SKILLMARKS]\", Object.keys(((raw && raw.skillMarks) ? raw.skillMarks : {})).length, ((raw && raw.skillMarks) ? raw.skillMarks : {}));\n    console.log('[FormBuilderAPI] \u25B6 save()', raw);\n\n    const { url } = ajaxEnv();\n    if (!url) {\n      window.CG_SAVE_IN_FLIGHT = false;\n      console.error('[FormBuilderAPI] save(): No AJAX URL available');\n      alert('Save error: missing AJAX URL');\n      return $.Deferred().reject('no-url').promise();\n    }\n\n    const data = buildPayload(raw);\n\n    const req = $.post(url, data);\n\n    req\n      .done(res => {\n        try { res = (typeof res === 'string') ? JSON.parse(res) : res; } catch (_) {}\n        if (!res || res.success !== true) {\n          console.error('[FormBuilderAPI] save.error()', res);\n          alert('Save failed: ' + (res?.data || 'Invalid payload.'));\n          return;\n        }\n\n        if (res.data?.id) {\n          this._data = { ...this._data, id: res.data.id };\n        }\n        this.isNew   = false;\n        this.hasData = true;\n\n        BuilderUI.markClean();\n        if (shouldClose) {\n          BuilderUI.closeBuilder();\n        } else {\n          alert('Character saved');\n        }\n\n        document.dispatchEvent(new CustomEvent('cg:character:saved',    { detail: { id: res.data?.id || raw.id || null, record: raw } }));\n        document.dispatchEvent(new CustomEvent('cg:characters:refresh', { detail: {} }));\n      })\n      .fail((xhr, status, err) => {\n        console.error('[FormBuilderAPI] save.fail()', status, err, xhr?.responseText);\n        alert('Save failed\u2014check console for details.');\n      })\n      .always(() => {\n        window.CG_SAVE_IN_FLIGHT = false;\n      });\n\n    return req;\n  },\n\n  listCharacters() {\n    const { url, nonce } = ajaxEnv();\n    return $.ajax({\n      url,\n      method: 'POST',\n      data: {\n        action:   'cg_load_characters',\n        security: nonce\n      }\n    });\n  },\n\n  fetchCharacter(id) {\n    const { url, nonce } = ajaxEnv();\n    console.log('[FormBuilderAPI] fetchCharacter() called with ID:', id);\n    return $.ajax({\n      url,\n      method: 'POST',\n      data: {\n        action:   'cg_get_character',\n        id,\n        security: nonce\n      }\n    });\n  }\n};\n\nexport default FormBuilderAPI;\n\n\n// CG_EC_PERSIST_REGEX_V1: window alias (debug)\ntry {\n  window.FormBuilderAPI = window.FormBuilderAPI || FormBuilderAPI;\n  window.CG_FormBuilderAPI = window.CG_FormBuilderAPI || FormBuilderAPI;\n} catch (_) {}\n", "// assets/js/src/core/species/events.js\r\n// One-time, namespaced bindings for Species select.\r\n// Fetches + normalizes profile, stores it on SpeciesAPI.currentProfile,\r\n// renders Profile tab species gifts, and announces via cg:species:changed.\r\n\r\nimport SpeciesAPI from './api.js';\r\n\r\nconst $ = window.jQuery;\r\nlet _bound = false;\r\n\r\n// Normalize various backend shapes into something our renderers expect.\r\nfunction normalizeSpeciesProfile(raw = {}) {\r\n  const out = { ...raw };\r\n\r\n  // A readable name used by Skills/Summary headers\r\n  out.speciesName =\r\n    raw.speciesName ||\r\n    raw.species_name ||\r\n    raw.ct_species_name ||\r\n    raw.name ||\r\n    raw.title ||\r\n    '';\r\n\r\n  // Ensure skill ids are strings (Skills module compares as strings)\r\n  if (raw.skill_one   != null) out.skill_one   = String(raw.skill_one);\r\n  if (raw.skill_two   != null) out.skill_two   = String(raw.skill_two);\r\n  if (raw.skill_three != null) out.skill_three = String(raw.skill_three);\r\n\r\n  // Gifts referenced by Traits service (id fields)\r\n  ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\r\n    if (raw[k] != null) out[k] = String(raw[k]);\r\n  });\r\n\r\n  // Manifold counts (default 1)\r\n  ['manifold_1', 'manifold_2', 'manifold_3'].forEach(k => {\r\n    if (raw[k] != null) out[k] = parseInt(raw[k], 10) || 1;\r\n  });\r\n\r\n  return out;\r\n}\r\n\r\nfunction renderGiftList($ul, items = []) {\r\n  if (!$ul || !$ul.length) return;\r\n  $ul.empty();\r\n  items.forEach(txt => {\r\n    if (!txt) return;\r\n    $ul.append(`<li>${txt}</li>`);\r\n  });\r\n}\r\n\r\nfunction namesFromProfile(profile = {}) {\r\n  // Prefer gift_1..gift_3 (names), otherwise nothing\r\n  const names = [profile.gift_1, profile.gift_2, profile.gift_3]\r\n    .map(v => (v == null ? '' : String(v)))\r\n    .filter(Boolean);\r\n  // Add \u00D7 manifold if > 1\r\n  return names.map((name, i) => {\r\n    const m = profile[`manifold_${i+1}`];\r\n    const mult = parseInt(m, 10) || 1;\r\n    return mult > 1 ? `${name} \u00D7 ${mult}` : name;\r\n  });\r\n}\r\n\r\nexport default function bindSpeciesEvents() {\r\n  if (_bound) return;\r\n  _bound = true;\r\n\r\n  $(document)\r\n    .off('change.cg', '#cg-species')\r\n    .on('change.cg', '#cg-species', e => {\r\n      const val = (e.currentTarget && e.currentTarget.value) || '';\r\n      console.log('[SpeciesEvents] selected species \u2192', val);\r\n\r\n      if (!val) {\r\n        SpeciesAPI.currentProfile = null;\r\n        renderGiftList($('#species-gift-block'), []);\r\n        $(document).trigger('cg:species:changed', [{ id: '', profile: null }]);\r\n        return;\r\n      }\r\n\r\n      SpeciesAPI.fetchProfile(val).done(profileRaw => {\r\n        const profile = normalizeSpeciesProfile(profileRaw || {});\r\n        SpeciesAPI.currentProfile = profile;\r\n\r\n        // Render gifts (from profile)\r\n        const giftNames = namesFromProfile(profile);\r\n        renderGiftList($('#species-gift-block'), giftNames);\r\n\r\n        $(document).trigger('cg:species:changed', [{ id: String(val), profile }]);\r\n      });\r\n    });\r\n}\r\n", "// assets/js/src/core/species/index.js\r\n// Coordinates Species API + events + select population/refetch\r\n\r\nimport SpeciesAPI from './api.js';\r\nimport bindSpeciesEvents from './events.js';\r\n\r\nconst SpeciesIndex = {\r\n  _init: false,\r\n\r\n  /**\r\n   * One-time init: bind change events and populate the select if present.\r\n   */\r\n  init() {\r\n    if (this._init) return;\r\n    this._init = true;\r\n\r\n    // Bind the #cg-species change handler (idempotent inside the module)\r\n    bindSpeciesEvents();\r\n\r\n    // Initial population if the select exists\r\n    const sel = document.querySelector('#cg-species');\r\n    if (sel) {\r\n      SpeciesAPI.populateSelect(sel);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * Refresh the species <select>. Will repopulate if empty or when force=true.\r\n   * @param {{force?: boolean}} opts\r\n   * @returns {Promise<void>|void}\r\n   */\r\n  refresh(opts = {}) {\r\n    const sel = document.querySelector('#cg-species');\r\n    if (!sel) return;\r\n\r\n    const force = !!opts.force || (sel.options.length <= 1);\r\n    return SpeciesAPI.populateSelect(sel, { force });\r\n  }\r\n};\r\n\r\nexport default SpeciesIndex;\r\n", "// assets/js/src/core/career/events.js\n// One-time, namespaced bindings for Career select.\n// Fetches + normalizes profile, stores it on CareerAPI.currentProfile,\n// renders Profile tab gifts, and announces via cg:career:changed.\n//\n// Jan 2026: If a non-repeatable Career gift duplicates a Species gift,\n// replace that Career gift slot with a dropdown that lets the user pick\n// an \"Increase Trait\" gift instead (e.g., Donkey + Soldier both grant Hiking).\n//\n// CareerEvents v2026-01-04c:\n// - Preserve saved career_gift_replacements during transient empty-career states\n// - Listen to BOTH jQuery + native species change events (prevents missed rerender)\n// - After render, explicitly set dropdown values (defensive against later resets)\n\nimport CareerAPI from './api.js';\nimport SpeciesAPI from '../species/api.js';\n\nconst $ = window.jQuery;\nlet _bound = false;\n\nlet _giftWaitTries = 0;\nlet _giftWaitTimer = null;\n\nfunction normalizeCareerProfile(raw = {}) {\n  const out = { ...raw };\n\n  out.careerName =\n    raw.careerName ||\n    raw.career_name ||\n    raw.ct_career_name ||\n    raw.name ||\n    raw.title ||\n    '';\n\n  if (raw.skill_one   != null) out.skill_one   = String(raw.skill_one);\n  if (raw.skill_two   != null) out.skill_two   = String(raw.skill_two);\n  if (raw.skill_three != null) out.skill_three = String(raw.skill_three);\n\n  ['gift_id_1', 'gift_id_2', 'gift_id_3'].forEach(k => {\n    if (raw[k] != null) out[k] = String(raw[k]);\n  });\n\n  ['manifold_1', 'manifold_2', 'manifold_3'].forEach(k => {\n    if (raw[k] != null) out[k] = parseInt(raw[k], 10) || 1;\n  });\n\n  return out;\n}\n\nfunction escapeHtml(s) {\n  return String(s ?? '')\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#039;');\n}\n\nfunction normalizeReplacementMap(src) {\n  if (!src) return {};\n  if (typeof src === 'string') {\n    try { return normalizeReplacementMap(JSON.parse(src)); }\n    catch (_) { return {}; }\n  }\n  if (Array.isArray(src)) {\n    const out = {};\n    src.forEach(it => {\n      const slot = it?.slot ?? it?.key ?? it?.k;\n      const id   = it?.id   ?? it?.value ?? it?.v;\n      if (slot != null && id != null && String(id)) out[String(slot)] = String(id);\n    });\n    return out;\n  }\n  if (typeof src === 'object') {\n    const out = {};\n    Object.keys(src).forEach(k => {\n      const v = src[k];\n      if (v != null && String(v)) out[String(k)] = String(v);\n    });\n    return out;\n  }\n  return {};\n}\n\nfunction getAllGiftsList() {\n  return (window.CG_FreeChoices && Array.isArray(window.CG_FreeChoices._allGifts))\n    ? window.CG_FreeChoices._allGifts\n    : [];\n}\n\nfunction byIdMap(all = []) {\n  const map = Object.create(null);\n  all.forEach(g => {\n    if (!g || g.id == null) return;\n    map[String(g.id)] = g;\n  });\n  return map;\n}\n\nfunction isRepeatableGift(g) {\n  if (!g) return false;\n  if (g.allows_multiple) return true;\n\n  const m = parseInt(g.ct_gifts_manifold, 10);\n  if (!Number.isNaN(m) && m > 1) return true;\n\n  const m2 = parseInt(g.manifold, 10);\n  if (!Number.isNaN(m2) && m2 > 1) return true;\n\n  return false;\n}\n\nfunction increaseTraitGifts(all = []) {\n  const inc = (all || [])\n    .filter(g => g && g.id != null)\n    .filter(g => {\n      const nm = String(g.name || g.title || g.ct_gift_name || '');\n      return /^Increase\\s+/i.test(nm) || /Increased Trait/i.test(nm);\n    })\n    .map(g => ({ id: String(g.id), name: String(g.name || g.title || g.ct_gift_name || `Gift #${g.id}`) }));\n\n  inc.sort((a, b) => a.name.localeCompare(b.name));\n  return inc;\n}\n\nfunction getFormBuilderData() {\n  const fb = window.CG_FormBuilderAPI || window.FormBuilderAPI || null;\n  return fb && fb._data ? fb._data : null;\n}\n\nfunction setFormBuilderCareerReplacements(map) {\n  const d = getFormBuilderData();\n  if (!d) return;\n  d.career_gift_replacements = map;\n}\n\nfunction _hasKeys(obj) {\n  try { return !!obj && typeof obj === 'object' && Object.keys(obj).length > 0; }\n  catch (_) { return false; }\n}\n\nfunction _shouldPreserveOnEmptyCareer(e) {\n  const isUser = !!(e && e.originalEvent);\n  if (isUser) return false;\n\n  const d = getFormBuilderData();\n  if (!d) return false;\n\n  const fbCareer = String(d.career_id ?? d.career ?? '').trim();\n  if (!fbCareer) return false;\n\n  const repl = normalizeReplacementMap(d.career_gift_replacements);\n  return _hasKeys(repl);\n}\n\nfunction renderCareerGiftsWithReplacements(profile) {\n  const $ul = $('#career-gifts');\n  if (!$ul || !$ul.length) return;\n\n  const sp = SpeciesAPI?.currentProfile || null;\n  const spIds = new Set(\n    (sp ? [sp.gift_id_1, sp.gift_id_2, sp.gift_id_3] : [])\n      .filter(v => v != null && String(v))\n      .map(v => String(v))\n  );\n\n  const all = getAllGiftsList();\n  const idMap = byIdMap(all);\n  const inc = increaseTraitGifts(all);\n\n  if (!all.length) {\n    const li = [];\n    for (let i = 1; i <= 3; i++) {\n      const name = profile[`gift_${i}`] || '';\n      const gid  = profile[`gift_id_${i}`] || '';\n      const mult = parseInt(profile[`manifold_${i}`], 10) || 1;\n\n      const display = name ? String(name) : (gid ? `Gift #${gid}` : '');\n      if (!display) continue;\n\n      li.push(`<li>${escapeHtml(mult > 1 ? `${display} \u00D7 ${mult}` : display)}</li>`);\n    }\n    $ul.html(li.join(''));\n\n    if (_giftWaitTries < 10) {\n      _giftWaitTries++;\n      clearTimeout(_giftWaitTimer);\n      _giftWaitTimer = setTimeout(() => renderCareerGiftsWithReplacements(profile), 350);\n    }\n    return;\n  }\n\n  _giftWaitTries = 0;\n  clearTimeout(_giftWaitTimer);\n  _giftWaitTimer = null;\n\n  const labels = ['Career Gift One', 'Career Gift Two', 'Career Gift Three'];\n\n  const savedFromFB = normalizeReplacementMap(getFormBuilderData()?.career_gift_replacements);\n  const savedFromProfile = normalizeReplacementMap(profile.career_gift_replacements);\n  const saved = { ...savedFromFB, ...savedFromProfile };\n\n  const neededSlots = new Set();\n  const li = [];\n\n  for (let i = 1; i <= 3; i++) {\n    const gid  = profile[`gift_id_${i}`] || '';\n    const mult = parseInt(profile[`manifold_${i}`], 10) || 1;\n\n    const fromProfileName = profile[`gift_${i}`] || '';\n    const fromAllName = gid && idMap[String(gid)]\n      ? (idMap[String(gid)].name || idMap[String(gid)].title || idMap[String(gid)].ct_gift_name || '')\n      : '';\n    const baseName = String(fromProfileName || fromAllName || (gid ? `Gift #${gid}` : ''));\n\n    if (!gid && !baseName) continue;\n\n    const dupeWithSpecies = gid && spIds.has(String(gid));\n    const repeatable = dupeWithSpecies ? isRepeatableGift(idMap[String(gid)]) : false;\n    const needsReplace = !!(dupeWithSpecies && !repeatable);\n\n    if (!needsReplace) {\n      const txt = mult > 1 ? `${baseName} \u00D7 ${mult}` : baseName;\n      li.push(`<li>${escapeHtml(txt)}</li>`);\n      continue;\n    }\n\n    neededSlots.add(String(i));\n\n    const current = saved[String(i)] || '';\n    const selectId = `cg-career-gift-replace-${i}`;\n\n    let selectHtml = '';\n    if (!inc.length) {\n      selectHtml = `<select id=\"${escapeHtml(selectId)}\" class=\"cg-profile-select cg-career-gift-replace\" data-slot=\"${escapeHtml(i)}\" disabled>\n        <option value=\"\">(No \u201CIncrease Trait\u201D gifts found)</option>\n      </select>`;\n    } else {\n      const opts = inc\n        .map(g => `<option value=\"${escapeHtml(g.id)}\"${String(g.id) === String(current) ? ' selected' : ''}>${escapeHtml(g.name)}</option>`)\n        .join('');\n      selectHtml = `<select id=\"${escapeHtml(selectId)}\" class=\"cg-profile-select cg-career-gift-replace\" data-slot=\"${escapeHtml(i)}\">\n        <option value=\"\">\u2014 Choose an Increase Trait gift \u2014</option>\n        ${opts}\n      </select>`;\n    }\n\n    li.push(\n      `<li class=\"cg-career-gift-line cg-career-gift-line--replace\" style=\"display:flex; align-items:center; gap:6px;\">\n        <span style=\"white-space:nowrap;\">Duplicate: ${escapeHtml(baseName)} \u2192</span>\n        ${selectHtml}\n      </li>`\n    );\n  }\n\n  const cleaned = {};\n  Object.keys(saved).forEach(k => {\n    if (neededSlots.has(String(k)) && saved[k]) cleaned[String(k)] = String(saved[k]);\n  });\n\n  profile.career_gift_replacements = cleaned;\n  CareerAPI.currentProfile = profile;\n  setFormBuilderCareerReplacements(cleaned);\n\n  $ul.html(li.join(''));\n\n  // Defensive: explicitly set values after DOM insert (in case another renderer resets selects)\n  setTimeout(() => {\n    try {\n      neededSlots.forEach(slot => {\n        const v = cleaned[String(slot)] || '';\n        const el = document.getElementById(`cg-career-gift-replace-${slot}`);\n        if (el && v) el.value = String(v);\n      });\n    } catch (_) {}\n  }, 0);\n}\n\nfunction _rerenderFromSpeciesChange() {\n  if (!CareerAPI.currentProfile) return;\n  renderCareerGiftsWithReplacements(CareerAPI.currentProfile);\n}\n\nexport default function bindCareerEvents() {\n  if (_bound) return;\n  _bound = true;\n\n  try {\n    window.__CG_BUILD_MARKERS__ = window.__CG_BUILD_MARKERS__ || {};\n    window.__CG_BUILD_MARKERS__.CareerEvents = 'v2026-01-04c';\n  } catch (_) {}\n\n  // Replacement dropdown changes (delegated)\n  $(document)\n    .off('change.cg', '#career-gifts .cg-career-gift-replace')\n    .on('change.cg', '#career-gifts .cg-career-gift-replace', e => {\n      const sel = e.currentTarget;\n      const slot = (sel && sel.dataset && sel.dataset.slot) ? String(sel.dataset.slot) : '';\n      const val  = (sel && sel.value) ? String(sel.value) : '';\n\n      const profile = CareerAPI.currentProfile || null;\n      if (!profile || !slot) return;\n\n      const map = normalizeReplacementMap(profile.career_gift_replacements);\n      if (!val) delete map[slot];\n      else map[slot] = val;\n\n      profile.career_gift_replacements = map;\n      CareerAPI.currentProfile = profile;\n      setFormBuilderCareerReplacements(map);\n\n      const careerId = String($('#cg-career').val() || '');\n      $(document).trigger('cg:career:changed', [{ id: careerId, profile }]);\n      $(document).trigger('cg:free-gift:changed', [{ source: 'career-replacement' }]);\n    });\n\n  // Career select change\n  $(document)\n    .off('change.cg', '#cg-career')\n    .on('change.cg', '#cg-career', e => {\n      const val = (e.currentTarget && e.currentTarget.value) || '';\n      console.log('[CareerEvents] selected career \u2192', val);\n\n      if (!val) {\n        const preserve = _shouldPreserveOnEmptyCareer(e);\n\n        CareerAPI.currentProfile = null;\n        $('#career-gifts').empty();\n\n        if (!preserve) {\n          setFormBuilderCareerReplacements({});\n        } else {\n          try {\n            const d = getFormBuilderData();\n            console.log('[CareerEvents] empty career during load; preserving career_gift_replacements', {\n              career: String(d?.career_id ?? d?.career ?? ''),\n              repl: normalizeReplacementMap(d?.career_gift_replacements)\n            });\n          } catch (_) {}\n        }\n\n        $(document).trigger('cg:career:changed', [{ id: '', profile: null }]);\n        return;\n      }\n\n      CareerAPI.fetchProfile(val).done(profileRaw => {\n        const profile = normalizeCareerProfile(profileRaw || {});\n\n        const saved = normalizeReplacementMap(getFormBuilderData()?.career_gift_replacements);\n        if (Object.keys(saved).length) profile.career_gift_replacements = saved;\n\n        CareerAPI.currentProfile = profile;\n\n        renderCareerGiftsWithReplacements(profile);\n\n        $(document).trigger('cg:career:changed', [{ id: String(val), profile }]);\n      });\n    });\n\n  // --- Species change: listen via BOTH jQuery + native CustomEvent ---\n  // jQuery path (if Species module uses $(document).trigger(...))\n  $(document)\n    .off('cg:species:changed.careergifts.cg')\n    .on('cg:species:changed.careergifts.cg', _rerenderFromSpeciesChange);\n\n  // Native path (if Species module uses document.dispatchEvent(new CustomEvent(...)))\n  try {\n    window.__CG_EVT__ = window.__CG_EVT__ || {};\n    if (window.__CG_EVT__.speciesChangedCareerGiftsNative) {\n      document.removeEventListener('cg:species:changed', window.__CG_EVT__.speciesChangedCareerGiftsNative);\n    }\n    window.__CG_EVT__.speciesChangedCareerGiftsNative = _rerenderFromSpeciesChange;\n    document.addEventListener('cg:species:changed', window.__CG_EVT__.speciesChangedCareerGiftsNative);\n  } catch (_) {}\n}\n", "// assets/js/src/core/career/extra.js\n//\n// Extra careers (Gift 184) + \"Increased Trait: Career\" targeting (Gift 223)\n//\n// Current behavior (Jan 2026):\n// - Extra Career selection UI lives on the Profile tab\n// - Extra Career trait dice display lives on the Traits tab\n// - Gift 223 targeting UI appears INLINE next to each free-choice slot that is set to 223\n//   (per-copy targeting: each free-choice copy gets its own target <select>)\n// - Any non-free-choice copies of 223 (species/career gifts) default to Main Career\n\nimport FormBuilderAPI from '../formBuilder';\nimport SpeciesAPI from '../species/api.js';\nimport CareerAPI from './api.js';\nimport GiftsState from '../gifts/state.js';\n\nconst $ = window.jQuery;\n\nconst LOG  = (...a) => console.log('[ExtraCareers]', ...a);\nconst WARN = (...a) => console.warn('[ExtraCareers]', ...a);\n\nconst EXTRA_CAREER_GIFT_ID = '184';\nconst INC_TRAIT_CAREER_GIFT_ID = '223'; // \"Increased Trait: Career\"\n\n// Legacy single-target key (migration only)\nconst BOOST_TARGET_KEY_LEGACY = 'increased_trait_career_target';\n\n// Per-copy keys (per free-choice slot)\nconst BOOST_TARGET_KEY_PREFIX = 'increased_trait_career_target_'; // + slotIndex (0..2)\n\nconst ALWAYS_ACQUIRED_GIFT_IDS = ['242', '236']; // Local Knowledge, Language\n\nconst BOOST_TARGET_STYLE_ID  = 'cg-inc-trait-career-target-inline-style';\n\nfunction boostKey(slot) { return `${BOOST_TARGET_KEY_PREFIX}${slot}`; }\nfunction boostSelectId(slot) { return `cg-inc-trait-career-target-${slot}`; }\n\nfunction ajaxEnv() {\n  const env = window.CG_AJAX || window.CG_Ajax || window.cgAjax || {};\n  const ajax_url =\n    env.ajax_url ||\n    window.ajaxurl ||\n    document.body?.dataset?.ajaxUrl ||\n    '/wp-admin/admin-ajax.php';\n\n  const perAction = (window.CG_NONCES && window.CG_NONCES.cg_get_career_gifts)\n    ? window.CG_NONCES.cg_get_career_gifts\n    : null;\n\n  const generic = env.nonce || env.security || env._ajax_nonce || window.CG_NONCE || null;\n  return { ajax_url, nonce: (perAction || generic) };\n}\n\nfunction parseJsonMaybe(res) {\n  try { return (typeof res === 'string') ? JSON.parse(res) : res; }\n  catch (_) { return res; }\n}\n\nfunction normalizeCareerProfile(raw = {}) {\n  const out = (raw && typeof raw === 'object') ? { ...raw } : {};\n\n  out.careerName =\n    raw.careerName ||\n    raw.career_name ||\n    raw.ct_career_name ||\n    raw.name ||\n    raw.title ||\n    '';\n\n  ['gift_id_1','gift_id_2','gift_id_3','skill_one','skill_two','skill_three'].forEach(k => {\n    if (out[k] != null) out[k] = String(out[k]);\n  });\n\n  out.skills = [out.skill_one, out.skill_two, out.skill_three]\n    .map(v => (v ? String(v) : ''))\n    .filter(Boolean);\n\n  return out;\n}\n\nfunction stepDie(die, steps) {\n  const order = ['d4', 'd6', 'd8', 'd10', 'd12'];\n  const d = String(die || '').toLowerCase();\n  const i = order.indexOf(d);\n  if (i === -1) return die || '';\n  const s = Math.max(0, parseInt(steps, 10) || 0);\n  return order[Math.min(order.length - 1, i + s)];\n}\n\nfunction escapeHtml(s) {\n  return String(s ?? '')\n    .replaceAll('&','&amp;')\n    .replaceAll('<','&lt;')\n    .replaceAll('>','&gt;')\n    .replaceAll('\"','&quot;')\n    .replaceAll(\"'\", '&#39;');\n}\n\nconst ExtraCareers = {\n  _inited: false,\n  _bound: false,\n\n  _profileCache: new Map(),   // careerId -> normalized profile\n  _profilePromise: new Map(), // careerId -> in-flight promise\n\n  _eligibleCacheKey: '',\n  _eligibleCache: [],\n\n  init() {\n    if (this._inited) return;\n    this._inited = true;\n\n    try { GiftsState.init?.(); } catch (_) {}\n\n    this._bindOnce();\n\n    // Native listeners must be idempotent across accidental double-enqueue / double-boot.\n    try {\n      window.__CG_EVT__ = window.__CG_EVT__ || {};\n      const EVT = window.__CG_EVT__;\n\n      if (EVT.extraCareersOnBuilderOpened) {\n        document.removeEventListener('cg:builder:opened', EVT.extraCareersOnBuilderOpened);\n      }\n      if (EVT.extraCareersOnCharacterLoaded) {\n        document.removeEventListener('cg:character:loaded', EVT.extraCareersOnCharacterLoaded);\n      }\n      if (EVT.extraCareersOnFreeGiftChanged) {\n        document.removeEventListener('cg:free-gift:changed', EVT.extraCareersOnFreeGiftChanged);\n      }\n\n      EVT.extraCareersOnBuilderOpened    = () => ExtraCareers.render();\n      EVT.extraCareersOnCharacterLoaded  = () => ExtraCareers.render();\n      EVT.extraCareersOnFreeGiftChanged  = () => ExtraCareers.render();\n\n      document.addEventListener('cg:builder:opened',   EVT.extraCareersOnBuilderOpened);\n      document.addEventListener('cg:character:loaded', EVT.extraCareersOnCharacterLoaded);\n      document.addEventListener('cg:free-gift:changed', EVT.extraCareersOnFreeGiftChanged);\n    } catch (e) {\n      try { WARN('idempotent native listener bind failed', e); } catch (_) {}\n    }\n\n    if ($) {\n      $(document)\n        .off('cg:species:changed.cgextra cg:career:changed.cgextra cg:free-gift:changed.cgextra')\n        .on('cg:species:changed.cgextra cg:career:changed.cgextra cg:free-gift:changed.cgextra', () => this.render());\n    }\n\n    setTimeout(() => this.render(), 0);\n  },\n\n  _bindOnce() {\n    if (this._bound || !$) return;\n    this._bound = true;\n\n    // Delegated change handler for any extra-career select\n    $(document)\n      .off('change.cgextra', '.cg-extra-career-select')\n      .on('change.cgextra', '.cg-extra-career-select', async (e) => {\n        const el = e.currentTarget;\n        const idx = parseInt(el.getAttribute('data-index') || '0', 10);\n        const careerId = String(el.value || '');\n\n        await this._setSelection(idx, careerId);\n        this.render();\n      });\n\n    // Delegated change handler for per-copy Gift-223 target selects\n    $(document)\n      .off('change.cgextra', '.cg-inc-trait-career-target-select')\n      .on('change.cgextra', '.cg-inc-trait-career-target-select', (e) => {\n        const el = e.currentTarget;\n        const slot = parseInt(el.getAttribute('data-slot') || '-1', 10);\n        const v = String(el.value || 'main') || 'main';\n        if (slot >= 0) this._setBoostTargetForSlot(slot, v);\n        this.render();\n      });\n  },\n\n  _getWrap() {\n    return document.querySelector('#cg-extra-careers') || null;\n  },\n\n  _getTraitsWrap() {\n    return document.querySelector('#cg-extra-career-traits') || null;\n  },\n\n  _hideProfileDiceBadges() {\n    try {\n      const badge = document.getElementById('cg-profile-trait_career-badge');\n      if (badge) badge.style.display = 'none';\n    } catch (_) {}\n  },\n\n  _readExtraCareersFromData() {\n    const d = FormBuilderAPI?._data || {};\n\n    if (Array.isArray(d.extraCareers)) return d.extraCareers.map(x => ({ ...x }));\n\n    if (typeof d.extra_careers === 'string' && d.extra_careers.trim()) {\n      try {\n        const arr = JSON.parse(d.extra_careers);\n        if (Array.isArray(arr)) return arr.map(x => ({ ...x }));\n      } catch (_) {}\n    }\n\n    const out = [];\n    for (let i = 1; i <= 6; i++) {\n      const key = `extra_career_${i}`;\n      if (!Object.prototype.hasOwnProperty.call(d, key)) continue;\n      const id = d[key] ? String(d[key]) : '';\n      out.push({ id, name: '', skills: [] });\n    }\n\n    if (!out.length && Object.prototype.hasOwnProperty.call(d, 'extra_career_0')) {\n      const id0 = d.extra_career_0 ? String(d.extra_career_0) : '';\n      if (id0) out.push({ id: id0, name: '', skills: [] });\n    }\n\n    return out;\n  },\n\n  _writeExtraCareersToData(list) {\n    const normalized = (Array.isArray(list) ? list : [])\n      .filter(x => x && x.id)\n      .map(x => ({\n        id: String(x.id),\n        name: String(x.name || ''),\n        skills: Array.isArray(x.skills) ? x.skills.map(String).filter(Boolean) : []\n      }));\n\n    const __cgr2 = FormBuilderAPI._data?.career_gift_replacements;\n\n    FormBuilderAPI._data = {\n      ...(FormBuilderAPI._data || {}),\n      extraCareers: normalized,\n      extra_careers: JSON.stringify(normalized),\n      career_gift_replacements: __cgr2 || {}\n    };\n\n    normalized.forEach((x, i) => {\n      const k = i + 1;\n      FormBuilderAPI._data[`extra_career_${k}`] = String(x.id);\n    });\n    for (let k = normalized.length + 1; k <= 6; k++) {\n      delete FormBuilderAPI._data[`extra_career_${k}`];\n    }\n    delete FormBuilderAPI._data.extra_career_0;\n  },\n\n  _emitChanged() {\n    const payload = { extraCareers: (FormBuilderAPI._data?.extraCareers || []) };\n    document.dispatchEvent(new CustomEvent('cg:extra-careers:changed', { detail: payload }));\n    if ($) $(document).trigger('cg:extra-careers:changed', [payload]);\n  },\n\n  _countGiftInAcquired(giftId) {\n    const target = String(giftId);\n    let count = 0;\n\n    const dFB = FormBuilderAPI?._data || {};\n    let free = (Array.isArray(GiftsState.selected) && GiftsState.selected.length)\n      ? GiftsState.selected\n      : null;\n\n    if (!free) {\n      if (Array.isArray(dFB.free_gifts) && dFB.free_gifts.length) free = dFB.free_gifts;\n      else if (Array.isArray(dFB.freeGifts) && dFB.freeGifts.length) free = dFB.freeGifts;\n      else {\n        free = [];\n        ['free-choice-0','free-choice-1','free-choice-2'].forEach(k => {\n          const v = dFB[k];\n          if (v != null && String(v).trim()) free.push(String(v));\n        });\n      }\n    }\n\n    free = Array.isArray(free) ? free : [];\n    free.forEach(id => { if (String(id) === target) count++; });\n\n    const sp = SpeciesAPI?.currentProfile || null;\n    if (sp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => {\n        if (sp[k] != null && String(sp[k]) === target) count++;\n      });\n    }\n\n    const cp = CareerAPI?.currentProfile || null;\n    if (cp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => {\n        if (cp[k] != null && String(cp[k]) === target) count++;\n      });\n    }\n\n    return count;\n  },\n\n  _mainCareerId() {\n    const dom = document.querySelector('#cg-career');\n    if (dom && dom.value) return String(dom.value);\n\n    const d = FormBuilderAPI?._data || {};\n    return String(d.career_id || d.career || '');\n  },\n\n  _mainCareerName() {\n    const dom = document.querySelector('#cg-career');\n    if (dom) {\n      const opt = dom.options?.[dom.selectedIndex];\n      const txt = opt ? opt.textContent : '';\n      if (txt) return String(txt).trim();\n    }\n    return 'Main Career';\n  },\n\n  _careerTraitBaseDie() {\n    const dom =\n      document.querySelector('#cg-trait_career') ||\n      document.querySelector('#cg-trait-career') ||\n      document.querySelector('select[name=\"trait_career\"]') ||\n      document.querySelector('select[data-trait=\"career\"]');\n\n    const data = FormBuilderAPI?.getData ? FormBuilderAPI.getData() : (FormBuilderAPI?._data || {});\n\n    const v =\n      (dom && dom.value) ? String(dom.value) :\n      (data && (data.trait_career || data.traitCareer)) ? String(data.trait_career || data.traitCareer) :\n      '';\n\n    return (v && v.trim()) ? v.trim() : 'd4';\n  },\n\n  _countExtraCareerUnlocks() {\n    let count = 0;\n\n    const free = Array.isArray(GiftsState.selected) ? GiftsState.selected : [];\n    free.forEach(id => { if (String(id) === EXTRA_CAREER_GIFT_ID) count++; });\n\n    const sp = SpeciesAPI?.currentProfile || null;\n    if (sp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => {\n        if (sp[k] != null && String(sp[k]) === EXTRA_CAREER_GIFT_ID) count++;\n      });\n    }\n\n    const cp = CareerAPI?.currentProfile || null;\n    if (cp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => {\n        if (cp[k] != null && String(cp[k]) === EXTRA_CAREER_GIFT_ID) count++;\n      });\n    }\n\n    return count;\n  },\n\n  _acquiredGiftSet() {\n    const set = new Set();\n    ALWAYS_ACQUIRED_GIFT_IDS.forEach(id => set.add(String(id)));\n\n    const free = Array.isArray(GiftsState.selected) ? GiftsState.selected : [];\n    free.forEach(id => { if (id) set.add(String(id)); });\n\n    const sp = SpeciesAPI?.currentProfile || null;\n    if (sp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => {\n        if (sp[k] != null && String(sp[k])) set.add(String(sp[k]));\n      });\n    }\n\n    const cp = CareerAPI?.currentProfile || null;\n    if (cp) {\n      ['gift_id_1','gift_id_2','gift_id_3'].forEach(k => {\n        if (cp[k] != null && String(cp[k])) set.add(String(cp[k]));\n      });\n    }\n\n    return set;\n  },\n\n  _getCareerProfile(careerId) {\n    const id = String(careerId || '');\n    if (!id) return Promise.resolve(null);\n\n    if (this._profileCache.has(id)) return Promise.resolve(this._profileCache.get(id));\n    if (this._profilePromise.has(id)) return this._profilePromise.get(id);\n\n    const { ajax_url, nonce } = ajaxEnv();\n    if (!ajax_url) return Promise.resolve(null);\n\n    const payload = { action: 'cg_get_career_gifts', id };\n    if (nonce) {\n      payload.security = nonce;\n      payload.nonce = nonce;\n      payload._ajax_nonce = nonce;\n    }\n\n    const cleanup = () => { this._profilePromise.delete(id); };\n\n    const req = ($ && $.post) ? $.post(ajax_url, payload) : null;\n\n    const p = (req ? req : Promise.resolve(null)).then(\n      (res) => {\n        const json = parseJsonMaybe(res);\n        const raw =\n          (json && json.success === true) ? json.data :\n          (json && json.success === undefined) ? json :\n          null;\n\n        if (!raw) return null;\n\n        const prof = normalizeCareerProfile(raw);\n        this._profileCache.set(id, prof);\n        return prof;\n      },\n      () => null\n    );\n\n    if (req && typeof req.always === 'function') req.always(cleanup);\n    else if (p && typeof p.finally === 'function') p.finally(cleanup);\n    else setTimeout(cleanup, 0);\n\n    this._profilePromise.set(id, p);\n    return p;\n  },\n\n  async _computeEligibleCareers() {\n    let mainCareerId = String(this._mainCareerId() || '').trim();\n    let mainCareerIdNum = parseInt(mainCareerId, 10) || 0;\n\n    if (mainCareerIdNum <= 0) {\n      for (let i = 0; i < 24 && mainCareerIdNum <= 0; i++) {\n        await new Promise(r => setTimeout(r, 25));\n        mainCareerId = String(this._mainCareerId() || '').trim();\n        mainCareerIdNum = parseInt(mainCareerId, 10) || 0;\n      }\n    }\n\n    mainCareerId = (mainCareerIdNum > 0) ? String(mainCareerIdNum) : '';\n\n    if (mainCareerIdNum > 0 && CareerAPI && typeof CareerAPI.fetchProfile === 'function') {\n      try {\n        const curId = String(CareerAPI.currentProfileId || '');\n        const want = String(mainCareerIdNum);\n        if (!CareerAPI.currentProfile || curId !== want) {\n          await Promise.resolve(CareerAPI.fetchProfile(want));\n          CareerAPI.currentProfileId = want;\n        }\n      } catch (_) {}\n    }\n\n    const acquired = this._acquiredGiftSet();\n    const key = [mainCareerId, ...Array.from(acquired).sort()].join('|');\n\n    if (key === this._eligibleCacheKey && Array.isArray(this._eligibleCache)) {\n      return this._eligibleCache.slice();\n    }\n\n    let list = await CareerAPI.getList(false);\n    let careers = Array.isArray(list) ? list : [];\n    const listHasExt = careers.some(c => c && (\n      c.gift_id_1 != null || c.gift_id_2 != null || c.gift_id_3 != null ||\n      c.skill_one != null || c.skill_two != null || c.skill_three != null\n    ));\n\n    if (!listHasExt) {\n      list = await CareerAPI.getList(true);\n      careers = Array.isArray(list) ? list : [];\n    }\n\n    const results = [];\n    for (const c of careers) {\n      const id = String(c?.id || '');\n      const name = String(c?.name || '');\n      if (!id || !name) continue;\n\n      if (mainCareerIdNum > 0 && String(mainCareerIdNum) === id) continue;\n\n      const g1 = (c?.gift_id_1 != null) ? String(c.gift_id_1) : '';\n      const g2 = (c?.gift_id_2 != null) ? String(c.gift_id_2) : '';\n      const g3 = (c?.gift_id_3 != null) ? String(c.gift_id_3) : '';\n      const listHasGiftIds = Boolean(g1 || g2 || g3);\n\n      let required = [];\n      let skills = [];\n\n      if (listHasGiftIds) {\n        required = [g1, g2, g3].filter(v => v && v !== '0');\n\n        const s1 = (c?.skill_one != null) ? String(c.skill_one) : '';\n        const s2 = (c?.skill_two != null) ? String(c.skill_two) : '';\n        const s3 = (c?.skill_three != null) ? String(c.skill_three) : '';\n        skills = [s1, s2, s3].filter(v => v && v !== '0');\n      } else {\n        const prof = await this._getCareerProfile(id);\n        if (!prof) continue;\n\n        required = [prof.gift_id_1, prof.gift_id_2, prof.gift_id_3]\n          .map(v => (v ? String(v) : ''))\n          .filter(Boolean);\n\n        if (Array.isArray(prof.skills) && prof.skills.length) skills = prof.skills.slice();\n        else {\n          const s1 = (prof.skill_one != null) ? String(prof.skill_one) : '';\n          const s2 = (prof.skill_two != null) ? String(prof.skill_two) : '';\n          const s3 = (prof.skill_three != null) ? String(prof.skill_three) : '';\n          skills = [s1, s2, s3].filter(v => v && v !== '0');\n        }\n      }\n\n      const eligible = required.every(gid => acquired.has(String(gid)));\n      if (!eligible) continue;\n\n      results.push({ id, name, skills });\n    }\n\n    const eligibleSorted = results.sort((a, b) => String(a.name).localeCompare(String(b.name)));\n\n    this._eligibleCacheKey = key;\n    this._eligibleCache = eligibleSorted.slice();\n\n    return eligibleSorted;\n  },\n\n  async _setSelection(slotIndex, careerId) {\n    const idx = parseInt(slotIndex, 10) || 0;\n\n    const unlocks = this._countExtraCareerUnlocks();\n    const maxSlots = Math.max(0, unlocks);\n\n    let list = this._readExtraCareersFromData();\n    while (list.length < maxSlots) list.push({ id: '', name: '', skills: [] });\n    list = list.slice(0, maxSlots);\n\n    if (!careerId) {\n      list[idx] = { id: '', name: '', skills: [] };\n      list = list.filter(x => x && x.id);\n      this._writeExtraCareersToData(list);\n      this._emitChanged();\n      return;\n    }\n\n    let name = '';\n    try {\n      const eligible = await this._computeEligibleCareers();\n      const hit = eligible.find(x => String(x.id) === String(careerId));\n      if (hit) name = hit.name || '';\n    } catch (_) {}\n\n    const prof = await this._getCareerProfile(careerId);\n    const skills = Array.isArray(prof?.skills) ? prof.skills.slice() : [];\n\n    list[idx] = { id: String(careerId), name: String(name || prof?.careerName || ''), skills };\n\n    const seen = new Set();\n    list = list.filter(x => {\n      if (!x || !x.id) return false;\n      const id = String(x.id);\n      if (seen.has(id)) return false;\n      seen.add(id);\n      return true;\n    });\n\n    this._writeExtraCareersToData(list);\n    this._emitChanged();\n  },\n\n  _eligibleSelectedIdSet(selectedCareers) {\n    return new Set((selectedCareers || []).map(x => String(x?.id || '')).filter(Boolean));\n  },\n\n  _getBoostTargetForSlot(slot) {\n    const d = FormBuilderAPI?._data || {};\n    const v = d[boostKey(slot)];\n    if (v != null && String(v).trim()) return String(v).trim();\n\n    // Legacy migration fallback\n    const legacy = d[BOOST_TARGET_KEY_LEGACY];\n    if (legacy != null && String(legacy).trim()) return String(legacy).trim();\n\n    return 'main';\n  },\n\n  _setBoostTargetForSlot(slot, targetValue) {\n    const v = String(targetValue || 'main') || 'main';\n    const __cgr = FormBuilderAPI._data?.career_gift_replacements;\n    FormBuilderAPI._data = {\n      ...(FormBuilderAPI._data || {}),\n      [boostKey(slot)]: v,\n      career_gift_replacements: __cgr || {}\n    };\n\n    // If legacy key exists, remove it to avoid future confusion\n    try { delete FormBuilderAPI._data[BOOST_TARGET_KEY_LEGACY]; } catch (_) {}\n\n    document.dispatchEvent(new CustomEvent('cg:traits:changed', { detail: { [boostKey(slot)]: v } }));\n    if ($) $(document).trigger('cg:traits:changed', [{ [boostKey(slot)]: v }]);\n  },\n\n  _findFreeChoiceSelectsFor223() {\n    const out = [];\n    for (let i = 0; i <= 2; i++) {\n      const el = document.getElementById(`cg-free-choice-${i}`);\n      if (el && String(el.value || '') === INC_TRAIT_CAREER_GIFT_ID) out.push({ slot: i, el });\n    }\n    return out;\n  },\n\n  _ensureBoostTargetInlineStyles() {\n    try {\n      if (document.getElementById(BOOST_TARGET_STYLE_ID)) return;\n      const st = document.createElement('style');\n      st.id = BOOST_TARGET_STYLE_ID;\n      st.textContent = `\n        .cg-free-slot--boosttarget {\n          display: flex;\n          gap: 12px;\n          align-items: center;\n          flex-wrap: wrap;\n        }\n        .cg-free-slot--boosttarget .cg-inc-trait-career-target-label {\n          font-weight: 600;\n          white-space: nowrap;\n          opacity: .85;\n        }\n        .cg-free-slot--boosttarget .cg-inc-trait-career-target-select {\n          min-width: 220px;\n          width: auto;\n        }\n        @media (max-width: 520px) {\n          .cg-free-slot--boosttarget {\n            flex-direction: column;\n            align-items: stretch;\n          }\n          .cg-free-slot--boosttarget .cg-inc-trait-career-target-label {\n            width: 100%;\n          }\n          .cg-free-slot--boosttarget .cg-inc-trait-career-target-select {\n            width: 100%;\n          }\n        }\n      `;\n      document.head.appendChild(st);\n    } catch (_) {}\n  },\n\n  _removeBoostTargetInlineUIForSlot(slot) {\n    const sid = boostSelectId(slot);\n    const sel = document.getElementById(sid);\n    let wrap = null;\n\n    if (sel) {\n      try { wrap = sel.closest('.cg-free-slot') || sel.parentElement; } catch (_) { wrap = sel.parentElement; }\n      try { sel.remove(); } catch (_) {}\n    }\n\n    if (wrap) {\n      const lbl = wrap.querySelector(`.cg-inc-trait-career-target-label[data-slot=\"${slot}\"]`);\n      if (lbl) { try { lbl.remove(); } catch (_) {} }\n\n      // If no more target selects inside, remove the wrapper marker class\n      if (!wrap.querySelector('select[id^=\"cg-inc-trait-career-target-\"]')) {\n        try { wrap.classList.remove('cg-free-slot--boosttarget'); } catch (_) {}\n      }\n    }\n  },\n\n  _cleanupBoostTargetData(activeSlotsSet) {\n    const d = FormBuilderAPI?._data || {};\n    for (let i = 0; i <= 2; i++) {\n      if (!activeSlotsSet.has(i)) {\n        try { delete d[boostKey(i)]; } catch (_) {}\n      }\n    }\n    // also drop legacy key once we're in per-slot world\n    try { delete d[BOOST_TARGET_KEY_LEGACY]; } catch (_) {}\n  },\n\n  _ensureBoostTargetInlineUI(selectedCareers) {\n    const boostsTotal = this._countGiftInAcquired(INC_TRAIT_CAREER_GIFT_ID);\n    const selected = Array.isArray(selectedCareers) ? selectedCareers.filter(x => x && x.id) : [];\n    const targets = this._findFreeChoiceSelectsFor223();\n\n    const shouldShow = (boostsTotal > 0) && (selected.length > 0) && (targets.length > 0);\n\n    // Always remove any stale slot UI that no longer has 223\n    const activeSlots = new Set(targets.map(t => t.slot));\n    for (let i = 0; i <= 2; i++) {\n      if (!activeSlots.has(i)) this._removeBoostTargetInlineUIForSlot(i);\n    }\n    this._cleanupBoostTargetData(activeSlots);\n\n    if (!shouldShow) return;\n\n    this._ensureBoostTargetInlineStyles();\n\n    const selectedIds = this._eligibleSelectedIdSet(selected);\n\n    // Legacy migration: if legacy exists and per-slot keys are missing, seed them\n    try {\n      const d = FormBuilderAPI?._data || {};\n      const legacy = (d[BOOST_TARGET_KEY_LEGACY] != null) ? String(d[BOOST_TARGET_KEY_LEGACY]).trim() : '';\n      if (legacy) {\n        targets.forEach(({ slot }) => {\n          if (d[boostKey(slot)] == null || String(d[boostKey(slot)]).trim() === '') {\n            d[boostKey(slot)] = legacy;\n          }\n        });\n        delete d[BOOST_TARGET_KEY_LEGACY];\n      }\n    } catch (_) {}\n\n    // Build options (Main + selected extra careers)\n    const mainLabel = this._mainCareerName();\n    const options = [{ value: 'main', label: `Main Career \u2014 ${mainLabel}` }]\n      .concat(selected.map(x => ({ value: String(x.id), label: `Extra Career \u2014 ${String(x.name || 'Extra Career')}` })));\n\n    // Ensure each active slot gets its own inline selector\n    targets.forEach(({ slot, el }) => {\n      let wrap = null;\n      try { wrap = el.closest('.cg-free-slot'); } catch (_) { wrap = null; }\n      if (!wrap) wrap = el.parentElement;\n      if (!wrap) return;\n\n      try { wrap.classList.add('cg-free-slot--boosttarget'); } catch (_) {}\n\n      // Label\n      let lbl = wrap.querySelector(`.cg-inc-trait-career-target-label[data-slot=\"${slot}\"]`);\n      if (!lbl) {\n        lbl = document.createElement('span');\n        lbl.className = 'cg-inc-trait-career-target-label';\n        lbl.setAttribute('data-slot', String(slot));\n        lbl.textContent = 'Applies to:';\n        // Insert right after the Gift-223 free-choice select\n        try { el.insertAdjacentElement('afterend', lbl); }\n        catch (_) { wrap.appendChild(lbl); }\n      }\n\n      // Select\n      const sid = boostSelectId(slot);\n      let sel = document.getElementById(sid);\n      if (!sel) {\n        sel = document.createElement('select');\n        sel.id = sid;\n        sel.className = 'cg-profile-select cg-inc-trait-career-target-select';\n        sel.setAttribute('data-slot', String(slot));\n      }\n\n      // Put it immediately after the label\n      if (sel.parentElement !== wrap) {\n        try { wrap.appendChild(sel); } catch (_) {}\n      }\n      try {\n        if (lbl.nextSibling !== sel) lbl.insertAdjacentElement('afterend', sel);\n      } catch (_) {}\n\n      // Fill options\n      sel.innerHTML = '';\n      options.forEach(o => sel.appendChild(new Option(o.label, o.value)));\n\n      // Validate saved value\n      let v = this._getBoostTargetForSlot(slot);\n\n      if (v !== 'main' && !selectedIds.has(String(v))) v = 'main';\n\n      // Persist coerced value if needed\n      const curSaved = this._getBoostTargetForSlot(slot);\n      if (String(curSaved) !== String(v)) this._setBoostTargetForSlot(slot, v);\n\n      sel.value = String(v);\n    });\n  },\n\n  _computeCareerBoostCounts(selectedCareers) {\n    const total = this._countGiftInAcquired(INC_TRAIT_CAREER_GIFT_ID);\n    const counts = Object.create(null);\n    counts.main = 0;\n\n    const selected = Array.isArray(selectedCareers) ? selectedCareers.filter(x => x && x.id) : [];\n    const selectedIds = this._eligibleSelectedIdSet(selected);\n\n    // Assign one boost per free-choice slot that is set to 223 (per-copy targeting)\n    const targets = this._findFreeChoiceSelectsFor223();\n\n    let assigned = 0;\n\n    for (const t of targets) {\n      if (assigned >= total) break; // safety: if totals mismatch, don't go negative\n      const slot = t.slot;\n\n      let v = this._getBoostTargetForSlot(slot);\n      if (v !== 'main' && !selectedIds.has(String(v))) v = 'main';\n\n      counts[v] = (counts[v] || 0) + 1;\n      assigned++;\n    }\n\n    // Remaining copies (e.g., from species/career gifts) default to main\n    const remaining = Math.max(0, total - assigned);\n    if (remaining) counts.main = (counts.main || 0) + remaining;\n\n    return counts;\n  },\n\n  _careerTraitDisplayWithCounts(targetKey, boostCounts) {\n    const base = this._careerTraitBaseDie();\n    const count = Math.max(0, parseInt((boostCounts && boostCounts[targetKey]) || 0, 10) || 0);\n\n    if (count <= 0) return { base, adjusted: base, boosts: 0, suffix: '' };\n\n    const adjusted = stepDie(base, count);\n    const suffix = count === 1 ? 'Increased by gift' : `Increased by gift \u00D7${count}`;\n    return { base, adjusted, boosts: count, suffix };\n  },\n\n  _renderTraitsTabExtraCareerDice(unlocks, selected, baseTrait, boostCounts) {\n    const traitsWrap = this._getTraitsWrap();\n    if (!traitsWrap) return;\n\n    if (!unlocks) {\n      traitsWrap.innerHTML = '';\n      return;\n    }\n\n    const rows = [];\n\n    for (let i = 0; i < unlocks; i++) {\n      const curId = selected[i]?.id ? String(selected[i].id) : '';\n      const name = curId\n        ? String(selected[i].name || `Extra Career ${i + 1}`)\n        : `Extra Career ${i + 1}`;\n\n      const traitInfo = curId\n        ? this._careerTraitDisplayWithCounts(String(curId), boostCounts)\n        : { adjusted: baseTrait, suffix: '' };\n\n      const shownDie = traitInfo.adjusted || baseTrait || 'd4';\n      const note = (curId && traitInfo.suffix) ? traitInfo.suffix : '';\n\n      rows.push(`\n        <div class=\"cg-extra-career-trait-row\">\n          <span class=\"cg-extra-career-trait-name\">${escapeHtml(name)}</span>\n          <span class=\"cg-trait-badge cg-trait-badge--sm\" aria-label=\"Career trait die\">${escapeHtml(shownDie)}</span>\n        </div>\n        ${note ? `<div class=\"trait-adjusted\">${escapeHtml(note)}</div>` : `<div class=\"trait-adjusted\"></div>`}\n      `);\n    }\n\n    traitsWrap.innerHTML = `\n      <h4>Extra Careers</h4>\n      ${rows.join('')}\n    `;\n  },\n\n  async render() {\n    const wrap = this._getWrap();\n    const traitsWrap = this._getTraitsWrap();\n\n    if (!wrap && traitsWrap) {\n      traitsWrap.innerHTML = '';\n      // still clean per-slot UI if builder remount happens\n      for (let i = 0; i <= 2; i++) this._removeBoostTargetInlineUIForSlot(i);\n      return;\n    }\n    if (!wrap) return;\n\n    const unlocks = this._countExtraCareerUnlocks();\n\n    if (!unlocks) {\n      wrap.innerHTML = '';\n      if (traitsWrap) traitsWrap.innerHTML = '';\n      this._writeExtraCareersToData([]);\n      this._emitChanged();\n\n      for (let i = 0; i <= 2; i++) this._removeBoostTargetInlineUIForSlot(i);\n      return;\n    }\n\n    wrap.innerHTML = `<div class=\"cg-extra-careers-loading\">Loading eligible extra careers\u2026</div>`;\n\n    let eligible = [];\n    try {\n      eligible = await this._computeEligibleCareers();\n    } catch (e) {\n      WARN('eligible compute failed', e);\n      eligible = [];\n    }\n\n    let selected = this._readExtraCareersFromData();\n    while (selected.length < unlocks) selected.push({ id: '', name: '', skills: [] });\n    selected = selected.slice(0, unlocks);\n\n    const eligibleIds = new Set(eligible.map(x => String(x.id)));\n    let changed = false;\n\n    selected = selected.map(x => {\n      if (!x || !x.id) return { id: '', name: '', skills: [] };\n      if (!eligibleIds.has(String(x.id))) { changed = true; return { id: '', name: '', skills: [] }; }\n      return x;\n    });\n\n    if (changed) {\n      this._writeExtraCareersToData(selected.filter(x => x.id));\n      this._emitChanged();\n    }\n\n    const selectedWithId = selected.filter(x => x && x.id);\n    const boostCounts = this._computeCareerBoostCounts(selectedWithId);\n\n    const baseTrait = this._careerTraitBaseDie();\n\n    // Populate the Traits tab extra-career dice display\n    this._renderTraitsTabExtraCareerDice(unlocks, selected, baseTrait, boostCounts);\n\n    const otherSelectedIds = (slot) => {\n      const set = new Set();\n      selected.forEach((x, i) => {\n        if (i === slot) return;\n        if (x && x.id) set.add(String(x.id));\n      });\n      return set;\n    };\n\n    const blockHtml = [];\n    for (let i = 0; i < unlocks; i++) {\n      const cur = selected[i]?.id ? String(selected[i].id) : '';\n      const exclude = otherSelectedIds(i);\n\n      const options = eligible\n        .filter(c => !exclude.has(String(c.id)) || String(c.id) === cur)\n        .map(c => {\n          const sel = (String(c.id) === cur) ? ' selected' : '';\n          return `<option value=\"${String(c.id)}\"${sel}>${escapeHtml(String(c.name))}</option>`;\n        })\n        .join('');\n\n      const traitInfo = cur\n        ? this._careerTraitDisplayWithCounts(String(cur), boostCounts)\n        : { suffix: '' };\n\n      const note = (cur && traitInfo.suffix) ? traitInfo.suffix : '';\n\n      blockHtml.push(`\n        <div class=\"cg-extra-career-block\">\n          <label for=\"cg-extra-career-${i}\">Extra Career ${i + 1}</label>\n\n          <div class=\"cg-trait-control cg-trait-control--profile cg-trait-control--extra\">\n            <select\n              id=\"cg-extra-career-${i}\"\n              class=\"cg-profile-select cg-extra-career-select\"\n              data-index=\"${i}\"\n            >\n              <option value=\"\">\u2014 Select Career \u2014</option>\n              ${options}\n            </select>\n          </div>\n\n          <div class=\"trait-adjusted\">${note ? escapeHtml(note) : ''}</div>\n        </div>\n      `);\n    }\n\n    wrap.innerHTML = `${blockHtml.join('')}`;\n\n    // Inline per-copy selectors next to each free-choice slot that is set to Gift 223\n    this._ensureBoostTargetInlineUI(selectedWithId);\n    setTimeout(() => this._ensureBoostTargetInlineUI(selectedWithId), 0);\n\n    this._hideProfileDiceBadges();\n\n    const needsHydrate = selected.some(x => x && x.id && (!Array.isArray(x.skills) || !x.skills.length));\n    if (needsHydrate) {\n      const hydrated = [];\n      for (let i = 0; i < selected.length; i++) {\n        const x = selected[i];\n        if (!x || !x.id) continue;\n        const prof = await this._getCareerProfile(x.id);\n        hydrated.push({\n          id: String(x.id),\n          name: String(x.name || prof?.careerName || ''),\n          skills: Array.isArray(prof?.skills) ? prof.skills.slice() : []\n        });\n      }\n      this._writeExtraCareersToData(hydrated);\n      this._emitChanged();\n    }\n\n    LOG('rendered', unlocks, 'slot(s). baseTrait:', baseTrait, 'boostCounts:', boostCounts);\n  }\n};\n\nwindow.CG_ExtraCareers = ExtraCareers;\nexport default ExtraCareers;\n", "// assets/js/src/core/career/index.js\n// Coordinates Career API + events + select population/refetch\n// + boots ExtraCareers module (Gift 184).\n\nimport CareerAPI from './api.js';\nimport bindCareerEvents from './events.js';\nimport ExtraCareers from './extra.js';\n\nconst CareerIndex = {\n  _init: false,\n\n  /**\n   * One-time init: bind change events and populate the select if present.\n   */\n  init() {\n    if (this._init) return;\n    this._init = true;\n\n    // Bind the #cg-career change handler (idempotent inside the module)\n    bindCareerEvents();\n\n    // Boot extra-career feature (idempotent internally)\n    try { ExtraCareers.init(); } catch (_) {}\n\n    // Initial population if the select exists\n    const sel = document.querySelector('#cg-career');\n    if (sel) {\n      CareerAPI.populateSelect(sel).catch?.(() => {});\n    }\n  },\n\n  /**\n   * Refresh the career <select>. Will repopulate if empty or when force=true.\n   * @param {{force?: boolean}} opts\n   * @returns {Promise<void>|void}\n   */\n  refresh(opts = {}) {\n    const sel = document.querySelector('#cg-career');\n    if (!sel) return;\n\n    const force = !!opts.force || (sel.options.length <= 1);\n    const p = CareerAPI.populateSelect(sel, { force }).catch?.(() => {});\n\n    // Also nudge extra-careers to re-render (new profile may change acquired gifts)\n    try { ExtraCareers.render?.(); } catch (_) {}\n\n    return p;\n  }\n};\n\nexport default CareerIndex;\n", "// assets/js/src/core/main/builder-ui.js\n// Ensures Species/Career lists populate on open and on load,\n// binds robust change flows so gifts/other tabs refresh.\n\nimport FormBuilderAPI from '../formBuilder';\nimport SpeciesIndex   from '../species';\nimport CareerIndex    from '../career';\n\nconst $ = window.jQuery;\n\nlet isDirty = false;\n\nconst SELECTORS = {\n  // Include #cg-* as canonical IDs (current formBuilder renders these).\n  species: ['#cg-species', 'select[name=\"species\"]', 'select[data-cg=\"species\"]', 'select.cg-species'],\n  career:  ['#cg-career',  'select[name=\"career\"]',  'select[data-cg=\"career\"]',  'select.cg-career'],\n};\n\nfunction first(selectorList, root = document) {\n  for (let i = 0; i < selectorList.length; i++) {\n    const el = root.querySelector(selectorList[i]);\n    if (el) return el;\n  }\n  return null;\n}\n\nfunction waitForSelects(timeoutMs = 2000) {\n  return new Promise(resolve => {\n    const start = Date.now();\n    (function tick() {\n      const speciesEl = first(SELECTORS.species);\n      const careerEl  = first(SELECTORS.career);\n      if (speciesEl && careerEl) return resolve({ speciesEl, careerEl });\n      if (Date.now() - start > timeoutMs) return resolve({ speciesEl, careerEl });\n      setTimeout(tick, 50);\n    })();\n  });\n}\n\nasync function ensureListsThenApply(record = {}) {\n  // Ask feature modules to build/bind (idempotent).\n  SpeciesIndex.init();\n  CareerIndex.init();\n\n  // Wait for selects to exist (form may render async).\n  const { speciesEl, careerEl } = await waitForSelects();\n\n  // Populate options if empty (feature modules handle globals/AJAX and dedupe).\n  if (speciesEl && speciesEl.options.length <= 1) SpeciesIndex.refresh();\n  if (careerEl  && careerEl.options.length  <= 1) CareerIndex.refresh();\n\n  // Apply record selections (id or name), then fire change so downstream recalcs run.\n  if (speciesEl) {\n    const want = record.species ?? record.species_id ?? '';\n    if (want) {\n      $(speciesEl).val(String(want));\n      if ($(speciesEl).val() !== String(want)) {\n        // try by visible text as fallback\n        const byName = [...speciesEl.options].find(o => o.textContent === String(want));\n        if (byName) $(speciesEl).val(byName.value);\n      }\n      $(speciesEl).trigger('change');\n    }\n  }\n\n  if (careerEl) {\n    const want = record.career ?? record.career_id ?? '';\n    if (want) {\n      $(careerEl).val(String(want));\n      if ($(careerEl).val() !== String(want)) {\n        const byName = [...careerEl.options].find(o => o.textContent === String(want));\n        if (byName) $(careerEl).val(byName.value);\n      }\n      $(careerEl).trigger('change');\n    }\n  }\n}\n\nfunction activateDefaultTab() {\n  try {\n    const $details = $('#cg-modal .cg-tabs li[data-tab=\"tab-details\"]');\n    if ($details.length) {\n      $details.trigger('click');\n      return;\n    }\n    // Fallback: first tab\n    const $first = $('#cg-modal .cg-tabs li').first();\n    if ($first.length) $first.trigger('click');\n  } catch (_) {}\n}\n\nfunction openBuilder({ isNew = false, payload = {} } = {}) {\n  console.log('[BuilderUI] openBuilder()', { isNew, payload });\n\n  isDirty = false;\n  $('#cg-unsaved-confirm, #cg-unsaved-backdrop').hide().css('display', 'none');\n\n  try { FormBuilderAPI?.init?.({ ...payload, isNew }); } catch (e) {\n    console.error('[BuilderUI] FormBuilderAPI.init error', e);\n  }\n\n  $('#cg-modal-overlay, #cg-modal')\n    .removeClass('cg-hidden')\n    .addClass('cg-visible')\n    .css('display', 'block');\n\n  // Always open on Details tab (user expectation).\n  activateDefaultTab();\n\n  // Critically: (re)build species/career options and push changes downstream.\n  ensureListsThenApply(payload).then(() => {\n    document.dispatchEvent(new CustomEvent('cg:builder:opened', { detail: { isNew, payload } }));\n  });\n}\n\nfunction closeBuilder() {\n  $('#cg-unsaved-backdrop').hide().css('display', 'none');\n  $('#cg-unsaved-confirm').removeClass('cg-visible').addClass('cg-hidden').hide().css('display', 'none');\n  $('#cg-modal, #cg-modal-overlay')\n    .removeClass('cg-visible')\n    .addClass('cg-hidden')\n    .fadeOut(200, () => {\n      $('#cg-form-container').empty();\n      document.dispatchEvent(new CustomEvent('cg:builder:closed'));\n    });\n  isDirty = false;\n}\n\nfunction markDirty()  { isDirty = true;  }\nfunction markClean()  { isDirty = false; }\nfunction getIsDirty() { return isDirty;  }\n\nfunction showUnsaved() {\n  if (!$('#cg-unsaved-backdrop').length) $('<div id=\"cg-unsaved-backdrop\"></div>').appendTo('body');\n  const $b = $('#cg-unsaved-backdrop'); const $p = $('#cg-unsaved-confirm');\n  if (!$p.parent().is('body')) $p.appendTo('body');\n  $b.show().css('display', 'block');\n  $p.removeClass('cg-hidden').addClass('cg-visible').show().css('display', 'block');\n}\n\nfunction hideUnsaved() {\n  $('#cg-unsaved-backdrop').hide().css('display', 'none');\n  $('#cg-unsaved-confirm').removeClass('cg-visible').addClass('cg-hidden').hide().css('display', 'none');\n}\n\n// Idempotent native listener: cg:character:loaded\n// IMPORTANT: do NOT also bind any legacy fallback handler (that\u2019s what caused the duplicate in DIST).\ntry {\n  window.__CG_EVT__ = window.__CG_EVT__ || {};\n  const EVT = window.__CG_EVT__;\n\n  if (EVT.builderUICharacterLoaded) {\n    document.removeEventListener('cg:character:loaded', EVT.builderUICharacterLoaded);\n  }\n\n  EVT.builderUICharacterLoaded = (ev) => {\n    const record = ev?.detail || {};\n    console.log('[BuilderUI] cg:character:loaded \u2192 rehydrate for record', record);\n    ensureListsThenApply(record);\n  };\n\n  document.addEventListener('cg:character:loaded', EVT.builderUICharacterLoaded);\n} catch (e) {\n  console.error('[BuilderUI] failed to bind idempotent cg:character:loaded listener', e);\n}\n\nexport default {\n  open: openBuilder,\n  openBuilder,\n  close: closeBuilder,\n  closeBuilder,\n  showUnsaved,\n  hideUnsaved,\n  markDirty,\n  markClean,\n  getIsDirty,\n};\n", "// binds DOM events for traits\n\nimport TraitsService from './service.js';\n\nconst $ = window.jQuery;\n\n// Coalesce multiple Traits refresh requests into at most one refresh per tick.\n// Also prevents re-entrant storms if upstream events fire while refreshAll() is running.\nlet _cgTraitsRefreshQueued  = false;\nlet _cgTraitsRefreshRunning = false;\nlet _cgTraitsRefreshPending = false;\n\nfunction scheduleTraitsRefresh(reason = 'auto') {\n  // If we're mid-refresh, mark that we owe one more refresh and bail.\n  if (_cgTraitsRefreshRunning) {\n    _cgTraitsRefreshPending = true;\n    return;\n  }\n\n  if (_cgTraitsRefreshQueued) return;\n  _cgTraitsRefreshQueued = true;\n\n  const run = () => {\n    _cgTraitsRefreshQueued = false;\n    _cgTraitsRefreshRunning = true;\n\n    try {\n      TraitsService.refreshAll();\n    } catch (e) {\n      console.error('[Traits] refreshAll failed', e);\n    } finally {\n      _cgTraitsRefreshRunning = false;\n\n      // If any upstream event arrived during refresh, do one more pass next tick.\n      if (_cgTraitsRefreshPending) {\n        _cgTraitsRefreshPending = false;\n        scheduleTraitsRefresh('pending');\n      }\n    }\n  };\n\n  if (typeof requestAnimationFrame === 'function') requestAnimationFrame(run);\n  else setTimeout(run, 0);\n}\n\nlet bound = false;\n\n// Stable handler reference (never inline anonymous in addEventListener)\nfunction onTraitsRefreshAll() {\n  scheduleTraitsRefresh('event');\n}\n\nexport default {\n  bind() {\n    if (bound) return;\n    bound = true;\n\n    // on initial page load (or panel insert)\n    $(function () {\n      scheduleTraitsRefresh('init');\n    });\n\n    // re-apply limits & labels on any dropdown change\n    $(document)\n      .off('change.cgtraits', '.cg-trait-select')\n      .on('change.cgtraits', '.cg-trait-select', () => {\n        scheduleTraitsRefresh('trait-change');\n      });\n\n    // refresh when gifts/species/career change, or when extra-career / boost-target changes\n    const jqEvents = [\n      'cg:free-gift:changed.cgtraits',\n      'cg:species:changed.cgtraits',\n      'cg:career:changed.cgtraits',\n      'cg:traits:changed.cgtraits',\n      'cg:extra-careers:changed.cgtraits',\n    ].join(' ');\n\n    $(document)\n      .off(jqEvents)\n      .on(jqEvents, () => {\n        scheduleTraitsRefresh('upstream');\n      });\n\n    // also catch native CustomEvent dispatches (idempotent bind via window.__CG_EVT__)\n    const nativeEvents = [\n      'cg:free-gift:changed',\n      'cg:species:changed',\n      'cg:career:changed',\n      'cg:traits:changed',\n      'cg:extra-careers:changed',\n    ];\n\n    nativeEvents.forEach((evt) => {\n      try {\n        window.__CG_EVT__ = window.__CG_EVT__ || {};\n        const EVT = window.__CG_EVT__;\n        const key = `traitsRefreshAll_${evt}`;\n\n        if (EVT[key]) {\n          try { document.removeEventListener(evt, EVT[key]); } catch (_) {}\n        }\n\n        EVT[key] = onTraitsRefreshAll;\n        document.addEventListener(evt, EVT[key]);\n      } catch (e) {\n        // Best-effort: named handler (still non-anonymous)\n        try { document.addEventListener(evt, onTraitsRefreshAll); } catch (_) {}\n      }\n    });\n  }\n};\n", "// public API for Traits\r\n\r\nimport TraitsService from './service.js';\r\nimport TraitsEvents  from './events.js';\r\n\r\nexport default {\r\n  init() {\r\n    // Enforce and display initial trait limits\r\n    TraitsService.refreshAll();\r\n\r\n    // Wire up change handlers\r\n    TraitsEvents.bind();\r\n  },\r\n\r\n  // Expose for other modules\r\n  getBoostedDie: TraitsService.getBoostedDie.bind(TraitsService)\r\n};\r\n", "// assets/js/src/core/quals/catalog.js\n\nconst TYPES = ['language', 'literacy', 'insider', 'mystic', 'piety'];\n\nfunction stripDiacritics(s) {\n  // ES2015-safe diacritic stripping\n  return String(s || '')\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n}\n\nfunction canon(s) {\n  return stripDiacritics(String(s || ''))\n    .trim()\n    .replace(/\\s+/g, ' ')\n    .toLowerCase();\n}\n\nfunction matchCategoryLine(text) {\n  // Match \"Language: X\", \"Literacy: Y\", etc (case-insensitive)\n  const m = String(text || '').trim().match(/^(Language|Literacy|Insider|Mystic|Piety)\\s*:\\s*(.+)\\s*$/i);\n  if (!m) return null;\n\n  const type = canon(m[1]);\n  const value = String(m[2] || '').trim();\n  if (!type || !value) return null;\n\n  const key = canon(value);\n  if (!key) return null;\n\n  return { type, value, key };\n}\n\nexport function buildQualCatalogFromGifts(gifts = []) {\n  const catalog = Object.create(null);\n  TYPES.forEach(t => (catalog[t] = Object.create(null)));\n\n  (Array.isArray(gifts) ? gifts : []).forEach(g => {\n    const rs = g?.requires_special ?? g?.ct_gifts_requires_special ?? '';\n    const hit = matchCategoryLine(rs);\n    if (!hit || !catalog[hit.type]) return;\n\n    const bucket = catalog[hit.type];\n    if (!bucket[hit.key]) {\n      bucket[hit.key] = { key: hit.key, forms: Object.create(null), count: 0 };\n    }\n\n    bucket[hit.key].count += 1;\n    bucket[hit.key].forms[hit.value] = (bucket[hit.key].forms[hit.value] || 0) + 1;\n  });\n\n  // Convert to arrays, choose best display label per canonical key\n  const out = Object.create(null);\n  TYPES.forEach(type => {\n    out[type] = Object.values(catalog[type]).map(entry => {\n      const forms = entry.forms || {};\n      let bestLabel = Object.keys(forms)[0] || entry.key;\n      let bestCount = -1;\n      for (const k of Object.keys(forms)) {\n        const c = forms[k] || 0;\n        if (c > bestCount) { bestCount = c; bestLabel = k; }\n      }\n      return { type, key: entry.key, label: bestLabel, count: entry.count };\n    }).sort((a, b) => a.label.localeCompare(b.label));\n  });\n\n  return out;\n}\n", "// assets/js/src/core/quals/index.js\nimport { buildQualCatalogFromGifts } from './catalog.js';\n\nconst Quals = {\n  _catalog: { language: [], literacy: [], insider: [], mystic: [], piety: [] },\n\n  updateFromGifts(gifts) {\n    this._catalog = buildQualCatalogFromGifts(gifts || []);\n    window.CG_QualCatalog = this._catalog; // debug-friendly\n  },\n\n  get(type) {\n    const t = String(type || '').toLowerCase();\n    return this._catalog[t] || [];\n  },\n\n  debugTop(limit = 30) {\n    const rows = [];\n    Object.keys(this._catalog || {}).forEach(type => {\n      (this._catalog[type] || []).forEach(o => {\n        rows.push({ type, count: o.count, text: `${type}: ${o.label}` });\n      });\n    });\n    rows.sort((a, b) => b.count - a.count);\n    const top = rows.slice(0, limit);\n    // eslint-disable-next-line no-console\n    console.table(top);\n    return top;\n  }\n};\n\nwindow.CG_Quals = Quals;\n\nexport default Quals;\n", "// assets/js/src/core/quals/state.js\nimport FormBuilderAPI from '../formBuilder';\n\nconst TYPES = ['language', 'literacy', 'insider', 'mystic', 'piety'];\n\nfunction stripDiacritics(s) {\n  return String(s || '')\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n}\n\nfunction canon(s) {\n  return stripDiacritics(String(s || ''))\n    .trim()\n    .replace(/\\s+/g, ' ')\n    .toLowerCase();\n}\n\nfunction emptyData() {\n  return {\n    language: [],\n    literacy: [],\n    insider: [],\n    mystic: [],\n    piety: [],\n  };\n}\n\nfunction normalizeList(v) {\n  if (v == null) return [];\n  const arr = Array.isArray(v) ? v : [v];\n  const out = [];\n  const seen = new Set();\n\n  arr.forEach(x => {\n    const raw = String(x || '').trim().replace(/\\s+/g, ' ');\n    if (!raw) return;\n    const k = canon(raw);\n    if (!k || seen.has(k)) return;\n    seen.add(k);\n    out.push(raw);\n  });\n\n  return out;\n}\n\nfunction getBuilderData() {\n  // Prefer live _data (mutable) if present, else fallback to getData()\n  if (FormBuilderAPI && FormBuilderAPI._data) return FormBuilderAPI._data;\n  if (typeof FormBuilderAPI?.getData === 'function') return FormBuilderAPI.getData() || {};\n  return {};\n}\n\nconst QualState = {\n  data: emptyData(),\n\n  init() {\n    const src = getBuilderData();\n    const q = src.qualifications || src.quals || src.cg_quals || {};\n    const next = emptyData();\n\n    TYPES.forEach(t => {\n      next[t] = normalizeList(q[t]);\n    });\n\n    this.data = next;\n\n    // Persist normalized version back (so save/load is consistent)\n    this.persist();\n  },\n\n  persist() {\n    const src = getBuilderData();\n    const payload = {};\n    TYPES.forEach(t => (payload[t] = (this.data[t] || []).slice()));\n\n    if (FormBuilderAPI && FormBuilderAPI._data) {\n      FormBuilderAPI._data.qualifications = payload;\n      // aliases (safe)\n      FormBuilderAPI._data.quals = payload;\n      FormBuilderAPI._data.cg_quals = payload;\n    } else {\n      // best-effort if only getData() exists\n      src.qualifications = payload;\n    }\n\n    // Notify others\n    document.dispatchEvent(new CustomEvent('cg:quals:changed', { detail: { qualifications: payload } }));\n    const $ = window.jQuery;\n    if ($) $(document).trigger('cg:quals:changed', [{ qualifications: payload }]);\n  },\n\n  getAll() {\n    return JSON.parse(JSON.stringify(this.data || emptyData()));\n  },\n\n  get(type) {\n    const t = String(type || '').toLowerCase();\n    return (this.data && Array.isArray(this.data[t])) ? this.data[t] : [];\n  },\n\n  has(type, value) {\n    const t = String(type || '').toLowerCase();\n    const k = canon(value);\n    return !!(this.data?.[t] || []).some(v => canon(v) === k);\n  },\n\n  add(type, value) {\n    const t = String(type || '').toLowerCase();\n    if (!TYPES.includes(t)) return false;\n\n    const raw = String(value || '').trim().replace(/\\s+/g, ' ');\n    if (!raw) return false;\n\n    if (this.has(t, raw)) return false;\n\n    this.data[t] = (this.data[t] || []).concat([raw]);\n    this.persist();\n    return true;\n  },\n\n  remove(type, value) {\n    const t = String(type || '').toLowerCase();\n    if (!TYPES.includes(t)) return false;\n\n    const k = canon(value);\n    const before = this.get(t);\n    const after = before.filter(v => canon(v) !== k);\n    if (after.length === before.length) return false;\n\n    this.data[t] = after;\n    this.persist();\n    return true;\n  },\n};\n\nwindow.CG_QualState = QualState;\nexport default QualState;\n", "// assets/js/src/core/gifts/free-choices.js\n//\n// Renders the \"Chosen\" Free Gifts (3) selects inside the Gifts tab placeholder #cg-free-choices.\n//\n// Requirements:\n// - Filtering MUST work even before choosing career/species (only depends on currently-owned gifts + traits).\n// - Filtering MUST respect prerequisite gifts in ct_gifts_requires* columns.\n// - Filtering MUST respect minimum trait requirements parsed from requires_special text (e.g. \"Mind of d8 or better\").\n// - Slot-scoped qualification selectors (Language/Literacy/Insider/Mystic/Piety) are rendered INLINE under each slot,\n//   driven by requires_special lines like \"Piety: ...\" / \"Mystic: ...\" etc.\n// - Base \"everyone gets one Language\" selector is handled by quals/ui.js; we do NOT render that here.\n//\n// Exposes: window.CG_FreeChoices\n\nimport FormBuilderAPI from '../formBuilder';\nimport State from './state.js';\nimport Quals from '../quals/index.js';\nimport QualState from '../quals/state.js';\n\nfunction cgWin() {\n  if (typeof globalThis !== 'undefined') return globalThis;\n  if (typeof window !== 'undefined') return window;\n  return {};\n}\n\nconst W = cgWin();\nconst $ = (W && W.jQuery) ? W.jQuery : null;\n\nconst log = (...a) => { try { console.log('[FreeChoices]', ...a); } catch (_) {} };\nconst warn = (...a) => { try { console.warn('[FreeChoices]', ...a); } catch (_) {} };\n\nconst ALWAYS_ACQUIRED_GIFT_IDS = ['242', '236']; // Local Knowledge, Language (always acquired in your model)\n\nfunction normalize3(arr) {\n  const out = (Array.isArray(arr) ? arr : []).slice(0, 3).map(v => (v ? String(v) : ''));\n  while (out.length < 3) out.push('');\n  return out;\n}\n\nfunction getBuilderData() {\n  if (FormBuilderAPI && FormBuilderAPI._data) return FormBuilderAPI._data;\n  if (typeof FormBuilderAPI?.getData === 'function') return FormBuilderAPI.getData() || {};\n  return {};\n}\n\nfunction setBuilderKey(key, value) {\n  const d = getBuilderData();\n  try {\n    if (FormBuilderAPI && FormBuilderAPI._data) FormBuilderAPI._data[key] = value;\n    else d[key] = value;\n  } catch (_) {}\n}\n\nfunction getAjax() {\n  return W.CG_AJAX || W.CG_Ajax || {};\n}\n\nfunction getNonceFor(action) {\n  const nonces = W.CG_NONCES || {};\n  if (nonces && nonces[action]) return nonces[action];\n  const ajax = getAjax();\n  if (ajax && ajax.nonce) return ajax.nonce;\n  if (ajax && ajax.security) return ajax.security;\n  return '';\n}\n\nfunction ajaxPost(payload) {\n  const ajax = getAjax();\n  const url = ajax.ajax_url || ajax.url || W.ajaxurl || '';\n  const data = { ...(payload || {}) };\n\n  const nonce = getNonceFor(String(data.action || ''));\n  if (nonce && !data.security && !data.nonce && !data._ajax_nonce) {\n    data.security = nonce;\n    data.nonce = nonce;\n    data._ajax_nonce = nonce;\n  }\n\n  if ($ && url) {\n    return new Promise((resolve, reject) => {\n      $.ajax({\n        url,\n        method: 'POST',\n        data,\n        dataType: 'json',\n        success: (res) => resolve(res),\n        error: (xhr, status, err) => reject(err || status || xhr)\n      });\n    });\n  }\n\n  if (!url) return Promise.reject(new Error('Missing AJAX url'));\n  const body = new URLSearchParams();\n  Object.entries(data).forEach(([k, v]) => body.append(k, String(v ?? '')));\n\n  return fetch(url, {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },\n    body\n  }).then(r => r.json());\n}\n\nfunction modalRoot() {\n  if (typeof document === 'undefined') return null;\n  return document.querySelector('#cg-modal') || null;\n}\n\nfunction getFreeGiftSlotsFromData() {\n  try {\n    if (State && typeof State.getFreeGifts === 'function') return normalize3(State.getFreeGifts());\n  } catch (_) {}\n\n  const d = getBuilderData();\n  const v =\n    d.free_gifts ||\n    d.freeGifts ||\n    d.cg_free_gifts ||\n    d.free_choices ||\n    d.freeChoices ||\n    [];\n\n  return normalize3(Array.isArray(v) ? v : [v]);\n}\n\nfunction emitFreeGiftChanged(selected, source = 'free-choices') {\n  try {\n    const detail = { free_gifts: selected.slice(), source: String(source || '') };\n    document.dispatchEvent(new CustomEvent('cg:free-gift:changed', { detail }));\n    if ($) $(document).trigger('cg:free-gift:changed', [detail]);\n  } catch (_) {}\n}\n\nfunction setFreeGiftSlotsToData(slots, source = 'free-choices') {\n  const normalized = normalize3(slots);\n\n  setBuilderKey('free_gifts', normalized);\n  setBuilderKey('freeGifts', normalized);\n  setBuilderKey('cg_free_gifts', normalized);\n\n  let stateHandled = false;\n  try {\n    if (State && typeof State.setSelected === 'function') {\n      State.setSelected(normalized);\n      stateHandled = true;\n    } else if (State && typeof State.setFreeGifts === 'function') {\n      State.setFreeGifts(normalized, { source });\n      stateHandled = true;\n    }\n  } catch (_) {}\n\n  if (!stateHandled) emitFreeGiftChanged(normalized, source);\n\n  return normalized;\n}\n\nfunction giftId(g) {\n  return String(g?.id ?? g?.ct_id ?? g?.gift_id ?? g?.ct_gift_id ?? '');\n}\n\nfunction giftName(g) {\n  return String(g?.name ?? g?.title ?? g?.gift_name ?? g?.ct_gift_name ?? '');\n}\n\nfunction requiresSpecialText(g) {\n  const rs = (g?.requires_special ?? g?.ct_gifts_requires_special ?? g?.requiresSpecial ?? '');\n  return String(rs ?? '').trim();\n}\n\nfunction allowsMultiple(g) {\n  const v = g?.allows_multiple ?? g?.ct_gifts_manifold ?? g?.manifold ?? null;\n  if (v === true) return true;\n  const n = Number(v);\n  return Number.isFinite(n) && n > 1;\n}\n\nfunction extractRequiredGiftIds(g) {\n  if (!g || typeof g !== 'object') return [];\n  const out = [];\n  Object.keys(g).forEach(k => {\n    if (!/^ct_gifts_requires(_[a-z]+)?$/i.test(k) && !/^ct_gifts_requires_/i.test(k)) return;\n    if (k.toLowerCase() === 'ct_gifts_requires_special') return;\n    const v = g[k];\n    if (v == null) return;\n    const s = String(v).trim();\n    if (!s) return;\n    s.split(',').map(x => x.trim()).filter(Boolean).forEach(x => out.push(String(x)));\n  });\n  return [...new Set(out)];\n}\n\nfunction diceToNum(s) {\n  const t = String(s || '').trim().toLowerCase();\n  const m = t.match(/d\\s*(4|6|8|10|12)/);\n  return m ? Number(m[1]) : null;\n}\n\nfunction getTraitDieValue(traitKey) {\n  const d = getBuilderData();\n\n  const pools = [];\n  if (d && typeof d === 'object') {\n    if (d.traits && typeof d.traits === 'object') pools.push(d.traits);\n    if (d.cg_traits && typeof d.cg_traits === 'object') pools.push(d.cg_traits);\n    pools.push(d);\n  }\n\n  const keys = [traitKey, `trait_${traitKey}`, `${traitKey}_die`, `die_${traitKey}`];\n\n  for (const obj of pools) {\n    for (const k of keys) {\n      if (!obj || !(k in obj)) continue;\n      const v = obj[k];\n      const n = diceToNum(v);\n      if (n != null) return n;\n    }\n  }\n\n  return null;\n}\n\nfunction extractTraitMinimaFromRequiresSpecial(rs) {\n  const text = String(rs || '');\n  if (!text) return [];\n\n  const traits = [\n    { key: 'mind', re: /\\bmind\\b/i },\n    { key: 'body', re: /\\bbody\\b/i },\n    { key: 'speed', re: /\\bspeed\\b/i },\n    { key: 'will', re: /\\bwill\\b/i },\n  ];\n\n  const mins = [];\n  const parts = text.split(/[\\n\\r.;]+/).map(s => s.trim()).filter(Boolean);\n\n  parts.forEach(p => {\n    traits.forEach(t => {\n      if (!t.re.test(p)) return;\n      const m = p.match(/d\\s*(4|6|8|10|12)/i);\n      if (!m) return;\n      const need = Number(m[1]);\n      if (!Number.isFinite(need)) return;\n      mins.push({ traitKey: t.key, need, raw: p });\n    });\n  });\n\n  const best = new Map();\n  mins.forEach(x => {\n    const cur = best.get(x.traitKey);\n    if (!cur || x.need > cur.need) best.set(x.traitKey, x);\n  });\n\n  return Array.from(best.values());\n}\n\nfunction traitMinimaSatisfied(g) {\n  const rs = requiresSpecialText(g);\n  const mins = extractTraitMinimaFromRequiresSpecial(rs);\n  if (!mins.length) return true;\n\n  for (const m of mins) {\n    const have = getTraitDieValue(m.traitKey);\n    if (have == null) return false;\n    if (have < m.need) return false;\n  }\n  return true;\n}\n\nfunction extractQualReqLinesFromRequiresSpecial(rs) {\n  const lines = String(rs || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean);\n  const out = [];\n  for (const line of lines) {\n    const m = line.match(/^(language|literacy|insider|mystic|piety)\\s*:\\s*(.+)$/i);\n    if (!m || !m[1] || !m[2]) continue;\n    out.push({ type: String(m[1]).toLowerCase(), raw: String(m[2]).trim() });\n  }\n  return out;\n}\n\n/**\n * Enforce simple qualification prerequisites expressed in requires_special, e.g.:\n *   \"Language: Magniloquentia\"\n *   \"Mystic: Elementalism\"\n *\n * We ONLY enforce explicit \"Type: Value\" lines for known types.\n * Anything else in requires_special is ignored here (future work).\n */\nfunction qualPrereqsSatisfied(g) {\n  const rs = requiresSpecialText(g);\n  if (!rs) return true;\n\n  // Non-enforceable GM permission text\n  if (/permission\\s+from\\s+the\\s+game\\s+host/i.test(rs)) return true;\n\n  const reqs = extractQualReqLinesFromRequiresSpecial(rs);\n  if (!reqs.length) return true;\n\n  try { ensureQualStateInit(); } catch (_) {}\n\n  for (const r of reqs) {\n    const type = r.type;\n    const raw = String(r.raw || '').trim();\n    if (!type || !raw) continue;\n\n    // Ambiguous placeholders: do not block eligibility on these\n    if (/\\[\\s*choice\\s*\\]/i.test(raw) || /\\bchoice\\b/i.test(raw)) continue;\n\n    const parts = raw\n      .split(/,|\\/|;|\\bor\\b/ig)\n      .map(s => String(s || '').trim())\n      .filter(Boolean);\n\n    if (!parts.length) continue;\n\n    let ok = false;\n    for (const p of parts) {\n      if (!p) continue;\n      if (/^any\\b/i.test(p)) { ok = true; break; }\n      if (qualStateHas(type, p)) { ok = true; break; }\n    }\n    if (!ok) return false;\n  }\n\n  return true;\n}\n\n\nfunction computeOwnedGiftIdSet(selectedFreeGiftIds = []) {\n  const owned = new Set();\n  ALWAYS_ACQUIRED_GIFT_IDS.forEach(id => owned.add(String(id)));\n  (selectedFreeGiftIds || []).filter(Boolean).forEach(id => owned.add(String(id)));\n\n  const d = getBuilderData();\n  const candidateKeys = [\n    'gift_id_1','gift_id_2','gift_id_3',\n    'species_gift_one','species_gift_two','species_gift_three',\n    'career_gift_one','career_gift_two','career_gift_three',\n    'species_gifts','career_gifts',\n    'gift_ids','giftIds','gifts',\n      'career_gift_replacements',\n      'cg_career_gift_replacements',\n  ];\n\n  candidateKeys.forEach(k => {\n    if (!d || !(k in d)) return;\n    const v = d[k];\n    if (Array.isArray(v)) v.forEach(x => x && owned.add(String(x)));\n    else if (v && typeof v === 'object') Object.values(v).forEach(x => x && owned.add(String(x)));\n    else if (v) owned.add(String(v));\n  });\n\n  const apis = [W.SpeciesAPI, W.CareerAPI].filter(Boolean);\n  apis.forEach(api => {\n    const prof = api?.currentProfile || api?.profile || api?.current || api?.selected || null;\n    if (!prof) return;\n    candidateKeys.forEach(k => {\n      if (!(k in prof)) return;\n      const v = prof[k];\n      if (Array.isArray(v)) v.forEach(x => x && owned.add(String(x)));\n      else if (v && typeof v === 'object') Object.values(v).forEach(x => x && owned.add(String(x)));\n      else if (v) owned.add(String(v));\n    });\n  });\n\n  return owned;\n}\n\nfunction giftEligible(g, ownedSet, otherSelectedIds = new Set()) {\n  if (!g) return false;\n  const id = giftId(g);\n  const name = giftName(g);\n      const __DBG471 = !!(W && W.__CG_DBG471__) && (String(id) === '471' || String(name).toLowerCase() === 'attendant fireball');\n    const __owned = (typeof ownedSet !== 'undefined') ? ownedSet : ((typeof owned !== 'undefined') ? owned : null);\n    const __others = (typeof otherSelectedIds !== 'undefined') ? otherSelectedIds : ((typeof others !== 'undefined') ? others : null);\n    if (__DBG471) {\n      console.log('[FreeChoices][DBG471] start', { id, name });\n      try { console.log('[FreeChoices][DBG471] owned', __owned ? Array.from(__owned) : __owned); } catch (_) {}\n      try { console.log('[FreeChoices][DBG471] others', __others ? Array.from(__others) : __others); } catch (_) {}\n      console.log('[FreeChoices][DBG471] fields', {\n        requires: g && g.requires,\n        ct_gifts_requires: g && g.ct_gifts_requires,\n        manifold: g && g.manifold,\n        ct_gifts_manifold: g && g.ct_gifts_manifold,\n        allows_multiple: g && g.allows_multiple,\n        ct_gifts_allows_multiple: g && g.ct_gifts_allows_multiple,\n        requires_special: g && (g.requires_special || g.ct_gifts_requires_special || g.requiresSpecial)\n      });\n    }\nif (!id || !name) { if (__DBG471) console.log('[FreeChoices][DBG471] FAIL: missing id/name', {id, name}); return false; }\n\n  const reqIds = extractRequiredGiftIds(g);\n  for (const rid of reqIds) {\n    if (!ownedSet.has(String(rid))) return false;\n  }\n\n  if (!traitMinimaSatisfied(g)) { if (__DBG471) { try { const rs = requiresSpecialText(g); const mins = extractTraitMinimaFromRequiresSpecial(rs); const tv = {}; mins.forEach(t => tv[t.trait] = getTraitDieValue(t.trait)); console.log('[FreeChoices][DBG471] FAIL: trait minima', { rs, mins, tv }); } catch (_) {} } return false; }\n\n  if (otherSelectedIds.has(id) && !allowsMultiple(g)) return false;\n\n  return true;\n}\n\nfunction ensureSectionInHost(host) {\n  if (typeof document === 'undefined') return null;\n\n  let section = document.getElementById('cg-free-gifts');\n  if (!section) {\n    section = document.createElement('div');\n    section.id = 'cg-free-gifts';\n    section.className = 'cg-profile-box cg-free-gifts';\n    section.innerHTML = `\n      <h3>Free Gifts (3)</h3>\n      <div class=\"cg-free-row\" style=\"display:flex; gap:10px; flex-wrap:wrap; align-items:flex-end;\"></div>\n    `;\n  }\n\n  try {\n    if (host && section.parentNode !== host) host.appendChild(section);\n  } catch (_) {}\n\n  return section;\n}\n\nfunction getSlotQualMap() {\n  const d = getBuilderData();\n  const m = d.free_gift_quals || d.cg_free_gift_quals || d.freeGiftQuals || {};\n  if (!m || typeof m !== 'object') return {};\n  return JSON.parse(JSON.stringify(m));\n}\n\nfunction setSlotQualMap(map) {\n  const clean = map && typeof map === 'object' ? map : {};\n  setBuilderKey('free_gift_quals', clean);\n  setBuilderKey('cg_free_gift_quals', clean);\n  setBuilderKey('freeGiftQuals', clean);\n}\n\nfunction stripDiacritics(s) {\n  return String(s || '')\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n}\n\nfunction canon(s) {\n  return stripDiacritics(String(s || ''))\n    .trim()\n    .replace(/\\s+/g, ' ')\n    .toLowerCase();\n}\n\nfunction detectQualTypesNeeded(g) {\n  const rs = requiresSpecialText(g);\n  const name = giftName(g).toLowerCase();\n\n  const found = new Set();\n  const lines = String(rs || '').split(/\\r?\\n/).map(s => s.trim()).filter(Boolean);\n  lines.forEach(line => {\n    const m = line.match(/^(language|literacy|insider|mystic|piety)\\s*:/i);\n    if (m && m[1]) found.add(String(m[1]).toLowerCase());\n  });\n\n  if (found.size === 0) {\n    if (name.includes('piety')) found.add('piety');\n    if (name.includes('mystic')) found.add('mystic');\n    if (name.includes('insider')) found.add('insider');\n    if (name.includes('literacy')) found.add('literacy');\n    if (name.includes('language')) found.add('language');\n  }\n\n  const TYPES = ['language', 'literacy', 'insider', 'mystic', 'piety'];\n  return TYPES.filter(t => found.has(t));\n}\n\n/**\n * IMPORTANT:\n * Primary source is Quals.get(type), BUT that catalog can be empty early in the session.\n * Fallback: derive possible values directly from the gifts list by scanning requires_special lines.\n */\nfunction getQualItemsForType(type, allGifts) {\n  let items = [];\n  try {\n    items = (Quals && typeof Quals.get === 'function') ? (Quals.get(type) || []) : [];\n  } catch (_) {\n    items = [];\n  }\n\n  if (Array.isArray(items) && items.length > 0) return items;\n\n  // Fallback: parse \"Type: Value\" lines across ALL gifts\n  const want = String(type || '').toLowerCase();\n  const rx = new RegExp(`^\\\\s*${want}\\\\s*:\\\\s*(.+)$`, 'i');\n\n  const keep = new Map(); // canon -> bestLabel\n\n  const list = Array.isArray(allGifts) ? allGifts : [];\n  for (const g of list) {\n    const rs = requiresSpecialText(g);\n    if (!rs) continue;\n\n    const lines = rs.split(/\\r?\\n/).map(s => s.trim()).filter(Boolean);\n    for (const line of lines) {\n      const m = line.match(rx);\n      if (!m || !m[1]) continue;\n\n      // Value part may contain multiple entries separated by commas or \" or \"\n      const raw = String(m[1]).trim();\n      const parts = raw\n        .split(/,|\\/|;|\\bor\\b/ig)\n        .map(s => String(s || '').trim())\n        .filter(Boolean);\n\n      for (const p of parts) {\n        // Avoid obvious non-values\n        if (/^any\\b/i.test(p)) continue;\n        const k = canon(p);\n        if (!k) continue;\n        if (!keep.has(k)) keep.set(k, p);\n      }\n    }\n  }\n\n  const labels = Array.from(keep.values())\n    .sort((a, b) => String(a).localeCompare(String(b), undefined, { sensitivity: 'base' }));\n\n  // Normalize to the same shape Quals.get typically returns\n  return labels.map(label => ({ label, key: label }));\n}\n\nfunction ensureQualStateInit() {\n  try { QualState?.init?.(); } catch (_) {}\n}\n\nfunction qualStateHas(type, value) {\n  type = String(type || '').toLowerCase();\n\n  if (!value) return false;\n  try {\n    if (typeof QualState?.has === 'function') return !!QualState.has(type, value);\n    const arr = QualState?.get?.(type) || [];\n    return arr.some(v => canon(v) === canon(value));\n  } catch (_) {\n    return false;\n  }\n}\n\nfunction qualStateAdd(type, value) {\n  if (!value) return;\n  ensureQualStateInit();\n\n  if (type === 'language') {\n    try {\n      const cur = (QualState?.get?.('language') || []).slice();\n      const base = cur[0] || '';\n      if (canon(base) === canon(value)) return;\n      if (qualStateHas('language', value)) return;\n\n      if (QualState?.data && Array.isArray(QualState.data.language) && typeof QualState.persist === 'function') {\n        QualState.data.language = [base, ...cur.slice(1).filter(v => canon(v) !== canon(value)), value].filter(Boolean);\n        QualState.persist();\n      } else if (typeof QualState?.add === 'function') {\n        QualState.add('language', value);\n      }\n    } catch (_) {}\n    return;\n  }\n\n  try {\n    if (qualStateHas(type, value)) return;\n    if (typeof QualState?.add === 'function') QualState.add(type, value);\n    else if (QualState?.data && Array.isArray(QualState.data[type]) && typeof QualState.persist === 'function') {\n      QualState.data[type] = (QualState.data[type] || []).concat([value]);\n      QualState.persist();\n    }\n  } catch (_) {}\n}\n\nfunction qualStateRemoveIfSafe(type, value, slotMap) {\n  if (!value) return;\n  ensureQualStateInit();\n\n  const stillUsed = Object.values(slotMap || {}).some(slotObj => {\n    if (!slotObj || typeof slotObj !== 'object') return false;\n    const v = slotObj[type];\n    return v && canon(v) === canon(value);\n  });\n  if (stillUsed) return;\n\n  if (type === 'language') {\n    try {\n      const cur = (QualState?.get?.('language') || []).slice();\n      const base = cur[0] || '';\n      if (canon(base) === canon(value)) return;\n    } catch (_) {}\n  }\n\n  try {\n    if (typeof QualState?.remove === 'function') QualState.remove(type, value);\n    else if (QualState?.data && Array.isArray(QualState.data[type]) && typeof QualState.persist === 'function') {\n      QualState.data[type] = (QualState.data[type] || []).filter(v => canon(v) !== canon(value));\n      QualState.persist();\n    }\n  } catch (_) {}\n}\n\nfunction renderQualSelectHtml({ slot, type, value, allGifts }) {\n  const items = getQualItemsForType(type, allGifts);\n  const opts = (Array.isArray(items) ? items : []).map(it => {\n    const label = String(it?.label ?? it?.key ?? '').trim();\n    if (!label) return '';\n    const sel = (canon(value) === canon(label)) ? ' selected' : '';\n    return `<option value=\"${label}\"${sel}>${label}</option>`;\n  }).filter(Boolean).join('\\n');\n\n  const nice = type.charAt(0).toUpperCase() + type.slice(1);\n\n  return `\n    <label style=\"display:flex; flex-direction:column; gap:4px; margin-top:8px; min-width: 220px;\">\n      <span style=\"font-weight:600;\">${nice}</span>\n      <select class=\"cg-free-qual-select\" data-slot=\"${slot}\" data-qtype=\"${type}\">\n        <option value=\"\">\u2014 Select ${nice} \u2014</option>\n        ${opts}\n      </select>\n    </label>\n  `;\n}\n\n// Reuse singleton if module is evaluated twice\nconst Existing = W.CG_FreeChoices;\n\nconst FreeChoices = (Existing && Existing.__cg_singleton) ? Existing : {\n  __cg_singleton: true,\n\n  _inited: false,\n  _bound: false,\n\n  _allGifts: [],\n  _byId: null,\n  _loading: false,\n\n\n    _renderQueued: false,\n    _renderRunning: false,\n    _renderPending: false,\n\n    _scheduleRender(reason = 'auto') {\n      // Coalesce bursts: at most one render per tick, plus one pending pass.\n      if (this._renderRunning) { this._renderPending = true; return; }\n      if (this._renderQueued) return;\n      this._renderQueued = true;\n\n      const run = () => {\n        this._renderQueued = false;\n        this._renderRunning = true;\n\n        try {\n          this.render();\n        } catch (e) {\n          try { console.error('[FreeChoices] render failed', e); } catch (_) {}\n        } finally {\n          this._renderRunning = false;\n\n          if (this._renderPending) {\n            this._renderPending = false;\n            this._scheduleRender('pending');\n          }\n        }\n      };\n\n      if (typeof requestAnimationFrame === 'function') requestAnimationFrame(run);\n      else setTimeout(run, 0);\n    },\n  init() {\n    if (this.__inited) return;\n    this.__inited = true;\n    if (this._inited) return;\n    this._inited = true;\n\n    try { State?.init?.(); } catch (_) {}\n    try { QualState?.init?.(); } catch (_) {}\n    try { Quals?.init?.(); } catch (_) {} // best-effort if Quals has an init\n\n    this._bindGlobalEventsOnce();\n    this.refresh({ reason: 'init', fetch: true });\n  },\n\n  _bindGlobalEventsOnce() {\n    if (this._bound) return;\n    this._bound = true;\n\n    const rerenderSoon = this._rerenderSoon || ((e) => { this._scheduleRender((e && e.type) ? e.type : 'event'); });\n    this._rerenderSoon = rerenderSoon;\n\n\n    // Prefer jQuery binding when available to avoid double-firing (jQuery also sees CustomEvent)\n    if ($ && $.fn) {\n      $(document)\n        .off('cg:builder:opened.cgfreechoices cg:tab:changed.cgfreechoices cg:character:loaded.cgfreechoices cg:quals:catalog-updated.cgfreechoices')\n        .on('cg:builder:opened.cgfreechoices cg:tab:changed.cgfreechoices cg:character:loaded.cgfreechoices cg:quals:catalog-updated.cgfreechoices', rerenderSoon);\n      return;\n    }\n\n    document.removeEventListener('cg:builder:opened', rerenderSoon);\n    document.addEventListener('cg:builder:opened', rerenderSoon);\n\n    try {\n      const W = window;\n      W.__CG_EVT__ = W.__CG_EVT__ || {};\n      const EVT = W.__CG_EVT__;\n      if (EVT.freeChoicesRerenderSoon) {\n        try { document.removeEventListener('cg:tab:changed', EVT.freeChoicesRerenderSoon); } catch (_) {}\n      }\n      EVT.freeChoicesRerenderSoon = rerenderSoon;\n      document.addEventListener('cg:tab:changed', EVT.freeChoicesRerenderSoon);\n    } catch (_) {\n      try { document.addEventListener('cg:tab:changed', rerenderSoon); } catch (_) {}\n    }\n    document.removeEventListener('cg:character:loaded', rerenderSoon);\n    document.addEventListener('cg:character:loaded', rerenderSoon);\n\n    document.removeEventListener('cg:quals:catalog-updated', rerenderSoon);\n    document.addEventListener('cg:quals:catalog-updated', rerenderSoon);\n\n    if ($ && $.fn) {\n      $(document)\n        .off('cg:builder:opened.cgfreechoices cg:tab:changed.cgfreechoices cg:character:loaded.cgfreechoices cg:quals:catalog-updated.cgfreechoices')\n        .on('cg:builder:opened.cgfreechoices cg:tab:changed.cgfreechoices cg:character:loaded.cgfreechoices cg:quals:catalog-updated.cgfreechoices', rerenderSoon);\n    }\n      // Removed legacy tab-click sniffing: cg:tab:changed is the canonical trigger.\n  },\n\n  async refresh({ fetch = false } = {}) {\n    if (fetch) await this._fetchAllGifts();\n      this._scheduleRender('refresh');\n},\n\n  async _fetchAllGifts() {\n    if (this._loading) return;\n    this._loading = true;\n\n    try {\n      const res = await ajaxPost({ action: 'cg_get_free_gifts' });\n\n      let list = null;\n      if (Array.isArray(res)) list = res;\n      else if (res && Array.isArray(res.data)) list = res.data;\n      else if (res && res.data && Array.isArray(res.data.gifts)) list = res.data.gifts;\n      else if (res && Array.isArray(res.gifts)) list = res.gifts;\n\n      if (!Array.isArray(list)) {\n        warn('cg_get_free_gifts returned unexpected payload', res);\n        list = [];\n      }\n\n      this._allGifts = list.slice();\n      this._byId = new Map();\n      this._allGifts.forEach(g => {\n        const id = giftId(g);\n        if (id) this._byId.set(id, g);\n      });\n\n      // Hydrate shared GiftsState so TraitsService/Quals can see gift rows\n      try { State.setList(this._allGifts); } catch (_) {}\n\n      log('Fetched gifts', { count: this._allGifts.length });\n    } catch (err) {\n      warn('Failed to fetch gifts', err);\n      this._allGifts = [];\n      this._byId = new Map();\n    } finally {\n      this._loading = false;\n    }\n  },\n\n  _getGift(id) {\n    const k = String(id || '');\n    if (!k) return null;\n    if (this._byId && this._byId.get(k)) return this._byId.get(k);\n    const list = Array.isArray(this._allGifts) ? this._allGifts : [];\n    return list.find(g => giftId(g) === k) || null;\n  },\n\n  render() {\n    const modal = modalRoot();\n    if (!modal) return;\n\n    const host = modal.querySelector('#cg-free-choices') || document.querySelector('#cg-free-choices');\n    if (!host) return;\n\n    const section = ensureSectionInHost(host);\n    if (!section) return;\n\n    this._bindSectionDelegates(section);\n\n    const slots = getFreeGiftSlotsFromData();\n    const row = section.querySelector('.cg-free-row');\n    if (!row) return;\n\n    const owned = computeOwnedGiftIdSet(slots.filter(Boolean));\n\n    const htmlSlots = [0, 1, 2].map(i => {\n      const selectedId = String(slots[i] || '').trim();\n      const others = new Set(slots.map((v, idx) => (idx === i ? '' : String(v || '').trim())).filter(Boolean));\n\n      const eligible = (Array.isArray(this._allGifts) ? this._allGifts : []).filter(g => giftEligible(g, owned, others));\n\n      const curGift = selectedId ? this._getGift(selectedId) : null;\n      const curOpt = curGift ? [{ id: giftId(curGift), name: giftName(curGift), _forced: true }] : [];\n\n      const seen = new Set();\n      const options = []\n        .concat(curOpt.map(o => ({ _forced: true, id: o.id, name: o.name })))\n        .concat(eligible.map(g => ({ id: giftId(g), name: giftName(g) })))\n        .filter(o => o && o.id && o.name)\n        .filter(o => {\n          if (seen.has(o.id)) return false;\n          seen.add(o.id);\n          return true;\n        })\n        .map(o => {\n          const sel = (String(selectedId) === String(o.id)) ? ' selected' : '';\n          const suffix = o._forced ? ' (saved)' : '';\n          return `<option value=\"${String(o.id)}\"${sel}>${String(o.name)}${suffix}</option>`;\n        })\n        .join('\\n');\n\n      return `\n        <div class=\"cg-free-slot\" data-slot=\"${i}\" style=\"display:flex; flex-direction:column;\">\n          <label style=\"display:flex; flex-direction:column; gap:4px; min-width: 220px;\">\n            <span style=\"font-weight:600;\">Free Gift ${i + 1}</span>\n            <select id=\"cg-free-choice-${i}\" class=\"cg-free-gift-select\" data-slot=\"${i}\">\n              <option value=\"\">\u2014 Select a gift \u2014</option>\n              ${options}\n            </select>\n          </label>\n          <div class=\"cg-free-slot-quals\" data-slot=\"${i}\"></div>\n        </div>\n      `;\n    });\n\n    row.innerHTML = htmlSlots.join('\\n');\n    this._renderSlotQuals(slots);\n  },\n\n  _bindSectionDelegates(section) {\n    if (section.__cgBound) return;\n    section.__cgBound = true;\n\n    section.addEventListener('change', (e) => {\n      const t = e.target;\n      if (!t || !t.classList) return;\n\n      if (t.classList.contains('cg-free-gift-select')) {\n        const slot = Number(t.getAttribute('data-slot') || '0');\n        const nextId = String(t.value || '').trim();\n\n        const prevSlots = getFreeGiftSlotsFromData();\n        const nextSlots = prevSlots.slice();\n        nextSlots[slot] = nextId;\n\n        this._cleanupSlotQualsOnGiftChange({ slot, prevGiftId: prevSlots[slot], nextGiftId: nextId });\n\n        setFreeGiftSlotsToData(nextSlots, 'free-gift-select');\n        this._scheduleRender('free-gift-select');\n        return;\n      }\n\n      if (t.classList.contains('cg-free-qual-select')) {\n        const slot = String(t.getAttribute('data-slot') || '0');\n        const type = String(t.getAttribute('data-qtype') || '').toLowerCase();\n        const val = String(t.value || '').trim();\n\n        const map = getSlotQualMap();\n        if (!map[slot] || typeof map[slot] !== 'object') map[slot] = {};\n\n        const prev = String(map[slot][type] || '').trim();\n\n        if (val) map[slot][type] = val;\n        else delete map[slot][type];\n\n        if (Object.keys(map[slot] || {}).length === 0) delete map[slot];\n\n        setSlotQualMap(map);\n\n        if (prev && canon(prev) !== canon(val)) qualStateRemoveIfSafe(type, prev, map);\n        if (val) qualStateAdd(type, val);\n\n        this._scheduleRender('free-qual-select');\n        return;\n      }\n    });\n  },\n\n  _cleanupSlotQualsOnGiftChange({ slot, prevGiftId, nextGiftId }) {\n    const prevG = prevGiftId ? this._getGift(prevGiftId) : null;\n    const nextG = nextGiftId ? this._getGift(nextGiftId) : null;\n\n    const prevNeeds = prevG ? detectQualTypesNeeded(prevG) : [];\n    const nextNeeds = nextG ? detectQualTypesNeeded(nextG) : [];\n\n    const map = getSlotQualMap();\n    const sKey = String(slot);\n\n    const slotObj = (map[sKey] && typeof map[sKey] === 'object') ? map[sKey] : null;\n    if (!slotObj) return;\n\n    prevNeeds.forEach(type => {\n      if (nextNeeds.includes(type)) return;\n\n      const prevVal = String(slotObj[type] || '').trim();\n      if (!prevVal) return;\n\n      delete slotObj[type];\n      qualStateRemoveIfSafe(type, prevVal, map);\n    });\n\n    if (slotObj && Object.keys(slotObj).length === 0) delete map[sKey];\n    setSlotQualMap(map);\n  },\n\n  _renderSlotQuals(slots) {\n    const section = document.getElementById('cg-free-gifts');\n    if (!section) return;\n\n    const map = getSlotQualMap();\n\n    [0, 1, 2].forEach(i => {\n      const slotId = String(i);\n      const giftIdSel = String(slots[i] || '').trim();\n      const wrap = section.querySelector(`.cg-free-slot-quals[data-slot=\"${i}\"]`);\n      if (!wrap) return;\n\n      if (!giftIdSel) {\n        wrap.innerHTML = '';\n        return;\n      }\n\n      const g = this._getGift(giftIdSel);\n      if (!g) {\n        wrap.innerHTML = '';\n        return;\n      }\n\n      const needs = detectQualTypesNeeded(g);\n      if (!needs.length) {\n        wrap.innerHTML = '';\n        return;\n      }\n\n      if (!map[slotId] || typeof map[slotId] !== 'object') map[slotId] = {};\n\n      const html = needs.map(type => {\n        const cur = String(map[slotId][type] || '').trim();\n        return renderQualSelectHtml({ slot: i, type, value: cur, allGifts: this._allGifts });\n      }).join('\\n');\n\n      wrap.innerHTML = html;\n      setSlotQualMap(map);\n    });\n  },\n\n  debug() {\n    const sizes = {};\n    ['language','literacy','insider','mystic','piety'].forEach(t => {\n      try { sizes[t] = getQualItemsForType(t, this._allGifts).length; } catch (_) { sizes[t] = null; }\n    });\n\n    return {\n      giftsCount: Array.isArray(this._allGifts) ? this._allGifts.length : 0,\n      slots: getFreeGiftSlotsFromData(),\n      slotQualMap: getSlotQualMap(),\n      qualCatalogSizes: sizes,\n      qualState: QualState?.getAll?.() || null\n    };\n  }\n};\n\nW.CG_FreeChoices = FreeChoices;\nexport default FreeChoices;\n", "// assets/js/src/core/quals/ui.js\n//\n// PURPOSE (after refactor):\n// - ONLY manage the BASE free Language selector (the \"everyone gets one Language\").\n// - REMOVE/STOP rendering the old global \"Qualifications\" UI (chips/add buttons).\n//\n// Slot-scoped qualification selectors (Language/Literacy/Mystic/Piety/Insider from selected gifts)\n// are rendered INLINE by gifts/free-choices.js under the free gift slots.\n//\n// Exposes: window.CG_QualUI\n\nimport Quals from './index.js';\nimport QualState from './state.js';\n\nfunction cgWin() {\n  if (typeof globalThis !== 'undefined') return globalThis;\n  if (typeof window !== 'undefined') return window;\n  return {};\n}\n\nconst W = cgWin();\nconst $ = (W && W.jQuery) ? W.jQuery : null;\n\nfunction modalRoot() {\n  if (typeof document === 'undefined') return null;\n  return document.querySelector('#cg-modal') || null;\n}\n\nfunction stripDiacritics(s) {\n  return String(s || '')\n    .normalize('NFD')\n    .replace(/[\\u0300-\\u036f]/g, '');\n}\n\nfunction canon(s) {\n  return stripDiacritics(String(s || ''))\n    .trim()\n    .replace(/\\s+/g, ' ')\n    .toLowerCase();\n}\n\nfunction uniqSorted(list) {\n  const seen = new Set();\n  const out = [];\n  (Array.isArray(list) ? list : []).forEach(v => {\n    const raw = String(v || '').trim().replace(/\\s+/g, ' ');\n    if (!raw) return;\n    const k = canon(raw);\n    if (!k || seen.has(k)) return;\n    seen.add(k);\n    out.push(raw);\n  });\n  out.sort((a, b) => canon(a).localeCompare(canon(b)));\n  return out;\n}\n\nfunction removeLegacyQualUIs(modal) {\n  if (!modal) return;\n  try {\n    const oldBox = modal.querySelector('#cg-quals-box');\n    if (oldBox) oldBox.remove();\n  } catch (_) {}\n\n  // If any older inline container exists from prior builds, remove it.\n  try {\n    const oldInline = modal.querySelector('#cg-quals-inline');\n    if (oldInline) oldInline.remove();\n  } catch (_) {}\n}\n\nfunction getAllGiftsList() {\n  // Primary: FreeChoices keeps the full gifts list after cg_get_free_gifts\n  const FC = W.CG_FreeChoices;\n  if (FC && Array.isArray(FC._allGifts) && FC._allGifts.length) return FC._allGifts;\n\n  // Secondary (best-effort): other globals if present\n  const GS = W.CG_GiftsState || W.CG_Gifts || null;\n  if (GS) {\n    if (Array.isArray(GS._allGifts) && GS._allGifts.length) return GS._allGifts;\n    if (Array.isArray(GS.allGifts) && GS.allGifts.length) return GS.allGifts;\n    if (Array.isArray(GS.gifts) && GS.gifts.length) return GS.gifts;\n  }\n\n  return [];\n}\n\nfunction getRequiresSpecial(g) {\n  return String(\n    g?.requires_special ??\n    g?.ct_gifts_requires_special ??\n    g?.ct_requires_special ??\n    ''\n  );\n}\n\nfunction extractLanguagesFromGifts(gifts) {\n  const out = [];\n\n  (Array.isArray(gifts) ? gifts : []).forEach(g => {\n    const rs = getRequiresSpecial(g);\n    if (!rs) return;\n\n    // Split into candidate lines\n    const lines = String(rs)\n      .split(/\\r?\\n|\u2022|\u00B7/g)\n      .map(s => String(s || '').trim())\n      .filter(Boolean);\n\n    lines.forEach(line => {\n      // Match: \"Language: X\"\n      const m = line.match(/^language\\s*:\\s*(.+)$/i);\n      if (!m) return;\n\n      const rest = String(m[1] || '').trim();\n      if (!rest) return;\n\n      // If it's clearly generic, ignore (keeps the base list \u201Creal\u201D)\n      const restCanon = canon(rest);\n      if (restCanon === 'any' || restCanon === 'varies' || restCanon === 'see text') return;\n\n      // Some rows might contain multiple languages separated by commas/semicolons\n      rest\n        .split(/\\s*[;,]\\s*/g)\n        .map(x => String(x || '').trim())\n        .filter(Boolean)\n        .forEach(x => out.push(x));\n    });\n  });\n\n  return uniqSorted(out);\n}\n\n/**\n * Best-effort: find where the \"Language\" gift placeholder lives in the Gifts list.\n * If we can't find it reliably, we mount directly before #cg-free-choices placeholder.\n */\nfunction findBaseLanguageHost(modal) {\n  if (!modal) return null;\n\n  // Best: the actual placeholder from render-profile.js\n  const cgLanguage = modal.querySelector('#cg-language');\n  if (cgLanguage) return cgLanguage;\n\n  // Prefer explicit IDs if they exist (future-proofing)\n  const direct =\n    modal.querySelector('#cg-free-language') ||\n    modal.querySelector('#cg-language-choice') ||\n    modal.querySelector('#cg-gift-language');\n  if (direct) return direct;\n\n  // Fallback: mount near free choices placeholder\n  const freeChoices = modal.querySelector('#cg-free-choices') || document.querySelector('#cg-free-choices');\n  if (freeChoices && freeChoices.parentElement) return freeChoices.parentElement;\n\n  return null;\n}\n\nfunction ensureBaseLanguageContainer(modal) {\n  const host = findBaseLanguageHost(modal);\n  if (!host) return null;\n\n  let wrap = modal.querySelector('#cg-base-language');\n  if (!wrap) {\n    wrap = document.createElement('div');\n    wrap.id = 'cg-base-language';\n    wrap.className = 'cg-gift-item cg-base-language';\n    wrap.innerHTML = `<div class=\"cg-base-language-control\"></div>`;\n  }\n\n  // If host is a gift-item, append inside it; otherwise insert before free choices.\n  try {\n    if (host.classList && host.classList.contains('cg-gift-item')) {\n      if (!host.querySelector('#cg-base-language')) host.appendChild(wrap);\n    } else {\n      const freeChoices = modal.querySelector('#cg-free-choices') || document.querySelector('#cg-free-choices');\n      if (freeChoices && freeChoices.parentElement) {\n        if (wrap.parentNode !== freeChoices.parentElement) {\n          freeChoices.parentElement.insertBefore(wrap, freeChoices);\n        }\n      } else if (wrap.parentNode !== host) {\n        host.appendChild(wrap);\n      }\n    }\n  } catch (_) {}\n\n  return wrap;\n}\n\nlet _languageListCache = null;\nlet _languageListLoading = false;\n\nfunction fetchLanguageList(onLoaded) {\n  if (_languageListCache !== null) {\n    if (onLoaded) onLoaded(_languageListCache);\n    return;\n  }\n  if (_languageListLoading) return;\n  _languageListLoading = true;\n\n  try {\n    const ajaxUrl = (W.CG_AJAX && W.CG_AJAX.ajax_url) ? W.CG_AJAX.ajax_url : '/api/ajax';\n    fetch(ajaxUrl, {\n      method: 'POST',\n      credentials: 'same-origin',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({ action: 'cg_get_language_list' }),\n    })\n      .then(r => r.json())\n      .then(json => {\n        _languageListLoading = false;\n        _languageListCache = (json && json.success && Array.isArray(json.data)) ? json.data : [];\n        if (onLoaded) onLoaded(_languageListCache);\n      })\n      .catch(() => {\n        _languageListLoading = false;\n        _languageListCache = [];\n        if (onLoaded) onLoaded(_languageListCache);\n      });\n  } catch (_) {\n    _languageListLoading = false;\n    _languageListCache = [];\n  }\n}\n\nfunction getLanguageLabelsForBaseSelect() {\n  if (_languageListCache !== null && _languageListCache.length) return _languageListCache;\n\n  // Fallback: derive languages from gifts requires_special (legacy path)\n  const gifts = getAllGiftsList();\n  const langs = extractLanguagesFromGifts(gifts);\n  return langs;\n}\n\nfunction renderLanguageSelect(container) {\n  if (!container) return;\n\n  const labels = getLanguageLabelsForBaseSelect();\n  const cur = (QualState && typeof QualState.get === 'function')\n    ? ((QualState.get('language') || [])[0] || '')\n    : '';\n\n  // Ensure current selection is always present, even if not in catalog yet\n  const finalLabels = uniqSorted([cur, ...labels]);\n\n  const opts = finalLabels.map(label => {\n    const sel = (canon(cur) === canon(label)) ? ' selected' : '';\n    const safe = String(label).replace(/\"/g, '&quot;');\n    return `<option value=\"${safe}\"${sel}>${label}</option>`;\n  }).join('\\n');\n\n  container.innerHTML = `\n    <select id=\"cg-base-language-select\" style=\"min-width:220px;\">\n      <option value=\"\">\u2014 Select Language \u2014</option>\n      ${opts}\n    </select>\n  `;\n\n  const sel = container.querySelector('#cg-base-language-select');\n  if (!sel) return;\n\n  sel.addEventListener('change', (e) => {\n    const nextVal = String(e.target.value || '').trim();\n    try { QualState?.init?.(); } catch (_) {}\n\n    // Keep base language as index 0 by rewriting the language list deterministically.\n    try {\n      const current = (QualState && typeof QualState.get === 'function')\n        ? (QualState.get('language') || []).slice()\n        : [];\n\n      const rest = current.filter(v => canon(v) !== canon(nextVal) && canon(v) !== canon(current[0] || ''));\n      const next = nextVal ? [nextVal, ...rest] : rest;\n\n      // Mutate state in-place and persist (QualState.persist() will dispatch cg:quals:changed)\n      if (QualState && QualState.data && Array.isArray(QualState.data.language) && typeof QualState.persist === 'function') {\n        QualState.data.language = next;\n        QualState.persist();\n      } else {\n        // Best-effort fallback: remove old base + add new (order might vary)\n        if (current[0]) QualState.remove('language', current[0]);\n        if (nextVal) QualState.add('language', nextVal);\n      }\n    } catch (_) {}\n  });\n}\n\n// Reuse singleton if module is evaluated twice\nconst Existing = W.CG_QualUI;\n\nconst QualUI = (Existing && Existing.__cg_singleton) ? Existing : {\n  __cg_singleton: true,\n\n  _inited: false,\n  _observer: null,\n  _lastModalPresent: null,\n\n  _renderScheduled: false,\n  _rendering: false,\n\n  _onCatalogUpdated: null,\n  _onBuilderOpened: null,\n  _onTabChanged: null,\n\n  init() {\n    if (this._inited) return;\n    this._inited = true;\n\n    try { QualState?.init?.(); } catch (_) {}\n\n    this._bindEvents();\n    this._installObserver();\n    this._scheduleRender('init');\n  },\n\n  _scheduleRender(reason = '') {\n    if (this._renderScheduled) return;\n    this._renderScheduled = true;\n\n    const run = () => {\n      this._renderScheduled = false;\n      if (this._rendering) return;\n      this._rendering = true;\n      try {\n        this.render();\n      } catch (err) {\n        console.error('[QualUI] render failed', { reason }, err);\n      } finally {\n        this._rendering = false;\n      }\n    };\n\n    if (typeof requestAnimationFrame !== 'undefined') requestAnimationFrame(run);\n    else setTimeout(run, 0);\n  },\n\n  _bindEvents() {\n    if (typeof document === 'undefined') return;\n\n    if (!this._onCatalogUpdated) this._onCatalogUpdated = () => this._scheduleRender('catalog-updated');\n    if (!this._onBuilderOpened)  this._onBuilderOpened  = () => { try { QualState?.init?.(); } catch (_) {} this._scheduleRender('builder-opened'); };\n    if (!this._onTabChanged)     this._onTabChanged     = () => this._scheduleRender('tab-changed');\n\n    document.removeEventListener('cg:quals:catalog-updated', this._onCatalogUpdated);\n    document.addEventListener('cg:quals:catalog-updated', this._onCatalogUpdated);\n\n    document.removeEventListener('cg:builder:opened', this._onBuilderOpened);\n    document.addEventListener('cg:builder:opened', this._onBuilderOpened);\n\n    document.removeEventListener('cg:tab:changed', this._onTabChanged);\n    document.addEventListener('cg:tab:changed', this._onTabChanged);\n\n    if ($ && $.fn) {\n      $(document)\n        .off('cg:quals:catalog-updated.cgqualui cg:builder:opened.cgqualui cg:tab:changed.cgqualui')\n        .on('cg:quals:catalog-updated.cgqualui', this._onCatalogUpdated)\n        .on('cg:builder:opened.cgqualui', this._onBuilderOpened)\n        .on('cg:tab:changed.cgqualui', this._onTabChanged);\n    }\n  },\n\n  _installObserver() {\n    if (this._observer) return;\n    if (typeof MutationObserver === 'undefined' || typeof document === 'undefined') return;\n\n    this._lastModalPresent = !!modalRoot();\n\n    this._observer = new MutationObserver(() => {\n      const present = !!modalRoot();\n      if (present !== this._lastModalPresent) {\n        this._lastModalPresent = present;\n        if (present) this._scheduleRender('modal-opened');\n        return;\n      }\n    });\n\n    this._observer.observe(document.body, { childList: true, subtree: true });\n  },\n\n  render() {\n    const modal = modalRoot();\n    if (!modal) return;\n\n    // Kill old \"Qualifications\" UI so we don't get global piety/literacy/etc spam.\n    removeLegacyQualUIs(modal);\n\n    // Ensure base language selector is mounted near the gifts list\n    const wrap = ensureBaseLanguageContainer(modal);\n    if (!wrap) return;\n\n    const control = wrap.querySelector('.cg-base-language-control');\n    if (!control) return;\n\n    // If language list not yet loaded, fetch it then re-render.\n    if (_languageListCache === null) {\n      fetchLanguageList(() => this._scheduleRender('language-list-loaded'));\n      return;\n    }\n\n    renderLanguageSelect(control);\n  }\n};\n\nW.CG_QualUI = QualUI;\nexport default QualUI;\n", "// assets/js/src/core/gifts/index.js\n//\n// Core-owned Gifts module (no self-boot).\n// BuilderEvents/Core should call GiftsAPI.init().\n//\n// IMPORTANT (Jan 2026):\n// Gifts UI (free-choice dropdowns) is tab-gated and may be initialized only\n// when the user first enters the Gifts tab. In that case the earlier\n// cg:builder:opened / cg:tab:changed events may have already fired.\n// So we force a refresh on init to ensure the dropdowns populate immediately.\n\nimport FreeChoices from './free-choices.js';\nimport State from './state.js';\nimport QualUI from '../quals/ui.js';\n\nexport function init() {\n  try { State.init(); } catch (_) {}\n  try { FreeChoices.init(); } catch (_) {}\n  try { QualUI.init(); } catch (_) {}\n\n  // Ensure data is fetched + UI fills when Gifts tab is opened the first time.\n  // refresh() is safe to call anytime; it will only touch DOM when Gifts tab is active.\n  try { FreeChoices.refresh({ force: false }); } catch (_) {}\n}\n\nexport function refresh(opts = {}) {\n  try { FreeChoices.refresh(opts); } catch (_) {}\n}\n\nexport function getSelected() {\n  return (Array.isArray(State.selected) ? State.selected : []);\n}\n\nconst GiftsAPI = { init, refresh, getSelected };\nexport default GiftsAPI;\n", "// assets/js/src/core/skills/render.js\n//\n// TAB-RESTRUCTURE HARDENING (Dec 2025):\n// - Do not touch DOM unless Skills tab is active AND #skills-table exists.\n// - This prevents background refresh calls from other tabs from mutating UI.\n\nimport FormBuilderAPI from '../formBuilder';\nimport SpeciesAPI     from '../species/api.js';\nimport CareerAPI      from '../career/api.js';\n\nconst $ = window.jQuery;\n\n// Map #marks \u2192 die\nconst MARK_DIE = {\n  1: 'd4',\n  2: 'd6',\n  3: 'd8'\n};\n\nfunction isSkillsTabActive() {\n  try {\n    const li  = document.querySelector('#cg-modal .cg-tabs li.active');\n    const tab = li ? (li.getAttribute('data-tab') || '') : '';\n    if (tab === 'tab-skills') return true;\n\n    const panel = document.getElementById('tab-skills');\n    if (panel && panel.classList.contains('active')) return true;\n  } catch (_) {}\n  return false;\n}\n\n/** -----------------------------\n * Tolerant utilities\n * ------------------------------*/\nfunction pickFirst(obj, keys) {\n  for (const k of keys) {\n    if (obj && Object.prototype.hasOwnProperty.call(obj, k) && obj[k] != null && obj[k] !== '') {\n      return obj[k];\n    }\n  }\n  return null;\n}\n\n/**\n * Extract up to 3 skill IDs from *any* shape:\n * - flat keys: skill_one/two/three, skill_id_1..3, career_skill_1..3, etc.\n * - arrays (of ids or objects with id/skill_id/value)\n * - nested under .skills / .career_skills / .data\n */\nfunction extractSkillTripletFromAny(input) {\n  const asStr = v => (v == null ? '' : String(v));\n\n  if (Array.isArray(input)) {\n    const ids = input\n      .map(x => (typeof x === 'object') ? (x.id ?? x.skill_id ?? x.value ?? null) : x)\n      .filter(v => v != null)\n      .slice(0, 3)\n      .map(asStr);\n    while (ids.length < 3) ids.push('');\n    return ids;\n  }\n\n  if (input && typeof input === 'object') {\n    if (input.skills != null)         return extractSkillTripletFromAny(input.skills);\n    if (input.career_skills != null)  return extractSkillTripletFromAny(input.career_skills);\n    if (input.species_skills != null) return extractSkillTripletFromAny(input.species_skills);\n    if (input.data != null)           return extractSkillTripletFromAny(input.data);\n\n    const id1 = pickFirst(input, [\n      'skill_one', 'skill1', 'skill_id_1', 'skill_one_id', 'career_skill_1', 'career_skill_one'\n    ]);\n    const id2 = pickFirst(input, [\n      'skill_two', 'skill2', 'skill_id_2', 'skill_two_id', 'career_skill_2', 'career_skill_two'\n    ]);\n    const id3 = pickFirst(input, [\n      'skill_three', 'skill3', 'skill_id_3', 'skill_three_id', 'career_skill_3', 'career_skill_three'\n    ]);\n    return [asStr(id1), asStr(id2), asStr(id3)];\n  }\n\n  return ['', '', ''];\n}\n\n/** Best-effort name helpers */\nfunction speciesNameOf(sp) {\n  return (\n    sp?.speciesName ||\n    sp?.species_name ||\n    sp?.name ||\n    ''\n  );\n}\n\nfunction careerNameOf(cp) {\n  return (\n    cp?.careerName ||\n    cp?.career_name ||\n    cp?.name ||\n    ''\n  );\n}\n\nfunction parseExtraCareersFromData(d) {\n  if (!d) return [];\n  if (Array.isArray(d.extraCareers)) return d.extraCareers;\n\n  if (typeof d.extra_careers === 'string' && d.extra_careers.trim()) {\n    try {\n      const arr = JSON.parse(d.extra_careers);\n      if (Array.isArray(arr)) return arr;\n    } catch (_) {}\n  }\n  return [];\n}\n\nexport default {\n  render() {\n    // HARD GATE: only run when Skills tab is active\n    if (!isSkillsTabActive()) return;\n\n    // HARD GATE: only run if the skills table exists\n    let $table = $('#tab-skills #skills-table');\n    if (!$table.length) $table = $('#skills-table');\n    if (!$table.length) return;\n\n    const data    = FormBuilderAPI.getData();\n    const skills  = data.skillsList || window.CG_SKILLS_LIST || [];\n    const species = SpeciesAPI.currentProfile || {};\n    const career  = CareerAPI.currentProfile  || {};\n\n    // Extra careers from state (written by career/extra.js)\n    const extraCareers = parseExtraCareersFromData(data)\n      .filter(x => x && x.id)\n      .map(x => ({\n        id: String(x.id),\n        name: String(x.name || ''),\n        skills: Array.isArray(x.skills) ? x.skills.map(String) : []\n      }));\n\n    // Read marks state & remaining budget\n    data.skillMarks = data.skillMarks || {};\n    const MAX_MARKS = 13;\n    const usedMarks = Object.values(data.skillMarks)\n      .reduce((sum, v) => sum + (parseInt(v, 10) || 0), 0);\n    const marksRemain = Math.max(0, MAX_MARKS - usedMarks);\n\n    // Inject \u201CMarks Remaining\u201D display (scoped to the skills area)\n    $('#tab-skills #marks-remaining, #marks-remaining').remove();\n    $table.before(`\n      <div id=\"marks-remaining\" class=\"marks-remaining\">\n        Marks Remaining: <strong>${marksRemain}</strong>\n      </div>\n    `);\n\n    // Build table header\n    const $thead = $('<thead>');\n    const $tr = $('<tr>')\n      .append('<th>Skill</th>')\n      .append(`<th>${speciesNameOf(species) || ''}</th>`)\n      .append(`<th>${careerNameOf(career) || ''}</th>`);\n\n    // Add extra-career columns\n    extraCareers.forEach(ec => {\n      $tr.append(`<th>${ec.name || 'Extra Career'}</th>`);\n    });\n\n    $tr.append('<th>Marks</th>')\n      .append('<th>Dice Pool</th>')\n      .appendTo($thead);\n\n    // Species & Career skill IDs (tolerant)\n    const spSkills = extractSkillTripletFromAny(species).map(String);\n    const cpSkills = extractSkillTripletFromAny(career).map(String);\n\n    const $tbody = $('<tbody>');\n\n    skills.forEach(skill => {\n      const id   = String(skill.id);\n      const name = skill.name;\n\n      // base dice\n      const spDie = spSkills.includes(id) ? 'd4' : '';\n      const cpDie = cpSkills.includes(id) ? 'd6' : '';\n\n      // Extra careers contribute d4 for matching skills\n      const extraDies = extraCareers.map(ec => (ec.skills || []).includes(id) ? 'd4' : '');\n\n      // mark buttons: empty content, active if mark index \u2264 myMarks\n      const myMarks = parseInt(data.skillMarks[id], 10) || 0;\n      let buttonsHtml = '';\n      [1, 2, 3].forEach(n => {\n        // disable any button above remaining budget (unless already active)\n        const disabled = (usedMarks >= MAX_MARKS && myMarks < n) ? ' disabled' : '';\n        const active   = myMarks >= n ? ' active' : '';\n        buttonsHtml += `<button\n          type=\"button\"\n          class=\"skill-mark-btn${active}\"\n          data-skill-id=\"${id}\"\n          data-mark=\"${n}\"\n          ${disabled}\n        ></button>`;\n      });\n\n      const markDie= myMarks ? MARK_DIE[myMarks] : '';\n      const markDisplay = markDie || '\u2013';\n\n      // dice pool = species + career + extra careers + marks\n      const poolDice = [spDie, cpDie].concat(extraDies).concat([markDie]).filter(Boolean);\n      const poolStr  = poolDice.length ? poolDice.join(' + ') : '\u2013';\n\n      const $row = $('<tr>')\n        .append(`<td>${name}</td>`)\n        .append(`<td>${spDie || '\u2013'}</td>`)\n        .append(`<td>${cpDie || '\u2013'}</td>`);\n\n      // Extra career cells\n      extraDies.forEach(die => {\n        $row.append(`<td>${die || '\u2013'}</td>`);\n      });\n\n      $row\n        .append(`<td>\n                   <div class=\"marks-buttons\">${buttonsHtml}</div>\n                   <div class=\"marks-display\">${markDisplay}</div>\n                 </td>`)\n        .append(`<td>${poolStr}</td>`);\n\n      $tbody.append($row);\n    });\n\n    // Inject into DOM\n    $table\n      .empty()\n      .append($thead)\n      .append($tbody);\n  }\n};\n", "// assets/js/src/core/skills/events.js\n// Skills tab event wiring.\n// IMPORTANT: tab activation is now driven by the canonical cg:tab:changed event\n// emitted from builder-events.js, not by clicking the panel DOM node.\n\nimport FormBuilderAPI from '../formBuilder';\nimport BuilderUI      from '../main/builder-ui.js';\nimport SkillsRender   from './render.js';\n\nconst $ = window.jQuery;\n\nlet _pendingRender = false;\n\nfunction isSkillsTabActive() {\n  try {\n    return String($('#cg-modal .cg-tabs li.active').data('tab') || '') === 'tab-skills';\n  } catch (_) {\n    return false;\n  }\n}\n\nfunction requestRender(_reason = '') {\n  // If skills tab is active, render immediately; otherwise mark pending.\n  if (isSkillsTabActive()) {\n    _pendingRender = false;\n    SkillsRender.render();\n  } else {\n    _pendingRender = true;\n  }\n}\n\nfunction onTabChanged(e) {\n  // Support both native CustomEvent and jQuery-wrapped events.\n  const detail = (e && e.detail) || (e && e.originalEvent && e.originalEvent.detail) || {};\n  const to = String(detail.to || '');\n\n  if (to === 'tab-skills') {\n    // On entry to Skills tab, always render (also clears pending).\n    _pendingRender = false;\n    SkillsRender.render();\n  }\n}\n\nexport default {\n  bind() {\n    // 1) Canonical tab change event (preferred)\n    $(document)\n      .off('cg:tab:changed.cgskills')\n      .on('cg:tab:changed.cgskills', onTabChanged);\n\n    // 2) Species/Career changes: refresh Skills, but only render immediately if Skills tab is active.\n    // (Otherwise we mark pending and the render happens when Skills tab is opened.)\n    $(document)\n      .off('change.cgskills', '#cg-species, #cg-career')\n      .on('change.cgskills', '#cg-species, #cg-career', () => {\n        requestRender('species/career change');\n      });\n\n    // 3) Extra careers: same behavior (pending unless tab active)\n    $(document)\n      .off('cg:extra-careers:changed.cgskills')\n      .on('cg:extra-careers:changed.cgskills', () => {\n        requestRender('extra careers changed');\n      });\n\n    // 4) Handle mark-button clicks (persist into FormBuilderAPI._data)\n    $(document)\n      .off('click.cgskills', '.skill-mark-btn')\n      .on('click.cgskills', '.skill-mark-btn', function() {\n        const skillId = String($(this).data('skill-id') ?? '');\n        const markRaw = parseInt($(this).data('mark'), 10);\n\n        if (!skillId) return;\n        const mark = Number.isFinite(markRaw) ? markRaw : 0;\n\n        // Ensure state exists\n        FormBuilderAPI._data = FormBuilderAPI._data || {};\n        FormBuilderAPI._data.skillMarks = (FormBuilderAPI._data.skillMarks && typeof FormBuilderAPI._data.skillMarks === 'object')\n          ? FormBuilderAPI._data.skillMarks\n          : {};\n\n        const current = parseInt(FormBuilderAPI._data.skillMarks[skillId], 10) || 0;\n\n        // UX: clicking the same active mark decrements by 1 (allows reaching 0)\n        let next = (current === mark) ? Math.max(0, mark - 1) : mark;\n\n        // Clamp to expected range\n        if (next < 0) next = 0;\n        if (next > 3) next = 3;\n\n        FormBuilderAPI._data.skillMarks[skillId] = next;\n\n        // Mark dirty and re-render table (render reads from state)\n        try { BuilderUI.markDirty(); } catch (_) {}\n        SkillsRender.render();\n      });\n\n    // If we bind while Skills is already visible, render once.\n    if (isSkillsTabActive() || _pendingRender) {\n      _pendingRender = false;\n      SkillsRender.render();\n    }\n  }\n};\n", "// assets/js/src/core/skills/index.js\n//\n// TAB-RESTRUCTURE HARDENING (Dec 2025):\n// - Skills should NOT render or touch DOM unless the Skills tab is active.\n// - Events can bind anytime (idempotent), but rendering is gated.\n// - Debug logging is opt-in via: window.CG_DEBUG_SKILLS = true\n\nimport FormBuilderAPI from '../formBuilder';\nimport SkillsEvents   from './events.js';\nimport SkillsRender   from './render.js';\n\nconst $ = window.jQuery;\n\nlet _inited = false;\n\nfunction isSkillsTabActive() {\n  try {\n    // Primary: active tab li in the modal\n    const li  = document.querySelector('#cg-modal .cg-tabs li.active');\n    const tab = li ? (li.getAttribute('data-tab') || '') : '';\n    if (tab === 'tab-skills') return true;\n\n    // Fallback: active panel class\n    const panel = document.getElementById('tab-skills');\n    if (panel && panel.classList.contains('active')) return true;\n  } catch (_) {}\n  return false;\n}\n\nexport default {\n  init() {\n    if (!_inited) {\n      _inited = true;\n\n      if (window.CG_DEBUG_SKILLS) {\n        console.log('[SkillsIndex] init \u2014 builder state:', FormBuilderAPI._data);\n      }\n\n      // Ensure we have the localized skills list\n      if (!Array.isArray(FormBuilderAPI._data.skillsList)) {\n        FormBuilderAPI._data.skillsList = window.CG_SKILLS_LIST || [];\n      }\n\n      // Initialize marks-allocation storage if missing\n      if (typeof FormBuilderAPI._data.skillMarks !== 'object' || !FormBuilderAPI._data.skillMarks) {\n        FormBuilderAPI._data.skillMarks = {};\n      }\n\n      // Wire up handlers (idempotent)\n      SkillsEvents.bind();\n    }\n\n    // Render ONLY if Skills tab is active (render.js is also gated)\n    if (isSkillsTabActive()) {\n      SkillsRender.render();\n    }\n  }\n};\n", "// Shared utilities for Summary\r\n\r\n/**\r\n * Capitalize first letter and replace underscores/dashes with spaces.\r\n */\r\nexport function capitalize(str) {\r\n  if (typeof str !== 'string') return '';\r\n  const cleaned = str.replace(/[_\\-]/g, ' ');\r\n  return cleaned.charAt(0).toUpperCase() + cleaned.slice(1);\r\n}\r\n\r\n/**\r\n * Given a die string like \"d8\", return half (rounded up) as a \"dX\".\r\n */\r\nexport function halfDie(die) {\r\n  if (typeof die !== 'string' || die[0] !== 'd') return '';\r\n  const n = parseInt(die.slice(1), 10);\r\n  return `d${Math.ceil(n / 2)}`;\r\n}\r\n\r\n/**\r\n * Maximum values for dice types.\r\n */\r\nexport const DIE_MAX = {\r\n  d4:  4,\r\n  d6:  6,\r\n  d8:  8,\r\n  d10: 10,\r\n  d12: 12\r\n};\r\n", "// assets/js/src/core/summary/api.js\n\nimport FormBuilderAPI from '../formBuilder';\nimport * as Utils     from './utils.js';\nimport TraitsService  from '../traits/service.js';\nimport SpeciesAPI     from '../species/api.js';\nimport CareerAPI      from '../career/api.js';\n\nconst $ = window.jQuery;\nconst TRAITS   = TraitsService.TRAITS;\nconst MARK_DIE = { 1: 'd4', 2: 'd6', 3: 'd8' };\n\nconst SummaryAPI = {\n  /**\n   * Entry point when the Summary tab is shown.\n   */\n  init() {\n    // CG HARDEN: make init() idempotent\n    // builder-refresh may call init() many times; this prevents duplicate bindings.\n    if (this.__cg_inited) {\n      try {\n        // Still refresh summary from current builder state on repeated calls\n        if (typeof window !== 'undefined' && window.FormBuilderAPI && typeof window.FormBuilderAPI.getData === 'function') {\n          this.renderSummary(window.FormBuilderAPI.getData() || {});\n            // Keep Summary bindings alive even on repeated init() calls\n            try { this.bindExportButton();\n\n      // Live updates: keep #cg-summary-sheet in sync while typing on other tabs\n      this.bindLiveUpdates(); } catch (_) {}\n            try { this.bindLiveUpdates(); } catch (_) {}\n\n        }\n      } catch (_) {}\n      return;\n    }\n    this.__cg_inited = true;\n    const data = FormBuilderAPI.getData();\n    console.log('[SummaryAPI] init \u2014 builder state:', data);\n\n    // 1) Render all summary sections\n    this.renderSummary(data);\n\n    \n\n      // CG HARDEN: auto-render on form changes\n      this.bindAutoRender();// 2) Wire up the Export to PDF button\n    this.bindExportButton();\n  },\n\n  /**\n   * Build and inject the full summary into #cg-summary-sheet.\n   */\n  renderSummary(data = {}) {\n    const $sheet = $('#cg-summary-sheet').empty();\n\n    // Basic Info\n    const name   = data.name   || '\u2014';\n    const age    = data.age    || '\u2014';\n    const gender = data.gender || '\u2014';\n    const motto  = data.motto  || '\u2014';\n\n    // Goals\n    const goals = [1, 2, 3]\n      .map(i => data[`goal${i}`] || '\u2014')\n      .filter(v => v !== '\u2014')\n      .join(', ')\n      || '\u2014';\n\n    // Description & Backstory\n    const description = data.description || '\u2014';\n    const backstory   = data.backstory   || '\u2014';\n\n    // Species & Career\n    const species = SpeciesAPI.currentProfile || {};\n    const career  = CareerAPI.currentProfile  || {};\n\n    // Skills, Marks, Battle\n    const skills = window.CG_SKILLS_LIST || [];\n    const marks  = data.skillMarks  || {};\n    const battle = data.battle      || [];\n\n    // Assemble HTML\n    let html = `\n      <div class=\"summary-section summary-basic\">\n        <h2>${name}</h2>\n        <p><strong>Age:</strong> ${age}</p>\n        <p><strong>Gender:</strong> ${gender}</p>\n        <p><strong>Motto:</strong> ${motto}</p>\n      </div>\n\n      <div class=\"summary-section summary-goals\">\n        <p><strong>Goals:</strong> ${goals}</p>\n      </div>\n\n      <div class=\"summary-section summary-description\">\n        <p><strong>Description:</strong> ${description}</p>\n      </div>\n\n      <div class=\"summary-section summary-backstory\">\n        <p><strong>Backstory:</strong> ${backstory}</p>\n      </div>\n\n      <div class=\"summary-section summary-species\">\n        <h3>Species: ${species.speciesName || '\u2014'}</h3>\n        <ul>\n    `;\n    ['gift_1','gift_2','gift_3'].forEach((_, idx) => {\n      const gift = species[`gift_${idx+1}`];\n      const mult = species[`manifold_${idx+1}`] || 1;\n      if (gift) {\n        html += `<li><strong>Gift ${idx+1}:</strong> ${gift} \u00D7 ${mult}</li>`;\n      }\n    });\n    html += `</ul></div>`;\n\n    html += `\n      <div class=\"summary-section summary-career\">\n        <h3>Career: ${career.careerName || '\u2014'}</h3>\n        <ul>\n    `;\n    ['gift_1','gift_2','gift_3'].forEach((_, idx) => {\n      const gift = career[`gift_${idx+1}`];\n      const mult = career[`manifold_${idx+1}`] || 1;\n      if (gift) {\n        html += `<li><strong>Gift ${idx+1}:</strong> ${gift} \u00D7 ${mult}</li>`;\n      }\n    });\n    html += `</ul></div>`;\n\n    html += `\n      <div class=\"summary-section summary-traits\">\n        <h3>Traits</h3>\n        <ul>\n    `;\n    TRAITS.forEach(key => {\n      let label = key.replace(/^trait_/, '');\n      if (label === 'species') label = 'Species';\n      else if (label === 'career') label = 'Career';\n      else label = Utils.capitalize(label);\n\n      const base  = data[key] || '\u2014';\n      const boost = TraitsService.getBoostedDie(key);\n      const display = boost ? `${base} \u2192 ${boost}` : base;\n\n      html += `<li><strong>${label}:</strong> ${display}</li>`;\n    });\n    html += `</ul></div>`;\n\n    html += `\n      <div class=\"summary-section summary-skills\">\n        <h3>Skills</h3>\n        <table class=\"cg-summary-skills\">\n          <thead><tr><th>Skill</th><th>Dice Pool</th></tr></thead>\n          <tbody>\n    `;\n    const spIds = [species.skill_one, species.skill_two, species.skill_three].map(String);\n    const cpIds = [career.skill_one,  career.skill_two,  career.skill_three].map(String);\n\n    skills.forEach(skill => {\n      const id = String(skill.id);\n      const sp = spIds.includes(id) ? 'd4' : '';\n      const cp = cpIds.includes(id) ? 'd6' : '';\n      const mk = MARK_DIE[marks[id]] || '';\n      const pool = [sp, cp, mk].filter(Boolean).join(' + ') || '\u2014';\n      html += `<tr><td>${skill.name}</td><td>${pool}</td></tr>`;\n    });\n    html += `\n          </tbody>\n        </table>\n      </div>\n    `;\n\n    if (battle.length) {\n      html += `\n        <div class=\"summary-section summary-battle\">\n          <h3>Battle</h3>\n          <ul>\n      `;\n      battle.forEach(item => {\n        html += `<li><strong>${Utils.capitalize(item.key)}:</strong> ${item.value}</li>`;\n      });\n      html += `</ul></div>`;\n    }\n\n    // Inject all HTML\n    $sheet.html(html);\n  },\n  // CG HARDEN: live summary updates across tabs\n  bindLiveUpdates() {\n    // One-time binding\n    if (this.__cg_live_bound) return;\n    this.__cg_live_bound = true;\n  \n    const sel = '#cg-modal input, #cg-modal select, #cg-modal textarea';\n    const self = this;\n  \n    function scheduleRender(e) {\n      try {\n        // Only if the summary sheet exists in DOM\n        if (!document.getElementById('cg-summary-sheet')) return;\n  \n        const t = e && e.target;\n        if (!t) return;\n  \n        // Ignore anything inside the summary sheet itself (avoid feedback loops)\n        if (t.closest && t.closest('#cg-summary-sheet')) return;\n  \n        clearTimeout(self.__cg_live_timer);\n        self.__cg_live_timer = setTimeout(() => {\n          try {\n            const data = (FormBuilderAPI && typeof FormBuilderAPI.getData === 'function')\n              ? (FormBuilderAPI.getData() || {})\n              : ((window.FormBuilderAPI && typeof window.FormBuilderAPI.getData === 'function')\n                ? (window.FormBuilderAPI.getData() || {})\n                : {});\n            self.renderSummary(data);\n          } catch (err) {\n            console.warn('[SummaryAPI] live update failed', err);\n          }\n        }, 200);\n      } catch (_) {}\n    }\n  \n    // Delegated + namespaced (idempotent)\n    $(document)\n      .off('input.cgSummary change.cgSummary', sel)\n      .on('input.cgSummary change.cgSummary', sel, scheduleRender);\n  \n    // First sync (in case user already typed before Summary tab was opened)\n    try { this.renderSummary(FormBuilderAPI.getData() || {}); } catch (_) {}\n  },\n\n\n  /**\n   * Open a new window, inject the summary + CSS, and print it.\n   */\n\n  // CG HARDEN: bindAutoRender (live summary updates)\n  // - Debounced re-render so typing doesn't spam heavy DOM work.\n  _scheduleRender(delayMs = 150) {\n    try {\n      if (this.__cg_render_timer) clearTimeout(this.__cg_render_timer);\n      this.__cg_render_timer = setTimeout(() => {\n        this.__cg_render_timer = null;\n        try {\n          const data = (typeof FormBuilderAPI !== 'undefined' && FormBuilderAPI.getData)\n            ? (FormBuilderAPI.getData() || {})\n            : (window.FormBuilderAPI?.getData?.() || {});\n          this.renderSummary(data);\n        } catch (_) {}\n      }, delayMs);\n    } catch (_) {}\n  },\n\n  bindAutoRender() {\n    // Idempotent: bind only once per page-load\n    if (this.__cg_autobound) return;\n    this.__cg_autobound = true;\n\n    // Remove old listeners if they exist (paranoia / hot reload)\n    try {\n      if (this.__cg_auto_handler) {\n        document.removeEventListener('input',  this.__cg_auto_handler, true);\n        document.removeEventListener('change', this.__cg_auto_handler, true);\n      }\n    } catch (_) {}\n\n    this.__cg_auto_handler = (e) => {\n      try {\n        const t = e && e.target;\n        if (!t) return;\n        const modal = document.getElementById('cg-modal');\n        if (!modal || !modal.contains(t)) return;\n\n        // input = typing (debounce a bit), change = selects/radios (render sooner)\n        const isChange = (e.type === 'change');\n        this._scheduleRender(isChange ? 0 : 150);\n      } catch (_) {}\n    };\n\n    document.addEventListener('input',  this.__cg_auto_handler, true);\n    document.addEventListener('change', this.__cg_auto_handler, true);\n  },\n\n  // CG HARDEN: namespaced export click\n\n  bindExportButton() {\n    $(document)\n      .off('click.cg', '#cg-export-pdf')\n      .on('click.cg', '#cg-export-pdf', e => {\n        e.preventDefault();\n        console.log('[SummaryAPI] Export to PDF clicked');\n\n        // 1) Grab the summary HTML\n        const sheetHtml = document\n          .getElementById('cg-summary-sheet')\n          .outerHTML;\n\n        // 2) Collect current <link rel=\"stylesheet\"> tags\n        const cssLinks = Array.from(\n          document.querySelectorAll('link[rel=\"stylesheet\"]')\n        )\n        .map(link => link.outerHTML)\n        .join('\\n');\n\n        // 3) Open a print window and write minimal HTML\n        const printWin = window.open('', '_blank', 'width=800,height=600');\n        printWin.document.open();\n        printWin.document.write(`\n          <!doctype html>\n          <html>\n            <head>\n              <meta charset=\"utf-8\">\n              <title>Character Sheet</title>\n              ${cssLinks}\n              <style>\n                @page { margin: 1cm; }\n                body { margin:0; padding:0; }\n              </style>\n            </head>\n            <body>\n              ${sheetHtml}\n            </body>\n          </html>\n        `);\n        printWin.document.close();\n        printWin.focus();\n\n        // 4) Trigger print and close window\n        setTimeout(() => {\n          printWin.print();\n          printWin.close();\n        }, 300);\n      });\n  }\n};\n\nexport default SummaryAPI;\n", "// assets/js/src/core/summary/index.js\n//\n// Summary module entry.\n// - Expose SummaryAPI on window at module-load for console debugging.\n// - Bind live auto-render at module-load so Summary updates even before visiting the Summary tab.\n// - Do NOT auto-call SummaryAPI.init() here; init() is still called by builder-refresh when Summary tab is shown.\n\nimport SummaryAPI from './api.js';\n\ntry {\n  if (typeof window !== 'undefined') {\n    window.SummaryAPI = window.SummaryAPI || SummaryAPI;\n\n    // CG HARDEN: bind auto-render at module load (no tab switch required)\n    if (window.SummaryAPI && typeof window.SummaryAPI.bindAutoRender === 'function') {\n      window.SummaryAPI.bindAutoRender();\n    }\n  }\n} catch (_) {}\n\nexport default {\n  init() {\n    SummaryAPI.init();\n  }\n};\n", "import TraitsAPI      from '../traits';\nimport SpeciesIndex   from '../species';\nimport CareerIndex    from '../career';\nimport GiftsAPI       from '../gifts';\nimport SkillsAPI      from '../skills';\nimport SummaryAPI     from '../summary';\n\nconst $ = window.jQuery;\n\n// Only re-init the active tab\u2019s logic (no DOM\u2192state merging here)\nexport default function refreshTab() {\n  const tab = String($('#cg-modal .cg-tabs li.active').data('tab') || '');\n\n  switch (tab) {\n    case 'tab-details':\n      // Pure inputs; no module init required.\n      break;\n\n    case 'tab-traits':\n      // Traits + Species + Career live together now.\n      // IMPORTANT ORDER:\n      // Career init (and career/extra.js render) creates the \"boost target\" radios.\n      // TraitsService reads those radios; if we run Traits first it defaults to 'main'.\n      SpeciesIndex.init();\n      CareerIndex.init();\n\n      // Next-tick Traits init so Career/Extra UI has a chance to render first.\n      setTimeout(() => {\n        try { TraitsAPI.init(); } catch (e) { console.error('[builder-refresh] TraitsAPI.init failed', e); }\n      }, 0);\n\n      break;\n\n    case 'tab-gifts':\n      GiftsAPI.init();\n      break;\n\n    case 'tab-skills':\n      SkillsAPI.init();\n      break;\n\n    case 'tab-trappings':\n      // Placeholder tab for now.\n      break;\n\n    case 'tab-description':\n      // Pure inputs; no module init required.\n      break;\n\n    case 'tab-summary':\n      SummaryAPI.init();\n      break;\n  }\n}\n", "// assets/js/src/core/main/builder-load.js\n// BuilderLoad v2026-01-04: guard against MutationObserver self-trigger loops + better AJAX parsing\nimport FormBuilderAPI from '../formBuilder';\n\nconst $ = window.jQuery;\nconst LOG = (...a) => console.log('[BuilderLoad]', ...a);\nconst ERR = (...a) => console.error('[BuilderLoad]', ...a);\n\nlet _inited = false;\n\n// Cache to avoid repeated AJAX calls and reduce flicker\nlet _cacheRows = null;\nlet _cacheAt = 0;\nconst CACHE_MS = 30_000;\n\n// Guards to prevent runaway loops\nlet _inFlight = null;           // promise of current list fetch\nlet _populating = false;        // we are actively mutating the select options\nlet _suppressObserver = false;  // ignore observer callbacks during our own DOM writes\nlet _lastEnsureAt = 0;\nconst ENSURE_THROTTLE_MS = 250;\n\nlet _lastForceFetchAt = 0;\nconst FORCE_THROTTLE_MS = 2000;\n\nfunction _getListRequest() {\n  // Prefer the current API name, but support the older one if present.\n  if (FormBuilderAPI && typeof FormBuilderAPI.listCharacters === 'function') {\n    return FormBuilderAPI.listCharacters();\n  }\n  if (FormBuilderAPI && typeof FormBuilderAPI.fetchCharacters === 'function') {\n    return FormBuilderAPI.fetchCharacters();\n  }\n  return null;\n}\n\nfunction _parseRows(resp) {\n  let parsed = resp;\n\n  if (typeof resp === 'string') {\n    try { parsed = JSON.parse(resp); } catch (_) { /* keep string */ }\n  }\n\n  // WordPress-style: { success: true|false, data: ... }\n  if (parsed && typeof parsed === 'object' && Object.prototype.hasOwnProperty.call(parsed, 'success')) {\n    if (parsed.success !== true) {\n      ERR('AJAX returned success:false', parsed.data || parsed);\n      return [];\n    }\n    if (Array.isArray(parsed.data)) return parsed.data;\n    if (Array.isArray(parsed.data?.data)) return parsed.data.data;\n    return [];\n  }\n\n  // Sometimes APIs return { data: [...] } or raw [...]\n  if (Array.isArray(parsed)) return parsed;\n  if (parsed && typeof parsed === 'object' && Array.isArray(parsed.data)) return parsed.data;\n\n  return [];\n}\n\nfunction fetchCharacterList(force = false) {\n  // Prevent duplicate concurrent calls\n  if (_inFlight) return _inFlight;\n\n  const now = Date.now();\n\n  // Throttle force-refresh storms (e.g. accidental repeated refresh events)\n  if (force && (now - _lastForceFetchAt) < FORCE_THROTTLE_MS && _cacheRows) {\n    return $.Deferred().resolve(_cacheRows).promise();\n  }\n\n  // Use cache unless force\n  if (!force && _cacheRows && (now - _cacheAt) < CACHE_MS) {\n    return $.Deferred().resolve(_cacheRows).promise();\n  }\n\n  LOG('fetching characters via AJAX\u2026', force ? '(force)' : '');\n\n  const req = _getListRequest();\n  if (!req) {\n    ERR('No listCharacters()/fetchCharacters() available on FormBuilderAPI');\n    return $.Deferred().resolve([]).promise();\n  }\n\n  const d = $.Deferred();\n  _inFlight = d.promise();\n  if (force) _lastForceFetchAt = now;\n\n  const finalize = (rows) => {\n    _inFlight = null;\n    d.resolve(rows);\n  };\n\n  const onOk = (resp) => {\n    const rows = _parseRows(resp);\n    _cacheRows = Array.isArray(rows) ? rows : [];\n    _cacheAt = Date.now();\n    LOG(`fetched ${_cacheRows.length} records`);\n    finalize(_cacheRows);\n  };\n\n  const onFail = (xhr, status, err) => {\n    // jqXHR-style failure\n    ERR('character list request failed', status, err, xhr?.status, xhr?.responseText);\n    finalize([]);\n  };\n\n  // Support both jqXHR (jQuery Deferred) and native Promises.\n  if (typeof req.then === 'function') {\n    Promise.resolve(req).then(onOk).catch((err) => {\n      ERR('character list request failed', err);\n      finalize([]);\n    });\n  } else if (typeof req.done === 'function' && typeof req.fail === 'function') {\n    req.done(onOk).fail(onFail);\n  } else {\n    ERR('character list request returned an unsupported value:', req);\n    finalize([]);\n  }\n\n  return _inFlight;\n}\n\nfunction populateLoadSelect(rows) {\n  const $sel = $('#cg-splash-load-select');\n  if (!$sel.length) return;\n\n  _populating = true;\n  _suppressObserver = true;\n\n  try {\n    const current = String($sel.val() || '');\n    $sel.empty();\n    $sel.append($('<option>', { value: '', text: '-- Select a character --' }));\n\n    (rows || []).forEach((r) => {\n      const id = String(r?.id ?? '');\n      const name = String(r?.name ?? '');\n      if (!id) return;\n      $sel.append($('<option>', { value: id, text: name || `#${id}` }));\n    });\n\n    if (current) $sel.val(current);\n  } finally {\n    // Let DOM mutations settle, then re-enable observer-driven checks.\n    setTimeout(() => {\n      _suppressObserver = false;\n      _populating = false;\n    }, 0);\n  }\n}\n\nfunction ensurePopulated({ force = false } = {}) {\n  const now = Date.now();\n  if ((now - _lastEnsureAt) < ENSURE_THROTTLE_MS) return;\n  _lastEnsureAt = now;\n\n  if (_populating || _suppressObserver) return;\n\n  const $sel = $('#cg-splash-load-select');\n  if (!$sel.length) return;\n\n  const count = $sel.find('option').length;\n  if (count > 1) return;\n\n  // If we already have a cache and we're not forcing, just paint it (no AJAX).\n  if (!force && _cacheRows && (now - _cacheAt) < CACHE_MS) {\n    populateLoadSelect(_cacheRows);\n    return;\n  }\n\n  LOG('populating #cg-splash-load-select');\n  fetchCharacterList(force).always(populateLoadSelect);\n}\n\nfunction _makeDebouncedEnsure() {\n  let t = null;\n  return () => {\n    if (t) return;\n    t = setTimeout(() => {\n      t = null;\n      ensurePopulated({ force: false });\n    }, 50);\n  };\n}\n\nexport default function bindLoadEvents() {\n  if (_inited) return;\n  _inited = true;\n\n  LOG('init');\n\n  // Populate once on init if present\n  ensurePopulated({ force: false });\n\n  // Cross-bundle idempotency: store all native listeners/observers on window.__CG_EVT__.\n  try {\n    window.__CG_EVT__ = window.__CG_EVT__ || {};\n\n    // ---- MutationObserver (idempotent) ----\n    if (window.__CG_EVT__.builderLoadObserver) {\n      try { window.__CG_EVT__.builderLoadObserver.disconnect(); } catch (_) {}\n    }\n\n    const debouncedEnsure = _makeDebouncedEnsure();\n\n    window.__CG_EVT__.builderLoadObserver = new MutationObserver(() => {\n      if (_suppressObserver) return;\n      debouncedEnsure();\n    });\n\n    try {\n      window.__CG_EVT__.builderLoadObserver.observe(document.body, { childList: true, subtree: true });\n    } catch (_) {}\n\n    // ---- Custom event cg:characters:refresh (idempotent, NEVER anonymous) ----\n    if (window.__CG_EVT__.charactersRefreshLoad) {\n      document.removeEventListener('cg:characters:refresh', window.__CG_EVT__.charactersRefreshLoad);\n    }\n\n    window.__CG_EVT__.charactersRefreshLoad = () => {\n      LOG('received cg:characters:refresh \u2192 repopulating load list');\n      fetchCharacterList(true).always(populateLoadSelect);\n    };\n\n    document.addEventListener('cg:characters:refresh', window.__CG_EVT__.charactersRefreshLoad);\n  } catch (e) {\n    ERR('failed to bind load listeners', e);\n  }\n\n  // Public debug handle (optional)\n  try {\n    window.CG_BuilderLoad = window.CG_BuilderLoad || {};\n    window.CG_BuilderLoad.refresh = () => fetchCharacterList(true).always(populateLoadSelect);\n    window.CG_BuilderLoad.ensure  = () => ensurePopulated({ force: false });\n    window.CG_BuilderLoad._debug  = () => ({\n      cacheAgeMs: _cacheAt ? (Date.now() - _cacheAt) : null,\n      cacheCount: Array.isArray(_cacheRows) ? _cacheRows.length : null,\n      inFlight: !!_inFlight,\n      populating: _populating,\n      suppressObserver: _suppressObserver\n    });\n  } catch (_) {}\n}\n", "// assets/js/src/core/main/builder-save.js\n//\n// HARDENING (Jan 2026):\n// - Prevent duplicate save handlers (jQuery delegated + legacy selectors).\n// - Explicitly unbind any old handlers attached to \".cg-close-after-save\".\n// - Stop propagation so only ONE save path runs.\n// - Route through FormBuilderAPI.save() so there is ONE save implementation + ONE in-flight guard.\n\nimport FormBuilderAPI from '../formBuilder';\n\nconst $ = window.jQuery;\n\nconst LOG  = (...a) => console.log('[BuilderSave]', ...a);\nconst WARN = (...a) => console.warn('[BuilderSave]', ...a);\n\nfunction setSaveButtonsDisabled(disabled) {\n  try {\n    $('#cg-modal .cg-save-button')\n      .prop('disabled', !!disabled)\n      .toggleClass('cg-disabled', !!disabled);\n  } catch (_) {}\n}\n\nexport default function bindSaveEvents() {\n  // HARD DEDUPE:\n  // Remove any previously bound click handlers for these selectors (namespaced or not).\n  // This catches legacy code that bound \".cg-close-after-save\" separately.\n  $(document).off('click', '.cg-save-button');\n  $(document).off('click', '.cg-close-after-save');\n\n  // Rebind with our namespace.\n  $(document).on('click.cg', '.cg-save-button', function (e) {\n    e.preventDefault();\n\n    // Critical: prevents other click handlers for the same event from firing AFTER this one.\n    // If some other handler was bound earlier on a different selector, our .off above removes it.\n    e.stopImmediatePropagation();\n\n    const $btn = $(this);\n\n    // Save & Close buttons carry this class in the markup.\n    const shouldClose = $btn.hasClass('cg-close-after-save');\n\n    if (window.CG_SAVE_IN_FLIGHT) {\n      WARN('Save click ignored: CG_SAVE_IN_FLIGHT already true', { shouldClose });\n      return;\n    }\n\n    setSaveButtonsDisabled(true);\n    LOG('\u25B6 Saving character...', { shouldClose });\n\n    const req = FormBuilderAPI.save(!!shouldClose);\n\n    // jqXHR has .always()\n    if (req && typeof req.always === 'function') {\n      req.always(() => setSaveButtonsDisabled(false));\n    } else {\n      // Best-effort unlock\n      setTimeout(() => setSaveButtonsDisabled(false), 1500);\n    }\n  });\n}\n", "/**\n * assets/js/src/core/main/builder-events.js\n * Maintains original builder wiring and adds safe hydration for Species/Career\n * across New, Load, tab switches, and post-save refreshes.\n *\n * IMPORTANT:\n * - Do NOT include trait_* selects in Species/Career selectors.\n * - Tabs may detach panels; when #cg-species/#cg-career are not present we must NOT\n *   accidentally target #cg-trait_species/#cg-trait_career.\n *\n * Jan 2026 fix:\n * - Prevent programmatic \"change\" events firing just because options were injected.\n *   Only fire change when we are applying a real record selection.\n * - Remove redundant NEW-character hydration (tab-click hydration already runs).\n */\n\nimport BuilderUI       from './builder-ui.js';\nimport FormBuilderAPI  from '../formBuilder';\nimport refreshTab      from './builder-refresh.js';\nimport bindLoadEvents  from './builder-load.js';\nimport bindSaveEvents  from './builder-save.js';\nimport TraitsAPI       from '../traits';\nimport SpeciesIndex    from '../species';\nimport CareerIndex     from '../career';\nimport GiftsAPI        from '../gifts';\nimport SkillsAPI       from '../skills';\nimport SummaryAPI      from '../summary';\n\n// Fallback APIs (used only if Index modules don't populate)\nimport SpeciesAPI      from '../species/api.js';\nimport CareerAPI       from '../career/api.js';\n\nconst $ = window.jQuery;\n\nconst LOG = (...a) => console.log('[BuilderEvents]', ...a);\nconst ERR = (...a) => console.error('[BuilderEvents]', ...a);\n\n// Broad selectors to match your actual controls no matter how they\u2019re rendered\n// NOTE: intentionally excludes trait_species / trait_career.\nconst SEL = {\n  species: '#cg-species, select[name=\"species\"], select[data-cg=\"species\"], .cg-species',\n  career:  '#cg-career,  select[name=\"career\"],  select[data-cg=\"career\"],  .cg-career',\n};\n\nfunction firstSelect(selector) {\n  const $sel = $(selector);\n  // prefer in-modal elements if multiple exist\n  const $modalSel = $('#cg-modal').find(selector);\n  if ($modalSel.length) return $modalSel.first();\n  return $sel.length ? $sel.first() : null;\n}\n\nfunction setSelectValue($sel, want) {\n  if (!$sel || !$sel.length || !want) return false;\n\n  const valRaw = String(want);\n  const val = valRaw.trim();\n\n  // Extra safety: never set a select to a dice value\n  const dice = new Set(['d4','d6','d8','d10','d12','\u2013','-']);\n  if (dice.has(val.toLowerCase())) return false;\n\n  $sel.val(val);\n  if (String($sel.val() || '') === val) return true;\n\n  // fallback: try by visible text\n  const $byText = $sel.find('option').filter(function () {\n    return $(this).text() === val;\n  }).first();\n\n  if ($byText.length) {\n    $sel.val($byText.val());\n    return true;\n  }\n  return false;\n}\n\n/**\n * Emit a single canonical tab-change event.\n * This is the anchor for the upcoming tab restructure so modules stop binding\n * \"panel click\" hacks and instead react to cg:tab:changed.\n */\nfunction emitTabChanged(fromTab, toTab) {\n  try {\n    if (!toTab) return;\n    if (fromTab && String(fromTab) === String(toTab)) return; // no-op: same tab\n    document.dispatchEvent(new CustomEvent('cg:tab:changed', {\n      detail: {\n        from: fromTab ? String(fromTab) : '',\n        to:   String(toTab),\n      }\n    }));\n  } catch (_) { /* non-fatal */ }\n}\n\n/**\n * hydrateSelect(kind: 'species'|'career', { force, record })\n * - Calls your Index module first (render/refresh); if empty, falls back to API.populateSelect\n * - Applies record\u2019s saved selection (id or name)\n * - IMPORTANT: Only triggers \"change\" when we actually applied a non-empty record selection.\n *   Do NOT trigger change merely because options were injected; that causes duplicate empty logs.\n */\nfunction hydrateSelect(kind, { force = false, record = null } = {}) {\n  const key      = kind === 'species' ? 'species' : 'career';\n  const selector = kind === 'species' ? SEL.species : SEL.career;\n  const $sel     = firstSelect(selector);\n\n  if (!$sel) { LOG(`no ${kind} select found`); return $.Deferred().resolve().promise(); }\n\n  const el = $sel.get(0);\n  const beforeVal = String($sel.val() || '').trim();\n\n  // Prefer project modules\n  try {\n    const Index = (kind === 'species') ? SpeciesIndex : CareerIndex;\n    if (Index?.refresh) Index.refresh();\n    else if (Index?.render) Index.render();\n  } catch (_) { /* non-fatal */ }\n\n  // Fallback populate via API if still empty\n  const ensureOptions = () => {\n    if (el.options.length > 1 && !force) return $.Deferred().resolve().promise();\n    const API = (kind === 'species') ? SpeciesAPI : CareerAPI;\n    if (typeof API?.populateSelect !== 'function') return $.Deferred().resolve().promise();\n    return API.populateSelect(el, { force: !!force });\n  };\n\n  const doApply = () => {\n    if (!record) return;\n\n    const wantRaw = record[key] ?? record[`${key}_id`] ?? '';\n    const want = String(wantRaw || '').trim();\n    if (!want) return;\n\n    const applied = setSelectValue($sel, want);\n    const afterVal = String($sel.val() || '').trim();\n\n    // Only trigger change if we have a real, non-empty selection after applying.\n    // This avoids \"selected species \u2192 ''\" logs during mere option injection.\n    if (afterVal) {\n      // If we successfully applied OR the value now differs from before, notify downstream\n      if (applied || afterVal !== beforeVal) {\n        $sel.trigger('change');\n      }\n    }\n  };\n\n  // Give the DOM a tick in case Index.render() appended later in the event loop\n  return $.Deferred(function (dfr) {\n    setTimeout(() => {\n      ensureOptions()\n        .then(() => { doApply(); dfr.resolve(); })\n        .catch(() => dfr.resolve());\n    }, 0);\n  }).promise();\n}\n\nfunction hydrateSpeciesAndCareer(opts = {}) {\n  return $.when(\n    hydrateSelect('species', opts),\n    hydrateSelect('career',  opts)\n  );\n}\n\n// Stable handler reference so we can remove/re-add safely.\nfunction onCharactersRefresh() {\n  setTimeout(() => {\n    hydrateSpeciesAndCareer({ force: true });\n  }, 0);\n}\n\nexport default function bindUIEvents() {\n  LOG('bindUIEvents() called');\n\n  // Core-owned Gifts module init (idempotent)\n  try { GiftsAPI?.init?.(); } catch (_) {}\n\n  // 1) Mark form dirty on change & sync into FormBuilderAPI._data\n  $(document)\n    .off('input.cg change.cg', '#cg-modal input, #cg-modal select, #cg-modal textarea')\n    .on('input.cg change.cg', '#cg-modal input, #cg-modal select, #cg-modal textarea', function() {\n      BuilderUI.markDirty();\n\n      const $el = $(this);\n\n      // Skill-marks inputs don\u2019t have an ID, so handle them explicitly\n      if ($el.hasClass('skill-marks')) {\n        const skillId = $el.data('skill-id');\n        const val     = parseInt($el.val(), 10) || 0;\n        FormBuilderAPI._data.skillMarks = FormBuilderAPI._data.skillMarks || {};\n        FormBuilderAPI._data.skillMarks[skillId] = val;\n        return;\n      }\n\n      // All other fields map by stripping \u201Ccg-\u201D off the ID\n      const id  = this.id;     // e.g. \u201Ccg-name\u201D, \u201Ccg-body\u201D, \u201Ccg-species\u201D\n      if (!id) return;\n      const key = id.replace(/^cg-/, '');\n      FormBuilderAPI._data[key] = $el.val();\n    });\n\n  // 2) Show splash (dropdown population is owned by builder-load.js)\n  $(document)\n    .off('click.cg', '#cg-open-builder')\n    .on('click.cg', '#cg-open-builder', e => {\n      e.preventDefault();\n      $('#cg-modal-splash').removeClass('cg-hidden').addClass('visible');\n\n      // If the dropdown exists but is still empty, ask BuilderLoad to populate ONCE.\n      try {\n        const $sel = $('#cg-splash-load-select');\n        const optCount = $sel.length ? $sel.find('option').length : 0;\n        if ($sel.length && optCount <= 1) {\n          document.dispatchEvent(new CustomEvent('cg:characters:refresh', { detail: { source: 'splash-open' } }));\n        }\n      } catch (_) {}\n    });\n\n  // 3) Open blank builder (NEW CHARACTER) and purge previous state\n  $(document)\n    .off('click.cg', '#cg-new-splash')\n    .on('click.cg', '#cg-new-splash', e => {\n      e.preventDefault();\n\n      // Hide the splash\n      $('#cg-modal-splash').removeClass('visible').addClass('cg-hidden');\n\n      // Clear all builder state\n      BuilderUI.openBuilder({ isNew: true, payload: {} });\n\n      // Reset skill marks\n      FormBuilderAPI._data.skillMarks = {};\n\n      // Reset species/career\n      FormBuilderAPI._data.species = '';\n      FormBuilderAPI._data.career  = '';\n\n      // Reset gifts state\n      if (window.CG_FreeChoicesState) {\n        window.CG_FreeChoicesState.selected = ['', '', ''];\n      }\n\n      // NOTE: Do NOT hydrate here; openBuilder() activates a tab which triggers hydration once.\n    });\n\n  // 4) Load character by ID and launch builder\n  $(document)\n    .off('click.cg', '#cg-load-splash')\n    .on('click.cg', '#cg-load-splash', e => {\n      e.preventDefault();\n      const charId = $('#cg-splash-load-select').val();\n      if (!charId) {\n        alert('Please select a character to load.');\n        return;\n      }\n\n      FormBuilderAPI.fetchCharacter(charId)\n        .done(resp => {\n          console.log('\uD83D\uDD0E [AJAX] raw cg_get_character response:', resp);\n          const parsed = typeof resp === 'string' ? JSON.parse(resp) : resp;\n          console.log('\uD83D\uDD0D [AJAX] parsed.data:', parsed?.data);\n\n          const record = parsed?.data || parsed;\n          if (!record || !record.id) {\n            alert('Character could not be loaded.');\n            return;\n          }\n\n          // Hide the splash, open builder, and seed state from record\n          $('#cg-modal-splash').removeClass('visible').addClass('cg-hidden');\n\n          BuilderUI.openBuilder({ isNew: false, payload: record });\n\n          // Rehydrate lists and apply record selections AFTER options exist (avoids \u201Cempty change\u201D)\n          setTimeout(() => {\n            hydrateSpeciesAndCareer({ force: true, record });\n          }, 0);\n        })\n        .fail((xhr) => {\n          console.error('Load failed:', xhr?.responseText || xhr);\n          alert('Could not load character. Check console for details.');\n        });\n    });\n\n  // 5) Wire up Save & Load inside builder\n  bindLoadEvents();\n  bindSaveEvents();\n\n  // 6) Tab navigation \u2192 highlight panel + run refreshTab() and gently rehydrate lists\n  $(document)\n    .off('click.cg', '#cg-modal .cg-tabs li')\n    .on('click.cg', '#cg-modal .cg-tabs li', function(e) {\n      e.preventDefault();\n\n      const fromTab = $('#cg-modal .cg-tabs li.active').data('tab');\n      const tabName = $(this).data('tab');\n\n      $('#cg-modal .cg-tabs li').removeClass('active');\n      $(this).addClass('active');\n\n      $('.tab-panel').removeClass('active');\n      $(`#${tabName}`).addClass('active');\n\n      // Canonical tab-change hook for the upcoming tab restructure\n      emitTabChanged(fromTab, tabName);\n\n      refreshTab();\n\n      // Some tabs rebuild DOM; ensure selects remain populated (NO change trigger here)\n      setTimeout(() => {\n        hydrateSpeciesAndCareer({ force: false });\n      }, 0);\n    });\n\n  // 7a) Modal close (X)\n  $(document)\n    .off('click.cg', '#cg-modal-close')\n    .on('click.cg', '#cg-modal-close', e => {\n      e.preventDefault();\n      BuilderUI.showUnsaved();\n    });\n\n  // 7b) Modal overlay click\n  $(document)\n    .off('click.cg', '#cg-modal-overlay')\n    .on('click.cg', '#cg-modal-overlay', function(e) {\n      if (e.target !== this) return;\n      BuilderUI.showUnsaved();\n    });\n\n  // 7c) Prompt: Save & Exit\n  $(document)\n    .off('click.cg', '#unsaved-save')\n    .on('click.cg', '#unsaved-save', e => {\n      e.preventDefault();\n      console.log('[BuilderEvents] Prompt: SAVE & EXIT clicked');\n      FormBuilderAPI.save(true);\n    });\n\n  // 7d) Prompt: Exit Without Save\n  $(document)\n    .off('click.cg', '#unsaved-exit')\n    .on('click.cg', '#unsaved-exit', e => {\n      e.preventDefault();\n      BuilderUI.closeBuilder();\n    });\n\n  // 7e) Prompt: Cancel\n  $(document)\n    .off('click.cg', '#unsaved-cancel')\n    .on('click.cg', '#unsaved-cancel', e => {\n      e.preventDefault();\n      BuilderUI.hideUnsaved();\n    });\n\n  // 8) After saves trigger list refresh elsewhere, gently rehydrate here too\n  // IMPORTANT: avoid stacking native listeners on repeated bindUIEvents() calls.\n  try {\n    window.__CG_EVT__ = window.__CG_EVT__ || {};\n    if (window.__CG_EVT__.charactersRefreshEvents) {\n      document.removeEventListener('cg:characters:refresh', window.__CG_EVT__.charactersRefreshEvents);\n    }\n    window.__CG_EVT__.charactersRefreshEvents = onCharactersRefresh;\n    document.addEventListener('cg:characters:refresh', window.__CG_EVT__.charactersRefreshEvents);\n  } catch (_) {}\n}\n", "// assets/js/src/core/main/index.js\r\n\r\nimport bindUIEvents from './builder-events.js';\r\n\r\nconst MainAPI = {\r\n  init() {\r\n    console.log('[MainAPI] init() called');\r\n    // now bind all your UI events\r\n    bindUIEvents();\r\n  }\r\n};\r\n\r\nexport default MainAPI;\r\n", "import MainAPI from './main';\nimport SkillsModule from './skills/index.js';\nimport SpeciesAPI from './species/api.js';\n\nfunction cgGlobal() {\n  // Works in browsers and avoids ReferenceError in other contexts\n  if (typeof globalThis !== 'undefined') return globalThis;\n  if (typeof window !== 'undefined') return window;\n  return {};\n}\n\nconst G = cgGlobal();\n\nconst LOADS_KEY = '__CG_CORE_BUNDLE_LOADS__';\nconst BOOT_KEY = '__CG_CORE_BOOTED__';\nconst INITCORE_KEY = '__CG_INITCORE_RAN__';\n\n// Track bundle loads to detect double-enqueue quickly\nG[LOADS_KEY] = (G[LOADS_KEY] || 0) + 1;\nconsole.log(`[Core] bundle loaded (#${G[LOADS_KEY]})`);\n\nconst Core = {\n  init(reason = 'auto') {\n    const g = cgGlobal();\n    if (g[BOOT_KEY]) return;              // hard guard: only once per page\n    g[BOOT_KEY] = true;\n\n    console.log('[Core] init() called');\n\n    try {\n      MainAPI.init();\n    } catch (err) {\n      console.error('[Core] MainAPI.init() failed', err);\n      throw err;\n    }\n  }\n};\n\n// Boot once when DOM is ready (safe even if this file is evaluated twice)\nfunction bootOnce() {\n  Core.init('domready');\n}\n\nif (typeof document !== 'undefined') {\n  if (document.readyState === 'loading') {\n    document.addEventListener('DOMContentLoaded', bootOnce, { once: true });\n  } else {\n    bootOnce();\n  }\n}\n\n/**\n * Legacy / secondary entrypoint.\n * Safe to call repeatedly; will only run once.\n */\nexport default function initCore() {\n  const g = cgGlobal();\n  if (g[INITCORE_KEY]) return;\n  g[INITCORE_KEY] = true;\n\n  // Ensure Core/MainAPI is booted\n  Core.init('initCore');\n\n  // Any one-time binds / module inits that should only occur once\n  try { SkillsModule.init(); } catch (err) { console.error('[Core] SkillsModule.init() failed', err); }\n}\n\n// Debug handles (helpful in Console)\nif (typeof window !== 'undefined') {\n  window.SpeciesAPI = SpeciesAPI;\n  window.CG_Core = Core;\n  window.CG_initCore = initCore;\n}\n"],
  "mappings": "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",
  "names": ["log", "warn", "$", "ajaxEnv", "normalizeList", "preloadedList", "postJSON", "api_default", "$", "api_default", "giftId", "api_default", "$", "TRAITS", "$", "$", "ajaxEnv", "normalize3", "_a", "_b", "_c", "_d", "_e", "_f", "_g", "_h", "_i", "$", "$", "_bound", "li", "api_default", "_a", "$", "ajaxEnv", "normalizeCareerProfile", "escapeHtml", "giftId", "api_default", "api_default", "$", "$", "TYPES", "stripDiacritics", "canon", "normalizeList", "$", "state_default", "$", "log", "warn", "ALWAYS_ACQUIRED_GIFT_IDS", "getBuilderData", "owned", "ALWAYS_ACQUIRED_GIFT_IDS", "getBuilderData", "stripDiacritics", "canon", "TYPES", "state_default", "$", "W", "_", "fetch", "warn", "log", "others", "cgWin", "W", "$", "modalRoot", "stripDiacritics", "canon", "getAllGiftsList", "state_default", "sel", "Existing", "$", "api_default", "$", "isSkillsTabActive", "events_default", "$", "isSkillsTabActive", "events_default", "capitalize", "$", "TRAITS", "MARK_DIE", "api_default", "capitalize", "api_default", "$", "$", "LOG", "_inited", "$", "LOG", "WARN", "$", "LOG", "$", "LOG", "api_default"]
}
